(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Bs=!1;var xr=Array.isArray,di=Array.prototype.indexOf,vs=Array.from,mo=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,wo=Object.getOwnPropertyDescriptors,vi=Object.prototype,pi=Array.prototype,ps=Object.getPrototypeOf,qs=Object.isExtensible;function Dn(e){return typeof e=="function"}const bn=()=>{};function hi(e){return e()}function fr(e){for(var t=0;t<e.length;t++)e[t]()}const ft=2,xo=4,kr=8,hs=16,Nt=32,Sn=64,dr=128,st=256,vr=512,Ke=1024,It=2048,an=4096,At=8192,Sr=16384,gi=32768,Cr=65536,ko=1<<17,_i=1<<19,So=1<<20,es=1<<21,xt=Symbol("$state"),Co=Symbol("legacy props"),bi=Symbol("");function $o(e){return e===this.v}function gs(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function _s(e){return!gs(e,this.v)}function yi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function mi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function wi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function xi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ki(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Si(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ci(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function $i(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Cn=!1,Pi=!1;function Ei(){Cn=!0}const bs=1,ys=2,Po=4,Ai=8,Ri=16,Oi=1,Ti=2,Eo=4,Di=8,ji=16,Ao=1,Ni=2,We=Symbol(),Ii="http://www.w3.org/1999/xhtml",Mi="http://www.w3.org/2000/svg";function Ro(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let de=null;function Ws(e){de=e}function He(e,t=!1,n){var r=de={p:de,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Cn&&!t&&(de.l={s:null,u:null,r1:[],r2:yn(!1)}),ms(()=>{r.d=!0})}function Be(e){const t=de;if(t!==null){const a=t.e;if(a!==null){var n=ie,r=se;t.e=null;try{for(var s=0;s<a.length;s++){var o=a[s];Kt(o.effect),kt(o.reaction),Pn(o.fn)}}finally{Kt(n),kt(r)}}de=t.p,t.m=!0}return{}}function Qn(){return!Cn||de!==null&&de.l===null}function en(e,t){if(typeof e!="object"||e===null||xt in e)return e;const n=ps(e);if(n!==vi&&n!==pi)return e;var r=new Map,s=xr(e),o=Jt(0),a=se,c=l=>{var u=se;kt(a);var f;return f=l(),kt(u),f};return s&&r.set("length",Jt(e.length)),new Proxy(e,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Si();var d=r.get(u);return d===void 0?(d=c(()=>Jt(f.value)),r.set(u,d)):y(d,c(()=>en(f.value))),!0},deleteProperty(l,u){var f=r.get(u);if(f===void 0)u in l&&r.set(u,c(()=>Jt(We)));else{if(s&&typeof u=="string"){var d=r.get("length"),v=Number(u);Number.isInteger(v)&&v<d.v&&y(d,v)}y(f,We),Ks(o)}return!0},get(l,u,f){var g;if(u===xt)return e;var d=r.get(u),v=u in l;if(d===void 0&&(!v||(g=Wt(l,u))!=null&&g.writable)&&(d=c(()=>Jt(en(v?l[u]:We))),r.set(u,d)),d!==void 0){var _=i(d);return _===We?void 0:_}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var d=r.get(u);d&&(f.value=i(d))}else if(f===void 0){var v=r.get(u),_=v==null?void 0:v.v;if(v!==void 0&&_!==We)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return f},has(l,u){var _;if(u===xt)return!0;var f=r.get(u),d=f!==void 0&&f.v!==We||Reflect.has(l,u);if(f!==void 0||ie!==null&&(!d||(_=Wt(l,u))!=null&&_.writable)){f===void 0&&(f=c(()=>Jt(d?en(l[u]):We)),r.set(u,f));var v=i(f);if(v===We)return!1}return d},set(l,u,f,d){var x;var v=r.get(u),_=u in l;if(s&&u==="length")for(var g=f;g<v.v;g+=1){var m=r.get(g+"");m!==void 0?y(m,We):g in l&&(m=c(()=>Jt(We)),r.set(g+"",m))}v===void 0?(!_||(x=Wt(l,u))!=null&&x.writable)&&(v=c(()=>Jt(void 0)),y(v,c(()=>en(f))),r.set(u,v)):(_=v.v!==We,y(v,c(()=>en(f))));var w=Reflect.getOwnPropertyDescriptor(l,u);if(w!=null&&w.set&&w.set.call(d,f),!_){if(s&&typeof u=="string"){var O=r.get("length"),S=Number(u);Number.isInteger(S)&&S>=O.v&&y(O,S+1)}Ks(o)}return!0},ownKeys(l){i(o);var u=Reflect.ownKeys(l).filter(v=>{var _=r.get(v);return _===void 0||_.v!==We});for(var[f,d]of r)d.v!==We&&!(f in l)&&u.push(f);return u},setPrototypeOf(){Ci()}})}function Ks(e,t=1){y(e,e.v+t)}function Ys(e){try{if(e!==null&&typeof e=="object"&&xt in e)return e[xt]}catch{}return e}function Li(e,t){return Object.is(Ys(e),Ys(t))}const Jn=new Map;function yn(e,t){var n={f:0,v:e,reactions:null,equals:$o,rv:0,wv:0};return n}function Jt(e,t){const n=yn(e);return Yi(n),n}function N(e,t=!1){var r;const n=yn(e);return t||(n.equals=_s),Cn&&de!==null&&de.l!==null&&((r=de.l).s??(r.s=[])).push(n),n}function he(e,t){return y(e,et(()=>i(e))),t}function y(e,t,n=!1){se!==null&&!wt&&Qn()&&(se.f&(ft|hs))!==0&&!(Ve!=null&&Ve.includes(e))&&$i();let r=n?en(t):t;return Vn(e,r)}function Vn(e,t){if(!e.equals(t)){var n=e.v;er?Jn.set(e,t):Jn.set(e,n),e.v=t,e.wv=Ho(),Oo(e,It),Qn()&&ie!==null&&(ie.f&Ke)!==0&&(ie.f&(Nt|Sn))===0&&(nt===null?Qi([e]):nt.push(e))}return t}function Qs(e,t=1){var n=i(e),r=t===1?n++:n--;return y(e,n),r}function Oo(e,t){var n=e.reactions;if(n!==null)for(var r=Qn(),s=n.length,o=0;o<s;o++){var a=n[o],c=a.f;(c&It)===0&&(!r&&a===ie||(vt(a,t),(c&(Ke|st))!==0&&((c&ft)!==0?Oo(a,an):Or(a))))}}let Fi=!1;var Zs,To,Do,jo;function Gi(){if(Zs===void 0){Zs=window,To=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Do=Wt(t,"firstChild").get,jo=Wt(t,"nextSibling").get,qs(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),qs(n)&&(n.__t=void 0)}}function Zn(e=""){return document.createTextNode(e)}function Et(e){return Do.call(e)}function $r(e){return jo.call(e)}function h(e,t){return Et(e)}function fe(e,t){{var n=Et(e);return n instanceof Comment&&n.data===""?$r(n):n}}function p(e,t=1,n=!1){let r=e;for(;t--;)r=$r(r);return r}function Ui(e){e.textContent=""}function Hn(e){var t=ft|It,n=se!==null&&(se.f&ft)!==0?se:null;return ie===null||n!==null&&(n.f&st)!==0?t|=st:ie.f|=So,{ctx:de,deps:null,effects:null,equals:$o,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ie}}function dt(e){const t=Hn(e);return t.equals=_s,t}function No(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Ot(t[n])}}function zi(e){for(var t=e.parent;t!==null;){if((t.f&ft)===0)return t;t=t.parent}return null}function Ji(e){var t,n=ie;Kt(zi(e));try{No(e),t=qo(e)}finally{Kt(n)}return t}function Io(e){var t=Ji(e),n=(Bt||(e.f&st)!==0)&&e.deps!==null?an:Ke;vt(e,n),e.equals(t)||(e.v=t,e.wv=Ho())}function Mo(e){ie===null&&se===null&&wi(),se!==null&&(se.f&st)!==0&&ie===null&&mi(),er&&yi()}function Vi(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function $n(e,t,n,r=!0){var s=ie,o={ctx:de,deps:null,nodes_start:null,nodes_end:null,f:e|It,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Rr(o),o.f|=gi}catch(l){throw Ot(o),l}else t!==null&&Or(o);var a=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(So|dr))===0;if(!a&&r&&(s!==null&&Vi(o,s),se!==null&&(se.f&ft)!==0)){var c=se;(c.effects??(c.effects=[])).push(o)}return o}function ms(e){const t=$n(kr,null,!1);return vt(t,Ke),t.teardown=e,t}function ts(e){Mo();var t=ie!==null&&(ie.f&Nt)!==0&&de!==null&&!de.m;if(t){var n=de;(n.e??(n.e=[])).push({fn:e,effect:ie,reaction:se})}else{var r=Pn(e);return r}}function Hi(e){return Mo(),ln(e)}function Bi(e){const t=$n(Sn,e,!0);return(n={})=>new Promise(r=>{n.outro?Bn(t,()=>{Ot(t),r(void 0)}):(Ot(t),r(void 0))})}function Pn(e){return $n(xo,e,!1)}function ct(e,t){var n=de,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=ln(()=>{e(),!r.ran&&(r.ran=!0,y(n.l.r2,!0),et(t))})}function Xn(){var e=de;ln(()=>{if(i(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Ke)!==0&&vt(n,an),En(n)&&Rr(n),t.ran=!1}e.l.r2.v=!1}})}function ln(e){return $n(kr,e,!0)}function W(e,t=[],n=Hn){const r=t.map(n);return Pr(()=>e(...r.map(i)))}function Pr(e,t=0){return $n(kr|hs|t,e,!0)}function mn(e,t=!0){return $n(kr|Nt,e,!0,t)}function Lo(e){var t=e.teardown;if(t!==null){const n=er,r=se;eo(!0),kt(null);try{t.call(null)}finally{eo(n),kt(r)}}}function Fo(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&Sn)!==0?n.parent=null:Ot(n,t),n=r}}function qi(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Nt)===0&&Ot(t),t=n}}function Ot(e,t=!0){var n=!1;if((t||(e.f&_i)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:$r(r);r.remove(),r=o}n=!0}Fo(e,t&&!n),_r(e,0),vt(e,Sr);var a=e.transitions;if(a!==null)for(const l of a)l.stop();Lo(e);var c=e.parent;c!==null&&c.first!==null&&Go(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Go(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function Bn(e,t){var n=[];ws(e,n,!0),Uo(n,()=>{Ot(e),t&&t()})}function Uo(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function ws(e,t,n){if((e.f&At)===0){if(e.f^=At,e.transitions!==null)for(const a of e.transitions)(a.is_global||n)&&t.push(a);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&Cr)!==0||(r.f&Nt)!==0;ws(r,t,o?n:!1),r=s}}}function qn(e){zo(e,!0)}function zo(e,t){if((e.f&At)!==0){e.f^=At,(e.f&Ke)===0&&(e.f^=Ke),En(e)&&(vt(e,It),Or(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&Cr)!==0||(n.f&Nt)!==0;zo(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let Wn=[],ns=[];function Jo(){var e=Wn;Wn=[],fr(e)}function Wi(){var e=ns;ns=[],fr(e)}function Er(e){Wn.length===0&&queueMicrotask(Jo),Wn.push(e)}function Xs(){Wn.length>0&&Jo(),ns.length>0&&Wi()}let lr=!1,pr=!1,hr=null,tn=!1,er=!1;function eo(e){er=e}let Gn=[];let se=null,wt=!1;function kt(e){se=e}let ie=null;function Kt(e){ie=e}let Ve=null;function Ki(e){Ve=e}function Yi(e){se!==null&&se.f&es&&(Ve===null?Ki([e]):Ve.push(e))}let ze=null,Qe=0,nt=null;function Qi(e){nt=e}let Vo=1,gr=0,Bt=!1,Ht=null;function Ho(){return++Vo}function En(e){var d;var t=e.f;if((t&It)!==0)return!0;if((t&an)!==0){var n=e.deps,r=(t&st)!==0;if(n!==null){var s,o,a=(t&vr)!==0,c=r&&ie!==null&&!Bt,l=n.length;if(a||c){var u=e,f=u.parent;for(s=0;s<l;s++)o=n[s],(a||!((d=o==null?void 0:o.reactions)!=null&&d.includes(u)))&&(o.reactions??(o.reactions=[])).push(u);a&&(u.f^=vr),c&&f!==null&&(f.f&st)===0&&(u.f^=st)}for(s=0;s<l;s++)if(o=n[s],En(o)&&Io(o),o.wv>e.wv)return!0}(!r||ie!==null&&!Bt)&&vt(e,Ke)}return!1}function Zi(e,t){for(var n=t;n!==null;){if((n.f&dr)!==0)try{n.fn(e);return}catch{n.f^=dr}n=n.parent}throw lr=!1,e}function Xi(e){return(e.f&Sr)===0&&(e.parent===null||(e.parent.f&dr)===0)}function Ar(e,t,n,r){if(lr){if(n===null&&(lr=!1),Xi(t))throw e;return}n!==null&&(lr=!0);{Zi(e,t);return}}function Bo(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];Ve!=null&&Ve.includes(e)||((o.f&ft)!==0?Bo(o,t,!1):t===o&&(n?vt(o,It):(o.f&Ke)!==0&&vt(o,an),Or(o)))}}function qo(e){var _;var t=ze,n=Qe,r=nt,s=se,o=Bt,a=Ve,c=de,l=wt,u=e.f;ze=null,Qe=0,nt=null,Bt=(u&st)!==0&&(wt||!tn||se===null),se=(u&(Nt|Sn))===0?e:null,Ve=null,Ws(e.ctx),wt=!1,gr++,e.f|=es;try{var f=(0,e.fn)(),d=e.deps;if(ze!==null){var v;if(_r(e,Qe),d!==null&&Qe>0)for(d.length=Qe+ze.length,v=0;v<ze.length;v++)d[Qe+v]=ze[v];else e.deps=d=ze;if(!Bt)for(v=Qe;v<d.length;v++)((_=d[v]).reactions??(_.reactions=[])).push(e)}else d!==null&&Qe<d.length&&(_r(e,Qe),d.length=Qe);if(Qn()&&nt!==null&&!wt&&d!==null&&(e.f&(ft|an|It))===0)for(v=0;v<nt.length;v++)Bo(nt[v],e);return s!==null&&(gr++,nt!==null&&(r===null?r=nt:r.push(...nt))),f}finally{ze=t,Qe=n,nt=r,se=s,Bt=o,Ve=a,Ws(c),wt=l,e.f^=es}}function el(e,t){let n=t.reactions;if(n!==null){var r=di.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&ft)!==0&&(ze===null||!ze.includes(t))&&(vt(t,an),(t.f&(st|vr))===0&&(t.f^=vr),No(t),_r(t,0))}function _r(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)el(e,n[r])}function Rr(e){var t=e.f;if((t&Sr)===0){vt(e,Ke);var n=ie,r=de,s=tn;ie=e,tn=!0;try{(t&hs)!==0?qi(e):Fo(e),Lo(e);var o=qo(e);e.teardown=typeof o=="function"?o:null,e.wv=Vo;var a=e.deps,c;Bs&&Pi&&e.f&It}catch(l){Ar(l,e,n,r||e.ctx)}finally{tn=s,ie=n}}}function tl(){try{xi()}catch(e){if(hr!==null)Ar(e,hr,null);else throw e}}function Wo(){var e=tn;try{var t=0;for(tn=!0;Gn.length>0;){t++>1e3&&tl();var n=Gn,r=n.length;Gn=[];for(var s=0;s<r;s++){var o=rl(n[s]);nl(o)}}}finally{pr=!1,tn=e,hr=null,Jn.clear()}}function nl(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Sr|At))===0)try{En(r)&&(Rr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Go(r):r.fn=null))}catch(s){Ar(s,r,null,r.ctx)}}}function Or(e){pr||(pr=!0,queueMicrotask(Wo));for(var t=hr=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(Sn|Nt))!==0){if((n&Ke)===0)return;t.f^=Ke}}Gn.push(t)}function rl(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Nt|Sn))!==0,o=s&&(r&Ke)!==0;if(!o&&(r&At)===0){if((r&xo)!==0)t.push(n);else if(s)n.f^=Ke;else{var a=se;try{se=n,En(n)&&Rr(n)}catch(u){Ar(u,n,null,n.ctx)}finally{se=a}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function sl(e){var t;for(Xs();Gn.length>0;)pr=!0,Wo(),Xs();return t}async function ol(){await Promise.resolve(),sl()}function i(e){var t=e.f,n=(t&ft)!==0;if(Ht!==null&&Ht.add(e),se!==null&&!wt){if(!(Ve!=null&&Ve.includes(e))){var r=se.deps;e.rv<gr&&(e.rv=gr,ze===null&&r!==null&&r[Qe]===e?Qe++:ze===null?ze=[e]:(!Bt||!ze.includes(e))&&ze.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&st)===0&&(s.f^=st)}return n&&(s=e,En(s)&&Io(s)),er&&Jn.has(e)?Jn.get(e):e.v}function al(e){var t=Ht;Ht=new Set;var n=Ht,r;try{if(et(e),t!==null)for(r of Ht)t.add(r)}finally{Ht=t}return n}function rs(e){var t=al(()=>et(e));for(var n of t)if((n.f&ko)!==0)for(const r of n.deps||[])(r.f&ft)===0&&Vn(r,r.v);else Vn(n,n.v)}function et(e){var t=wt;try{return wt=!0,e()}finally{wt=t}}const il=-7169;function vt(e,t){e.f=e.f&il|t}function xs(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(xt in e)ss(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&xt in n&&ss(n)}}}function ss(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{ss(e[r],t)}catch{}const n=ps(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=wo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function ll(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const cl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function ul(e){return cl.includes(e)}const fl={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function dl(e){return e=e.toLowerCase(),fl[e]??e}const vl=["touchstart","touchmove"];function pl(e){return vl.includes(e)}function hl(e,t){if(t){const n=document.body;e.autofocus=!0,Er(()=>{document.activeElement===n&&e.focus()})}}let to=!1;function gl(){to||(to=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function Ko(e){var t=se,n=ie;kt(null),Kt(null);try{return e()}finally{kt(t),Kt(n)}}function ks(e,t,n,r=n){e.addEventListener(t,()=>Ko(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),gl()}const Yo=new Set,os=new Set;function Qo(e,t,n,r={}){function s(o){if(r.capture||Mn.call(t,o),!o.cancelBubble)return Ko(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Er(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function L(e,t,n,r,s){var o={capture:r,passive:s},a=Qo(e,t,n,o);(t===document.body||t===window||t===document)&&ms(()=>{t.removeEventListener(e,a,o)})}function _l(e){for(var t=0;t<e.length;t++)Yo.add(e[t]);for(var n of os)n(e)}function Mn(e){var S;var t=this,n=t.ownerDocument,r=e.type,s=((S=e.composedPath)==null?void 0:S.call(e))||[],o=s[0]||e.target,a=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var u=s.indexOf(t);if(u===-1)return;l<=u&&(a=l)}if(o=s[a]||e.target,o!==t){mo(e,"currentTarget",{configurable:!0,get(){return o||n}});var f=se,d=ie;kt(null),Kt(null);try{for(var v,_=[];o!==null;){var g=o.assignedSlot||o.parentNode||o.host||null;try{var m=o["__"+r];if(m!=null&&(!o.disabled||e.target===o))if(xr(m)){var[w,...O]=m;w.apply(o,[e,...O])}else m.call(o,e)}catch(x){v?_.push(x):v=x}if(e.cancelBubble||g===t||g===null)break;o=g}if(v){for(let x of _)queueMicrotask(()=>{throw x});throw v}}finally{e.__root=t,delete e.currentTarget,kt(f),Kt(d)}}}function Zo(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function sn(e,t){var n=ie;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function E(e,t){var n=(t&Ao)!==0,r=(t&Ni)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=Zo(o?e:"<!>"+e),n||(s=Et(s)));var a=r||To?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=Et(a),l=a.lastChild;sn(c,l)}else sn(a,a);return a}}function Xo(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Ao)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,a;return()=>{if(!a){var c=Zo(o),l=Et(c);if(s)for(a=document.createDocumentFragment();Et(l);)a.appendChild(Et(l));else a=Et(l)}var u=a.cloneNode(!0);if(s){var f=Et(u),d=u.lastChild;sn(f,d)}else sn(u,u);return u}}function Ie(e=""){{var t=Zn(e+"");return sn(t,t),t}}function $e(){var e=document.createDocumentFragment(),t=document.createComment(""),n=Zn();return e.append(t,n),sn(t,n),e}function b(e,t){e!==null&&e.before(t)}function B(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function bl(e,t){return yl(e,t)}const hn=new Map;function yl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:a=!0}){Gi();var c=new Set,l=d=>{for(var v=0;v<d.length;v++){var _=d[v];if(!c.has(_)){c.add(_);var g=pl(_);t.addEventListener(_,Mn,{passive:g});var m=hn.get(_);m===void 0?(document.addEventListener(_,Mn,{passive:g}),hn.set(_,1)):hn.set(_,m+1)}}};l(vs(Yo)),os.add(l);var u=void 0,f=Bi(()=>{var d=n??t.appendChild(Zn());return mn(()=>{if(o){He({});var v=de;v.c=o}s&&(r.$$events=s),u=e(d,r)||{},o&&Be()}),()=>{var g;for(var v of c){t.removeEventListener(v,Mn);var _=hn.get(v);--_===0?(document.removeEventListener(v,Mn),hn.delete(v)):hn.set(v,_)}os.delete(l),d!==n&&((g=d.parentNode)==null||g.removeChild(d))}});return ml.set(u,f),u}let ml=new WeakMap;function j(e,t,[n,r]=[0,0]){var s=e,o=null,a=null,c=We,l=n>0?Cr:0,u=!1;const f=(v,_=!0)=>{u=!0,d(_,v)},d=(v,_)=>{c!==(c=v)&&(c?(o?qn(o):_&&(o=mn(()=>_(s))),a&&Bn(a,()=>{a=null})):(a?qn(a):_&&(a=mn(()=>_(s,[n+1,r]))),o&&Bn(o,()=>{o=null})))};Pr(()=>{u=!1,t(f),u||d(null,null)},l)}function Kn(e,t){return t}function wl(e,t,n,r){for(var s=[],o=t.length,a=0;a<o;a++)ws(t[a].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;Ui(l),l.append(n),r.clear(),Vt(e,t[0].prev,t[o-1].next)}Uo(s,()=>{for(var u=0;u<o;u++){var f=t[u];c||(r.delete(f.k),Vt(e,f.prev,f.next)),Ot(f.e,!c)}})}function Tt(e,t,n,r,s,o=null){var a=e,c={flags:t,items:new Map,first:null},l=(t&Po)!==0;if(l){var u=e;a=u.appendChild(Zn())}var f=null,d=!1,v=dt(()=>{var _=n();return xr(_)?_:_==null?[]:vs(_)});Pr(()=>{var _=i(v),g=_.length;d&&g===0||(d=g===0,xl(_,c,a,s,t,r,n),o!==null&&(g===0?f?qn(f):f=mn(()=>o(a)):f!==null&&Bn(f,()=>{f=null})),i(v))})}function xl(e,t,n,r,s,o,a){var be,xe,ye,U;var c=(s&Ai)!==0,l=(s&(bs|ys))!==0,u=e.length,f=t.items,d=t.first,v=d,_,g=null,m,w=[],O=[],S,x,P,D;if(c)for(D=0;D<u;D+=1)S=e[D],x=o(S,D),P=f.get(x),P!==void 0&&((be=P.a)==null||be.measure(),(m??(m=new Set)).add(P));for(D=0;D<u;D+=1){if(S=e[D],x=o(S,D),P=f.get(x),P===void 0){var z=v?v.e.nodes_start:n;g=Sl(z,t,g,g===null?t.first:g.next,S,x,D,r,s,a),f.set(x,g),w=[],O=[],v=g.next;continue}if(l&&kl(P,S,D,s),(P.e.f&At)!==0&&(qn(P.e),c&&((xe=P.a)==null||xe.unfix(),(m??(m=new Set)).delete(P))),P!==v){if(_!==void 0&&_.has(P)){if(w.length<O.length){var J=O[0],I;g=J.prev;var Y=w[0],le=w[w.length-1];for(I=0;I<w.length;I+=1)no(w[I],J,n);for(I=0;I<O.length;I+=1)_.delete(O[I]);Vt(t,Y.prev,le.next),Vt(t,g,Y),Vt(t,le,J),v=J,g=le,D-=1,w=[],O=[]}else _.delete(P),no(P,v,n),Vt(t,P.prev,P.next),Vt(t,P,g===null?t.first:g.next),Vt(t,g,P),g=P;continue}for(w=[],O=[];v!==null&&v.k!==x;)(v.e.f&At)===0&&(_??(_=new Set)).add(v),O.push(v),v=v.next;if(v===null)continue;P=v}w.push(P),g=P,v=P.next}if(v!==null||_!==void 0){for(var _e=_===void 0?[]:vs(_);v!==null;)(v.e.f&At)===0&&_e.push(v),v=v.next;var we=_e.length;if(we>0){var ve=(s&Po)!==0&&u===0?n:null;if(c){for(D=0;D<we;D+=1)(ye=_e[D].a)==null||ye.measure();for(D=0;D<we;D+=1)(U=_e[D].a)==null||U.fix()}wl(t,_e,ve,f)}}c&&Er(()=>{var ee;if(m!==void 0)for(P of m)(ee=P.a)==null||ee.apply()}),ie.first=t.first&&t.first.e,ie.last=g&&g.e}function kl(e,t,n,r){(r&bs)!==0&&Vn(e.v,t),(r&ys)!==0?Vn(e.i,n):e.i=n}function Sl(e,t,n,r,s,o,a,c,l,u){var f=(l&bs)!==0,d=(l&Ri)===0,v=f?d?N(s):yn(s):s,_=(l&ys)===0?a:yn(a),g={i:_,v,k:o,a:null,e:null,prev:n,next:r};try{return g.e=mn(()=>c(e,v,_,u),Fi),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?t.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function no(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var a=$r(o);s.before(o),o=a}}function Vt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Mt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],a=!1;o===!0&&(o=t.children,a=!0),o===void 0||o(e,a?()=>r:r)}function Cl(e,t,n,r,s,o){var a,c,l=null,u=e,f;Pr(()=>{const d=t()||null;var v=Mi;d!==a&&(f&&(d===null?Bn(f,()=>{f=null,c=null}):d===c?qn(f):Ot(f)),d&&d!==c&&(f=mn(()=>{if(l=document.createElementNS(v,d),sn(l,l),r){var _=l.appendChild(Zn());r(l,_)}ie.nodes_end=l,u.before(l)})),a=d,a&&(c=a))},Cr)}function $l(e,t,n){Pn(()=>{var r=et(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};ln(()=>{var a=n();xs(a),s&&gs(o,a)&&(o=a,r.update(a))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function ea(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=ea(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Pl(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=ea(e))&&(r&&(r+=" "),r+=t);return r}function El(e){return typeof e=="object"?Pl(e):e??""}const ro=[...` 	
\r\f \v\uFEFF`];function Al(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,a=0;(a=r.indexOf(s,a))>=0;){var c=a+o;(a===0||ro.includes(r[a-1]))&&(c===r.length||ro.includes(r[c]))?r=(a===0?"":r.substring(0,a))+r.substring(c+1):a=c}}return r===""?null:r}function so(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function Br(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Rl(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(Br)),s&&l.push(...Object.keys(s).map(Br));var u=0,f=-1;const m=e.length;for(var d=0;d<m;d++){var v=e[d];if(c?v==="/"&&e[d-1]==="*"&&(c=!1):o?o===v&&(o=!1):v==="/"&&e[d+1]==="*"?c=!0:v==='"'||v==="'"?o=v:v==="("?a++:v===")"&&a--,!c&&o===!1&&a===0){if(v===":"&&f===-1)f=d;else if(v===";"||d===m-1){if(f!==-1){var _=Br(e.substring(u,f).trim());if(!l.includes(_)){v!==";"&&d++;var g=e.substring(u,d).trim();n+=" "+g+";"}}u=d+1,f=-1}}}}return r&&(n+=so(r)),s&&(n+=so(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function wn(e,t,n,r,s,o){var a=e.__className;if(a!==n){var c=Al(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var u=!!o[l];(s==null||u!==!!s[l])&&e.classList.toggle(l,u)}return o}function qr(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function ta(e,t,n,r){var s=e.__style;if(s!==t){var o=Rl(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(qr(e,n==null?void 0:n[0],r[0]),qr(e,n==null?void 0:n[1],r[1],"important")):qr(e,n,r));return r}const jn=Symbol("class"),Nn=Symbol("style"),na=Symbol("is custom element"),ra=Symbol("is html");function Ol(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function qt(e,t,n,r){var s=sa(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[bi]=n),n==null?e.removeAttribute(t):typeof n!="string"&&oa(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function oo(e,t,n,r,s=!1){var o=sa(e),a=o[na],c=!o[ra],l=t||{},u=e.tagName==="OPTION";for(var f in t)f in n||(n[f]=null);n.class?n.class=El(n.class):n[jn]&&(n.class=null),n[Nn]&&(n.style??(n.style=null));var d=oa(e);for(const x in n){let P=n[x];if(u&&x==="value"&&P==null){e.value=e.__value="",l[x]=P;continue}if(x==="class"){var v=e.namespaceURI==="http://www.w3.org/1999/xhtml";wn(e,v,P,r,t==null?void 0:t[jn],n[jn]),l[x]=P,l[jn]=n[jn];continue}if(x==="style"){ta(e,P,t==null?void 0:t[Nn],n[Nn]),l[x]=P,l[Nn]=n[Nn];continue}var _=l[x];if(P!==_){l[x]=P;var g=x[0]+x[1];if(g!=="$$")if(g==="on"){const D={},z="$$"+x;let J=x.slice(2);var m=ul(J);if(ll(J)&&(J=J.slice(0,-7),D.capture=!0),!m&&_){if(P!=null)continue;e.removeEventListener(J,l[z],D),l[z]=null}if(P!=null)if(m)e[`__${J}`]=P,_l([J]);else{let I=function(Y){l[x].call(this,Y)};var S=I;l[z]=Qo(J,e,I,D)}else m&&(e[`__${J}`]=void 0)}else if(x==="style")qt(e,x,P);else if(x==="autofocus")hl(e,!!P);else if(!a&&(x==="__value"||x==="value"&&P!=null))e.value=e.__value=P;else if(x==="selected"&&u)Ol(e,P);else{var w=x;c||(w=dl(w));var O=w==="defaultValue"||w==="defaultChecked";if(P==null&&!a&&!O)if(o[x]=null,w==="value"||w==="checked"){let D=e;const z=t===void 0;if(w==="value"){let J=D.defaultValue;D.removeAttribute(w),D.defaultValue=J,D.value=D.__value=z?J:null}else{let J=D.defaultChecked;D.removeAttribute(w),D.defaultChecked=J,D.checked=z?J:!1}}else e.removeAttribute(x);else O||d.includes(w)&&(a||typeof P!="string")?e[w]=P:typeof P!="function"&&qt(e,w,P)}}}return l}function sa(e){return e.__attributes??(e.__attributes={[na]:e.nodeName.includes("-"),[ra]:e.namespaceURI===Ii})}var ao=new Map;function oa(e){var t=ao.get(e.nodeName);if(t)return t;ao.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=wo(r);for(var o in n)n[o].set&&t.push(o);r=ps(r)}return t}function Ze(e,t,n=t){var r=Qn();ks(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=Wr(e)?Kr(o):o,n(o),r&&o!==(o=t())){var a=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=a,e.selectionEnd=Math.min(c,e.value.length))}}),et(t)==null&&e.value&&n(Wr(e)?Kr(e.value):e.value),ln(()=>{var s=t();Wr(e)&&s===Kr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function or(e,t,n=t){ks(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),et(t)==null&&n(e.checked),ln(()=>{var r=t();e.checked=!!r})}function Wr(e){var t=e.type;return t==="number"||t==="range"}function Kr(e){return e===""?null:+e}function aa(e,t,n){if(e.multiple)return Dl(e,t);for(var r of e.options){var s=Un(r);if(Li(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Tl(e,t){Pn(()=>{var n=new MutationObserver(()=>{var r=e.__value;aa(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function as(e,t,n=t){var r=!0;ks(e,"change",s=>{var o=s?"[selected]":":checked",a;if(e.multiple)a=[].map.call(e.querySelectorAll(o),Un);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");a=c&&Un(c)}n(a)}),Pn(()=>{var s=t();if(aa(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=Un(o),n(s))}e.__value=s,r=!1}),Tl(e)}function Dl(e,t){for(var n of e.options)n.selected=~t.indexOf(Un(n))}function Un(e){return"__value"in e?e.__value:e.value}function io(e,t){return e===t||(e==null?void 0:e[xt])===t}function Ln(e={},t,n,r){return Pn(()=>{var s,o;return ln(()=>{s=o,o=[],et(()=>{e!==n(...o)&&(t(e,...o),s&&io(n(...s),e)&&t(null,...s))})}),()=>{Er(()=>{o&&io(n(...o),e)&&t(null,...o)})}}),e}function jl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ye(e=!1){const t=de,n=t.l.u;if(!n)return;let r=()=>xs(t.s);if(e){let s=0,o={};const a=Hn(()=>{let c=!1;const l=t.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&s++,s});r=()=>i(a)}n.b.length&&Hi(()=>{lo(t,r),fr(n.b)}),ts(()=>{const s=et(()=>n.m.map(hi));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&ts(()=>{lo(t,r),fr(n.a)})}function lo(e,t){if(e.l.s)for(const n of e.l.s)i(n);t()}function ia(e,t,n){if(e==null)return t(void 0),bn;const r=et(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const gn=[];function at(e,t=bn){let n=null;const r=new Set;function s(c){if(gs(e,c)&&(e=c,n)){const l=!gn.length;for(const u of r)u[1](),gn.push(u,e);if(l){for(let u=0;u<gn.length;u+=2)gn[u][0](gn[u+1]);gn.length=0}}}function o(c){s(c(e))}function a(c,l=bn){const u=[c,l];return r.add(u),r.size===1&&(n=t(s,o)||bn),c(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:a}}function Me(e){let t;return ia(e,n=>t=n)(),t}let ar=!1,is=Symbol();function on(e,t,n){const r=n[t]??(n[t]={store:null,source:N(void 0),unsubscribe:bn});if(r.store!==e&&!(is in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=bn;else{var s=!0;r.unsubscribe=ia(e,o=>{s?r.source.v=o:y(r.source,o)}),s=!1}return e&&is in n?Me(e):i(r.source)}function Tr(){const e={};function t(){ms(()=>{for(var n in e)e[n].unsubscribe();mo(e,is,{enumerable:!1,value:!0})})}return[e,t]}function Nl(e){var t=ar;try{return ar=!1,[e(),ar]}finally{ar=t}}const Il={get(e,t){if(!e.exclude.includes(t))return i(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=Xe({get[t](){return e.props[t]}},t,Eo)),e.special[t](n),Qs(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),Qs(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function Dt(e,t){return new Proxy({props:e,exclude:t,special:{},version:yn(0)},Il)}const Ml={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];Dn(s)&&(s=s());const o=Wt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Wt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===xt||t===Co)return!1;for(let n of e.props)if(Dn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Dn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function cn(...e){return new Proxy({props:e},Ml)}function co(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function Xe(e,t,n,r){var J;var s=(n&Oi)!==0,o=!Cn||(n&Ti)!==0,a=(n&Di)!==0,c=(n&ji)!==0,l=!1,u;a?[u,l]=Nl(()=>e[t]):u=e[t];var f=xt in e||Co in e,d=a&&(((J=Wt(e,t))==null?void 0:J.set)??(f&&t in e&&(I=>e[t]=I)))||void 0,v=r,_=!0,g=!1,m=()=>(g=!0,_&&(_=!1,c?v=et(r):v=r),v);u===void 0&&r!==void 0&&(d&&o&&ki(),u=m(),d&&d(u));var w;if(o)w=()=>{var I=e[t];return I===void 0?m():(_=!0,g=!1,I)};else{var O=(s?Hn:dt)(()=>e[t]);O.f|=ko,w=()=>{var I=i(O);return I!==void 0&&(v=void 0),I===void 0?v:I}}if((n&Eo)===0)return w;if(d){var S=e.$$legacy;return function(I,Y){return arguments.length>0?((!o||!Y||S||l)&&d(Y?w():I),I):w()}}var x=!1,P=!1,D=N(u),z=Hn(()=>{var I=w(),Y=i(D);return x?(x=!1,P=!0,Y):(P=!1,D.v=I)});return a&&i(z),s||(z.equals=_s),function(I,Y){if(Ht!==null&&(x=P,w(),i(D)),arguments.length>0){const le=Y?i(z):o&&a?en(I):I;if(!z.equals(le)){if(x=!0,y(D,le),g&&v!==void 0&&(v=le),co(z))return I;et(()=>i(z))}return I}return co(z)?z.v:i(z)}}function Dr(e){de===null&&Ro(),Cn&&de.l!==null?Gl(de).m.push(e):ts(()=>{const t=et(e);if(typeof t=="function")return t})}function Ll(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function Fl(){const e=de;return e===null&&Ro(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const a=xr(s)?s.slice():[s],c=Ll(t,n,r);for(const l of a)l.call(e.x,c);return!c.defaultPrevented}return!0}}function Gl(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const Ul="5";var yo;typeof window<"u"&&((yo=window.__svelte??(window.__svelte={})).v??(yo.v=new Set)).add(Ul);Ei();const Rt=at({isLoggedIn:!1,token:null,user:null});function Yr(){Rt.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const rt=at("home"),jr=at(null),De=at({phase:"streaming",paused:!1,loadedCount:0,totalCount:null}),zl="modulepreload",Jl=function(e){return"/skygit/"+e},uo={},xn=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=Jl(l),l in uo)return;uo[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":zl,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((v,_)=>{d.addEventListener("load",v),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function la(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function ls(e,t){const n=await la(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+a.byteLength);return c.set(r,0),c.set(new Uint8Array(a),r.byteLength),btoa(String.fromCharCode(...c))}async function Ss(e,t){const n=Uint8Array.from(atob(t),u=>u.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await la(e),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(a);return JSON.parse(l)}const Vl="https://api.github.com",Hl="skygit-config";function ca(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}async function pt(e){const t=await fetch(`${Vl}/user`,{headers:ca(e)});if(!t.ok)throw new Error("Failed to fetch GitHub user");return(await t.json()).login}async function ua(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${Hl}`,{headers:ca(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function fa(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},a=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:a})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function Nr(e,t){const n=await pt(e),r=`repositories/${t.owner}-${t.name}.json`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));let a=null;const c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:s});c.ok&&(a=(await c.json()).sha);const l={message:`Update repo ${t.full_name}`,content:o};a&&(l.sha=a);const u=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"PUT",headers:s,body:JSON.stringify(l)});if(!u.ok){const f=await u.text();throw new Error(`GitHub commit failed: ${f}`)}}async function Cs(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){De.set({phase:"idle",loadedCount:0,totalCount:0,paused:!1});return}if(!s.ok){const c=await s.text();throw new Error(`Failed to load repository list: ${c}`)}const a=(await s.json()).filter(c=>c.name.endsWith(".json"));De.set({phase:"streaming",loadedCount:0,totalCount:a.length,paused:!1});for(const c of a){let l=!1;if(De.subscribe(u=>l=u.paused)(),l)break;try{const u=await fetch(c.url,{headers:r});if(!u.ok){console.warn(`[SkyGit] Skipped missing repo file: ${c.name} (${u.status})`);continue}const f=await u.json(),d=atob(f.content),v=JSON.parse(d);ya([v]),De.update(_=>({..._,loadedCount:_.loadedCount+1}))}catch(u){console.warn(`[SkyGit] Skipped malformed repo file: ${c.name}`,u);continue}}De.update(c=>({...c,phase:"idle"}))}async function da(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const a=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of a){const u=await fetch(l.url,{headers:r});if(!u.ok)continue;const f=await u.json(),d=JSON.parse(atob(f.content));c.push(d)}return c}async function va(e,t){const n=await pt(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),a=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!a.ok){const c=await a.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function pa(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),a=`https://api.github.com/repos/${t.full_name}/contents/.messages/config.json`;let c=null;try{const u=await fetch(a,{headers:n});if(u.ok)c=(await u.json()).sha;else if(u.status!==404){const f=await u.text();throw new Error(`Failed to check if config.json exists: ${f}`)}}catch(u){console.warn("Error checking for config.json",u)}const l=await fetch(a,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:s,...c&&{sha:c}})});if(!l.ok){const u=await l.text();throw new Error(`Failed to commit config.json: ${u}`)}t.has_messages=!0,t.config=r,await Nr(e,t)}async function ha(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),a=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let c=null;a.ok&&(c=(await a.json()).sha);const l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:o,...c&&{sha:c}})});if(!l.ok){const f=await l.text();throw new Error(`Failed to update config.json: ${f}`)}const{commitRepoToGitHub:u}=await xn(async()=>{const{commitRepoToGitHub:f}=await Promise.resolve().then(()=>Bl);return{commitRepoToGitHub:f}},void 0);await u(e,t)}async function Ir(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function zn(e,t,n=null){const s=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const u=await l.text();throw new Error(`Failed to check secrets.json: ${u}`)}}const a={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(a)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function ga(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials,s=await ls(e,r),{secrets:o,sha:a}=await Ir(e);o[n]=s,await zn(e,o,a)}const Bl=Object.freeze(Object.defineProperty({__proto__:null,activateMessagingForRepo:pa,checkSkyGitRepoExists:ua,commitRepoToGitHub:Nr,createSkyGitRepo:fa,deleteRepoFromGitHub:va,getGitHubUsername:pt,getSecretsMap:Ir,saveSecretsMap:zn,storeEncryptedCredentials:ga,streamPersistedConversationsFromGitHub:da,streamPersistedReposFromGitHub:Cs,updateRepoMessagingConfig:ha},Symbol.toStringTag,{value:"Module"})),_a="skygit_repos",ql=5*60*1e3,Wl=10;let nn=[],br=null;const Kl=JSON.parse(localStorage.getItem(_a)||"[]"),jt=at(Kl),$s=at(0),Ps=at(null);jt.subscribe(e=>{localStorage.setItem(_a,JSON.stringify(e))});function ba(e){if(jt.update(n=>n.some(s=>s.full_name===e.full_name)?n:[...n,e]),nn.some(n=>n.full_name===e.full_name)||nn.push(e),nn.length>=Wl){yr();return}br||(br=setTimeout(yr,ql))}async function yr(){if(nn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...nn];nn=[],clearTimeout(br),br=null;for(const n of t)try{await Nr(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function ya(e){jt.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function ma(){return nn.length>0}function wa(e){let t;return jt.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const fo=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:$s,flushRepoCommitQueue:yr,getRepoByFullName:wa,hasPendingRepoCommits:ma,queueRepoForCommit:ba,repoList:jt,selectedRepo:Ps,syncRepoListFromGitHub:ya},Symbol.toStringTag,{value:"Module"}));async function Yl(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function Ql(e){localStorage.setItem("skygit_token",e)}function Zl(){return localStorage.getItem("skygit_token")}const xa="skygit_conversations",Xl=JSON.parse(localStorage.getItem(xa)||"{}"),An=at(Xl),Es=at(null);An.subscribe(e=>{localStorage.setItem(xa,JSON.stringify(e))});function cs(e,t){An.update(n=>({...n,[e]:t}))}function ec(e,t){An.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function ka(e,t,n){An.update(r=>{const o=(r[t]||[]).map(a=>a.id===e?{...a,messages:[...a.messages||[],n],updatedAt:n.timestamp||Date.now()}:a);return{...r,[t]:o}}),Es.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Oe=[];for(let e=0;e<256;++e)Oe.push((e+256).toString(16).slice(1));function tc(e,t=0){return(Oe[e[t+0]]+Oe[e[t+1]]+Oe[e[t+2]]+Oe[e[t+3]]+"-"+Oe[e[t+4]]+Oe[e[t+5]]+"-"+Oe[e[t+6]]+Oe[e[t+7]]+"-"+Oe[e[t+8]]+Oe[e[t+9]]+"-"+Oe[e[t+10]]+Oe[e[t+11]]+Oe[e[t+12]]+Oe[e[t+13]]+Oe[e[t+14]]+Oe[e[t+15]]).toLowerCase()}let Qr;const nc=new Uint8Array(16);function rc(){if(!Qr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Qr=crypto.getRandomValues.bind(crypto)}return Qr(nc)}const sc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vo={randomUUID:sc};function oc(e,t,n){var s;if(vo.randomUUID&&!e)return vo.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??rc();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tc(r)}async function ac(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const a=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));cs(t.full_name,a),t.conversations=a.map(c=>c.id),await Nr(e,t)}async function Sa(e,t){console.log("[SkyGit] 📝 commitToSkyGitConversations() called"),console.log("⏩ Payload:",t);const n=await pt(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,a=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:a})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function ic(e,t,n){console.log("[SkyGit] 🔧 createConversation called for:",t.full_name,"with title:",n),await pt(e);const r=oc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,a={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(a)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const f=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${f}`)}try{console.log("[SkyGit] 📤 Now committing to skygit-config..."),await Sa(e,a)}catch(f){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",f)}const u={id:r,name:s,path:o,repo:t.full_name,title:n};ec(u,t)}const Fn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let cr=!1;function lc(){cr=!0}async function us(e){cr=!1;const t=new Set,n=JSON.parse(localStorage.getItem("skygit_repos")||"[]").map(a=>a.full_name),r=[],s=await Zr("https://api.github.com/user/repos",Fn(e));r.push(...s),De.update(a=>({...a,totalCount:r.length}));const o=await Zr("https://api.github.com/user/orgs",Fn(e));for(const a of o){if(cr)return;const c=await Zr(`https://api.github.com/orgs/${a.login}/repos`,Fn(e));r.push(...c),De.update(l=>({...l,totalCount:r.length}))}for(const a of r){if(cr)return;const c=a.full_name;if(t.has(c)||n.includes(c)){De.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(c);const l=await cc(e,c),u=typeof a.has_discussions=="boolean"?a.has_discussions:!1,f={name:a.name,owner:a.owner.login,full_name:c,url:a.html_url,private:a.private,has_messages:l,has_discussions:u,config:null};if(f.has_discussions)try{const d=await fetch(`https://api.github.com/repos/${c}/contents/.messages/config.json`,{headers:Fn(e)});if(d.ok){const v=await d.json();f.config=JSON.parse(atob(v.content)),await ac(e,f)}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${c}`,d)}De.update(d=>({...d,loadedCount:d.loadedCount+1})),ba(f)}De.update(a=>({...a,phase:"idle"}))}async function Zr(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),a=await o.json();o.ok&&Array.isArray(a)?(n=n.concat(a),s=a.length<100,r++):s=!0}return n}async function cc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Fn(e)})).status===200}catch{return!1}}const fs=at({config:null,secrets:{},secretsSha:null});async function uc(e){const t=await pt(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)cs(o,s[o]);console.log("[SkyGit] ✅ Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const a=JSON.parse(atob(o.content)),c={};for(const[l,u]of Object.entries(a))try{c[l]=await Ss(e,u)}catch(f){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,f)}r.secrets=c,r.secretsSha=o.sha}catch(a){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",a),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}fs.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await Cs(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await da(e)||[],o={};for(const a of s)o[a.repo]||(o[a.repo]=[]),o[a.repo].push({id:a.id,title:a.title,name:`${a.repo.replace(/\W+/g,"_")}_${a.title.replace(/\W+/g,"_")}.json`,path:`.messages/${a.repo.replace(/\W+/g,"_")}_${a.title.replace(/\W+/g,"_")}.json`,repo:a.repo});for(const a in o)cs(a,o[a])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let Yn=new Set,ur=new Map;const fc=10;function As(e,t){const n=`${e}::${t}`;if(Yn.add(n),Yn.size>=fc){mr();return}const r=dc(e);if(!ur.has(n)){const s=setTimeout(()=>{mr([n]),ur.delete(n)},r);ur.set(n,s)}}function dc(e){var s;const n=Me(jt).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function mr(e=null){const t=e||Array.from(Yn);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await pt(n);const r=Me(An);for(const s of t){Yn.delete(s),ur.delete(s);const[o,a]=s.split("::"),l=(r[o]||[]).find(f=>f.id===a);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const u={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await Sa(n,u);const f=`.messages/conversation-${u.id}.json`,d=btoa(JSON.stringify(u,null,2)),v=await fetch(`https://api.github.com/repos/${o}/contents/${f}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${u.id}`,content:d})});if(!v.ok){const _=await v.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(f){console.error("[SkyGit] Conversation commit failed:",f)}}}function Ca(){return Yn.size>0}const Rs=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:mr,hasPendingConversationCommits:Ca,queueConversationForCommit:As},Symbol.toStringTag,{value:"Module"}));var vc=E('<p class="text-red-500 text-sm"> </p>'),pc=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticating…',1),hc=E('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Don’t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function gc(e,t){He(t,!1);let n=Xe(t,"onSubmit",8),r=Xe(t,"error",8,null),s=N(""),o=N(!1);async function a(){i(o)||(y(o,!0),await n()(i(s)),y(o,!1))}Ye();var c=hc(),l=p(h(c),2),u=p(l,2);{var f=m=>{var w=vc(),O=h(w);W(()=>B(O,r())),b(m,w)};j(u,m=>{r()&&m(f)})}var d=p(u,2),v=h(d);{var _=m=>{var w=pc();b(m,w)},g=m=>{var w=Ie("Authenticate");b(m,w)};j(v,m=>{i(o)?m(_):m(g,!1)})}W(()=>{l.disabled=i(o),d.disabled=i(o)}),Ze(l,()=>i(s),m=>y(s,m)),L("click",d,a),b(e,c),Be()}var _c=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),bc=E('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function yc(e,t){He(t,!1);let n=Xe(t,"onApprove",8),r=Xe(t,"onReject",8),s=N(!1);async function o(){i(s)||(y(s,!0),await n()(),y(s,!1))}Ye();var a=bc(),c=p(h(a),6),l=h(c),u=h(l);{var f=_=>{var g=_c();b(_,g)},d=_=>{var g=Ie("I Accept");b(_,g)};j(u,_=>{i(s)?_(f):_(d,!1)})}var v=p(l,2);W(()=>{l.disabled=i(s),v.disabled=i(s)}),L("click",l,o),L("click",v,function(..._){var g;(g=r())==null||g.apply(this,_)}),b(e,a),Be()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const mc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var wc=Xo("<svg><!><!></svg>");function un(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]),r=Dt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);He(t,!1);let s=Xe(t,"name",8,void 0),o=Xe(t,"color",8,"currentColor"),a=Xe(t,"size",8,24),c=Xe(t,"strokeWidth",8,2),l=Xe(t,"absoluteStrokeWidth",8,!1),u=Xe(t,"iconNode",24,()=>[]);const f=(...m)=>m.filter((w,O,S)=>!!w&&S.indexOf(w)===O).join(" ");Ye();var d=wc();let v;var _=h(d);Tt(_,1,u,Kn,(m,w)=>{let O=()=>i(w)[0],S=()=>i(w)[1];var x=$e(),P=fe(x);Cl(P,O,!0,(D,z)=>{let J;W(()=>J=oo(D,J,{...S()}))}),b(m,x)});var g=p(_);Mt(g,t,"default",{}),W((m,w)=>v=oo(d,v,{...mc,...r,width:a(),height:a(),stroke:o(),"stroke-width":m,class:w}),[()=>l()?Number(c())*24/Number(a()):c(),()=>f("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],dt),b(e,d),Be()}function xc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function kc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function po(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function Sc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function Cc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function $c(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function Pc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var a=$e(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}var Ec=E('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),Ac=E('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),Rc=E('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></button>'),Oc=E('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),Tc=E('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function Dc(e,t){He(t,!1);const n=N();let r=N({});An.subscribe(u=>y(r,u));function s(u){jr.set(u),Es.set(u),rt.set("chats")}ct(()=>i(r),()=>{y(n,Object.values(i(r)).flat().sort((u,f)=>{const d=new Date(u.updatedAt||u.createdAt||0).getTime();return new Date(f.updatedAt||f.createdAt||0).getTime()-d}))}),Xn(),Ye();var o=Tc(),a=h(o);Tt(a,1,()=>i(n),u=>u.id,(u,f)=>{var d=Rc(),v=h(d),_=h(v),g=p(v,2),m=h(g),w=p(g,2);{var O=x=>{var P=Ec(),D=h(P);W(z=>B(D,z),[()=>i(f).messages.at(-1).content],dt),b(x,P)},S=x=>{var P=Ac();b(x,P)};j(w,x=>{i(f).messages&&i(f).messages.length>0?x(O):x(S,!1)})}W(x=>{B(_,x),B(m,i(f).repo)},[()=>i(f).title||`Conversation ${i(f).id.slice(0,6)}`],dt),L("click",d,()=>s(i(f))),b(u,d)});var c=p(a,2);{var l=u=>{var f=Oc();b(u,f)};j(c,u=>{i(n).length===0&&u(l)})}b(e,o),Be()}var jc=E('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),Nc=E('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),Ic=E('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">✔️ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">🔄 Sync</button> <button class="text-blue-600 text-xs underline">🔍 Discover</button></div></div>'),Mc=E('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),Lc=E('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),Fc=E('<ul class="space-y-2"></ul>'),Gc=E('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),Uc=E('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),zc=E('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> 🔒 Private</label> <label><input type="checkbox"> 🌐 Public</label> <label><input type="checkbox"> 💬 With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function Jc(e,t){He(t,!1);const n=N(),r=N();let s=Xe(t,"search",8,""),o=N([]),a=N(),c=N(),l=N(!0),u=N(!0),f=N(!0),d=N(!0);jt.subscribe(C=>y(o,C)),De.subscribe(C=>y(a,C));function v(){De.update(C=>({...C,paused:!C.paused}))}function _(){if(i(a).paused){De.update(T=>({...T,paused:!1}));const C=localStorage.getItem("skygit_token");C&&us(C)}else lc(),De.update(C=>({...C,paused:!0}))}async function g(C){const T=i(o).find(H=>H.full_name===C);if(T){jt.update(H=>H.filter(K=>K.full_name!==C));try{const H=localStorage.getItem("skygit_token");await va(H,T),console.log(`[SkyGit] Deleted ${C} from GitHub`)}catch(H){console.warn(`[SkyGit] Failed to delete ${C} from GitHub:`,H)}}}async function m(){const C=localStorage.getItem("skygit_token");C&&(De.update(T=>({...T,phase:"streaming",paused:!1,loadedCount:0})),await Cs(C))}async function w(){const C=localStorage.getItem("skygit_token");C&&(De.update(T=>({...T,phase:"discovery",paused:!1})),us(C))}function O(C){if(!C.has_discussions){alert("Discussions are not enabled for this repository. Please enable Discussions in GitHub settings.");return}Ps.set(C),jr.set(C)}ct(()=>(i(o),xs(s()),i(l),i(u),i(f),i(d)),()=>{y(n,i(o).filter(C=>{const T=s().toLowerCase(),H=C.full_name.toLowerCase().includes(T)||C.name.toLowerCase().includes(T)||C.owner.toLowerCase().includes(T),K=C.private&&i(l)||!C.private&&i(u),Z=C.has_messages&&i(f)||!C.has_messages&&i(d);return H&&K&&Z}))}),ct(()=>i(n),()=>{$s.set(i(n).length)}),ct(()=>i(o),()=>{y(r,i(o).some(C=>!C.has_discussions))}),Xn(),Ye();var S=zc(),x=fe(S);{var P=C=>{var T=jc(),H=h(T),K=h(H);po(K,{class:"w-4 h-4 animate-spin text-blue-500"});var Z=p(K,2),ne=h(Z),ae=p(H,2),oe=h(ae);W(()=>{B(ne,`Syncing: ${i(a).loadedCount??""}/${i(a).totalCount??"?"}`),B(oe,i(a).paused?"Resume Syncing":"Pause Syncing")}),L("click",ae,v),b(C,T)},D=(C,T)=>{{var H=Z=>{var ne=Nc(),ae=h(ne);po(ae,{class:"w-4 h-4 animate-spin text-blue-500"});var oe=p(ae,2),Pe=h(oe),M=p(oe,2),q=h(M);W(()=>{B(Pe,`Discov.: ${i(a).loadedCount??""}/${i(a).totalCount??"?"}`),B(q,i(a).paused?"Resume Discovery":"Pause Discovery")}),L("click",M,_),b(Z,ne)},K=(Z,ne)=>{{var ae=oe=>{var Pe=Ic(),M=p(h(Pe),2),q=h(M),ke=p(q,2);L("click",q,m),L("click",ke,w),b(oe,Pe)};j(Z,oe=>{i(a).phase==="idle"&&oe(ae)},ne)}};j(C,Z=>{i(a).phase==="discovery"?Z(H):Z(K,!1)},T)}};j(x,C=>{i(a).phase==="streaming"?C(P):C(D,!1)})}var z=p(x,2),J=h(z),I=h(J),Y=p(J,2),le=h(Y),_e=p(Y,2),we=h(_e),ve=p(_e,2),be=h(ve),xe=p(z,2);{var ye=C=>{var T=Fc();Tt(T,5,()=>i(n),H=>H.full_name,(H,K)=>{var Z=Lc(),ne=h(Z),ae=h(ne),oe=h(ae),Pe=p(ae,2),M=h(Pe),q=p(M);{var ke=pe=>{var Ee=Mc();b(pe,Ee)};j(q,pe=>{i(K).has_discussions||pe(ke)})}Ln(ne,pe=>y(c,pe),()=>i(c));var Se=p(ne,2),tt=h(Se);$c(tt,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),W(()=>{ae.disabled=!i(K).has_discussions,B(oe,i(K).full_name),B(M,`${(i(K).has_messages?" | 💬 .messages":" | no messaging")??""} `)}),L("click",ae,()=>O(i(K))),L("click",Se,()=>g(i(K).full_name)),b(H,Z)}),b(C,T)},U=C=>{var T=Gc();b(C,T)};j(xe,C=>{i(n).length>0?C(ye):C(U,!1)})}var ee=p(xe,2);{var Q=C=>{var T=Uc();b(C,T)};j(ee,C=>{i(r)&&C(Q)})}or(I,()=>i(l),C=>y(l,C)),or(le,()=>i(u),C=>y(u,C)),or(we,()=>i(f),C=>y(f,C)),or(be,()=>i(d),C=>y(d,C)),b(e,S),Be()}var Vc=E('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function Hc(e){var t=Vc();b(e,t)}var Bc=E('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function qc(e){var t=Bc();b(e,t)}var Wc=E('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function Kc(e){var t=Wc();b(e,t)}function Xr(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Yc=E('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),Qc=E('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Zc=E('<button type="button"><div><!></div> <!> </button>'),Xc=E('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">⋯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function eu(e,t){He(t,!1);const[n,r]=Tr(),s=()=>on(rt,"$currentRoute",n),o=()=>on($s,"$filteredCount",n);let a=N(null),c=N(!1),l=N("");function u(){rt.set("settings")}function f(U){rt.set(U)}Rt.subscribe(U=>{y(a,U.user)});const d=[{id:"chats",icon:Sc,label:"Chats"},{id:"repos",icon:kc,label:"Repos"},{id:"calls",icon:Cc,label:"Calls"},{id:"contacts",icon:Pc,label:"Contacts"},{id:"notifications",icon:xc,label:"Notifs"}];function v(){y(c,!i(c))}function _(){y(c,!1)}Ye();var g=Xc(),m=h(g),w=h(m),O=h(w),S=p(O,2),x=h(S),P=h(x),D=p(x,2),z=h(D),J=p(w,2),I=p(J,2);{var Y=U=>{var ee=Yc(),Q=h(ee),C=p(Q,6);$l(ee,(T,H)=>Xr==null?void 0:Xr(T,H),()=>_),L("click",Q,u),L("click",C,function(...T){Yr==null||Yr.apply(this,T)}),b(U,ee)};j(I,U=>{i(c)&&U(Y)})}var le=p(m,2),_e=h(le),we=p(le,2);Tt(we,5,()=>d,Kn,(U,ee)=>{let Q=()=>i(ee).id,C=()=>i(ee).icon,T=()=>i(ee).label;var H=Zc();let K;var Z=h(H),ne=h(Z);C()(ne,{class:"w-5 h-5"});var ae=p(Z,2);{var oe=M=>{var q=Qc(),ke=h(q);W(()=>B(ke,o())),b(M,q)};j(ae,M=>{Q()==="repos"&&i(l).trim()!==""&&M(oe)})}var Pe=p(ae);W(M=>{K=wn(H,1,"relative flex flex-col items-center text-xs focus:outline-none",null,K,M),wn(Z,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===Q()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),B(Pe,` ${T()??""}`)},[()=>({"text-blue-600":s()===Q()})],dt),L("click",H,()=>f(Q())),b(U,H)});var ve=p(we,2),be=h(ve);{var xe=U=>{Dc(U,{})},ye=(U,ee)=>{{var Q=T=>{Jc(T,{get search(){return i(l)}})},C=(T,H)=>{{var K=ne=>{Hc(ne)},Z=(ne,ae)=>{{var oe=M=>{qc(M)},Pe=(M,q)=>{{var ke=Se=>{Kc(Se)};j(M,Se=>{s()==="notifications"&&Se(ke)},q)}};j(ne,M=>{s()==="contacts"?M(oe):M(Pe,!1)},ae)}};j(T,ne=>{s()==="calls"?ne(K):ne(Z,!1)},H)}};j(U,T=>{s()==="repos"?T(Q):T(C,!1)},ee)}};j(be,U=>{s()==="chats"?U(xe):U(ye,!1)})}W(()=>{var U,ee,Q,C;qt(O,"src",(U=i(a))==null?void 0:U.avatar_url),B(P,((ee=i(a))==null?void 0:ee.name)||((Q=i(a))==null?void 0:Q.login)),B(z,`@${((C=i(a))==null?void 0:C.login)??""}`)}),L("click",J,v),Ze(_e,()=>i(l),U=>y(l,U)),b(e,g),Be(),r()}var tu=E('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">←</button>'),nu=E('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Mr(e,t){He(t,!1);let n=N(!1);function r(g){y(n,g.detail.open)}Rt.subscribe(g=>{g.user}),Dr(()=>{const g=()=>{window.innerWidth>=768&&y(n,!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)}),jr.subscribe(g=>{g&&window.innerWidth<768&&y(n,!1)}),Ye();var s=nu(),o=h(s),a=h(o);{var c=g=>{var m=tu();L("click",m,()=>y(n,!0)),b(g,m)};j(a,g=>{i(n)||g(c)})}var l=p(o,2);let u;var f=h(l);eu(f,{$$events:{toggle:r}});var d=p(l,2);let v;var _=h(d);Mt(_,t,"default",{}),W((g,m)=>{u=wn(l,1,"sidebar md:block svelte-scw01y",null,u,g),v=wn(d,1,"main w-full svelte-scw01y",null,v,m)},[()=>({hidden:!i(n),open:i(n)}),()=>({hidden:i(n)})],dt),b(e,s),Be()}var ru=E('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function su(e){Mr(e,{children:(t,n)=>{var r=ru();b(t,r)},$$slots:{default:!0}})}var ou=E('<button title="Save">💾</button>'),au=E('<button title="Edit">✏️</button>'),iu=E('<button title="Hide">🙈</button> <!>',1),lu=E('<button title="Reveal">👁️</button>'),cu=E('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),uu=E('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),fu=E('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),du=E('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),vu=E('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">🗑️</button></td></tr> <!>',1),pu=E('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),hu=E('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),gu=E('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">🔐 Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">➕ Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">💾 Add Credential</button></div></div>');function _u(e,t){He(t,!1);let n=N({}),r=N({}),s=N(new Set),o=N(null),a=N(""),c=N("s3"),l=N({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),u=N({}),f=null;const d=localStorage.getItem("skygit_token");Dr(async()=>{if(!d)return;const S=await Ir(d);y(n,S.secrets),f=S.sha});async function v(S){try{i(r)[S]||he(r,i(r)[S]=await Ss(d,i(n)[S])),y(s,new Set(i(s)).add(S))}catch{alert("❌ Failed to decrypt.")}}function _(S){y(s,new Set([...i(s)].filter(x=>x!==S))),i(o)===S&&y(o,null)}function g(S){i(s).has(S)||y(s,new Set(i(s)).add(S)),y(o,S),y(u,{...i(r)[S]})}async function m(S){const x=await ls(d,i(u));he(n,i(n)[S]=x),he(r,i(r)[S]=i(u)),y(s,new Set(i(s)).add(S)),y(o,null),await zn(d,i(n),f)}async function w(S){confirm(`Are you sure you want to delete the credential for:
${S}?`)&&(delete i(n)[S],delete i(r)[S],y(s,new Set([...i(s)].filter(x=>x!==S))),i(o)===S&&y(o,null),await zn(d,i(n),f))}async function O(){if(!i(a)||!i(c))return;const S=i(c)==="s3"?{type:"s3",accessKeyId:i(l).accessKeyId||"",secretAccessKey:i(l).secretAccessKey||"",region:i(l).region||""}:{type:"google_drive",client_id:i(l).client_id||"",client_secret:i(l).client_secret||"",refresh_token:i(l).refresh_token||""},x=await ls(d,S);he(n,i(n)[i(a)]=x),he(r,i(r)[i(a)]=S),y(s,new Set(i(s)).add(i(a))),y(a,""),y(c,"s3"),y(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await zn(d,i(n),f)}Ye(),Mr(e,{children:(S,x)=>{var P=gu(),D=p(h(P),2),z=p(h(D));Tt(z,5,()=>Object.entries(i(n)),Kn,(Q,C)=>{let T=()=>i(C)[0],H=()=>i(C)[1];var K=vu(),Z=fe(K),ne=h(Z),ae=h(ne),oe=p(ne),Pe=h(oe),M=p(oe),q=h(M);{var ke=ce=>{var Ce=Ie();W(()=>B(Ce,i(r)[T()].type==="s3"?"S3":"Google Drive")),b(ce,Ce)},Se=ce=>{var Ce=Ie("?");b(ce,Ce)};j(q,ce=>{i(r)[T()]?ce(ke):ce(Se,!1)})}var tt=p(M),pe=h(tt);{var Ee=ce=>{var Ce=iu(),Ct=fe(Ce),Yt=p(Ct,2);{var Gt=Ae=>{var Le=ou();L("click",Le,()=>m(T())),b(Ae,Le)},$t=Ae=>{var Le=au();L("click",Le,()=>g(T())),b(Ae,Le)};j(Yt,Ae=>{i(o)===T()?Ae(Gt):Ae($t,!1)})}L("click",Ct,()=>_(T())),b(ce,Ce)},ht=ce=>{var Ce=lu();L("click",Ce,()=>v(T())),b(ce,Ce)};j(pe,ce=>{i(s).has(T())?ce(Ee):ce(ht,!1)})}var Lt=p(pe,2),Ft=p(Z,2);{var St=ce=>{var Ce=du(),Ct=h(Ce),Yt=h(Ct);{var Gt=Ae=>{var Le=uu(),Pt=fe(Le),k=p(h(Pt),2),$=h(k),R={},G=h($),V=p(Pt,2);Tt(V,1,()=>Object.entries(i(u)),Kn,(te,re)=>{let X=()=>i(re)[0];var Fe=$e(),gt=fe(Fe);{var Ge=_t=>{var Ut=cu(),Qt=h(Ut),Zt=h(Qt),fn=p(Qt,2);W(()=>B(Zt,X())),Ze(fn,()=>i(u)[X()],dn=>he(u,i(u)[X()]=dn)),b(_t,Ut)};j(gt,_t=>{X()!=="type"&&_t(Ge)})}b(te,Fe)}),W(()=>{R!==(R=i(u).type)&&($.value=($.__value=i(u).type)==null?"":i(u).type),B(G,i(u).type)}),b(Ae,Le)},$t=Ae=>{var Le=fu(),Pt=h(Le);W(k=>B(Pt,`${k??""}
                                    `),[()=>JSON.stringify(i(r)[T()],null,2)],dt),b(Ae,Le)};j(Yt,Ae=>{i(o)===T()?Ae(Gt):Ae($t,!1)})}b(ce,Ce)};j(Ft,ce=>{i(s).has(T())&&ce(St)})}W(ce=>{B(ae,T()),B(Pe,`${ce??""}...`)},[()=>H().slice(0,20)],dt),L("click",Lt,()=>w(T())),b(Q,K)});var J=p(D,2),I=p(h(J),2),Y=h(I),le=p(h(Y)),_e=p(Y,2),we=p(h(_e));W(()=>{i(c),rs(()=>{})});var ve=h(we);ve.value=(ve.__value="s3")==null?"":"s3";var be=p(ve);be.value=(be.__value="google_drive")==null?"":"google_drive";var xe=p(I,2);{var ye=Q=>{var C=pu(),T=h(C),H=p(h(T)),K=p(T,2),Z=p(h(K)),ne=p(K,2),ae=p(h(ne));Ze(H,()=>i(l).accessKeyId,oe=>he(l,i(l).accessKeyId=oe)),Ze(Z,()=>i(l).secretAccessKey,oe=>he(l,i(l).secretAccessKey=oe)),Ze(ae,()=>i(l).region,oe=>he(l,i(l).region=oe)),b(Q,C)},U=(Q,C)=>{{var T=H=>{var K=hu(),Z=h(K),ne=p(h(Z)),ae=p(Z,2),oe=p(h(ae)),Pe=p(ae,2),M=p(h(Pe));Ze(ne,()=>i(l).client_id,q=>he(l,i(l).client_id=q)),Ze(oe,()=>i(l).client_secret,q=>he(l,i(l).client_secret=q)),Ze(M,()=>i(l).refresh_token,q=>he(l,i(l).refresh_token=q)),b(H,K)};j(Q,H=>{i(c)==="google_drive"&&H(T)},C)}};j(xe,Q=>{i(c)==="s3"?Q(ye):Q(U,!1)})}var ee=p(xe,2);Ze(le,()=>i(a),Q=>y(a,Q)),as(we,()=>i(c),Q=>y(c,Q)),L("click",ee,O),b(S,P)},$$slots:{default:!0}}),Be()}var bu=E('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),yu=E('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),mu=E('<div class="p-4 space-y-3"><!></div>');function wu(e,t){He(t,!1);const[n,r]=Tr(),s=()=>on(Es,"$selectedConversation",n),o=N(),a=N();ct(()=>s(),()=>{y(o,s())}),ct(()=>i(o),()=>{var d;y(a,((d=i(o))==null?void 0:d.messages)??[])}),ct(()=>i(a),()=>{console.log("[MessageList] Updated messages:",i(a))}),Xn(),Ye();var c=mu(),l=h(c);{var u=d=>{var v=$e(),_=fe(v);Tt(_,1,()=>i(a),g=>g.id||g.timestamp,(g,m)=>{var w=bu(),O=h(w),S=h(O),x=p(O,2),P=h(x),D=p(x,2),z=h(D);W(J=>{B(S,i(m).sender),B(P,i(m).content),B(z,J)},[()=>new Date(i(m).timestamp).toLocaleString()],dt),b(g,w)}),b(d,v)},f=d=>{var v=yu();b(d,v)};j(l,d=>{i(a).length>0?d(u):d(f,!1)})}b(e,c),Be(),r()}const tr="https://api.github.com";async function Lr(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`${tr}/repos/${t}/discussions`,s=await fetch(r,{headers:n});if(!s.ok)throw new Error("Failed to list discussions");let a=(await s.json()).find(u=>u.title==="SkyGit Presence Channel");if(a)return a.number;const c=await fetch(r,{method:"POST",headers:n,body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."})});if(!c.ok)throw new Error("Failed to create presence discussion");return(await c.json()).number}function xu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function ku(e,t,n,r,s=null){const o=await Lr(e,t),a={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${tr}/repos/${t}/discussions/${o}/comments`,l=new Date().toISOString();let u=l;const f=await fetch(c,{headers:a});let d=[];f.ok&&(d=await f.json());const v=d.find(m=>{try{const w=JSON.parse(m.body);return w.username===n&&w.session_id===r}catch{return!1}});if(v)try{const m=JSON.parse(v.body);m.join_timestamp&&(u=m.join_timestamp)}catch{}const _={username:n,session_id:r,join_timestamp:u,last_seen:l,signaling_info:s};let g=!1;if(v){let m;try{m=JSON.parse(v.body)}catch{m={}}const w=Math.abs(new Date(l)-new Date(m.last_seen));(!xu(m,_)||w>3e4)&&(g=!0)}if(v&&g){const m=`${c}/${v.id}`,w=await fetch(m,{method:"PATCH",headers:a,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] updated presence comment",w.status,w.statusText)}else if(!v){const m=await fetch(c,{method:"POST",headers:a,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] posted new presence comment",m.status,m.statusText)}for(const m of d)try{const w=JSON.parse(m.body);if(w.username===n&&w.session_id!==r){const O=`${c}/${m.id}`;await fetch(O,{method:"DELETE",headers:a}),console.log("[SkyGit][Presence] deleted old presence comment",m.id)}}catch{}}async function Su(e,t,n,r,s){const o=await Lr(e,t),a={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${tr}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:a});if(!l.ok)return;const f=(await l.json()).find(d=>{try{const v=JSON.parse(d.body);return v.username===n&&v.session_id===r}catch{return!1}});if(f){let d;try{d=JSON.parse(f.body)}catch{d={}}d.pendingRemovalBy=s,d.pendingRemovalAt=new Date().toISOString();const v=`${c}/${f.id}`;await fetch(v,{method:"PATCH",headers:a,body:JSON.stringify({body:JSON.stringify(d)})}),console.log("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function Cu(e,t,n,r){const s=await Lr(e,t),o={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},a=`${tr}/repos/${t}/discussions/${s}/comments`,c=await fetch(a,{headers:o});if(!c.ok)return;const u=(await c.json()).find(f=>{try{const d=JSON.parse(f.body);return d.username===n&&d.session_id===r}catch{return!1}});if(u){let f;try{f=JSON.parse(u.body)}catch{f={}}if(f.pendingRemovalBy&&f.pendingRemovalAt&&Date.now()-new Date(f.pendingRemovalAt).getTime()>6e4){const v=`${a}/${u.id}`;await fetch(v,{method:"DELETE",headers:o}),console.log("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function $u(e,t){const n=await Lr(e,t),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=`${tr}/repos/${t}/discussions/${n}/comments`,o=await fetch(s,{headers:r});if(!o.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",o.status,o.statusText),[];const a=await o.json(),c=Date.now(),l=a.map(u=>{try{return JSON.parse(u.body)}catch{return null}}).filter(Boolean).filter(u=>u.last_seen&&c-new Date(u.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",l),l}async function wr(e,t,n,r,s=null){await ku(e,t,n,r,s)}async function Os(e,t){return await $u(e,t)}class Pu{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:a,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:u,onFileSendProgress:f}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=a,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=u,this.onFileSendProgress=f,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let a=0,c=0;const l=new FileReader;l.onload=f=>{if(f.target.readyState!==FileReader.DONE)return;const d=new Uint8Array(f.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(d)}),c++,a+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),a<t.size?u():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const u=()=>{const f=t.slice(a,a+r);l.readAsArrayBuffer(f)};u()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Te=at({}),ot=at([]);let ge=null,Je=null,ut=null,rn=null,$a=null,_n=null,In=null,ir={token:null,repoFullName:null,username:null};function Eu({_token:e,_repoFullName:t,_username:n,_sessionId:r}){ir.token===e&&ir.repoFullName===t&&ir.username===n||(ir={token:e,repoFullName:t,username:n},Ou(),Te.set({}),ot.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),ut=e,Je=t,ge=n,rn=r,Os(ut,Je).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(a=>a.username!==ge);ot.set(o),Ts(s),Pa(),Ea(),kn(s,ge)?Au():Ru()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function Au(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Je,"as",ge,"session",rn),wr(ut,Je,ge,rn),$a=setInterval(()=>{wr(ut,Je,ge,rn)},3e4),_n=setInterval(async()=>{const e=await Os(ut,Je);console.log("[SkyGit][Presence] [Leader] polled peers:",e),ot.set(e.filter(t=>t.username!==ge)),Ts(e),Pa(),Ea()},5e3)}function Ru(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Je,"as",ge,"session",rn);const e=async()=>{const n=await Os(ut,Je);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),ot.set(n.filter(r=>r.username!==ge)),Ts(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),_n=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Te.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&_n&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(_n),_n=null,t())})}function Ou(){console.log("[SkyGit][Presence] stopPresence"),clearInterval($a),clearInterval(_n)}async function Ts(e){Te.update(t=>{const n={...t},r=Ds(e,ge);if(ge===r){for(const s of e)s.username!==ge&&(n[s.username]||(n[s.username]={status:"connecting",conn:null},go(s,n)));Object.keys(n).forEach(s=>{s!==ge&&(e.some(o=>o.username===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.username===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null},go(s,n))}return n});for(const t of e){if(t.username===ge)continue;const n=Me(Te);n[t.username]&&n[t.username].status==="connected"||(Su(ut,Je,t.username,t.session_id,ge),setTimeout(()=>{Cu(ut,Je,t.username,t.session_id)},6e4))}}function Ds(e,t){return e.map(r=>r.username).concat(t).sort()[0]}function kn(e,t){return Ds(e,t)===t}function Tu(e,t){if(!e||!e.conversationId||!e.content)return;ka(e.conversationId,Je,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=Me(ot);kn(n,ge)&&(As(Je,e.conversationId),Te.update(r=>(Object.entries(r).forEach(([s,{conn:o}])=>{s!==t&&o&&o.dataChannel&&o.send({type:"chat",...e})}),r)))}function Du(e,t){e&&Array.isArray(e.onlinePeers)&&ot.set(e.onlinePeers)}function ju(e,t){!e||!e.subtype||Te.update(n=>{var s;const r=(s=n[t])==null?void 0:s.conn;return r&&typeof r.handleSignal=="function"&&r.handleSignal(e),n})}function ho(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function go(e,t){const n=new Pu({token:ut,repoFullName:Je,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{wr(ut,Je,ge,rn,r)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":Tu(r,e.username);break;case"presence":Du(r,e.username);break;case"signal":ju(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{ho(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{ho(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{wr(ut,Je,ge,rn,r)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.username]={conn:n,status:"connected"},Te.set(t)}function Pa(){const e=Me(ot);kn(e,ge)?In||(In=setInterval(()=>{const n=Me(ot);kn(n,ge)&&xn(()=>Promise.resolve().then(()=>Rs),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",_o)):In&&(clearInterval(In),In=null,window.removeEventListener("beforeunload",_o))}function _o(e){const t=Me(ot);kn(t,ge)&&xn(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let bo=!1;function Ea(){const e=Me(ot),t=kn(e,ge);t&&!bo&&xn(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),bo=t}function ds(e,t){Te.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function Nu(e){Te.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var Iu=E('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function Mu(e,t){He(t,!1);let n=Xe(t,"conversation",8),r=N("");function s(){var g;if(!i(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:i(r).trim(),timestamp:Date.now()};ka(n().id,n().repo,l);const f=(g=Me(Rt).user)==null?void 0:g.login,d=Me(ot),v=Ds(d,f),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};f===v?(Nu({type:"chat",..._}),As(n().repo,n().id)):ds(v,{type:"chat",..._}),y(r,"")}Ye();var o=Iu(),a=h(o),c=p(a,2);Ze(a,()=>i(r),l=>y(r,l)),L("keydown",a,l=>l.key==="Enter"&&s()),L("click",c,s),b(e,o),Be()}var Lu=E(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),Fu=E('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),Gu=E('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),Uu=E('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),zu=E('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),Ju=E('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),Vu=E('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),Hu=E('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),Bu=E('<button class="bg-yellow-100 border px-3 py-1 rounded">🔄 Change Screen Source</button>'),qu=E("<span>🎤</span>"),Wu=E("<span>🔇</span>"),Ku=E("<span>📷</span>"),Yu=E("<span>🚫📷</span>"),Qu=E("<span>⏹️ Stop Recording</span>"),Zu=E("<span>⏺️ Start Recording</span>"),Xu=E('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>⏺️ Recording...</span></div>'),ef=E('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>⚠️ Peer is recording</span></div>'),tf=E('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">📎 Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),nf=E('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">×</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),rf=E('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),sf=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),of=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),af=E('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),lf=E('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function cf(e,t){He(t,!1);const[n,r]=Tr(),s=()=>on(Te,"$peerConnections",n),o=()=>on(ot,"$onlinePeers",n);let a=N(null),c=N(!1),l=N(null),u=N(null),f=null,d=N(!1),v=N(null),_=null,g=N(!1),m=N(null),w=N(!1),O=N(!0),S=N(!0),x=N(!0),P=N(!0),D=N(!0),z=N(!1),J=N(!1),I=null,Y=[],le=N({x:0,y:0}),_e=!1,we={x:0,y:0},ve=N(),be=N(null),xe=N(!1),ye=N(),U=N(),ee=N();function Q(){y(w,!0)}function C(){y(w,!1)}function T(k){y(w,!1),pe(!0,k)}function H(k){_e=!0,we={x:k.clientX-i(le).x,y:k.clientY-i(le).y},document.addEventListener("mousemove",K),document.addEventListener("mouseup",Z)}function K(k){_e&&(he(le,i(le).x=k.clientX-we.x),he(le,i(le).y=k.clientY-we.y))}function Z(){_e=!1,document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Z)}function ne(){y(O,!1)}function ae(){y(O,!0)}function oe(){y(be,null),y(xe,!1)}async function Pe(){let k=i(a)&&i(a).repo,$=Me(fs).decrypted,R=null,G=null,V=null,te=null;if(k&&window.selectedRepo&&window.selectedRepo.config){const X=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;X&&$[X]&&($[X].type==="s3"&&(R=$[X]),$[X].type==="google_drive"&&(G=$[X]))}for(const X in $)$[X].type==="s3"&&!R&&(V=$[X]),$[X].type==="google_drive"&&!G&&(te=$[X]);const re=[];return(R||V)&&re.push("s3"),(G||te)&&re.push("google_drive"),re.length===2?(y(xe,!0),new Promise(X=>{const Fe=setInterval(()=>{i(be)&&(y(xe,!1),clearInterval(Fe),X(i(be)))},100)})):re.length===1?re[0]:null}Te.subscribe(k=>{Object.keys(k).filter($=>k[$].status==="connected").map($=>({username:$}))});let M=N(!1),q=N("");async function ke(k){const $=localStorage.getItem("skygit_token");if(!$||!k)return null;try{const R=await fetch(`https://api.github.com/repos/${k}`,{headers:{Authorization:`token ${$}`}});if(R.ok){const G=await R.json();return jt.update(V=>V.map(te=>te.full_name===k?{...te,has_discussions:G.has_discussions}:te)),G.has_discussions}}catch(R){console.warn("Failed to refresh Discussions status",R)}return null}jr.subscribe(k=>{var te;console.log("[SkyGit][Presence] currentContent changed:",k),y(a,k),y(M,!1),y(q,"");const $=localStorage.getItem("skygit_token"),R=Me(Rt),G=((te=R==null?void 0:R.user)==null?void 0:te.login)||null,V=i(a)?i(a).repo:null;if(console.log("[SkyGit][Presence] authStore value:",R),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",G,"repo",V,"selectedConversation",i(a)),$&&G&&V&&Eu({_token:$,_repoFullName:V,_username:G,_sessionId:crypto.randomUUID()}),i(a)&&i(a).repo){const re=wa(i(a).repo);console.log("[SkyGit][DEBUG] Lookup repo:",i(a).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&ke(i(a).repo).then(X=>{X?y(M,!1):y(M,!0)})}});function Se(){y(c,!1),f=null,i(l)&&(i(l).getTracks().forEach(k=>k.stop()),y(l,null)),y(u,null),f&&ds(f,{type:"signal",subtype:"call-end",conversationId:i(a).id})}function tt(k){const $=k.target.files[0];!$||!i(c)||!f||Te.update(R=>{var V;const G=(V=R[f])==null?void 0:V.conn;return G&&typeof G.sendFile=="function"&&G.sendFile($),R})}async function pe(k=!0,$="screen"){try{let R={video:!0,audio:k};$==="tab"?R={video:{displaySurface:"browser",cursor:"always"},audio:k}:$==="window"?R={video:{displaySurface:"window",cursor:"always"},audio:k}:$==="screen"&&(R={video:{displaySurface:"monitor",cursor:"always"},audio:k}),y(v,await navigator.mediaDevices.getDisplayMedia(R)),y(d,!0),Te.update(G=>{var te;const V=(te=G[f])==null?void 0:te.conn;return V&&V.replaceVideoTrack&&(V.replaceVideoTrack(i(v).getVideoTracks()[0]),V.sendScreenShareSignal&&V.sendScreenShareSignal(!0,{audio:k})),G}),y(l,i(v)),i(v).getVideoTracks()[0].onended=Ee}catch(R){console.error("Screen share error:",R)}}function Ee(){i(v)&&(i(v).getTracks().forEach(k=>k.stop()),y(v,null)),y(d,!1),Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.replaceVideoTrack,k}),y(l,_)}async function ht(){if(i(d))try{const k=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Te.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.replaceVideoTrack&&R.replaceVideoTrack(k.getVideoTracks()[0]),$}),i(v)&&i(v).getTracks().forEach($=>$.stop()),y(v,k),y(l,k),k.getVideoTracks()[0].onended=Ee}catch(k){console.error("Change screen source error:",k)}}function Lt(){y(S,!i(S)),i(l)&&i(l).getAudioTracks().forEach(k=>k.enabled=i(S)),St()}function Ft(){y(x,!i(x)),i(l)&&i(l).getVideoTracks().forEach(k=>k.enabled=i(x)),St()}function St(){Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.send&&$.send({type:"media-status",micOn:i(S),cameraOn:i(x)}),k})}function ce(k){Te.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.send&&R.send({type:"recording-status",recording:k}),$})}function Ce(){i(l)&&(Y=[],I=new MediaRecorder(i(l),{mimeType:"video/webm; codecs=vp9"}),I.ondataavailable=k=>{k.data.size>0&&Y.push(k.data)},I.onstop=Yt,I.start(),y(z,!0),ce(!0))}function Ct(){I&&i(z)&&(I.stop(),y(z,!1),ce(!1))}async function Yt(){const k=new Blob(Y,{type:"video/webm"});await $t(k)}typeof window<"u"&&(window.skygitOnRecordingStatus=k=>{y(J,!!k.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(k,$)=>{y(g,k),y(m,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=k=>{typeof k.micOn=="boolean"&&y(P,k.micOn),typeof k.cameraOn=="boolean"&&y(D,k.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(k,$,R)=>{k.name,$===R&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(k,$,R)=>{$===R&&setTimeout(()=>{},2e3)});async function Gt(k,$){const R=`skygit-recording-${Date.now()}.webm`,G=$.bucket,V=$.region;if(!G||!V)return alert("S3 credential missing bucket or region."),null;const te=$.endpoint||`https://${G}.s3.${V}.amazonaws.com/${R}`;return(await fetch(te,{method:"PUT",headers:{"Content-Type":"video/webm"},body:k})).ok?te.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function $t(k){let $=Me(fs).decrypted,R=i(a)&&i(a).repo,G=null,V=null,te=null,re=null;if(R&&window.selectedRepo&&window.selectedRepo.config){const Ge=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Ge&&$[Ge]&&($[Ge].type==="s3"&&(G=$[Ge]),$[Ge].type==="google_drive"&&(V=$[Ge]))}for(const Ge in $)$[Ge].type==="s3"&&!G&&(te=$[Ge]),$[Ge].type==="google_drive"&&!V&&(re=$[Ge]);let X=null,Fe=await Pe();if(!Fe){alert("No upload destination (S3 or Google Drive) configured.");return}Fe==="s3"&&(X=G||te),Fe==="google_drive"&&(X=V||re);let gt=null;Fe==="s3"?gt=await Gt(k,X):Fe==="google_drive"&&(gt=await Ae(k,X)),gt&&(ds(f,{type:"chat",content:`📹 Recording: ${gt}`}),alert("Recording uploaded and link shared!"))}async function Ae(k,$){let R;try{R=await Le($)}catch(gt){return alert("Google Drive authentication failed: "+gt.message),null}const G={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},V=new FormData;V.append("metadata",new Blob([JSON.stringify(G)],{type:"application/json"})),V.append("file",k);const te=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+R},body:V});if(!te.ok)return alert("Failed to upload to Google Drive"),null;const re=await te.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+R,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Fe=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+R}})).json();return Fe.webViewLink||Fe.webContentLink}async function Le(k){const $=new URLSearchParams;$.append("client_id",k.client_id),$.append("client_secret",k.client_secret),$.append("refresh_token",k.refresh_token),$.append("grant_type","refresh_token");const R=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!R.ok)throw new Error("Failed to get Google access token");return(await R.json()).access_token}function Pt(){var te;const k=localStorage.getItem("skygit_token"),$=Me(Rt),R=((te=$==null?void 0:$.user)==null?void 0:te.login)||null,G=i(a)?i(a).repo:null,V=window.skygitSessionId;k&&R&&G&&V&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:k,repoFullName:G,username:R,sessionId:V})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",Pt),ct(()=>(i(ye),i(l)),()=>{i(ye)&&i(l)&&he(ye,i(ye).srcObject=i(l))}),ct(()=>(i(U),i(u)),()=>{i(U)&&i(u)&&he(U,i(U).srcObject=i(u))}),ct(()=>(i(ee),i(v)),()=>{i(ee)&&i(v)&&he(ee,i(ee).srcObject=i(v))}),Xn(),Ye(),Mr(e,{children:(k,$)=>{var R=$e(),G=fe(R);{var V=re=>{var X=$e(),Fe=fe(X);{var gt=_t=>{var Ut=Lu(),Qt=h(Ut),Zt=p(h(Qt),4),fn=p(Zt,2),dn=h(fn),Fr=p(dn,2);W(()=>qt(Zt,"href",i(q))),L("click",dn,()=>y(M,!1)),L("click",Fr,async()=>{await ke(i(a).repo)}),b(_t,Ut)},Ge=_t=>{var Ut=af(),Qt=h(Ut),Zt=h(Qt),fn=h(Zt),dn=h(fn),Fr=p(fn,2),Aa=h(Fr),js=p(Zt,2),Ra=h(js),Oa=p(js,2),Ns=h(Oa);{var Ta=ue=>{var Re=$e(),bt=fe(Re);Tt(bt,1,()=>i(a).participants,qe=>qe,(qe,me)=>{var je=$e(),Ue=fe(je);{var Rn=it=>{var yt=Fu();b(it,yt)},vn=it=>{var yt=$e(),Gr=fe(yt);{var Ur=zt=>{var Xt=$e(),On=fe(Xt);{var pn=Ne=>{var lt=Gu(),Tn=p(h(lt));W(()=>B(Tn,` ${i(me)??""}`)),b(Ne,lt)},mt=Ne=>{var lt=Uu(),Tn=p(h(lt));W(()=>B(Tn,` ${i(me)??""}`)),b(Ne,lt)};j(On,Ne=>{s()[i(me)].status==="connected"?Ne(pn):Ne(mt,!1)})}b(zt,Xt)},zr=(zt,Xt)=>{{var On=mt=>{var Ne=zu(),lt=p(h(Ne));W(()=>B(lt,` ${i(me)??""}`)),b(mt,Ne)},pn=mt=>{var Ne=Ju(),lt=p(h(Ne));W(()=>B(lt,` ${i(me)??""}`)),b(mt,Ne)};j(zt,mt=>{o().find(Ne=>Ne.username===i(me))?mt(On):mt(pn,!1)},Xt)}};j(Gr,zt=>{s()[i(me)]?zt(Ur):zt(zr,!1)})}b(it,yt)};j(Ue,it=>{i(me)===Me(Rt).user.login?it(Rn):it(vn,!1)})}b(qe,je)}),b(ue,Re)};j(Ns,ue=>{i(a).participants&&ue(Ta)})}var Da=p(Ns,2);{var ja=ue=>{var Re=Vu();L("click",Re,Se),b(ue,Re)};j(Da,ue=>{i(c)&&ue(ja)})}var Is=p(Qt,2);{var Na=ue=>{var Re=tf(),bt=fe(Re),qe=h(bt),me=p(h(qe),2);me.muted=!0,Ln(me,A=>y(ye,A),()=>i(ye));var je=p(me,2),Ue=h(je),Rn=h(Ue);{var vn=A=>{var F=Ie("🎤 Mic On");b(A,F)},it=A=>{var F=Ie("🔇 Mic Off");b(A,F)};j(Rn,A=>{i(S)?A(vn):A(it,!1)})}var yt=p(Ue,2),Gr=h(yt);{var Ur=A=>{var F=Ie("📷 Cam On");b(A,F)},zr=A=>{var F=Ie("🚫📷 Cam Off");b(A,F)};j(Gr,A=>{i(x)?A(Ur):A(zr,!1)})}var zt=p(qe,2),Xt=p(h(zt),2);Ln(Xt,A=>y(U,A),()=>i(U));var On=p(Xt,2),pn=h(On),mt=h(pn);{var Ne=A=>{var F=Ie("🎤 Mic On");b(A,F)},lt=A=>{var F=Ie("🔇 Mic Off");b(A,F)};j(mt,A=>{i(P)?A(Ne):A(lt,!1)})}var Tn=p(pn,2),za=h(Tn);{var Ja=A=>{var F=Ie("📷 Cam On");b(A,F)},Va=A=>{var F=Ie("🚫📷 Cam Off");b(A,F)};j(za,A=>{i(D)?A(Ja):A(Va,!1)})}var Us=p(bt,2);{var Ha=A=>{var F=Hu(),ci=h(F),ui=p(h(ci));{var fi=Hr=>{var sr=Ie("(with audio)");b(Hr,sr)};j(ui,Hr=>{var sr;(sr=i(m))!=null&&sr.audio&&Hr(fi)})}b(A,F)};j(Us,A=>{i(g)&&A(Ha)})}var zs=p(Us,2),Js=h(zs),Ba=p(h(Js)),Jr=p(Js,2),qa=h(Jr);{var Wa=A=>{var F=Ie("🛑 Stop Sharing");b(A,F)},Ka=A=>{var F=Ie("🖥️ Share Screen");b(A,F)};j(qa,A=>{i(d)?A(Wa):A(Ka,!1)})}var Vs=p(Jr,2);{var Ya=A=>{var F=Bu();L("click",F,ht),b(A,F)};j(Vs,A=>{i(d)&&A(Ya)})}var nr=p(Vs,2),Qa=h(nr);{var Za=A=>{var F=qu();b(A,F)},Xa=A=>{var F=Wu();b(A,F)};j(Qa,A=>{i(S)?A(Za):A(Xa,!1)})}var rr=p(nr,2),ei=h(rr);{var ti=A=>{var F=Ku();b(A,F)},ni=A=>{var F=Yu();b(A,F)};j(ei,A=>{i(x)?A(ti):A(ni,!1)})}var Vr=p(rr,2),ri=h(Vr);{var si=A=>{var F=Qu();b(A,F)},oi=A=>{var F=Zu();b(A,F)};j(ri,A=>{i(z)?A(si):A(oi,!1)})}var Hs=p(zs,2);{var ai=A=>{var F=Xu();b(A,F)};j(Hs,A=>{i(z)&&A(ai)})}var ii=p(Hs,2);{var li=A=>{var F=ef();b(A,F)};j(ii,A=>{i(J)&&A(li)})}W(()=>{qt(nr,"title",i(S)?"Mute Mic":"Unmute Mic"),qt(rr,"title",i(x)?"Turn Off Camera":"Turn On Camera"),qt(Vr,"title",i(z)?"Stop Recording":"Start Recording")}),L("change",Ba,tt),L("click",Jr,function(...A){var F;(F=i(d)?Ee:Q)==null||F.apply(this,A)}),L("click",nr,Lt),L("click",rr,Ft),L("click",Vr,function(...A){var F;(F=i(z)?Ct:Ce)==null||F.apply(this,A)}),b(ue,Re)};j(Is,ue=>{i(c)&&ue(Na)})}var Ms=p(Is,2);{var Ia=ue=>{var Re=$e(),bt=fe(Re);{var qe=je=>{var Ue=nf(),Rn=h(Ue),vn=h(Rn),it=p(vn,4);it.muted=!0,Ln(it,yt=>y(ee,yt),()=>i(ee)),Ln(Ue,yt=>y(ve,yt),()=>i(ve)),W(()=>ta(Ue,`left: ${i(le).x??""}px; top: ${i(le).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),L("click",vn,jl(ne)),L("mousedown",Ue,H),b(je,Ue)},me=je=>{var Ue=rf();L("click",Ue,ae),b(je,Ue)};j(bt,je=>{i(O)?je(qe):je(me,!1)})}b(ue,Re)};j(Ms,ue=>{i(d)&&i(v)&&ue(Ia)})}var Ls=p(Ms,2);{var Ma=ue=>{var Re=sf(),bt=h(Re),qe=p(h(bt),2),me=p(qe,2),je=p(me,2),Ue=p(je,2);L("click",qe,()=>T("screen")),L("click",me,()=>T("window")),L("click",je,()=>T("tab")),L("click",Ue,C),b(ue,Re)};j(Ls,ue=>{i(w)&&ue(Ma)})}var Fs=p(Ls,2);{var La=ue=>{var Re=of(),bt=h(Re),qe=p(h(bt),2),me=p(qe,2),je=p(me,2);L("click",qe,()=>{y(be,"google_drive")}),L("click",me,()=>{y(be,"s3")}),L("click",je,oe),b(ue,Re)};j(Fs,ue=>{i(xe)&&ue(La)})}var Gs=p(Fs,2),Fa=h(Gs);wu(Fa,{get conversation(){return i(a)}});var Ga=p(Gs,2),Ua=h(Ga);Mu(Ua,{get conversation(){return i(a)}}),W(()=>{var ue;B(dn,i(a).title),B(Aa,i(a).repo),B(Ra,`${((ue=i(a).participants)==null?void 0:ue.length)??0} participants`)}),b(_t,Ut)};j(Fe,_t=>{i(M)?_t(gt):_t(Ge,!1)})}b(re,X)},te=re=>{var X=lf();b(re,X)};j(G,re=>{i(a)?re(V):re(te,!1)})}b(k,R)},$$slots:{default:!0}}),Be(),r()}var uf=E('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function ff(e,t){He(t,!1);const n=Fl();let r=N("");function s(){if(!i(r).trim()){alert("Title is required.");return}n("create",{title:i(r).trim()}),y(r,"")}function o(){n("cancel")}Ye();var a=uf(),c=h(a),l=p(h(c),2),u=p(l,2),f=h(u),d=p(f,2);Ze(l,()=>i(r),v=>y(r,v)),L("click",f,o),L("click",d,s),b(e,a),Be()}var df=E('<span class="text-green-700 font-semibold">✅ Enabled</span>'),vf=E("<span> </span>"),pf=E('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),hf=Xo('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),gf=E('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),_f=E('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>💬 New Conversation (Enable Discussions first)</button></div>'),bf=E("<option> </option>"),yf=E('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">🛠️ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>— Select a credential —</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💾 Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💬 New Conversation</button> <!>',1),mf=E('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),wf=E('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function xf(e,t){He(t,!1);let n=N([]),r=N(),s=N(!1),o=N(!1),a=N(""),c;Ps.subscribe(g=>y(r,g)),Dr(async()=>{const g=localStorage.getItem("skygit_token");if(g)try{const{secrets:m}=await Ir(g),w=Object.keys(m),O=[];for(const S of w)try{const x=await Ss(g,m[S]);O.push({url:S,...x})}catch(x){console.warn("Failed to decrypt",S,x)}y(n,O)}catch(m){console.warn("Could not load secrets",m)}});async function l(){const g=localStorage.getItem("skygit_token");if(!(!i(r)||!g)){y(s,!0);try{await pa(g,i(r)),he(r,i(r).has_messages=!0),xn(async()=>{const{selectedRepo:m}=await Promise.resolve().then(()=>fo);return{selectedRepo:m}},void 0).then(({selectedRepo:m})=>{m.set({...i(r)})})}catch(m){alert("Failed to activate messaging."),console.warn(m)}finally{y(s,!1)}}}async function u(){const g=localStorage.getItem("skygit_token");if(!(!g||!i(r)))try{await ha(g,i(r)),alert("✅ Messaging config updated.");try{await ga(g,i(r))}catch(m){alert("❌ Failed to store credential."),console.warn(m)}}catch(m){alert("❌ Failed to update config."),console.warn(m)}}async function f(g){const m=g.detail.title,w=localStorage.getItem("skygit_token");console.log("[SkyGit] 🧪 handleCreate() called with title:",m),await ic(w,i(r),m),y(o,!1)}function d(){y(o,!1)}function v(){if(!i(r))return;const g=`https://github.com/${i(r).full_name}/settings#discussions`;window.open(g,"_blank")}async function _(){const g=localStorage.getItem("skygit_token");if(!g||!i(r))return;const m=await fetch(`https://api.github.com/repos/${i(r).full_name}`,{headers:{Authorization:`token ${g}`}});if(m.ok){const w=await m.json(),O=!i(r).has_discussions;he(r,i(r).has_discussions=w.has_discussions),xn(async()=>{const{selectedRepo:S}=await Promise.resolve().then(()=>fo);return{selectedRepo:S}},void 0).then(({selectedRepo:S})=>{S.set({...i(r)})}),await ol(),O&&i(r).has_discussions?y(a,"✅ Discussions enabled! You can now use messaging."):i(r).has_discussions?y(a,""):y(a,"❌ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{y(a,"")},4e3)}}Ye(),Mr(e,{children:(g,m)=>{var w=$e(),O=fe(w);{var S=P=>{var D=mf(),z=h(D),J=h(z),I=p(z,2),Y=h(I),le=p(h(Y)),_e=p(Y,2),we=p(h(_e)),ve=p(_e,2),be=p(h(ve),2),xe=h(be),ye=p(ve,2),U=p(h(ye)),ee=p(ye,2),Q=p(h(ee)),C=p(ee,2),T=p(h(C),2);{var H=M=>{var q=df();b(M,q)},K=M=>{var q=pf(),ke=p(fe(q),2),Se=p(ke,2),tt=p(Se,2);{var pe=Ee=>{var ht=vf();let Lt;var Ft=h(ht);W(St=>{Lt=wn(ht,1,"ml-2 text-xs font-semibold",null,Lt,St),B(Ft,i(a))},[()=>({"text-green-700":i(a).startsWith("✅"),"text-red-600":i(a).startsWith("❌")})],dt),b(Ee,ht)};j(tt,Ee=>{i(a)&&Ee(pe)})}L("click",ke,v),L("click",Se,_),b(M,q)};j(T,M=>{i(r).has_discussions?M(H):M(K,!1)})}var Z=p(I,2);{var ne=M=>{var q=gf(),ke=h(q);{var Se=pe=>{var Ee=hf();b(pe,Ee)},tt=pe=>{var Ee=Ie("💬 Activate Messaging");b(pe,Ee)};j(ke,pe=>{i(s)?pe(Se):pe(tt,!1)})}W(()=>q.disabled=i(s)),L("click",q,l),b(M,q)};j(Z,M=>{i(r).has_messages||M(ne)})}var ae=p(Z,2);{var oe=M=>{var q=_f();b(M,q)},Pe=(M,q)=>{{var ke=Se=>{var tt=yf(),pe=fe(tt),Ee=p(h(pe),2),ht=h(Ee),Lt=p(h(ht)),Ft=p(ht,2),St=p(h(Ft));W(()=>{i(r),rs(()=>{})});var ce=h(St);ce.value=(ce.__value="gitfs")==null?"":"gitfs";var Ce=p(ce);Ce.value=(Ce.__value="s3")==null?"":"s3";var Ct=p(Ce);Ct.value=(Ct.__value="google_drive")==null?"":"google_drive";var Yt=p(Ft,2),Gt=p(h(Yt));W(()=>{i(r),rs(()=>{i(n)})});var $t=h(Gt);$t.value=(($t.__value="")==null,"");var Ae=p($t);Tt(Ae,1,()=>i(n).filter(R=>R.type===i(r).config.binary_storage_type),Kn,(R,G)=>{var V=bf(),te={},re=h(V);W(()=>{te!==(te=i(G).url)&&(V.value=(V.__value=i(G).url)==null?"":i(G).url),B(re,i(G).url)}),b(R,V)});var Le=p(Ee,2),Pt=p(pe,2),k=p(Pt,2);{var $=R=>{ff(R,{$$events:{create:f,cancel:d}})};j(k,R=>{i(o)&&R($)})}Ze(Lt,()=>i(r).config.commit_frequency_min,R=>he(r,i(r).config.commit_frequency_min=R)),as(St,()=>i(r).config.binary_storage_type,R=>he(r,i(r).config.binary_storage_type=R)),as(Gt,()=>i(r).config.storage_info.url,R=>he(r,i(r).config.storage_info.url=R)),L("click",Le,u),L("click",Pt,()=>y(o,!0)),b(Se,tt)};j(M,Se=>{i(r).has_messages&&i(r).config&&Se(ke)},q)}};j(ae,M=>{i(r).has_discussions?M(Pe,!1):M(oe)})}W(()=>{B(J,i(r).full_name),B(le,` ${i(r).name??""}`),B(we,` ${i(r).owner??""}`),qt(be,"href",i(r).url),B(xe,i(r).url),B(U,` ${(i(r).private?"🔒 Private":"🌐 Public")??""}`),B(Q,` ${(i(r).has_messages?"💬 Available":"🚫 Not enabled")??""}`)}),b(P,D)},x=P=>{var D=wf();b(P,D)};j(O,P=>{i(r)?P(S):P(x,!1)})}b(g,w)},$$slots:{default:!0}}),Be()}var kf=E('<p class="text-center mt-20">Loading...</p>');function Sf(e,t){He(t,!1);const[n,r]=Tr(),s=()=>on(rt,"$currentRoute",n),o=()=>on(De,"$syncState",n);let a=N(null),c=null,l=N("");Rt.subscribe(O=>{O.isLoggedIn||(rt.set("login"),y(a,null),c=null)}),Dr(()=>{const O=Zl();O?u(O):rt.set("login")});async function u(O){y(l,"");const S=await Yl(O);if(!S){localStorage.removeItem("skygit_token"),y(l,"Invalid token. Please check your PAT and try again."),rt.set("login");return}y(a,O),c=S,Ql(O),Rt.set({isLoggedIn:!0,token:i(a),user:c}),await ua(i(a),c.login)?(rt.set("home"),await v()):rt.set("consent")}async function f(){await fa(i(a)),rt.set("home"),await v()}function d(){localStorage.removeItem("skygit_token"),rt.set("login")}async function v(){try{console.log("[SkyGit] Initializing app state..."),await uc(i(a))}catch(O){console.warn("[SkyGit] Failed to initialize startup state:",O)}}window.addEventListener("beforeunload",O=>{(Ca()||ma())&&(mr(),yr(),O.preventDefault(),O.returnValue="")}),ct(()=>(s(),o(),i(a)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{us(i(a))}catch(O){console.warn("[SkyGit] Repo discovery failed:",O)}}),Xn(),Ye();var _=$e(),g=fe(_);{var m=O=>{var S=kf();b(O,S)},w=(O,S)=>{{var x=D=>{gc(D,{onSubmit:u,get error(){return i(l)}})},P=(D,z)=>{{var J=Y=>{yc(Y,{onApprove:f,onReject:d})},I=(Y,le)=>{{var _e=ve=>{_u(ve,{})},we=(ve,be)=>{{var xe=U=>{cf(U,{})},ye=(U,ee)=>{{var Q=T=>{xf(T,{})},C=T=>{su(T)};j(U,T=>{s()==="repos"?T(Q):T(C,!1)},ee)}};j(ve,U=>{s()==="chats"?U(xe):U(ye,!1)},be)}};j(Y,ve=>{s()==="settings"?ve(_e):ve(we,!1)},le)}};j(D,Y=>{s()==="consent"?Y(J):Y(I,!1)},z)}};j(O,D=>{s()==="login"?D(x):D(P,!1)},S)}};j(g,O=>{s()==="loading"?O(m):O(w,!1)})}b(e,_),Be(),r()}bl(Sf,{target:document.getElementById("app")});
