(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const to=!1;var Ls=Array.isArray,$i=Array.prototype.indexOf,kr=Array.from,Io=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,To=Object.getOwnPropertyDescriptors,Pi=Object.prototype,Ai=Array.prototype,Sr=Object.getPrototypeOf,no=Object.isExtensible;function Hn(e){return typeof e=="function"}const En=()=>{};function Ei(e){return e()}function Cs(e){for(var t=0;t<e.length;t++)e[t]()}const gt=2,jo=4,Gs=8,Cr=16,Mt=32,Mn=64,$s=128,lt=256,Ps=512,Ze=1024,Nt=2048,hn=4096,Rt=8192,Us=16384,Ri=32768,Fs=65536,Mo=1<<17,Di=1<<19,No=1<<20,fr=1<<21,kt=Symbol("$state"),Lo=Symbol("legacy props"),Oi=Symbol("");function Go(e){return e===this.v}function zs(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Ii(e,t){return e!==t}function $r(e){return!zs(e,this.v)}function Ti(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ji(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Mi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ni(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Li(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Gi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ui(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Fi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Nn=!1,zi=!1;function Ji(){Nn=!0}const Pr=1,Ar=2,Uo=4,qi=8,Vi=16,Hi=1,Bi=2,Fo=4,Wi=8,Ki=16,zo=1,Yi=2,Je=Symbol(),Qi="http://www.w3.org/1999/xhtml",Zi="http://www.w3.org/2000/svg";function Er(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let ve=null;function so(e){ve=e}function We(e,t=!1,n){var s=ve={p:ve,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Nn&&!t&&(ve.l={s:null,u:null,r1:[],r2:Dn(!1)}),Rr(()=>{s.d=!0})}function Ke(e){const t=ve;if(t!==null){const i=t.e;if(i!==null){var n=ue,s=re;t.e=null;try{for(var r=0;r<i.length;r++){var o=i[r];Xt(o.effect),St(o.reaction),Un(o.fn)}}finally{Xt(n),St(s)}}ve=t.p,t.m=!0}return{}}function Ln(){return!Nn||ve!==null&&ve.l===null}function cn(e,t){if(typeof e!="object"||e===null||kt in e)return e;const n=Sr(e);if(n!==Pi&&n!==Ai)return e;var s=new Map,r=Ls(e),o=Bt(0),i=re,c=l=>{var f=re;St(i);var d;return d=l(),St(f),d};return r&&s.set("length",Bt(e.length)),new Proxy(e,{defineProperty(l,f,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Gi();var v=s.get(f);return v===void 0?(v=c(()=>Bt(d.value)),s.set(f,v)):y(v,c(()=>cn(d.value))),!0},deleteProperty(l,f){var d=s.get(f);if(d===void 0)f in l&&s.set(f,c(()=>Bt(Je)));else{if(r&&typeof f=="string"){var v=s.get("length"),u=Number(f);Number.isInteger(u)&&u<v.v&&y(v,u)}y(d,Je),ro(o)}return!0},get(l,f,d){var p;if(f===kt)return e;var v=s.get(f),u=f in l;if(v===void 0&&(!u||(p=Qt(l,f))!=null&&p.writable)&&(v=c(()=>Bt(cn(u?l[f]:Je))),s.set(f,v)),v!==void 0){var g=a(v);return g===Je?void 0:g}return Reflect.get(l,f,d)},getOwnPropertyDescriptor(l,f){var d=Reflect.getOwnPropertyDescriptor(l,f);if(d&&"value"in d){var v=s.get(f);v&&(d.value=a(v))}else if(d===void 0){var u=s.get(f),g=u==null?void 0:u.v;if(u!==void 0&&g!==Je)return{enumerable:!0,configurable:!0,value:g,writable:!0}}return d},has(l,f){var g;if(f===kt)return!0;var d=s.get(f),v=d!==void 0&&d.v!==Je||Reflect.has(l,f);if(d!==void 0||ue!==null&&(!v||(g=Qt(l,f))!=null&&g.writable)){d===void 0&&(d=c(()=>Bt(v?cn(l[f]):Je)),s.set(f,d));var u=a(d);if(u===Je)return!1}return v},set(l,f,d,v){var k;var u=s.get(f),g=f in l;if(r&&f==="length")for(var p=d;p<u.v;p+=1){var b=s.get(p+"");b!==void 0?y(b,Je):p in l&&(b=c(()=>Bt(Je)),s.set(p+"",b))}u===void 0?(!g||(k=Qt(l,f))!=null&&k.writable)&&(u=c(()=>Bt(void 0)),y(u,c(()=>cn(d))),s.set(f,u)):(g=u.v!==Je,y(u,c(()=>cn(d))));var S=Reflect.getOwnPropertyDescriptor(l,f);if(S!=null&&S.set&&S.set.call(v,d),!g){if(r&&typeof f=="string"){var C=s.get("length"),M=Number(f);Number.isInteger(M)&&M>=C.v&&y(C,M+1)}ro(o)}return!0},ownKeys(l){a(o);var f=Reflect.ownKeys(l).filter(u=>{var g=s.get(u);return g===void 0||g.v!==Je});for(var[d,v]of s)v.v!==Je&&!(d in l)&&f.push(d);return f},setPrototypeOf(){Ui()}})}function ro(e,t=1){y(e,e.v+t)}function oo(e){try{if(e!==null&&typeof e=="object"&&kt in e)return e[kt]}catch{}return e}function Xi(e,t){return Object.is(oo(e),oo(t))}const ss=new Map;function Dn(e,t){var n={f:0,v:e,reactions:null,equals:Go,rv:0,wv:0};return n}function Bt(e,t){const n=Dn(e);return fl(n),n}function j(e,t=!1){var s;const n=Dn(e);return t||(n.equals=$r),Nn&&ve!==null&&ve.l!==null&&((s=ve.l).s??(s.s=[])).push(n),n}function ke(e,t){return y(e,Xe(()=>a(e))),t}function y(e,t,n=!1){re!==null&&!xt&&Ln()&&(re.f&(gt|Cr))!==0&&!(He!=null&&He.includes(e))&&Fi();let s=n?cn(t):t;return rs(e,s)}function rs(e,t){if(!e.equals(t)){var n=e.v;ps?ss.set(e,t):ss.set(e,n),e.v=t,e.wv=sa(),Jo(e,Nt),Ln()&&ue!==null&&(ue.f&Ze)!==0&&(ue.f&(Mt|Mn))===0&&(at===null?dl([e]):at.push(e))}return t}function ao(e,t=1){var n=a(e),s=t===1?n++:n--;return y(e,n),s}function Jo(e,t){var n=e.reactions;if(n!==null)for(var s=Ln(),r=n.length,o=0;o<r;o++){var i=n[o],c=i.f;(c&Nt)===0&&(!s&&i===ue||(_t(i,t),(c&(Ze|lt))!==0&&((c&gt)!==0?Jo(i,hn):Bs(i))))}}let el=!1;var io,qo,Vo,Ho;function tl(){if(io===void 0){io=window,qo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Vo=Qt(t,"firstChild").get,Ho=Qt(t,"nextSibling").get,no(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),no(n)&&(n.__t=void 0)}}function fs(e=""){return document.createTextNode(e)}function At(e){return Vo.call(e)}function Js(e){return Ho.call(e)}function _(e,t){return At(e)}function de(e,t){{var n=At(e);return n instanceof Comment&&n.data===""?Js(n):n}}function h(e,t=1,n=!1){let s=e;for(;t--;)s=Js(s);return s}function nl(e){e.textContent=""}function os(e){var t=gt|Nt,n=re!==null&&(re.f&gt)!==0?re:null;return ue===null||n!==null&&(n.f&lt)!==0?t|=lt:ue.f|=No,{ctx:ve,deps:null,effects:null,equals:Go,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ue}}function ht(e){const t=os(e);return t.equals=$r,t}function Bo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)It(t[n])}}function sl(e){for(var t=e.parent;t!==null;){if((t.f&gt)===0)return t;t=t.parent}return null}function rl(e){var t,n=ue;Xt(sl(e));try{Bo(e),t=oa(e)}finally{Xt(n)}return t}function Wo(e){var t=rl(e),n=(Yt||(e.f&lt)!==0)&&e.deps!==null?hn:Ze;_t(e,n),e.equals(t)||(e.v=t,e.wv=sa())}function Ko(e){ue===null&&re===null&&Mi(),re!==null&&(re.f&lt)!==0&&ue===null&&ji(),ps&&Ti()}function ol(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Gn(e,t,n,s=!0){var r=ue,o={ctx:ve,deps:null,nodes_start:null,nodes_end:null,f:e|Nt,first:null,fn:t,last:null,next:null,parent:r,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Hs(o),o.f|=Ri}catch(l){throw It(o),l}else t!==null&&Bs(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(No|$s))===0;if(!i&&s&&(r!==null&&ol(o,r),re!==null&&(re.f&gt)!==0)){var c=re;(c.effects??(c.effects=[])).push(o)}return o}function Rr(e){const t=Gn(Gs,null,!1);return _t(t,Ze),t.teardown=e,t}function dr(e){Ko();var t=ue!==null&&(ue.f&Mt)!==0&&ve!==null&&!ve.m;if(t){var n=ve;(n.e??(n.e=[])).push({fn:e,effect:ue,reaction:re})}else{var s=Un(e);return s}}function al(e){return Ko(),_n(e)}function il(e){const t=Gn(Mn,e,!0);return(n={})=>new Promise(s=>{n.outro?On(t,()=>{It(t),s(void 0)}):(It(t),s(void 0))})}function Un(e){return Gn(jo,e,!1)}function vt(e,t){var n=ve,s={effect:null,ran:!1};n.l.r1.push(s),s.effect=_n(()=>{e(),!s.ran&&(s.ran=!0,y(n.l.r2,!0),Xe(t))})}function ds(){var e=ve;_n(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Ze)!==0&&_t(n,hn),Fn(n)&&Hs(n),t.ran=!1}e.l.r2.v=!1}})}function _n(e){return Gn(Gs,e,!0)}function Q(e,t=[],n=os){const s=t.map(n);return vs(()=>e(...s.map(a)))}function vs(e,t=0){return Gn(Gs|Cr|t,e,!0)}function vn(e,t=!0){return Gn(Gs|Mt,e,!0,t)}function Yo(e){var t=e.teardown;if(t!==null){const n=ps,s=re;co(!0),St(null);try{t.call(null)}finally{co(n),St(s)}}}function Qo(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var s=n.next;(n.f&Mn)!==0?n.parent=null:It(n,t),n=s}}function ll(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Mt)===0&&It(t),t=n}}function It(e,t=!0){var n=!1;if((t||(e.f&Di)!==0)&&e.nodes_start!==null){for(var s=e.nodes_start,r=e.nodes_end;s!==null;){var o=s===r?null:Js(s);s.remove(),s=o}n=!0}Qo(e,t&&!n),Ds(e,0),_t(e,Us);var i=e.transitions;if(i!==null)for(const l of i)l.stop();Yo(e);var c=e.parent;c!==null&&c.first!==null&&Zo(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Zo(e){var t=e.parent,n=e.prev,s=e.next;n!==null&&(n.next=s),s!==null&&(s.prev=n),t!==null&&(t.first===e&&(t.first=s),t.last===e&&(t.last=n))}function On(e,t){var n=[];Dr(e,n,!0),Xo(n,()=>{It(e),t&&t()})}function Xo(e,t){var n=e.length;if(n>0){var s=()=>--n||t();for(var r of e)r.out(s)}else t()}function Dr(e,t,n){if((e.f&Rt)===0){if(e.f^=Rt,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var s=e.first;s!==null;){var r=s.next,o=(s.f&Fs)!==0||(s.f&Mt)!==0;Dr(s,t,o?n:!1),s=r}}}function as(e){ea(e,!0)}function ea(e,t){if((e.f&Rt)!==0){e.f^=Rt,(e.f&Ze)===0&&(e.f^=Ze),Fn(e)&&(_t(e,Nt),Bs(e));for(var n=e.first;n!==null;){var s=n.next,r=(n.f&Fs)!==0||(n.f&Mt)!==0;ea(n,r?t:!1),n=s}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let is=[],vr=[];function ta(){var e=is;is=[],Cs(e)}function cl(){var e=vr;vr=[],Cs(e)}function qs(e){is.length===0&&queueMicrotask(ta),is.push(e)}function lo(){is.length>0&&ta(),vr.length>0&&cl()}let ws=!1,As=!1,Es=null,fn=!1,ps=!1;function co(e){ps=e}let ts=[];let re=null,xt=!1;function St(e){re=e}let ue=null;function Xt(e){ue=e}let He=null;function ul(e){He=e}function fl(e){re!==null&&re.f&fr&&(He===null?ul([e]):He.push(e))}let qe=null,tt=0,at=null;function dl(e){at=e}let na=1,Rs=0,Yt=!1,Kt=null;function sa(){return++na}function Fn(e){var v;var t=e.f;if((t&Nt)!==0)return!0;if((t&hn)!==0){var n=e.deps,s=(t&lt)!==0;if(n!==null){var r,o,i=(t&Ps)!==0,c=s&&ue!==null&&!Yt,l=n.length;if(i||c){var f=e,d=f.parent;for(r=0;r<l;r++)o=n[r],(i||!((v=o==null?void 0:o.reactions)!=null&&v.includes(f)))&&(o.reactions??(o.reactions=[])).push(f);i&&(f.f^=Ps),c&&d!==null&&(d.f&lt)===0&&(f.f^=lt)}for(r=0;r<l;r++)if(o=n[r],Fn(o)&&Wo(o),o.wv>e.wv)return!0}(!s||ue!==null&&!Yt)&&_t(e,Ze)}return!1}function vl(e,t){for(var n=t;n!==null;){if((n.f&$s)!==0)try{n.fn(e);return}catch{n.f^=$s}n=n.parent}throw ws=!1,e}function pl(e){return(e.f&Us)===0&&(e.parent===null||(e.parent.f&$s)===0)}function Vs(e,t,n,s){if(ws){if(n===null&&(ws=!1),pl(t))throw e;return}n!==null&&(ws=!0);{vl(e,t);return}}function ra(e,t,n=!0){var s=e.reactions;if(s!==null)for(var r=0;r<s.length;r++){var o=s[r];He!=null&&He.includes(e)||((o.f&gt)!==0?ra(o,t,!1):t===o&&(n?_t(o,Nt):(o.f&Ze)!==0&&_t(o,hn),Bs(o)))}}function oa(e){var g;var t=qe,n=tt,s=at,r=re,o=Yt,i=He,c=ve,l=xt,f=e.f;qe=null,tt=0,at=null,Yt=(f&lt)!==0&&(xt||!fn||re===null),re=(f&(Mt|Mn))===0?e:null,He=null,so(e.ctx),xt=!1,Rs++,e.f|=fr;try{var d=(0,e.fn)(),v=e.deps;if(qe!==null){var u;if(Ds(e,tt),v!==null&&tt>0)for(v.length=tt+qe.length,u=0;u<qe.length;u++)v[tt+u]=qe[u];else e.deps=v=qe;if(!Yt)for(u=tt;u<v.length;u++)((g=v[u]).reactions??(g.reactions=[])).push(e)}else v!==null&&tt<v.length&&(Ds(e,tt),v.length=tt);if(Ln()&&at!==null&&!xt&&v!==null&&(e.f&(gt|hn|Nt))===0)for(u=0;u<at.length;u++)ra(at[u],e);return r!==null&&(Rs++,at!==null&&(s===null?s=at:s.push(...at))),d}finally{qe=t,tt=n,at=s,re=r,Yt=o,He=i,so(c),xt=l,e.f^=fr}}function gl(e,t){let n=t.reactions;if(n!==null){var s=$i.call(n,e);if(s!==-1){var r=n.length-1;r===0?n=t.reactions=null:(n[s]=n[r],n.pop())}}n===null&&(t.f&gt)!==0&&(qe===null||!qe.includes(t))&&(_t(t,hn),(t.f&(lt|Ps))===0&&(t.f^=Ps),Bo(t),Ds(t,0))}function Ds(e,t){var n=e.deps;if(n!==null)for(var s=t;s<n.length;s++)gl(e,n[s])}function Hs(e){var t=e.f;if((t&Us)===0){_t(e,Ze);var n=ue,s=ve,r=fn;ue=e,fn=!0;try{(t&Cr)!==0?ll(e):Qo(e),Yo(e);var o=oa(e);e.teardown=typeof o=="function"?o:null,e.wv=na;var i=e.deps,c;to&&zi&&e.f&Nt}catch(l){Vs(l,e,n,s||e.ctx)}finally{fn=r,ue=n}}}function hl(){try{Ni()}catch(e){if(Es!==null)Vs(e,Es,null);else throw e}}function aa(){var e=fn;try{var t=0;for(fn=!0;ts.length>0;){t++>1e3&&hl();var n=ts,s=n.length;ts=[];for(var r=0;r<s;r++){var o=yl(n[r]);_l(o)}}}finally{As=!1,fn=e,Es=null,ss.clear()}}function _l(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var s=e[n];if((s.f&(Us|Rt))===0)try{Fn(s)&&(Hs(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?Zo(s):s.fn=null))}catch(r){Vs(r,s,null,s.ctx)}}}function Bs(e){As||(As=!0,queueMicrotask(aa));for(var t=Es=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(Mn|Mt))!==0){if((n&Ze)===0)return;t.f^=Ze}}ts.push(t)}function yl(e){for(var t=[],n=e;n!==null;){var s=n.f,r=(s&(Mt|Mn))!==0,o=r&&(s&Ze)!==0;if(!o&&(s&Rt)===0){if((s&jo)!==0)t.push(n);else if(r)n.f^=Ze;else{var i=re;try{re=n,Fn(n)&&Hs(n)}catch(f){Vs(f,n,null,n.ctx)}finally{re=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function ml(e){var t;for(lo();ts.length>0;)As=!0,aa(),lo();return t}async function bl(){await Promise.resolve(),ml()}function a(e){var t=e.f,n=(t&gt)!==0;if(Kt!==null&&Kt.add(e),re!==null&&!xt){if(!(He!=null&&He.includes(e))){var s=re.deps;e.rv<Rs&&(e.rv=Rs,qe===null&&s!==null&&s[tt]===e?tt++:qe===null?qe=[e]:(!Yt||!qe.includes(e))&&qe.push(e))}}else if(n&&e.deps===null&&e.effects===null){var r=e,o=r.parent;o!==null&&(o.f&lt)===0&&(r.f^=lt)}return n&&(r=e,Fn(r)&&Wo(r)),ps&&ss.has(e)?ss.get(e):e.v}function wl(e){var t=Kt;Kt=new Set;var n=Kt,s;try{if(Xe(e),t!==null)for(s of Kt)t.add(s)}finally{Kt=t}return n}function pr(e){var t=wl(()=>Xe(e));for(var n of t)if((n.f&Mo)!==0)for(const s of n.deps||[])(s.f&gt)===0&&rs(s,s.v);else rs(n,n.v)}function Xe(e){var t=xt;try{return xt=!0,e()}finally{xt=t}}const xl=-7169;function _t(e,t){e.f=e.f&xl|t}function Or(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(kt in e)gr(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&kt in n&&gr(n)}}}function gr(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let s in e)try{gr(e[s],t)}catch{}const n=Sr(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const s=To(n);for(let r in s){const o=s[r].get;if(o)try{o.call(e)}catch{}}}}}function kl(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const Sl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Cl(e){return Sl.includes(e)}const $l={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Pl(e){return e=e.toLowerCase(),$l[e]??e}const Al=["touchstart","touchmove"];function El(e){return Al.includes(e)}function Rl(e,t){if(t){const n=document.body;e.autofocus=!0,qs(()=>{document.activeElement===n&&e.focus()})}}let uo=!1;function Dl(){uo||(uo=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function ia(e){var t=re,n=ue;St(null),Xt(null);try{return e()}finally{St(t),Xt(n)}}function Ir(e,t,n,s=n){e.addEventListener(t,()=>ia(n));const r=e.__on_r;r?e.__on_r=()=>{r(),s(!0)}:e.__on_r=()=>s(!0),Dl()}const la=new Set,hr=new Set;function ca(e,t,n,s={}){function r(o){if(s.capture||Yn.call(t,o),!o.cancelBubble)return ia(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?qs(()=>{t.addEventListener(e,r,s)}):t.addEventListener(e,r,s),r}function N(e,t,n,s,r){var o={capture:s,passive:r},i=ca(e,t,n,o);(t===document.body||t===window||t===document)&&Rr(()=>{t.removeEventListener(e,i,o)})}function Ol(e){for(var t=0;t<e.length;t++)la.add(e[t]);for(var n of hr)n(e)}function Yn(e){var M;var t=this,n=t.ownerDocument,s=e.type,r=((M=e.composedPath)==null?void 0:M.call(e))||[],o=r[0]||e.target,i=0,c=e.__root;if(c){var l=r.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=r.indexOf(t);if(f===-1)return;l<=f&&(i=l)}if(o=r[i]||e.target,o!==t){Io(e,"currentTarget",{configurable:!0,get(){return o||n}});var d=re,v=ue;St(null),Xt(null);try{for(var u,g=[];o!==null;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var b=o["__"+s];if(b!=null&&(!o.disabled||e.target===o))if(Ls(b)){var[S,...C]=b;S.apply(o,[e,...C])}else b.call(o,e)}catch(k){u?g.push(k):u=k}if(e.cancelBubble||p===t||p===null)break;o=p}if(u){for(let k of g)queueMicrotask(()=>{throw k});throw u}}finally{e.__root=t,delete e.currentTarget,St(d),Xt(v)}}}function ua(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function pn(e,t){var n=ue;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function A(e,t){var n=(t&zo)!==0,s=(t&Yi)!==0,r,o=!e.startsWith("<!>");return()=>{r===void 0&&(r=ua(o?e:"<!>"+e),n||(r=At(r)));var i=s||qo?document.importNode(r,!0):r.cloneNode(!0);if(n){var c=At(i),l=i.lastChild;pn(c,l)}else pn(i,i);return i}}function fa(e,t,n="svg"){var s=!e.startsWith("<!>"),r=(t&zo)!==0,o=`<${n}>${s?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=ua(o),l=At(c);if(r)for(i=document.createDocumentFragment();At(l);)i.appendChild(At(l));else i=At(l)}var f=i.cloneNode(!0);if(r){var d=At(f),v=f.lastChild;pn(d,v)}else pn(f,f);return f}}function Ue(e=""){{var t=fs(e+"");return pn(t,t),t}}function Ae(){var e=document.createDocumentFragment(),t=document.createComment(""),n=fs();return e.append(t,n),pn(t,n),e}function m(e,t){e!==null&&e.before(t)}function W(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function Il(e,t){return Tl(e,t)}const $n=new Map;function Tl(e,{target:t,anchor:n,props:s={},events:r,context:o,intro:i=!0}){tl();var c=new Set,l=v=>{for(var u=0;u<v.length;u++){var g=v[u];if(!c.has(g)){c.add(g);var p=El(g);t.addEventListener(g,Yn,{passive:p});var b=$n.get(g);b===void 0?(document.addEventListener(g,Yn,{passive:p}),$n.set(g,1)):$n.set(g,b+1)}}};l(kr(la)),hr.add(l);var f=void 0,d=il(()=>{var v=n??t.appendChild(fs());return vn(()=>{if(o){We({});var u=ve;u.c=o}r&&(s.$$events=r),f=e(v,s)||{},o&&Ke()}),()=>{var p;for(var u of c){t.removeEventListener(u,Yn);var g=$n.get(u);--g===0?(document.removeEventListener(u,Yn),$n.delete(u)):$n.set(u,g)}hr.delete(l),v!==n&&((p=v.parentNode)==null||p.removeChild(v))}});return jl.set(f,d),f}let jl=new WeakMap;function T(e,t,[n,s]=[0,0]){var r=e,o=null,i=null,c=Je,l=n>0?Fs:0,f=!1;const d=(u,g=!0)=>{f=!0,v(g,u)},v=(u,g)=>{c!==(c=u)&&(c?(o?as(o):g&&(o=vn(()=>g(r))),i&&On(i,()=>{i=null})):(i?as(i):g&&(i=vn(()=>g(r,[n+1,s]))),o&&On(o,()=>{o=null})))};vs(()=>{f=!1,t(d),f||v(null,null)},l)}function Ml(e,t,n){var s=e,r=Je,o,i=Ln()?Ii:zs;vs(()=>{i(r,r=t())&&(o&&On(o),o=vn(()=>n(s)))})}function ls(e,t){return t}function Nl(e,t,n,s){for(var r=[],o=t.length,i=0;i<o;i++)Dr(t[i].e,r,!0);var c=o>0&&r.length===0&&n!==null;if(c){var l=n.parentNode;nl(l),l.append(n),s.clear(),Wt(e,t[0].prev,t[o-1].next)}Xo(r,()=>{for(var f=0;f<o;f++){var d=t[f];c||(s.delete(d.k),Wt(e,d.prev,d.next)),It(d.e,!c)}})}function Tt(e,t,n,s,r,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&Uo)!==0;if(l){var f=e;i=f.appendChild(fs())}var d=null,v=!1,u=ht(()=>{var g=n();return Ls(g)?g:g==null?[]:kr(g)});vs(()=>{var g=a(u),p=g.length;v&&p===0||(v=p===0,Ll(g,c,i,r,t,s,n),o!==null&&(p===0?d?as(d):d=vn(()=>o(i)):d!==null&&On(d,()=>{d=null})),a(u))})}function Ll(e,t,n,s,r,o,i){var Ce,Re,$e,z;var c=(r&qi)!==0,l=(r&(Pr|Ar))!==0,f=e.length,d=t.items,v=t.first,u=v,g,p=null,b,S=[],C=[],M,k,w,R;if(c)for(R=0;R<f;R+=1)M=e[R],k=o(M,R),w=d.get(k),w!==void 0&&((Ce=w.a)==null||Ce.measure(),(b??(b=new Set)).add(w));for(R=0;R<f;R+=1){if(M=e[R],k=o(M,R),w=d.get(k),w===void 0){var U=u?u.e.nodes_start:n;p=Ul(U,t,p,p===null?t.first:p.next,M,k,R,s,r,i),d.set(k,p),S=[],C=[],u=p.next;continue}if(l&&Gl(w,M,R,r),(w.e.f&Rt)!==0&&(as(w.e),c&&((Re=w.a)==null||Re.unfix(),(b??(b=new Set)).delete(w))),w!==u){if(g!==void 0&&g.has(w)){if(S.length<C.length){var D=C[0],O;p=D.prev;var H=S[0],ee=S[S.length-1];for(O=0;O<S.length;O+=1)fo(S[O],D,n);for(O=0;O<C.length;O+=1)g.delete(C[O]);Wt(t,H.prev,ee.next),Wt(t,p,H),Wt(t,ee,D),u=D,p=ee,R-=1,S=[],C=[]}else g.delete(w),fo(w,u,n),Wt(t,w.prev,w.next),Wt(t,w,p===null?t.first:p.next),Wt(t,p,w),p=w;continue}for(S=[],C=[];u!==null&&u.k!==k;)(u.e.f&Rt)===0&&(g??(g=new Set)).add(u),C.push(u),u=u.next;if(u===null)continue;w=u}S.push(w),p=w,u=w.next}if(u!==null||g!==void 0){for(var q=g===void 0?[]:kr(g);u!==null;)(u.e.f&Rt)===0&&q.push(u),u=u.next;var Y=q.length;if(Y>0){var me=(r&Uo)!==0&&f===0?n:null;if(c){for(R=0;R<Y;R+=1)($e=q[R].a)==null||$e.measure();for(R=0;R<Y;R+=1)(z=q[R].a)==null||z.fix()}Nl(t,q,me,d)}}c&&qs(()=>{var ne;if(b!==void 0)for(w of b)(ne=w.a)==null||ne.apply()}),ue.first=t.first&&t.first.e,ue.last=p&&p.e}function Gl(e,t,n,s){(s&Pr)!==0&&rs(e.v,t),(s&Ar)!==0?rs(e.i,n):e.i=n}function Ul(e,t,n,s,r,o,i,c,l,f){var d=(l&Pr)!==0,v=(l&Vi)===0,u=d?v?j(r):Dn(r):r,g=(l&Ar)===0?i:Dn(i),p={i:g,v:u,k:o,a:null,e:null,prev:n,next:s};try{return p.e=vn(()=>c(e,u,g,f),el),p.e.prev=n&&n.e,p.e.next=s&&s.e,n===null?t.first=p:(n.next=p,n.e.next=p.e),s!==null&&(s.prev=p,s.e.prev=p.e),p}finally{}}function fo(e,t,n){for(var s=e.next?e.next.e.nodes_start:n,r=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==s;){var i=Js(o);r.before(o),o=i}}function Wt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Lt(e,t,n,s,r){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>s:s)}function Fl(e,t,n,s,r,o){var i,c,l=null,f=e,d;vs(()=>{const v=t()||null;var u=Zi;v!==i&&(d&&(v===null?On(d,()=>{d=null,c=null}):v===c?as(d):It(d)),v&&v!==c&&(d=vn(()=>{if(l=document.createElementNS(u,v),pn(l,l),s){var g=l.appendChild(fs());s(l,g)}ue.nodes_end=l,f.before(l)})),i=v,i&&(c=i))},Fs)}function zl(e,t,n){Un(()=>{var s=Xe(()=>t(e,n==null?void 0:n())||{});if(n&&(s!=null&&s.update)){var r=!1,o={};_n(()=>{var i=n();Or(i),r&&zs(o,i)&&(o=i,s.update(i))}),r=!0}if(s!=null&&s.destroy)return()=>s.destroy()})}function da(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=da(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function Jl(){for(var e,t,n=0,s="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=da(e))&&(s&&(s+=" "),s+=t);return s}function ql(e){return typeof e=="object"?Jl(e):e??""}const vo=[...` 	
\r\fÂ \v\uFEFF`];function Vl(e,t,n){var s=e==null?"":""+e;if(t&&(s=s?s+" "+t:t),n){for(var r in n)if(n[r])s=s?s+" "+r:r;else if(s.length)for(var o=r.length,i=0;(i=s.indexOf(r,i))>=0;){var c=i+o;(i===0||vo.includes(s[i-1]))&&(c===s.length||vo.includes(s[c]))?s=(i===0?"":s.substring(0,i))+s.substring(c+1):i=c}}return s===""?null:s}function po(e,t=!1){var n=t?" !important;":";",s="";for(var r in e){var o=e[r];o!=null&&o!==""&&(s+=" "+r+": "+o+n)}return s}function sr(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Hl(e,t){if(t){var n="",s,r;if(Array.isArray(t)?(s=t[0],r=t[1]):s=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(sr)),r&&l.push(...Object.keys(r).map(sr));var f=0,d=-1;const b=e.length;for(var v=0;v<b;v++){var u=e[v];if(c?u==="/"&&e[v-1]==="*"&&(c=!1):o?o===u&&(o=!1):u==="/"&&e[v+1]==="*"?c=!0:u==='"'||u==="'"?o=u:u==="("?i++:u===")"&&i--,!c&&o===!1&&i===0){if(u===":"&&d===-1)d=v;else if(u===";"||v===b-1){if(d!==-1){var g=sr(e.substring(f,d).trim());if(!l.includes(g)){u!==";"&&v++;var p=e.substring(f,v).trim();n+=" "+p+";"}}f=v+1,d=-1}}}}return s&&(n+=po(s)),r&&(n+=po(r,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function In(e,t,n,s,r,o){var i=e.__className;if(i!==n){var c=Vl(n,s,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&r!==o)for(var l in o){var f=!!o[l];(r==null||f!==!!r[l])&&e.classList.toggle(l,f)}return o}function rr(e,t={},n,s){for(var r in n){var o=n[r];t[r]!==o&&(n[r]==null?e.style.removeProperty(r):e.style.setProperty(r,o,s))}}function va(e,t,n,s){var r=e.__style;if(r!==t){var o=Hl(t,s);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else s&&(Array.isArray(s)?(rr(e,n==null?void 0:n[0],s[0]),rr(e,n==null?void 0:n[1],s[1],"important")):rr(e,n,s));return s}const Bn=Symbol("class"),Wn=Symbol("style"),pa=Symbol("is custom element"),ga=Symbol("is html");function Bl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Et(e,t,n,s){var r=ha(e);r[t]!==(r[t]=n)&&(t==="loading"&&(e[Oi]=n),n==null?e.removeAttribute(t):typeof n!="string"&&_a(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function go(e,t,n,s,r=!1){var o=ha(e),i=o[pa],c=!o[ga],l=t||{},f=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=ql(n.class):n[Bn]&&(n.class=null),n[Wn]&&(n.style??(n.style=null));var v=_a(e);for(const k in n){let w=n[k];if(f&&k==="value"&&w==null){e.value=e.__value="",l[k]=w;continue}if(k==="class"){var u=e.namespaceURI==="http://www.w3.org/1999/xhtml";In(e,u,w,s,t==null?void 0:t[Bn],n[Bn]),l[k]=w,l[Bn]=n[Bn];continue}if(k==="style"){va(e,w,t==null?void 0:t[Wn],n[Wn]),l[k]=w,l[Wn]=n[Wn];continue}var g=l[k];if(w!==g){l[k]=w;var p=k[0]+k[1];if(p!=="$$")if(p==="on"){const R={},U="$$"+k;let D=k.slice(2);var b=Cl(D);if(kl(D)&&(D=D.slice(0,-7),R.capture=!0),!b&&g){if(w!=null)continue;e.removeEventListener(D,l[U],R),l[U]=null}if(w!=null)if(b)e[`__${D}`]=w,Ol([D]);else{let O=function(H){l[k].call(this,H)};var M=O;l[U]=ca(D,e,O,R)}else b&&(e[`__${D}`]=void 0)}else if(k==="style")Et(e,k,w);else if(k==="autofocus")Rl(e,!!w);else if(!i&&(k==="__value"||k==="value"&&w!=null))e.value=e.__value=w;else if(k==="selected"&&f)Bl(e,w);else{var S=k;c||(S=Pl(S));var C=S==="defaultValue"||S==="defaultChecked";if(w==null&&!i&&!C)if(o[k]=null,S==="value"||S==="checked"){let R=e;const U=t===void 0;if(S==="value"){let D=R.defaultValue;R.removeAttribute(S),R.defaultValue=D,R.value=R.__value=U?D:null}else{let D=R.defaultChecked;R.removeAttribute(S),R.defaultChecked=D,R.checked=U?D:!1}}else e.removeAttribute(k);else C||v.includes(S)&&(i||typeof w!="string")?e[S]=w:typeof w!="function"&&Et(e,S,w)}}}return l}function ha(e){return e.__attributes??(e.__attributes={[pa]:e.nodeName.includes("-"),[ga]:e.namespaceURI===Qi})}var ho=new Map;function _a(e){var t=ho.get(e.nodeName);if(t)return t;ho.set(e.nodeName,t=[]);for(var n,s=e,r=Element.prototype;r!==s;){n=To(s);for(var o in n)n[o].set&&t.push(o);s=Sr(s)}return t}function nt(e,t,n=t){var s=Ln();Ir(e,"input",r=>{var o=r?e.defaultValue:e.value;if(o=or(e)?ar(o):o,n(o),s&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),Xe(t)==null&&e.value&&n(or(e)?ar(e.value):e.value),_n(()=>{var r=t();or(e)&&r===ar(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function Qn(e,t,n=t){Ir(e,"change",s=>{var r=s?e.defaultChecked:e.checked;n(r)}),Xe(t)==null&&n(e.checked),_n(()=>{var s=t();e.checked=!!s})}function or(e){var t=e.type;return t==="number"||t==="range"}function ar(e){return e===""?null:+e}function ya(e,t,n){if(e.multiple)return Kl(e,t);for(var s of e.options){var r=ns(s);if(Xi(r,t)){s.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Wl(e,t){Un(()=>{var n=new MutationObserver(()=>{var s=e.__value;ya(e,s)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function _r(e,t,n=t){var s=!0;Ir(e,"change",r=>{var o=r?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),ns);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&ns(c)}n(i)}),Un(()=>{var r=t();if(ya(e,r,s),s&&r===void 0){var o=e.querySelector(":checked");o!==null&&(r=ns(o),n(r))}e.__value=r,s=!1}),Wl(e)}function Kl(e,t){for(var n of e.options)n.selected=~t.indexOf(ns(n))}function ns(e){return"__value"in e?e.__value:e.value}function _o(e,t){return e===t||(e==null?void 0:e[kt])===t}function Zn(e={},t,n,s){return Un(()=>{var r,o;return _n(()=>{r=o,o=[],Xe(()=>{e!==n(...o)&&(t(e,...o),r&&_o(n(...r),e)&&t(null,...r))})}),()=>{qs(()=>{o&&_o(n(...o),e)&&t(null,...o)})}}),e}function Yl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function et(e=!1){const t=ve,n=t.l.u;if(!n)return;let s=()=>Or(t.s);if(e){let r=0,o={};const i=os(()=>{let c=!1;const l=t.s;for(const f in l)l[f]!==o[f]&&(o[f]=l[f],c=!0);return c&&r++,r});s=()=>a(i)}n.b.length&&al(()=>{yo(t,s),Cs(n.b)}),dr(()=>{const r=Xe(()=>n.m.map(Ei));return()=>{for(const o of r)typeof o=="function"&&o()}}),n.a.length&&dr(()=>{yo(t,s),Cs(n.a)})}function yo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function ma(e,t,n){if(e==null)return t(void 0),En;const s=Xe(()=>e.subscribe(t,n));return s.unsubscribe?()=>s.unsubscribe():s}const Pn=[];function ot(e,t=En){let n=null;const s=new Set;function r(c){if(zs(e,c)&&(e=c,n)){const l=!Pn.length;for(const f of s)f[1](),Pn.push(f,e);if(l){for(let f=0;f<Pn.length;f+=2)Pn[f][0](Pn[f+1]);Pn.length=0}}}function o(c){r(c(e))}function i(c,l=En){const f=[c,l];return s.add(f),s.size===1&&(n=t(r,o)||En),c(e),()=>{s.delete(f),s.size===0&&n&&(n(),n=null)}}return{set:r,update:o,subscribe:i}}function ie(e){let t;return ma(e,n=>t=n)(),t}let ms=!1,yr=Symbol();function gn(e,t,n){const s=n[t]??(n[t]={store:null,source:j(void 0),unsubscribe:En});if(s.store!==e&&!(yr in n))if(s.unsubscribe(),s.store=e??null,e==null)s.source.v=void 0,s.unsubscribe=En;else{var r=!0;s.unsubscribe=ma(e,o=>{r?s.source.v=o:y(s.source,o)}),r=!1}return e&&yr in n?ie(e):a(s.source)}function Ws(){const e={};function t(){Rr(()=>{for(var n in e)e[n].unsubscribe();Io(e,yr,{enumerable:!1,value:!0})})}return[e,t]}function Ql(e){var t=ms;try{return ms=!1,[e(),ms]}finally{ms=t}}const Zl={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=st({get[t](){return e.props[t]}},t,Fo)),e.special[t](n),ao(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),ao(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function jt(e,t){return new Proxy({props:e,exclude:t,special:{},version:Dn(0)},Zl)}const Xl={get(e,t){let n=e.props.length;for(;n--;){let s=e.props[n];if(Hn(s)&&(s=s()),typeof s=="object"&&s!==null&&t in s)return s[t]}},set(e,t,n){let s=e.props.length;for(;s--;){let r=e.props[s];Hn(r)&&(r=r());const o=Qt(r,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let s=e.props[n];if(Hn(s)&&(s=s()),typeof s=="object"&&s!==null&&t in s){const r=Qt(s,t);return r&&!r.configurable&&(r.configurable=!0),r}}},has(e,t){if(t===kt||t===Lo)return!1;for(let n of e.props)if(Hn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Hn(n)&&(n=n());for(const s in n)t.includes(s)||t.push(s)}return t}};function yn(...e){return new Proxy({props:e},Xl)}function mo(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function st(e,t,n,s){var D;var r=(n&Hi)!==0,o=!Nn||(n&Bi)!==0,i=(n&Wi)!==0,c=(n&Ki)!==0,l=!1,f;i?[f,l]=Ql(()=>e[t]):f=e[t];var d=kt in e||Lo in e,v=i&&(((D=Qt(e,t))==null?void 0:D.set)??(d&&t in e&&(O=>e[t]=O)))||void 0,u=s,g=!0,p=!1,b=()=>(p=!0,g&&(g=!1,c?u=Xe(s):u=s),u);f===void 0&&s!==void 0&&(v&&o&&Li(),f=b(),v&&v(f));var S;if(o)S=()=>{var O=e[t];return O===void 0?b():(g=!0,p=!1,O)};else{var C=(r?os:ht)(()=>e[t]);C.f|=Mo,S=()=>{var O=a(C);return O!==void 0&&(u=void 0),O===void 0?u:O}}if((n&Fo)===0)return S;if(v){var M=e.$$legacy;return function(O,H){return arguments.length>0?((!o||!H||M||l)&&v(H?S():O),O):S()}}var k=!1,w=!1,R=j(f),U=os(()=>{var O=S(),H=a(R);return k?(k=!1,w=!0,H):(w=!1,R.v=O)});return i&&a(U),r||(U.equals=$r),function(O,H){if(Kt!==null&&(k=w,S(),a(R)),arguments.length>0){const ee=H?a(U):o&&i?cn(O):O;if(!U.equals(ee)){if(k=!0,y(R,ee),p&&u!==void 0&&(u=ee),mo(U))return O;Xe(()=>a(U))}return O}return mo(U)?U.v:a(U)}}function gs(e){ve===null&&Er(),Nn&&ve.l!==null?sc(ve).m.push(e):dr(()=>{const t=Xe(e);if(typeof t=="function")return t})}function ec(e){ve===null&&Er(),gs(()=>()=>Xe(e))}function tc(e,t,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:s})}function nc(){const e=ve;return e===null&&Er(),(t,n,s)=>{var o;const r=(o=e.s.$$events)==null?void 0:o[t];if(r){const i=Ls(r)?r.slice():[r],c=tc(t,n,s);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function sc(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const rc="5";var Oo;typeof window<"u"&&((Oo=window.__svelte??(window.__svelte={})).v??(Oo.v=new Set)).add(rc);Ji();const Dt=ot({isLoggedIn:!1,token:null,user:null});function ir(){Dt.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const it=ot("home"),Ks=ot(null),Ee=ot({phase:"streaming",paused:!0,loadedCount:0,totalCount:null}),oc="modulepreload",ac=function(e){return"/skygit/"+e},bo={},ba=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(n.map(l=>{if(l=ac(l),l in bo)return;bo[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":oc,f||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),f)return new Promise((u,g)=>{v.addEventListener("load",u),v.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function wa(e){const n=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",s,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function mr(e,t){const n=await wa(e),s=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},n,o),c=new Uint8Array(s.byteLength+i.byteLength);return c.set(s,0),c.set(new Uint8Array(i),s.byteLength),btoa(String.fromCharCode(...c))}async function Tr(e,t){const n=Uint8Array.from(atob(t),f=>f.charCodeAt(0)),s=n.slice(0,12),r=n.slice(12),o=await wa(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,r),l=new TextDecoder().decode(i);return JSON.parse(l)}const Rn=new Map,Os=new Map,ic="https://api.github.com",lc="skygit-config";function xa(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}let Kn=null;async function $t(e){return Kn||(Kn=(async()=>{const t=await fetch(`${ic}/user`,{headers:xa(e)});if(!t.ok)throw Kn=null,new Error("Failed to fetch GitHub user");return(await t.json()).login})(),Kn)}async function cc(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${lc}`,{headers:xa(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function uc(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const s=await n.json(),r=s.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),s}async function jr(e,t,n=2){const s=await $t(e),r=`repositories/${t.owner}-${t.name}.json`,o=Rn.get(r);if(o)return o;const i={Authorization:`token ${e}`,Accept:"application/vnd.github+json","Content-Type":"application/json"},c=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(Os.get(r)===c)return;let f=0,d=null;const u=(async()=>{for(;f<=n;){let g=null;try{const C=await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/${r}`,{headers:i});C.ok&&(g=(await C.json()).sha)}catch{}const p={message:`Update repo ${t.full_name}`,content:c,...g&&{sha:g}},b=await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/${r}`,{method:"PUT",headers:i,body:JSON.stringify(p)});if(b.ok){Os.set(r,c);return}if(d=await b.text(),b.status===409){f+=1;continue}break}throw new Error(`GitHub commit failed: ${d}`)})().finally(()=>Rn.delete(r));return Rn.set(r,u),u}async function ka(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/repositories`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=await fetch(n,{headers:s});if(r.status===404){const{paused:l}=ie(Ee);Ee.set({phase:"idle",loadedCount:0,totalCount:0,paused:l});return}if(!r.ok){const l=await r.text();throw new Error(`Failed to load repository list: ${l}`)}const i=(await r.json()).filter(l=>l.name.endsWith(".json")),{paused:c}=ie(Ee);Ee.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:c});for(const l of i){let f=!1;if(Ee.subscribe(d=>f=d.paused)(),f)break;try{const d=await fetch(l.url,{headers:s});if(!d.ok){console.warn(`[SkyGit] Skipped missing repo file: ${l.name} (${d.status})`);continue}const v=await d.json(),u=atob(v.content),g=JSON.parse(u);$a([g]),Ee.update(p=>({...p,loadedCount:p.loadedCount+1}))}catch(d){console.warn(`[SkyGit] Skipped malformed repo file: ${l.name}`,d);continue}}Ee.update(l=>({...l,phase:"idle"}))}async function fc(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/conversations`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=await fetch(n,{headers:s});if(r.status===404)return;if(!r.ok){const l=await r.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await r.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const f=await fetch(l.url,{headers:s});if(!f.ok)continue;const d=await f.json(),v=JSON.parse(atob(d.content));c.push(v)}return c}async function dc(e,t){const n=await $t(e),s=`repositories/${t.owner}-${t.name}.json`,r=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${s}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!r.ok){const c=await r.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await r.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${s}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function vc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},r=".messages/config.json",o=`${t.full_name}/${r}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(s,null,2))));if(Os.get(o)===i)return;const c=Rn.get(o);if(c)return c;const l=`https://api.github.com/repos/${t.full_name}/contents/${r}`;let f=null;try{const v=await fetch(l,{headers:n});if(v.ok)f=(await v.json()).sha;else if(v.status!==404){const u=await v.text();throw new Error(`Failed to check if config.json exists: ${u}`)}}catch(v){console.warn("Error checking for config.json",v)}const d=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:i,...f&&{sha:f}})});if(!d.ok){const v=await d.text();throw new Error(`Failed to commit config.json: ${v}`)}t.has_messages=!0,t.config=s,await jr(e,t)}async function pc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=t.config,r=".messages/config.json",o=`${t.full_name}/${r}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(s,null,2)))),c=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${r}`,{headers:n});let l=null;c.ok&&(l=(await c.json()).sha);const f=fetch(`https://api.github.com/repos/${t.full_name}/contents/${r}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:i,...l&&{sha:l}})}).then(async v=>{if(!v.ok){const u=await v.text();throw new Error(`Failed to update config.json: ${u}`)}Os.set(o,i)}).finally(()=>{Rn.delete(o)});Rn.set(o,f),await f;const{queueRepoForCommit:d}=await ba(async()=>{const{queueRepoForCommit:v}=await Promise.resolve().then(()=>Ea);return{queueRepoForCommit:v}},void 0);await d(t)}async function Mr(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/secrets.json`,s=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(s.status===404)return{secrets:{},sha:null};const r=await s.json();return{secrets:JSON.parse(atob(r.content)),sha:r.sha}}async function xs(e,t,n=null){const r=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(r,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const f=await l.text();throw new Error(`Failed to check secrets.json: ${f}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(r,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function gc(e,t){const n=t.config.storage_info.url,s=t.config.storage_info.credentials;if(!s||Object.keys(s).length===0)return;const r=await mr(e,s),{secrets:o,sha:i}=await Mr(e);o[n]=r,await xs(e,o,i)}const Sa="skygit_repos",hc=5*60*1e3,_c=10;let dn=[],Is=null;const yc=JSON.parse(localStorage.getItem(Sa)||"[]"),Ct=ot(yc),Nr=ot(0),Ts=ot(null);Ct.subscribe(e=>{localStorage.setItem(Sa,JSON.stringify(e))});function Ca(e){if(Ct.update(n=>{const s=n.findIndex(r=>r.full_name===e.full_name);if(s>=0){const r=[...n];return r[s]=e,r}return[...n,e]}),dn.some(n=>n.full_name===e.full_name)||dn.push(e),dn.length>=_c){cs();return}Is||(Is=setTimeout(cs,hc))}async function cs(){if(dn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...dn];dn=[],clearTimeout(Is),Is=null;for(const n of t)try{await jr(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(s){console.error("[SkyGit] Failed to commit repo:",n.full_name,s)}}function $a(e){Ct.update(t=>{const n=new Map(t.map(r=>[r.full_name,r]));for(const r of e)n.set(r.full_name,r);const s=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(s)),s})}function Pa(){return dn.length>0}function Aa(e){let t;return Ct.update(n=>(t=n.find(s=>s.full_name===e||s.name===e),n)),t}const Ea=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Nr,flushRepoCommitQueue:cs,getRepoByFullName:Aa,hasPendingRepoCommits:Pa,queueRepoForCommit:Ca,repoList:Ct,selectedRepo:Ts,syncRepoListFromGitHub:$a},Symbol.toStringTag,{value:"Module"}));async function mc(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function bc(e){localStorage.setItem("skygit_token",e)}function wc(){return localStorage.getItem("skygit_token")}const Ra="skygit_conversations",xc=JSON.parse(localStorage.getItem(Ra)||"{}"),zn=ot(xc),Lr=ot(null);zn.subscribe(e=>{localStorage.setItem(Ra,JSON.stringify(e))});function br(e,t){zn.update(n=>({...n,[e]:t}))}function kc(e,t){zn.update(n=>{const s=n[t.full_name]||[];return{...n,[t.full_name]:[...s,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function Da(e,t,n){zn.update(s=>{const o=(s[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...s,[t]:o}}),Lr.update(s=>(s==null?void 0:s.id)===e&&(s==null?void 0:s.repo)===t?{...s,messages:[...s.messages||[],n],updatedAt:n.timestamp||Date.now()}:s)}const Ne=[];for(let e=0;e<256;++e)Ne.push((e+256).toString(16).slice(1));function Sc(e,t=0){return(Ne[e[t+0]]+Ne[e[t+1]]+Ne[e[t+2]]+Ne[e[t+3]]+"-"+Ne[e[t+4]]+Ne[e[t+5]]+"-"+Ne[e[t+6]]+Ne[e[t+7]]+"-"+Ne[e[t+8]]+Ne[e[t+9]]+"-"+Ne[e[t+10]]+Ne[e[t+11]]+Ne[e[t+12]]+Ne[e[t+13]]+Ne[e[t+14]]+Ne[e[t+15]]).toLowerCase()}let lr;const Cc=new Uint8Array(16);function $c(){if(!lr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");lr=crypto.getRandomValues.bind(crypto)}return lr(Cc)}const Pc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wo={randomUUID:Pc};function Ac(e,t,n){var r;if(wo.randomUUID&&!e)return wo.randomUUID();e=e||{};const s=e.random??((r=e.rng)==null?void 0:r.call(e))??$c();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Sc(s)}async function Ec(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=`https://api.github.com/repos/${t.full_name}/contents/.messages`,r=await fetch(s,{headers:n});if(!r.ok)return;const i=(await r.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));br(t.full_name,i),t.conversations=i.map(c=>c.id),await jr(e,t)}async function Oa(e,t){console.log("[SkyGit] ðŸ“ commitToSkyGitConversations() called"),console.log("â© Payload:",t);const n=await $t(e),s=t.repo.replace(/\W+/g,"_"),r=t.title.replace(/\W+/g,"_"),o=`conversations/${s}_${r}.json`,i=btoa(JSON.stringify(t,null,2));let c=null;try{const d=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});d.ok&&(c=(await d.json()).sha)}catch{}const l={message:`Add conversation ${t.id}`,content:i,...c&&{sha:c}},f=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(l)});if(!f.ok){const d=await f.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${f.status} ${d}`)}}async function Rc(e,t,n){console.log("[SkyGit] ðŸ”§ createConversation called for:",t.full_name,"with title:",n),await $t(e);const s=Ac();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const r=`conversation-${s}.json`,o=`.messages/${r}`,i={id:s,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${s}`,content:c})});if(!l.ok){const d=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${d}`)}try{console.log("[SkyGit] ðŸ“¤ Now committing to skygit-config..."),await Oa(e,i)}catch(d){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",d)}const f={id:s,name:r,path:o,repo:t.full_name,title:n};kc(f,t)}const Xn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let ks=!1;function Dc(){ks=!0}async function wr(e){ks=!1;const t=new Set,n=[],s=await cr("https://api.github.com/user/repos",Xn(e));n.push(...s),Ee.update(o=>({...o,totalCount:n.length}));const r=await cr("https://api.github.com/user/orgs",Xn(e));for(const o of r){if(ks)return;const i=await cr(`https://api.github.com/orgs/${o.login}/repos`,Xn(e));n.push(...i),Ee.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(ks)return;const i=o.full_name;if(t.has(i)){Ee.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(i);const c=await Oc(e,i),l=typeof o.has_discussions=="boolean"?o.has_discussions:!1,f={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(f.has_messages){try{const d=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:Xn(e)});if(d.ok){const v=await d.json();f.config=JSON.parse(atob(v.content))}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${i}`,d)}await Ec(e,f)}Ee.update(d=>({...d,loadedCount:d.loadedCount+1})),Ca(f)}try{await cs()}catch(o){console.warn("[SkyGit] Failed to flush repo commit queue:",o)}Ee.update(o=>({...o,phase:"idle"}))}async function cr(e,t){let n=[],s=1,r=!1;for(;!r;){const o=await fetch(`${e}?per_page=100&page=${s}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),r=i.length<100,s++):r=!0}return n}async function Oc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Xn(e)})).status===200}catch{return!1}}const Qe=ot({config:null,secrets:{},secretsSha:null,cleanupMode:!1});async function Ic(e){const t=await $t(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s={config:null,secrets:{},secretsSha:null,cleanupMode:localStorage.getItem("skygit_cleanup_mode")==="true"};try{const r=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in r)br(o,r[o]);console.log("[SkyGit] âœ… Loaded conversations from localStorage")}catch(r){console.warn("[SkyGit] Failed to load local conversations:",r)}try{const r=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(r.ok){const o=await r.json();s.config=JSON.parse(atob(o.content))}else r.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await r.text())}catch(r){console.warn("[SkyGit] Error loading config.json:",r)}try{const r=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(r.ok){const o=await r.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,f]of Object.entries(i))try{c[l]=await Tr(e,f)}catch(d){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,d)}s.secrets=c,s.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),s.secrets={},s.secretsSha=o.sha}}else r.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await r.text())}catch(r){console.warn("[SkyGit] Error loading secrets.json:",r)}Qe.set(s);try{console.log("[SkyGit] Streaming saved repos..."),await ka(e)}catch(r){console.warn("[SkyGit] Failed to stream repos:",r)}try{console.log("[SkyGit] Streaming saved conversations...");const r=await fc(e)||[],o={};for(const i of r)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)br(i,o[i])}catch(r){console.warn("[SkyGit] Failed to stream conversations:",r)}}let us=new Set,Ss=new Map;const Tc=10;function Ia(e,t){const n=`${e}::${t}`;if(us.add(n),us.size>=Tc){Tn();return}const s=jc(e);if(!Ss.has(n)){const r=setTimeout(()=>{Tn([n]),Ss.delete(n)},s);Ss.set(n,r)}}function jc(e){var r;const n=ie(Ct).find(o=>o.full_name===e);return(((r=n==null?void 0:n.config)==null?void 0:r.commit_frequency_min)??5)*60*1e3}async function Tn(e=null){const t=e||Array.from(us);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await $t(n);const s=ie(zn);for(const r of t){us.delete(r),Ss.delete(r);const[o,i]=r.split("::"),l=(s[o]||[]).find(d=>d.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",r);continue}const f={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await Oa(n,f);const d=`.messages/conversation-${f.id}.json`,v=btoa(JSON.stringify(f,null,2));let u=null;try{const b=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"}});b.ok&&(u=(await b.json()).sha)}catch{}const g={message:`Update conversation ${f.id}`,content:v,...u&&{sha:u}},p=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify(g)});if(!p.ok){const b=await p.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,b)}}catch(d){console.error("[SkyGit] Conversation commit failed:",d)}}}function Mc(){return us.size>0}var Nc=A('<p class="text-red-500 text-sm"> </p>'),Lc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticatingâ€¦',1),Gc=A('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Donâ€™t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function Uc(e,t){We(t,!1);let n=st(t,"onSubmit",8),s=st(t,"error",8,null),r=j(""),o=j(!1);async function i(){a(o)||(y(o,!0),await n()(a(r)),y(o,!1))}et();var c=Gc(),l=h(_(c),2),f=h(l,2);{var d=b=>{var S=Nc(),C=_(S);Q(()=>W(C,s())),m(b,S)};T(f,b=>{s()&&b(d)})}var v=h(f,2),u=_(v);{var g=b=>{var S=Lc();m(b,S)},p=b=>{var S=Ue("Authenticate");m(b,S)};T(u,b=>{a(o)?b(g):b(p,!1)})}Q(()=>{l.disabled=a(o),v.disabled=a(o)}),nt(l,()=>a(r),b=>y(r,b)),N("click",v,i),m(e,c),Ke()}var Fc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),zc=A('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function Jc(e,t){We(t,!1);let n=st(t,"onApprove",8),s=st(t,"onReject",8),r=j(!1);async function o(){a(r)||(y(r,!0),await n()(),y(r,!1))}et();var i=zc(),c=h(_(i),6),l=_(c),f=_(l);{var d=g=>{var p=Fc();m(g,p)},v=g=>{var p=Ue("I Accept");m(g,p)};T(f,g=>{a(r)?g(d):g(v,!1)})}var u=h(l,2);Q(()=>{l.disabled=a(r),u.disabled=a(r)}),N("click",l,o),N("click",u,function(...g){var p;(p=s())==null||p.apply(this,g)}),m(e,i),Ke()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const qc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Vc=fa("<svg><!><!></svg>");function mn(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]),s=jt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);We(t,!1);let r=st(t,"name",8,void 0),o=st(t,"color",8,"currentColor"),i=st(t,"size",8,24),c=st(t,"strokeWidth",8,2),l=st(t,"absoluteStrokeWidth",8,!1),f=st(t,"iconNode",24,()=>[]);const d=(...b)=>b.filter((S,C,M)=>!!S&&M.indexOf(S)===C).join(" ");et();var v=Vc();let u;var g=_(v);Tt(g,1,f,ls,(b,S)=>{let C=()=>a(S)[0],M=()=>a(S)[1];var k=Ae(),w=de(k);Fl(w,C,!0,(R,U)=>{let D;Q(()=>D=go(R,D,{...M()}))}),m(b,k)});var p=h(g);Lt(p,t,"default",{}),Q((b,S)=>u=go(v,u,{...qc,...s,width:i(),height:i(),stroke:o(),"stroke-width":b,class:S}),[()=>l()?Number(c())*24/Number(i()):c(),()=>d("lucide-icon","lucide",r()?`lucide-${r()}`:"",n.class)],ht),m(e,v),Ke()}function Hc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function Bc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function xo(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function Wc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function Kc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function Yc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}function Qc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);mn(e,yn({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(r,o)=>{var i=Ae(),c=de(i);Lt(c,t,"default",{}),m(r,i)},$$slots:{default:!0}}))}const js=ot({});function ko(e,t){js.update(n=>({...n,[e]:t}))}var Zc=A('<span title="Presence paused" class="mt-0.5">â¸ï¸</span>'),Xc=A('<span title="Presence active" class="mt-0.5">â–¶ï¸</span>'),eu=A('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),tu=A('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),nu=A('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left flex gap-2 items-start"><!> <div class="flex-1"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></div></button>'),su=A('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),ru=A('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function ou(e,t){We(t,!1);const n=j();let s=j({}),r=j({});zn.subscribe(d=>y(s,d)),js.subscribe(d=>y(r,d));function o(d){Ks.set(d),Lr.set(d),it.set("chats")}vt(()=>a(s),()=>{y(n,Object.values(a(s)).flat().sort((d,v)=>{const u=new Date(d.updatedAt||d.createdAt||0).getTime();return new Date(v.updatedAt||v.createdAt||0).getTime()-u}))}),ds(),et();var i=ru(),c=_(i);Tt(c,1,()=>a(n),d=>d.id,(d,v)=>{var u=Ae(),g=de(u);Ml(g,()=>`${a(v).id}-${a(r)[a(v).repo]}`,p=>{var b=nu(),S=_(b);{var C=q=>{var Y=Zc();m(q,Y)},M=q=>{var Y=Xc();m(q,Y)};T(S,q=>{a(r)[a(v).repo]===!1?q(C):q(M,!1)})}var k=h(S,2),w=_(k),R=_(w),U=h(w,2),D=_(U),O=h(U,2);{var H=q=>{var Y=eu(),me=_(Y);Q(Ce=>W(me,Ce),[()=>a(v).messages.at(-1).content],ht),m(q,Y)},ee=q=>{var Y=tu();m(q,Y)};T(O,q=>{a(v).messages&&a(v).messages.length>0?q(H):q(ee,!1)})}Q(q=>{W(R,q),W(D,a(v).repo)},[()=>a(v).title||`Conversation ${a(v).id.slice(0,6)}`],ht),N("click",b,()=>o(a(v))),m(p,b)}),m(d,u)});var l=h(c,2);{var f=d=>{var v=su();m(d,v)};T(l,d=>{a(n).length===0&&d(f)})}m(e,i),Ke()}var au=A('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),iu=A('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),lu=A('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">âœ”ï¸ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">ðŸ”„ Sync</button> <button class="text-blue-600 text-xs underline">ðŸ” Discover</button></div></div>'),cu=A('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),uu=A('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),fu=A('<ul class="space-y-2"></ul>'),du=A('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),vu=A('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),pu=A('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> ðŸ”’ Private</label> <label><input type="checkbox"> ðŸŒ Public</label> <label><input type="checkbox"> ðŸ’¬ With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function gu(e,t){We(t,!1);const n=j(),s=j();let r=st(t,"search",8,""),o=j([]),i=j(),c=j(),l=j(!0),f=j(!0),d=j(!0),v=j(!0);Ct.subscribe(P=>y(o,P)),Ee.subscribe(P=>y(i,P));function u(){Ee.update(P=>({...P,paused:!P.paused}))}function g(){if(a(i).paused){Ee.update(L=>({...L,paused:!1}));const P=localStorage.getItem("skygit_token");P&&wr(P)}else Dc(),Ee.update(P=>({...P,paused:!0}))}async function p(P){const L=a(o).find(X=>X.full_name===P);if(L){Ct.update(X=>X.filter(le=>le.full_name!==P));try{const X=localStorage.getItem("skygit_token");await dc(X,L),console.log(`[SkyGit] Deleted ${P} from GitHub`)}catch(X){console.warn(`[SkyGit] Failed to delete ${P} from GitHub:`,X)}}}async function b(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"streaming",paused:!1,loadedCount:0})),await ka(P))}async function S(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"discovery",paused:!1})),wr(P))}function C(P){Ts.set(P),Ks.set(P)}vt(()=>(a(o),Or(r()),a(l),a(f),a(d),a(v)),()=>{y(n,a(o).filter(P=>{const L=r().toLowerCase(),X=P.full_name.toLowerCase().includes(L)||P.name.toLowerCase().includes(L)||P.owner.toLowerCase().includes(L),le=P.private&&a(l)||!P.private&&a(f),B=P.has_messages&&a(d)||!P.has_messages&&a(v);return X&&le&&B}))}),vt(()=>a(n),()=>{Nr.set(a(n).length)}),vt(()=>a(o),()=>{y(s,a(o).some(P=>!P.has_discussions))}),ds(),et();var M=pu(),k=de(M);{var w=P=>{var L=au(),X=_(L),le=_(X);xo(le,{class:"w-4 h-4 animate-spin text-blue-500"});var B=h(le,2),te=_(B),V=h(X,2),pe=_(V);Q(()=>{W(te,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),W(pe,a(i).paused?"Resume Syncing":"Pause Syncing")}),N("click",V,u),m(P,L)},R=(P,L)=>{{var X=B=>{var te=iu(),V=_(te);xo(V,{class:"w-4 h-4 animate-spin text-blue-500"});var pe=h(V,2),be=_(pe),G=h(pe,2),Z=_(G);Q(()=>{W(be,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),W(Z,a(i).paused?"Resume Discovery":"Pause Discovery")}),N("click",G,g),m(B,te)},le=(B,te)=>{{var V=pe=>{var be=lu(),G=h(_(be),2),Z=_(G),we=h(Z,2);N("click",Z,b),N("click",we,S),m(pe,be)};T(B,pe=>{a(i).phase==="idle"&&pe(V)},te)}};T(P,B=>{a(i).phase==="discovery"?B(X):B(le,!1)},L)}};T(k,P=>{a(i).phase==="streaming"?P(w):P(R,!1)})}var U=h(k,2),D=_(U),O=_(D),H=h(D,2),ee=_(H),q=h(H,2),Y=_(q),me=h(q,2),Ce=_(me),Re=h(U,2);{var $e=P=>{var L=fu();Tt(L,5,()=>a(n),X=>X.full_name,(X,le)=>{var B=uu(),te=_(B),V=_(te),pe=_(V),be=h(V,2),G=_(be),Z=h(G);{var we=he=>{var xe=cu();m(he,xe)};T(Z,he=>{a(le).has_discussions||he(we)})}Zn(te,he=>y(c,he),()=>a(c));var ce=h(te,2),De=_(ce);Yc(De,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),Q(()=>{W(pe,a(le).full_name),W(G,`${(a(le).has_messages?" | ðŸ’¬ .messages":" | no messaging")??""} `)}),N("click",V,()=>C(a(le))),N("click",ce,()=>p(a(le).full_name)),m(X,B)}),m(P,L)},z=P=>{var L=du();m(P,L)};T(Re,P=>{a(n).length>0?P($e):P(z,!1)})}var ne=h(Re,2);{var fe=P=>{var L=vu();m(P,L)};T(ne,P=>{a(s)&&P(fe)})}Qn(O,()=>a(l),P=>y(l,P)),Qn(ee,()=>a(f),P=>y(f,P)),Qn(Y,()=>a(d),P=>y(d,P)),Qn(Ce,()=>a(v),P=>y(v,P)),m(e,M),Ke()}var hu=A('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function _u(e){var t=hu();m(e,t)}var yu=A('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function mu(e){var t=yu();m(e,t)}var bu=A('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function wu(e){var t=bu();m(e,t)}function ur(e,t){const n=s=>{e.contains(s.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var xu=A('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),ku=A('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Su=A('<button type="button"><div><!></div> <!> </button>'),Cu=A('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">â‹¯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function $u(e,t){We(t,!1);const[n,s]=Ws(),r=()=>gn(it,"$currentRoute",n),o=()=>gn(Nr,"$filteredCount",n);let i=j(null),c=j(!1),l=j("");function f(){it.set("settings")}function d(z){it.set(z)}Dt.subscribe(z=>{y(i,z.user)});const v=[{id:"chats",icon:Wc,label:"Chats"},{id:"repos",icon:Bc,label:"Repos"},{id:"calls",icon:Kc,label:"Calls"},{id:"contacts",icon:Qc,label:"Contacts"},{id:"notifications",icon:Hc,label:"Notifs"}];function u(){y(c,!a(c))}function g(){y(c,!1)}et();var p=Cu(),b=_(p),S=_(b),C=_(S),M=h(C,2),k=_(M),w=_(k),R=h(k,2),U=_(R),D=h(S,2),O=h(D,2);{var H=z=>{var ne=xu(),fe=_(ne),P=h(fe,6);zl(ne,(L,X)=>ur==null?void 0:ur(L,X),()=>g),N("click",fe,f),N("click",P,function(...L){ir==null||ir.apply(this,L)}),m(z,ne)};T(O,z=>{a(c)&&z(H)})}var ee=h(b,2),q=_(ee),Y=h(ee,2);Tt(Y,5,()=>v,ls,(z,ne)=>{let fe=()=>a(ne).id,P=()=>a(ne).icon,L=()=>a(ne).label;var X=Su();let le;var B=_(X),te=_(B);P()(te,{class:"w-5 h-5"});var V=h(B,2);{var pe=G=>{var Z=ku(),we=_(Z);Q(()=>W(we,o())),m(G,Z)};T(V,G=>{fe()==="repos"&&a(l).trim()!==""&&G(pe)})}var be=h(V);Q(G=>{le=In(X,1,"relative flex flex-col items-center text-xs focus:outline-none",null,le,G),In(B,1,`w-10 h-10 rounded-full flex items-center justify-center ${r()===fe()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),W(be,` ${L()??""}`)},[()=>({"text-blue-600":r()===fe()})],ht),N("click",X,()=>d(fe())),m(z,X)});var me=h(Y,2),Ce=_(me);{var Re=z=>{ou(z,{})},$e=(z,ne)=>{{var fe=L=>{gu(L,{get search(){return a(l)}})},P=(L,X)=>{{var le=te=>{_u(te)},B=(te,V)=>{{var pe=G=>{mu(G)},be=(G,Z)=>{{var we=ce=>{wu(ce)};T(G,ce=>{r()==="notifications"&&ce(we)},Z)}};T(te,G=>{r()==="contacts"?G(pe):G(be,!1)},V)}};T(L,te=>{r()==="calls"?te(le):te(B,!1)},X)}};T(z,L=>{r()==="repos"?L(fe):L(P,!1)},ne)}};T(Ce,z=>{r()==="chats"?z(Re):z($e,!1)})}Q(()=>{var z,ne,fe,P;Et(C,"src",(z=a(i))==null?void 0:z.avatar_url),W(w,((ne=a(i))==null?void 0:ne.name)||((fe=a(i))==null?void 0:fe.login)),W(U,`@${((P=a(i))==null?void 0:P.login)??""}`)}),N("click",D,u),nt(q,()=>a(l),z=>y(l,z)),m(e,p),Ke(),s()}var Pu=A('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">â†</button>'),Au=A('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Ys(e,t){We(t,!1);let n=j(!1);function s(p){y(n,p.detail.open)}Dt.subscribe(p=>{p.user}),gs(()=>{const p=()=>{window.innerWidth>=768&&y(n,!1)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)}),Ks.subscribe(p=>{p&&window.innerWidth<768&&y(n,!1)}),et();var r=Au(),o=_(r),i=_(o);{var c=p=>{var b=Pu();N("click",b,()=>y(n,!0)),m(p,b)};T(i,p=>{a(n)||p(c)})}var l=h(o,2);let f;var d=_(l);$u(d,{$$events:{toggle:s}});var v=h(l,2);let u;var g=_(v);Lt(g,t,"default",{}),Q((p,b)=>{f=In(l,1,"sidebar md:block svelte-scw01y",null,f,p),u=In(v,1,"main w-full svelte-scw01y",null,u,b)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],ht),m(e,r),Ke()}var Eu=A('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function Ru(e){Ys(e,{children:(t,n)=>{var s=Eu();m(t,s)},$$slots:{default:!0}})}var Du=A('<button title="Save">ðŸ’¾</button>'),Ou=A('<button title="Edit">âœï¸</button>'),Iu=A('<button title="Hide">ðŸ™ˆ</button> <!>',1),Tu=A('<button title="Reveal">ðŸ‘ï¸</button>'),ju=A('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),Mu=A('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),Nu=A('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),Lu=A('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),Gu=A('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">ðŸ—‘ï¸</button></td></tr> <!>',1),Uu=A('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Fu=A('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),zu=A('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">ðŸ” Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">âž• Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">ðŸ’¾ Add Credential</button></div> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">App Settings</h3> <label class="flex items-center space-x-2"><input type="checkbox"> <span>Cleanup mode (delete old presence channels)</span></label></div></div>');function Ju(e,t){We(t,!1);let n=j({}),s=j({}),r=j(new Set),o=j(null),i=j(""),c=j("s3"),l=j({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),f=j({}),d=null,v=j(!1);const u=localStorage.getItem("skygit_token");gs(async()=>{if(y(v,ie(Qe).cleanupMode||!1),!u)return;const w=await Mr(u);y(n,w.secrets),d=w.sha});async function g(w){try{a(s)[w]||ke(s,a(s)[w]=await Tr(u,a(n)[w])),y(r,new Set(a(r)).add(w))}catch{alert("âŒ Failed to decrypt.")}}function p(w){y(r,new Set([...a(r)].filter(R=>R!==w))),a(o)===w&&y(o,null)}function b(w){a(r).has(w)||y(r,new Set(a(r)).add(w)),y(o,w),y(f,{...a(s)[w]})}async function S(w){const R=await mr(u,a(f));ke(n,a(n)[w]=R),y(n,{...a(n)}),ke(s,a(s)[w]=a(f)),y(s,{...a(s)}),y(r,new Set(a(r)).add(w)),y(o,null),await xs(u,a(n),d)}async function C(w){confirm(`Are you sure you want to delete the credential for:
${w}?`)&&(delete a(n)[w],y(n,{...a(n)}),delete a(s)[w],y(s,{...a(s)}),y(r,new Set([...a(r)].filter(R=>R!==w))),a(o)===w&&y(o,null),await xs(u,a(n),d))}async function M(){if(!a(i)||!a(c))return;const w=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},R=await mr(u,w);ke(n,a(n)[a(i)]=R),y(n,{...a(n)}),ke(s,a(s)[a(i)]=w),y(s,{...a(s)}),y(r,new Set(a(r)).add(a(i))),y(i,""),y(c,"s3"),y(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await xs(u,a(n),d)}function k(){Qe.update(w=>({...w,cleanupMode:a(v)})),localStorage.setItem("skygit_cleanup_mode",a(v)?"true":"false")}et(),Ys(e,{children:(w,R)=>{var U=zu(),D=h(_(U),2),O=h(_(D));Tt(O,5,()=>Object.entries(a(n)),ls,(B,te)=>{let V=()=>a(te)[0],pe=()=>a(te)[1];var be=Gu(),G=de(be),Z=_(G),we=_(Z),ce=h(Z),De=_(ce),he=h(ce),xe=_(he);{var yt=_e=>{var Te=Ue();Q(()=>W(Te,a(s)[V()].type==="s3"?"S3":"Google Drive")),m(_e,Te)},Gt=_e=>{var Te=Ue("?");m(_e,Te)};T(xe,_e=>{a(s)[V()]?_e(yt):_e(Gt,!1)})}var Ut=h(he),ct=_(Ut);{var tn=_e=>{var Te=Iu(),Ft=de(Te),zt=h(Ft,2);{var rn=oe=>{var Oe=Du();N("click",Oe,()=>S(V())),m(oe,Oe)},on=oe=>{var Oe=Ou();N("click",Oe,()=>b(V())),m(oe,Oe)};T(zt,oe=>{a(o)===V()?oe(rn):oe(on,!1)})}N("click",Ft,()=>p(V())),m(_e,Te)},nn=_e=>{var Te=Tu();N("click",Te,()=>g(V())),m(_e,Te)};T(ct,_e=>{a(r).has(V())?_e(tn):_e(nn,!1)})}var bn=h(ct,2),wn=h(G,2);{var sn=_e=>{var Te=Lu(),Ft=_(Te),zt=_(Ft);{var rn=oe=>{var Oe=Mu(),x=de(Oe),$=h(_(x),2),I=_($),J={},K=_(I),ye=h(x,2);Tt(ye,1,()=>Object.entries(a(f)),ls,(se,ae)=>{let je=()=>a(ae)[0];var ut=Ae(),Fe=de(ut);{var Jt=Pt=>{var an=ju(),qt=_(an),xn=_(qt),kn=h(qt,2);Q(()=>W(xn,je())),nt(kn,()=>a(f)[je()],Vt=>ke(f,a(f)[je()]=Vt)),m(Pt,an)};T(Fe,Pt=>{je()!=="type"&&Pt(Jt)})}m(se,ut)}),Q(()=>{J!==(J=a(f).type)&&(I.value=(I.__value=a(f).type)==null?"":a(f).type),W(K,a(f).type)}),m(oe,Oe)},on=oe=>{var Oe=Nu(),x=_(Oe);Q($=>W(x,`${$??""}
                                    `),[()=>JSON.stringify(a(s)[V()],null,2)],ht),m(oe,Oe)};T(zt,oe=>{a(o)===V()?oe(rn):oe(on,!1)})}m(_e,Te)};T(wn,_e=>{a(r).has(V())&&_e(sn)})}Q(_e=>{W(we,V()),W(De,`${_e??""}...`)},[()=>pe().slice(0,20)],ht),N("click",bn,()=>C(V())),m(B,be)});var H=h(D,2),ee=h(_(H),2),q=_(ee),Y=h(_(q)),me=h(q,2),Ce=h(_(me));Q(()=>{a(c),pr(()=>{})});var Re=_(Ce);Re.value=(Re.__value="s3")==null?"":"s3";var $e=h(Re);$e.value=($e.__value="google_drive")==null?"":"google_drive";var z=h(ee,2);{var ne=B=>{var te=Uu(),V=_(te),pe=h(_(V)),be=h(V,2),G=h(_(be)),Z=h(be,2),we=h(_(Z));nt(pe,()=>a(l).accessKeyId,ce=>ke(l,a(l).accessKeyId=ce)),nt(G,()=>a(l).secretAccessKey,ce=>ke(l,a(l).secretAccessKey=ce)),nt(we,()=>a(l).region,ce=>ke(l,a(l).region=ce)),m(B,te)},fe=(B,te)=>{{var V=pe=>{var be=Fu(),G=_(be),Z=h(_(G)),we=h(G,2),ce=h(_(we)),De=h(we,2),he=h(_(De));nt(Z,()=>a(l).client_id,xe=>ke(l,a(l).client_id=xe)),nt(ce,()=>a(l).client_secret,xe=>ke(l,a(l).client_secret=xe)),nt(he,()=>a(l).refresh_token,xe=>ke(l,a(l).refresh_token=xe)),m(pe,be)};T(B,pe=>{a(c)==="google_drive"&&pe(V)},te)}};T(z,B=>{a(c)==="s3"?B(ne):B(fe,!1)})}var P=h(z,2),L=h(H,2),X=h(_(L),2),le=_(X);nt(Y,()=>a(i),B=>y(i,B)),_r(Ce,()=>a(c),B=>y(c,B)),N("click",P,M),Qn(le,()=>a(v),B=>y(v,B)),N("change",le,k),m(w,U)},$$slots:{default:!0}}),Ke()}var qu=A('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),Vu=A('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),Hu=A('<div class="p-4 space-y-3"><!></div>');function Bu(e,t){We(t,!1);const[n,s]=Ws(),r=()=>gn(Lr,"$selectedConversation",n),o=j(),i=j();vt(()=>r(),()=>{y(o,r())}),vt(()=>a(o),()=>{var v;y(i,((v=a(o))==null?void 0:v.messages)??[])}),vt(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),ds(),et();var c=Hu(),l=_(c);{var f=v=>{var u=Ae(),g=de(u);Tt(g,1,()=>a(i),p=>p.id||p.timestamp,(p,b)=>{var S=qu(),C=_(S),M=_(C),k=h(C,2),w=_(k),R=h(k,2),U=_(R);Q(D=>{W(M,a(b).sender),W(w,a(b).content),W(U,D)},[()=>new Date(a(b).timestamp).toLocaleString()],ht),m(p,S)}),m(v,u)},d=v=>{var u=Vu();m(v,u)};T(l,v=>{a(i).length>0?v(f):v(d,!1)})}m(e,c),Ke(),s()}const So="skygit_context_id";function Ta(){if(typeof window>"u")return"server";let e=localStorage.getItem(So);return e||(e=crypto.randomUUID(),localStorage.setItem(So,e)),e}const Be="https://api.github.com";let Ms=!1;async function Wu(e,t,n){const[s,r]=t.split("/");return(await Zt(e,`
    query($owner:String!,$name:String!,$number:Int!){
      repository(owner:$owner,name:$name){ discussion(number:$number){ id } }
    }`,{owner:s,name:r,number:n})).repository.discussion.id}async function Ku(e,t,n){await Zt(e,`
    mutation($id:ID!,$body:String!){
      addDiscussionComment(input:{discussionId:$id,body:$body}){ clientMutationId }
    }`,{id:t,body:n})}async function ja(e,t,n){await Zt(e,`
    mutation($cid:ID!,$body:String!){
      updateDiscussionComment(input:{commentId:$cid,body:$body}){ clientMutationId }
    }`,{cid:t,body:n})}async function Ma(e,t){await Zt(e,`
    mutation($cid:ID!){ deleteDiscussionComment(input:{id:$cid}){ clientMutationId } }`,{cid:t})}async function Yu(e,t){await Zt(e,`
    mutation($id:ID!){ deleteDiscussion(input:{id:$id}){ clientMutationId } }`,{id:t})}async function Zt(e,t,n={}){const s=await fetch(`${Be}/graphql`,{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})});if(!s.ok){const o=await s.text();throw new Error(`GraphQL API error (${s.status}): ${o}`)}const r=await s.json();if(r.errors&&r.errors.length)throw new Error(`GraphQL API returned errors: ${JSON.stringify(r.errors)}`);return r.data}function bs(e){return`skygit_presence_discussion_${e}`}async function en(e,t,n=!1){var v;if(!n&&typeof window<"u"){const u=localStorage.getItem(bs(t));if(u)try{if((await fetch(`${Be}/repos/${t}/discussions/${u}`,{headers:{Authorization:`token ${e}`}})).ok)return Number(u);localStorage.removeItem(bs(t))}catch{}}const s={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},r=`${Be}/repos/${t}/discussions?per_page=100`;let o=[];try{let u=1;for(;;){const g=await fetch(`${r}&page=${u}`,{headers:s});if(!g.ok)break;const p=await g.json();if(o=o.concat(p),p.length<100)break;u++}}catch{}const i=o.filter(u=>u.title==="SkyGit Presence Channel");if(i.length){const u=i[0];if(n&&i.length>1)for(const g of i.slice(1))try{await Yu(e,g.node_id)}catch{}return typeof window<"u"&&localStorage.setItem(bs(t),u.number),u.number}let c;try{const u=await fetch(`${Be}/repos/${t}/discussions/categories`,{headers:s});if(u.ok){const g=await u.json();g.length&&(c=((v=g.find(p=>p.slug==="general"))==null?void 0:v.id)||g[0].id)}}catch{}if(!c){const[u,g]=t.split("/");try{const b=(await Zt(e,`
        query($owner:String!,$name:String!){
          repository(owner:$owner,name:$name){
            discussionCategories(first:50){ nodes{ id slug name } }
          }
        }`,{owner:u,name:g})).repository.discussionCategories.nodes;b.length&&(c=(b.find(C=>C.slug==="general")||b[0]).id)}catch(p){console.warn("[SkyGit][Presence] GraphQL categories fallback failed",p)}}if(!c)throw new Error("Failed to resolve a discussion category id");if(typeof c=="string"&&c.startsWith("DIC_")){const[u,g]=t.split("/"),p=`
      mutation($repoId:ID!,$catId:ID!,$title:String!,$body:String!){
        createDiscussion(input:{repositoryId:$repoId,categoryId:$catId,title:$title,body:$body}){
          discussion{ number }
        }
      }`,S=(await Zt(e,"query($owner:String!,$name:String!){repository(owner:$owner,name:$name){id}}",{owner:u,name:g})).repository.id,C=await Zt(e,p,{repoId:S,catId:c,title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."});return l(C.createDiscussion.discussion.number)}function l(u){return typeof window<"u"&&localStorage.setItem(bs(t),u),u}const f=await fetch(r,{method:"POST",headers:{...s,"Content-Type":"application/json"},body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore.",category_id:c})});if(!f.ok){if(f.status===422||f.status===409){const u=await fetch(r,{headers:s});if(u.ok){const p=(await u.json()).find(b=>b.title==="SkyGit Presence Channel");if(p)return l(p.number)}}throw new Error("Failed to create presence discussion")}const d=await f.json();return l(d.number)}function Qu(e,t){const n=s=>{const{last_seen:r,...o}=s;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function Zu(e,t,n,s,r=null,o=!1){const i=await en(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${Be}/repos/${t}/discussions/${i}/comments`;let f=null;async function d(){return f||(f=await Wu(e,t,i),f)}const v=new Date().toISOString();let u=v,g=await fetch(l,{headers:c}),p=[];if(!g.ok&&g.status===404){clearCachedDiscussion(t);const D=await en(e,t,o);D!==i&&(i=D,f=null,g=await fetch(`${Be}/repos/${t}/discussions/${i}/comments`,{headers:c}))}g.ok&&(p=await g.json());let b=null;if(typeof window<"u"&&(b=localStorage.getItem(C())),b&&!p.some(D=>String(D.id)===b))try{const D=await fetch(`${Be}/repos/${t}/discussions/comments/${b}`,{headers:c});if(D.ok){const O=await D.json();p.push(O)}else typeof window<"u"&&localStorage.removeItem(C()),b=null}catch{}const S=Ta();function C(){return`skygit_presence_comment_${t}_${S}`}const M=p.filter(D=>{try{const O=JSON.parse(D.body);return O.username===n&&O.context_id===S}catch{return!1}}),k=M.find(D=>{try{return JSON.parse(D.body).session_id===s}catch{return!1}});if(k)try{const D=JSON.parse(k.body);D.join_timestamp&&(u=D.join_timestamp)}catch{}const w={username:n,context_id:S,session_id:s,join_timestamp:u,last_seen:v,signaling_info:r};let R=!1;if(k){let D;try{D=JSON.parse(k.body)}catch{D={}}const O=Math.abs(new Date(v)-new Date(D.last_seen));(!Qu(D,w)||O>3e4)&&(R=!0)}if(k&&R){try{await ja(e,k.node_id,JSON.stringify(w)),typeof window<"u"&&localStorage.setItem(C(),String(k.id))}catch{const O=`${l}/${k.id}`;await fetch(O,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(w)})}),typeof window<"u"&&localStorage.setItem(C(),String(k.id))}Ms||Co(t,k.id)}else if(!k)try{const D=await d();await Ku(e,D,JSON.stringify(w));const O=await fetch(l,{headers:c});if(O.ok){const ee=(await O.json()).find(q=>{try{const Y=JSON.parse(q.body);return Y.session_id===s&&Y.context_id===S}catch{return!1}});ee&&typeof window<"u"&&(localStorage.setItem(C(),String(ee.id)),Ms||Co(t,ee.id))}}catch{await fetch(l,{method:"POST",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(w)})});try{const O=await fetch(l+"?per_page=1",{headers:c});if(O.ok){const H=await O.json();H.length&&typeof window<"u"&&localStorage.setItem(C(),String(H[0].id))}}catch{}}const U=10*60*1e3;for(const D of M)if(!(k&&D.id===k.id))try{const O=JSON.parse(D.body);Date.now()-new Date(O.last_seen||O.join_timestamp).getTime()>U&&(await Ma(e,D.node_id),typeof window<"u"&&b===String(D.id)&&localStorage.removeItem(C()))}catch{}}function Co(e,t){typeof window>"u"||Ms||(Ms=!0,window.addEventListener("beforeunload",()=>{const n=`${Be}/repos/${e}/discussions/comments/${t}`,s={body:JSON.stringify({left_at:new Date().toISOString()})};fetch(n,{method:"PATCH",headers:{Authorization:`token ${localStorage.getItem("skygit_token")||""}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json","Content-Type":"application/json"},body:JSON.stringify(s),keepalive:!0}).catch(()=>{})}))}async function Xu(e,t,n,s,r,o=!1){const i=await en(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${Be}/repos/${t}/discussions/${i}/comments`;let f=await fetch(l,{headers:c});if(!f.ok&&f.status===404){clearCachedDiscussion(t);const u=await en(e,t,o);u!==i&&(i=u,f=await fetch(`${Be}/repos/${t}/discussions/${i}/comments`,{headers:c}))}if(!f.ok)return;const v=(await f.json()).find(u=>{try{const g=JSON.parse(u.body);return g.username===n&&g.session_id===s}catch{return!1}});if(v){let u;try{u=JSON.parse(v.body)}catch{u={}}u.pendingRemovalBy=r,u.pendingRemovalAt=new Date().toISOString();try{await ja(e,v.node_id,JSON.stringify(u))}catch{const p=`${l}/${v.id}`;await fetch(p,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(u)})})}console.debug("[SkyGit][Presence] marked peer for pending removal",n,s)}}async function ef(e,t,n,s,r=!1){const o=await en(e,t,r),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},c=`${Be}/repos/${t}/discussions/${o}/comments`;let l=await fetch(c,{headers:i});if(!l.ok&&l.status===404){clearCachedDiscussion(t);const v=await en(e,t,r);v!==o&&(o=v,l=await fetch(`${Be}/repos/${t}/discussions/${o}/comments`,{headers:i}))}if(!l.ok)return;const d=(await l.json()).find(v=>{try{const u=JSON.parse(v.body);return u.username===n&&u.session_id===s}catch{return!1}});if(d){let v;try{v=JSON.parse(d.body)}catch{v={}}if(v.pendingRemovalBy&&v.pendingRemovalAt&&Date.now()-new Date(v.pendingRemovalAt).getTime()>6e4){try{await Ma(e,d.node_id)}catch{const p=`${c}/${d.id}`;await fetch(p,{method:"DELETE",headers:i})}console.debug("[SkyGit][Presence] deleted stale peer presence",n,s)}}}async function tf(e,t,n=!1){const s=await en(e,t,n),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},o=`${Be}/repos/${t}/discussions/${s}/comments`;let i=await fetch(o,{headers:r});if(!i.ok&&i.status===404){clearCachedDiscussion(t);const d=await en(e,t,n);d!==s&&(s=d,i=await fetch(`${Be}/repos/${t}/discussions/${s}/comments`,{headers:r}))}if(!i.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",i.status,i.statusText),[];const c=await i.json(),l=Date.now(),f=c.map(d=>{try{return JSON.parse(d.body)}catch{return null}}).filter(Boolean).filter(d=>d.last_seen&&l-new Date(d.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",f),f}async function Ns(e,t,n,s,r=null,o=!1){await Zu(e,t,n,s,r,o)}async function Gr(e,t,n=!1){return await tf(e,t,n)}async function nf(e,t){if(typeof window>"u")return;const n=`skygit_presence_comment_${t}_${Ta()}`,s=localStorage.getItem(n);if(!s)return;const r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"};try{await fetch(`${Be}/repos/${t}/discussions/comments/${s}`,{method:"DELETE",headers:r})}catch(o){console.warn("[SkyGit][Presence] failed to delete own presence comment",o)}localStorage.removeItem(n)}class sf{constructor({token:t,repoFullName:n,peerUsername:s,isPersistent:r=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:f,onFileSendProgress:d}){this.token=t,this.repoFullName=n,this.peerUsername=s,this.isPersistent=r,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=f,this.onFileSendProgress=d,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=s=>{s.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:s.candidate})},this.peerConnection.ontrack=s=>{this.onRemoteStream&&this.onRemoteStream(s.streams[0])},this.peerConnection.ondatachannel=s=>{this.remoteDataChannel=s.channel,this.setupDataChannel(s.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:s})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:s})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),s=16*1024,r=Math.ceil(t.size/s),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:r};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=d=>{if(d.target.readyState!==FileReader.DONE)return;const v=new Uint8Array(d.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(v)}),c++,i+=s,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,r),i<t.size?f():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,r,r))};const f=()=>{const d=t.slice(i,i+s);l.readAsArrayBuffer(d)};f()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const s=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,s),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const s=this.peerConnection.getSenders().find(r=>r.track&&r.track.kind==="video");s&&s.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Ie=ot({}),rt=ot([]);let Ot=null,Ve=null,pt=null,Se=null;function rf(){return Se}let Na=null,An=null,un=null;function $o(){La(),Ie.set({}),rt.set([]),clearInterval(un),un=null,es={token:null,repoFullName:null,username:null}}let es={token:null,repoFullName:null,username:null};function Po({_token:e,_repoFullName:t,_username:n,_sessionId:s}){es.token===e&&es.repoFullName===t&&es.username===n||(es={token:e,repoFullName:t,username:n},La(),Ie.set({}),rt.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:s}),pt=e,Ve=t,Ot=n,Se=s,Gr(pt,Ve,ie(Qe).cleanupMode).then(r=>{console.log("[SkyGit][Presence] initial peers:",r);const o=r.filter(i=>i.username!==Ot);rt.set(o),Ur(r),Ga(),Ua(),jn(r,Se)?of():af()}).catch(r=>{console.error("[SkyGit][Presence] initial poll error",r)}))}function of(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Ve,"as",Ot,"session",Se),Ns(pt,Ve,Ot,Se,null,ie(Qe).cleanupMode),Na=setInterval(()=>{Ns(pt,Ve,Ot,Se,null,ie(Qe).cleanupMode)},3e4),An=setInterval(async()=>{const e=await Gr(pt,Ve,ie(Qe).cleanupMode);console.log("[SkyGit][Presence] [Leader] polled peers:",e),rt.set(e.filter(t=>t.session_id!==Se)),Ur(e),Ga(),Ua()},5e3)}function af(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Ve,"as",Ot,"session",Se);const e=async()=>{const n=await Gr(pt,Ve,ie(Qe).cleanupMode);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),rt.set(n.filter(s=>s.session_id!==Se)),Ur(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),An=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Ie.subscribe(n=>{Object.values(n).some(r=>r.status==="connected")&&An&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(An),An=null,t())})}function La(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(Na),clearInterval(An)}async function Ur(e){Ie.update(t=>{const n={...t},s=Fr(e,Se);if(Se===s){for(const r of e)r.session_id!==Se&&(n[r.session_id]||(n[r.session_id]={status:"connecting",conn:null,username:r.username},Eo(r,n)));Object.keys(n).forEach(r=>{r!==Se&&(e.some(o=>o.session_id===r)||(n[r].conn&&n[r].conn.stop(),delete n[r]))})}else{const r=e.find(o=>o.session_id===s);Object.keys(n).forEach(o=>{o!==s&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),r&&!n[s]&&(n[s]={status:"connecting",conn:null,username:r.username},Eo(r,n))}return n});for(const t of e){if(t.session_id===Se)continue;const n=ie(Ie);n[t.session_id]&&n[t.session_id].status==="connected"||(Xu(pt,Ve,t.username,t.session_id,Ot,ie(Qe).cleanupMode),setTimeout(()=>{ef(pt,Ve,t.username,t.session_id,ie(Qe).cleanupMode)},6e4))}}function Fr(e,t){return e.map(s=>s.session_id).concat(t).sort()[0]}function jn(e,t){return Fr(e,t)===t}function lf(e,t){if(!e||!e.conversationId||!e.content)return;Da(e.conversationId,Ve,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=ie(rt);jn(n,Se)&&(Ia(Ve,e.conversationId),Ie.update(s=>(Object.values(s).forEach(({conn:r,username:o})=>{o!==t&&r&&r.dataChannel&&r.send({type:"chat",...e})}),s)))}function cf(e,t){e&&Array.isArray(e.onlinePeers)&&rt.set(e.onlinePeers)}function uf(e,t){!e||!e.subtype||Ie.update(n=>{const s=Object.values(n).find(o=>o.username===t),r=s==null?void 0:s.conn;return r&&typeof r.handleSignal=="function"&&r.handleSignal(e),n})}function Ao(e,t,n,s){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,s);const r=URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(r)},2e3)}async function Eo(e,t){const n=new sf({token:pt,repoFullName:Ve,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:s=>{Ns(pt,Ve,Ot,Se,s,ie(Qe).cleanupMode)},onDataChannelMessage:s=>{if(!(!s||typeof s!="object"))switch(s.type){case"chat":lf(s,e.username);break;case"presence":cf(s,e.username);break;case"signal":uf(s,e.username);break;default:console.log("Unknown message type:",s);break}},onFileReceived:(s,r)=>{Ao(s,r,s.totalChunks,s.totalChunks)},onFileReceiveProgress:(s,r,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(s,r,o)},onFileSendProgress:(s,r,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(s,r,o)}});n.onFileReceived=(s,r)=>{Ao(s,r,s.totalChunks,s.totalChunks)},n.onFileReceiveProgress=(s,r,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(s,r,o)},n.signalingCallback=s=>{Ns(pt,Ve,Ot,Se,s,ie(Qe).cleanupMode)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.session_id]={conn:n,status:"connected",username:e.username},Ie.set(t)}function Ga(){const e=ie(rt);jn(e,Se)?un||(un=setInterval(()=>{const n=ie(rt);jn(n,Se)&&Tn()},10*60*1e3),window.addEventListener("beforeunload",Ro)):un&&(clearInterval(un),un=null,window.removeEventListener("beforeunload",Ro))}function Ro(e){const t=ie(rt);jn(t,Se)&&Tn()}let Do=!1;function Ua(){const e=ie(rt),t=jn(e,Se);t&&!Do&&Tn(),Do=t}function xr(e,t){Ie.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function ff(e){Ie.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var df=A('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function vf(e,t){We(t,!1);let n=st(t,"conversation",8),s=j("");function r(){var p;if(!a(s).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(s).trim(),timestamp:Date.now()};Da(n().id,n().repo,l),(p=ie(Dt).user)==null||p.login;const d=ie(rt),v=rf(),u=Fr(d,v),g={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};v===u?(ff({type:"chat",...g}),Ia(n().repo,n().id)):xr(u,{type:"chat",...g}),y(s,"")}et();var o=df(),i=_(o),c=h(i,2);nt(i,()=>a(s),l=>y(s,l)),N("keydown",i,l=>l.key==="Enter"&&r()),N("click",c,r),m(e,o),Ke()}var pf=A(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),gf=A('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),hf=A('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),_f=A('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),yf=A('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),mf=A('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),bf=A('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),wf=A('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),xf=A('<button class="bg-yellow-100 border px-3 py-1 rounded">ðŸ”„ Change Screen Source</button>'),kf=A("<span>ðŸŽ¤</span>"),Sf=A("<span>ðŸ”‡</span>"),Cf=A("<span>ðŸ“·</span>"),$f=A("<span>ðŸš«ðŸ“·</span>"),Pf=A("<span>â¹ï¸ Stop Recording</span>"),Af=A("<span>âºï¸ Start Recording</span>"),Ef=A('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>âºï¸ Recording...</span></div>'),Rf=A('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>âš ï¸ Peer is recording</span></div>'),Df=A('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">ðŸ“Ž Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),Of=A('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">Ã—</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),If=A('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),Tf=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),jf=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),Mf=A('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <button class="ml-4 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200"> </button> <button class="ml-2 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200" title="Commit and push messages now">ðŸ’¾ Commit Now</button> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),Nf=A('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function Lf(e,t){We(t,!1);const[n,s]=Ws(),r=()=>gn(Ie,"$peerConnections",n),o=()=>gn(rt,"$onlinePeers",n);let i=j(null),c=j(!1),l=j(null),f=j(null),d=null,v=j(!1),u=j(null),g=null,p=j(!1),b=j(null),S=j(!1),C=j(!0),M=j(!0),k=j(!0),w=j(!0),R=j(!0),U=j(!1),D=j(!1),O=j(!0);const H=js.subscribe(x=>{a(i)&&a(i).repo&&y(O,x[a(i).repo]!==!1)});let ee=null,q=[],Y=j({x:0,y:0}),me=!1,Ce={x:0,y:0},Re=j(),$e=j(null),z=j(!1),ne=j(),fe=j(),P=j();function L(){y(S,!0)}function X(){y(S,!1)}function le(x){y(S,!1),Ut(!0,x)}function B(x){me=!0,Ce={x:x.clientX-a(Y).x,y:x.clientY-a(Y).y},document.addEventListener("mousemove",te),document.addEventListener("mouseup",V)}function te(x){me&&(ke(Y,a(Y).x=x.clientX-Ce.x),ke(Y,a(Y).y=x.clientY-Ce.y))}function V(){me=!1,document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",V)}function pe(){y(C,!1)}function be(){y(C,!0)}function G(){y($e,null),y(z,!1)}function Z(){var K;if(!a(i))return;const x=a(i).repo,$=localStorage.getItem("skygit_token"),I=ie(Dt),J=(K=I==null?void 0:I.user)==null?void 0:K.login;!$||!J||(a(O)?(ko(x,!1),$o()):(ko(x,!0),Po({_token:$,_repoFullName:x,_username:J,_sessionId:crypto.randomUUID()})))}function we(){if(!a(i))return;const x=`${a(i).repo}::${a(i).id}`;flushConversationCommitQueue([x])}ec(()=>{H()});async function ce(){let x=a(i)&&a(i).repo,$=ie(Qe).decrypted,I=null,J=null,K=null,ye=null;if(x&&window.selectedRepo&&window.selectedRepo.config){const ae=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;ae&&$[ae]&&($[ae].type==="s3"&&(I=$[ae]),$[ae].type==="google_drive"&&(J=$[ae]))}for(const ae in $)$[ae].type==="s3"&&!I&&(K=$[ae]),$[ae].type==="google_drive"&&!J&&(ye=$[ae]);const se=[];return(I||K)&&se.push("s3"),(J||ye)&&se.push("google_drive"),se.length===2?(y(z,!0),new Promise(ae=>{const je=setInterval(()=>{a($e)&&(y(z,!1),clearInterval(je),ae(a($e)))},100)})):se.length===1?se[0]:null}Ie.subscribe(x=>{Object.entries(x).filter(([$,I])=>I.status==="connected").map(([$,I])=>({session_id:$,username:I.username}))});let De=j(!1),he=j("");async function xe(x){const $=localStorage.getItem("skygit_token");if(!$||!x)return null;try{const I=await fetch(`https://api.github.com/repos/${x}`,{headers:{Authorization:`token ${$}`}});if(I.ok){const J=await I.json();return Ct.update(K=>K.map(ye=>ye.full_name===x?{...ye,has_discussions:J.has_discussions}:ye)),J.has_discussions}}catch(I){console.warn("Failed to refresh Discussions status",I)}return null}Ks.subscribe(x=>{var ye;console.log("[SkyGit][Presence] currentContent changed:",x),y(i,x),y(De,!1),y(he,"");const $=localStorage.getItem("skygit_token"),I=ie(Dt),J=((ye=I==null?void 0:I.user)==null?void 0:ye.login)||null,K=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",I),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",J,"repo",K,"selectedConversation",a(i)),$&&J&&K){const se=ie(js);y(O,se[K]!==!1),a(O)?Po({_token:$,_repoFullName:K,_username:J,_sessionId:crypto.randomUUID()}):$o()}if(a(i)&&a(i).repo){const se=Aa(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",se,"has_discussions:",se==null?void 0:se.has_discussions),se&&se.has_discussions===!1&&xe(a(i).repo).then(ae=>{ae?y(De,!1):y(De,!0)})}});function yt(){y(c,!1),d=null,a(l)&&(a(l).getTracks().forEach(x=>x.stop()),y(l,null)),y(f,null),d&&xr(d,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function Gt(x){const $=x.target.files[0];!$||!a(c)||!d||Ie.update(I=>{var K;const J=(K=I[d])==null?void 0:K.conn;return J&&typeof J.sendFile=="function"&&J.sendFile($),I})}async function Ut(x=!0,$="screen"){try{let I={video:!0,audio:x};$==="tab"?I={video:{displaySurface:"browser",cursor:"always"},audio:x}:$==="window"?I={video:{displaySurface:"window",cursor:"always"},audio:x}:$==="screen"&&(I={video:{displaySurface:"monitor",cursor:"always"},audio:x}),y(u,await navigator.mediaDevices.getDisplayMedia(I)),y(v,!0),Ie.update(J=>{var ye;const K=(ye=J[d])==null?void 0:ye.conn;return K&&K.replaceVideoTrack&&(K.replaceVideoTrack(a(u).getVideoTracks()[0]),K.sendScreenShareSignal&&K.sendScreenShareSignal(!0,{audio:x})),J}),y(l,a(u)),a(u).getVideoTracks()[0].onended=ct}catch(I){console.error("Screen share error:",I)}}function ct(){a(u)&&(a(u).getTracks().forEach(x=>x.stop()),y(u,null)),y(v,!1),Ie.update(x=>{var I;const $=(I=x[d])==null?void 0:I.conn;return $&&$.replaceVideoTrack,x}),y(l,g)}async function tn(){if(a(v))try{const x=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Ie.update($=>{var J;const I=(J=$[d])==null?void 0:J.conn;return I&&I.replaceVideoTrack&&I.replaceVideoTrack(x.getVideoTracks()[0]),$}),a(u)&&a(u).getTracks().forEach($=>$.stop()),y(u,x),y(l,x),x.getVideoTracks()[0].onended=ct}catch(x){console.error("Change screen source error:",x)}}function nn(){y(M,!a(M)),a(l)&&a(l).getAudioTracks().forEach(x=>x.enabled=a(M)),wn()}function bn(){y(k,!a(k)),a(l)&&a(l).getVideoTracks().forEach(x=>x.enabled=a(k)),wn()}function wn(){Ie.update(x=>{var I;const $=(I=x[d])==null?void 0:I.conn;return $&&$.send&&$.send({type:"media-status",micOn:a(M),cameraOn:a(k)}),x})}function sn(x){Ie.update($=>{var J;const I=(J=$[d])==null?void 0:J.conn;return I&&I.send&&I.send({type:"recording-status",recording:x}),$})}function _e(){a(l)&&(q=[],ee=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),ee.ondataavailable=x=>{x.data.size>0&&q.push(x.data)},ee.onstop=Ft,ee.start(),y(U,!0),sn(!0))}function Te(){ee&&a(U)&&(ee.stop(),y(U,!1),sn(!1))}async function Ft(){const x=new Blob(q,{type:"video/webm"});await rn(x)}typeof window<"u"&&(window.skygitOnRecordingStatus=x=>{y(D,!!x.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(x,$)=>{y(p,x),y(b,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=x=>{typeof x.micOn=="boolean"&&y(w,x.micOn),typeof x.cameraOn=="boolean"&&y(R,x.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(x,$,I)=>{x.name,$===I&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(x,$,I)=>{$===I&&setTimeout(()=>{},2e3)});async function zt(x,$){const I=`skygit-recording-${Date.now()}.webm`,J=$.bucket,K=$.region;if(!J||!K)return alert("S3 credential missing bucket or region."),null;const ye=$.endpoint||`https://${J}.s3.${K}.amazonaws.com/${I}`;return(await fetch(ye,{method:"PUT",headers:{"Content-Type":"video/webm"},body:x})).ok?ye.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function rn(x){let $=ie(Qe).decrypted,I=a(i)&&a(i).repo,J=null,K=null,ye=null,se=null;if(I&&window.selectedRepo&&window.selectedRepo.config){const Fe=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Fe&&$[Fe]&&($[Fe].type==="s3"&&(J=$[Fe]),$[Fe].type==="google_drive"&&(K=$[Fe]))}for(const Fe in $)$[Fe].type==="s3"&&!J&&(ye=$[Fe]),$[Fe].type==="google_drive"&&!K&&(se=$[Fe]);let ae=null,je=await ce();if(!je){alert("No upload destination (S3 or Google Drive) configured.");return}je==="s3"&&(ae=J||ye),je==="google_drive"&&(ae=K||se);let ut=null;je==="s3"?ut=await zt(x,ae):je==="google_drive"&&(ut=await on(x,ae)),ut&&(xr(d,{type:"chat",content:`ðŸ“¹ Recording: ${ut}`}),alert("Recording uploaded and link shared!"))}async function on(x,$){let I;try{I=await oe($)}catch(ut){return alert("Google Drive authentication failed: "+ut.message),null}const J={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},K=new FormData;K.append("metadata",new Blob([JSON.stringify(J)],{type:"application/json"})),K.append("file",x);const ye=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+I},body:K});if(!ye.ok)return alert("Failed to upload to Google Drive"),null;const se=await ye.json();await fetch(`https://www.googleapis.com/drive/v3/files/${se.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+I,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const je=await(await fetch(`https://www.googleapis.com/drive/v3/files/${se.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+I}})).json();return je.webViewLink||je.webContentLink}async function oe(x){const $=new URLSearchParams;$.append("client_id",x.client_id),$.append("client_secret",x.client_secret),$.append("refresh_token",x.refresh_token),$.append("grant_type","refresh_token");const I=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!I.ok)throw new Error("Failed to get Google access token");return(await I.json()).access_token}function Oe(){const x=localStorage.getItem("skygit_token"),$=a(i)?a(i).repo:null;x&&$&&nf(x,$)}window.addEventListener("beforeunload",Oe),vt(()=>(a(ne),a(l)),()=>{a(ne)&&a(l)&&ke(ne,a(ne).srcObject=a(l))}),vt(()=>(a(fe),a(f)),()=>{a(fe)&&a(f)&&ke(fe,a(fe).srcObject=a(f))}),vt(()=>(a(P),a(u)),()=>{a(P)&&a(u)&&ke(P,a(P).srcObject=a(u))}),ds(),et(),Ys(e,{children:(x,$)=>{var I=Ae(),J=de(I);{var K=se=>{var ae=Ae(),je=de(ae);{var ut=Jt=>{var Pt=pf(),an=_(Pt),qt=h(_(an),4),xn=h(qt,2),kn=_(xn),Vt=h(kn,2);Q(()=>Et(qt,"href",a(he))),N("click",kn,()=>y(De,!1)),N("click",Vt,async()=>{await xe(a(i).repo)}),m(Jt,Pt)},Fe=Jt=>{var Pt=Mf(),an=_(Pt),qt=_(an),xn=_(qt),kn=_(xn),Vt=h(xn,2),Fa=_(Vt),zr=h(Vt,2),za=h(zr,2),Ja=_(za),Jr=h(qt,2),qa=_(Jr),Va=h(Jr,2),qr=_(Va);{var Ha=ge=>{var Me=Ae(),mt=de(Me);Tt(mt,1,()=>a(i).participants,Ye=>Ye,(Ye,Pe)=>{var Le=Ae(),ze=de(Le);{var Jn=ft=>{var bt=gf();m(ft,bt)},Sn=ft=>{var bt=Ae(),Qs=de(bt);{var Zs=Ht=>{var ln=Ae(),qn=de(ln);{var Cn=Ge=>{var dt=hf(),Vn=h(_(dt));Q(()=>W(Vn,` ${a(Pe)??""}`)),m(Ge,dt)},wt=Ge=>{var dt=_f(),Vn=h(_(dt));Q(()=>W(Vn,` ${a(Pe)??""}`)),m(Ge,dt)};T(qn,Ge=>{r()[a(Pe)].status==="connected"?Ge(Cn):Ge(wt,!1)})}m(Ht,ln)},Xs=(Ht,ln)=>{{var qn=wt=>{var Ge=yf(),dt=h(_(Ge));Q(()=>W(dt,` ${a(Pe)??""}`)),m(wt,Ge)},Cn=wt=>{var Ge=mf(),dt=h(_(Ge));Q(()=>W(dt,` ${a(Pe)??""}`)),m(wt,Ge)};T(Ht,wt=>{o().find(Ge=>Ge.username===a(Pe))?wt(qn):wt(Cn,!1)},ln)}};T(Qs,Ht=>{r()[a(Pe)]?Ht(Zs):Ht(Xs,!1)})}m(ft,bt)};T(ze,ft=>{a(Pe)===ie(Dt).user.login?ft(Jn):ft(Sn,!1)})}m(Ye,Le)}),m(ge,Me)};T(qr,ge=>{a(i).participants&&ge(Ha)})}var Ba=h(qr,2);{var Wa=ge=>{var Me=bf();N("click",Me,yt),m(ge,Me)};T(Ba,ge=>{a(c)&&ge(Wa)})}var Vr=h(an,2);{var Ka=ge=>{var Me=Df(),mt=de(Me),Ye=_(mt),Pe=h(_(Ye),2);Pe.muted=!0,Zn(Pe,E=>y(ne,E),()=>a(ne));var Le=h(Pe,2),ze=_(Le),Jn=_(ze);{var Sn=E=>{var F=Ue("ðŸŽ¤ Mic On");m(E,F)},ft=E=>{var F=Ue("ðŸ”‡ Mic Off");m(E,F)};T(Jn,E=>{a(M)?E(Sn):E(ft,!1)})}var bt=h(ze,2),Qs=_(bt);{var Zs=E=>{var F=Ue("ðŸ“· Cam On");m(E,F)},Xs=E=>{var F=Ue("ðŸš«ðŸ“· Cam Off");m(E,F)};T(Qs,E=>{a(k)?E(Zs):E(Xs,!1)})}var Ht=h(Ye,2),ln=h(_(Ht),2);Zn(ln,E=>y(fe,E),()=>a(fe));var qn=h(ln,2),Cn=_(qn),wt=_(Cn);{var Ge=E=>{var F=Ue("ðŸŽ¤ Mic On");m(E,F)},dt=E=>{var F=Ue("ðŸ”‡ Mic Off");m(E,F)};T(wt,E=>{a(w)?E(Ge):E(dt,!1)})}var Vn=h(Cn,2),ni=_(Vn);{var si=E=>{var F=Ue("ðŸ“· Cam On");m(E,F)},ri=E=>{var F=Ue("ðŸš«ðŸ“· Cam Off");m(E,F)};T(ni,E=>{a(R)?E(si):E(ri,!1)})}var Yr=h(mt,2);{var oi=E=>{var F=wf(),ki=_(F),Si=h(_(ki));{var Ci=nr=>{var ys=Ue("(with audio)");m(nr,ys)};T(Si,nr=>{var ys;(ys=a(b))!=null&&ys.audio&&nr(Ci)})}m(E,F)};T(Yr,E=>{a(p)&&E(oi)})}var Qr=h(Yr,2),Zr=_(Qr),ai=h(_(Zr)),er=h(Zr,2),ii=_(er);{var li=E=>{var F=Ue("ðŸ›‘ Stop Sharing");m(E,F)},ci=E=>{var F=Ue("ðŸ–¥ï¸ Share Screen");m(E,F)};T(ii,E=>{a(v)?E(li):E(ci,!1)})}var Xr=h(er,2);{var ui=E=>{var F=xf();N("click",F,tn),m(E,F)};T(Xr,E=>{a(v)&&E(ui)})}var hs=h(Xr,2),fi=_(hs);{var di=E=>{var F=kf();m(E,F)},vi=E=>{var F=Sf();m(E,F)};T(fi,E=>{a(M)?E(di):E(vi,!1)})}var _s=h(hs,2),pi=_(_s);{var gi=E=>{var F=Cf();m(E,F)},hi=E=>{var F=$f();m(E,F)};T(pi,E=>{a(k)?E(gi):E(hi,!1)})}var tr=h(_s,2),_i=_(tr);{var yi=E=>{var F=Pf();m(E,F)},mi=E=>{var F=Af();m(E,F)};T(_i,E=>{a(U)?E(yi):E(mi,!1)})}var eo=h(Qr,2);{var bi=E=>{var F=Ef();m(E,F)};T(eo,E=>{a(U)&&E(bi)})}var wi=h(eo,2);{var xi=E=>{var F=Rf();m(E,F)};T(wi,E=>{a(D)&&E(xi)})}Q(()=>{Et(hs,"title",a(M)?"Mute Mic":"Unmute Mic"),Et(_s,"title",a(k)?"Turn Off Camera":"Turn On Camera"),Et(tr,"title",a(U)?"Stop Recording":"Start Recording")}),N("change",ai,Gt),N("click",er,function(...E){var F;(F=a(v)?ct:L)==null||F.apply(this,E)}),N("click",hs,nn),N("click",_s,bn),N("click",tr,function(...E){var F;(F=a(U)?Te:_e)==null||F.apply(this,E)}),m(ge,Me)};T(Vr,ge=>{a(c)&&ge(Ka)})}var Hr=h(Vr,2);{var Ya=ge=>{var Me=Ae(),mt=de(Me);{var Ye=Le=>{var ze=Of(),Jn=_(ze),Sn=_(Jn),ft=h(Sn,4);ft.muted=!0,Zn(ft,bt=>y(P,bt),()=>a(P)),Zn(ze,bt=>y(Re,bt),()=>a(Re)),Q(()=>va(ze,`left: ${a(Y).x??""}px; top: ${a(Y).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),N("click",Sn,Yl(pe)),N("mousedown",ze,B),m(Le,ze)},Pe=Le=>{var ze=If();N("click",ze,be),m(Le,ze)};T(mt,Le=>{a(C)?Le(Ye):Le(Pe,!1)})}m(ge,Me)};T(Hr,ge=>{a(v)&&a(u)&&ge(Ya)})}var Br=h(Hr,2);{var Qa=ge=>{var Me=Tf(),mt=_(Me),Ye=h(_(mt),2),Pe=h(Ye,2),Le=h(Pe,2),ze=h(Le,2);N("click",Ye,()=>le("screen")),N("click",Pe,()=>le("window")),N("click",Le,()=>le("tab")),N("click",ze,X),m(ge,Me)};T(Br,ge=>{a(S)&&ge(Qa)})}var Wr=h(Br,2);{var Za=ge=>{var Me=jf(),mt=_(Me),Ye=h(_(mt),2),Pe=h(Ye,2),Le=h(Pe,2);N("click",Ye,()=>{y($e,"google_drive")}),N("click",Pe,()=>{y($e,"s3")}),N("click",Le,G),m(ge,Me)};T(Wr,ge=>{a(z)&&ge(Za)})}var Kr=h(Wr,2),Xa=_(Kr);Bu(Xa,{get conversation(){return a(i)}});var ei=h(Kr,2),ti=_(ei);vf(ti,{get conversation(){return a(i)}}),Q(()=>{var ge;W(kn,a(i).title),Et(Vt,"title",a(O)?"Pause presence polling":"Start presence polling"),W(Fa,a(O)?"â¸ Pause Presence":"â–¶ Start Presence"),W(Ja,a(i).repo),W(qa,`${((ge=a(i).participants)==null?void 0:ge.length)??0} participants`)}),N("click",Vt,Z),N("click",zr,we),m(Jt,Pt)};T(je,Jt=>{a(De)?Jt(ut):Jt(Fe,!1)})}m(se,ae)},ye=se=>{var ae=Nf();m(se,ae)};T(J,se=>{a(i)?se(K):se(ye,!1)})}m(x,I)},$$slots:{default:!0}}),Ke(),s()}var Gf=A('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function Uf(e,t){We(t,!1);const n=nc();let s=j("");function r(){if(!a(s).trim()){alert("Title is required.");return}n("create",{title:a(s).trim()}),y(s,"")}function o(){n("cancel")}et();var i=Gf(),c=_(i),l=h(_(c),2),f=h(l,2),d=_(f),v=h(d,2);nt(l,()=>a(s),u=>y(s,u)),N("click",d,o),N("click",v,r),m(e,i),Ke()}var Ff=A('<span class="text-green-700 font-semibold">âœ… Enabled</span>'),zf=A("<span> </span>"),Jf=A('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),qf=fa('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),Vf=A('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),Hf=A('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>ðŸ’¬ New Conversation (Enable Discussions first)</button></div>'),Bf=A("<option> </option>"),Wf=A('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">ðŸ› ï¸ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>â€” Select a credential â€”</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¾ Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¬ New Conversation</button> <!>',1),Kf=A('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),Yf=A('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function Qf(e,t){We(t,!1);let n=j([]),s=j(),r=j(!1),o=j(!1),i=j(""),c;Ts.subscribe(p=>y(s,p)),gs(async()=>{const p=localStorage.getItem("skygit_token");if(p)try{const{secrets:b}=await Mr(p),S=Object.keys(b),C=[];for(const M of S)try{const k=await Tr(p,b[M]);C.push({url:M,...k})}catch(k){console.warn("Failed to decrypt",M,k)}y(n,C)}catch(b){console.warn("Could not load secrets",b)}});async function l(){const p=localStorage.getItem("skygit_token");if(!(!a(s)||!p)){y(r,!0);try{await vc(p,a(s)),ke(s,a(s).has_messages=!0),ba(async()=>{const{selectedRepo:b}=await Promise.resolve().then(()=>Ea);return{selectedRepo:b}},void 0).then(({selectedRepo:b})=>{b.set({...a(s)})})}catch(b){alert("Failed to activate messaging."),console.warn(b)}finally{y(r,!1)}}}async function f(){const p=localStorage.getItem("skygit_token");if(!(!p||!a(s)))try{await pc(p,a(s)),alert("âœ… Messaging config updated.");try{await gc(p,a(s))}catch(b){alert("âŒ Failed to store credential."),console.warn(b)}}catch(b){alert("âŒ Failed to update config."),console.warn(b)}}async function d(p){const b=p.detail.title,S=localStorage.getItem("skygit_token");console.log("[SkyGit] ðŸ§ª handleCreate() called with title:",b),await Rc(S,a(s),b),y(o,!1)}function v(){y(o,!1)}function u(){if(!a(s))return;const p=`https://github.com/${a(s).full_name}/settings/discussions`;window.open(p,"_blank")}async function g(){const p=localStorage.getItem("skygit_token");if(!p||!a(s))return;const b=await fetch(`https://api.github.com/repos/${a(s).full_name}`,{headers:{Authorization:`token ${p}`}});if(b.ok){const S=await b.json(),C=!a(s).has_discussions;ke(s,a(s).has_discussions=S.has_discussions),Ts.set({...a(s)}),Ct.update(M=>M.map(k=>k.full_name===a(s).full_name?{...a(s)}:k)),await bl(),C&&a(s).has_discussions?y(i,"âœ… Discussions enabled! You can now use messaging."):a(s).has_discussions?y(i,""):y(i,"âŒ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{y(i,"")},4e3)}}et(),Ys(e,{children:(p,b)=>{var S=Ae(),C=de(S);{var M=w=>{var R=Kf(),U=_(R),D=_(U),O=h(U,2),H=_(O),ee=h(_(H)),q=h(H,2),Y=h(_(q)),me=h(q,2),Ce=h(_(me),2),Re=_(Ce),$e=h(me,2),z=h(_($e)),ne=h($e,2),fe=h(_(ne)),P=h(ne,2),L=h(_(P),2);{var X=G=>{var Z=Ff();m(G,Z)},le=G=>{var Z=Jf(),we=h(de(Z),2),ce=h(we,2),De=h(ce,2);{var he=xe=>{var yt=zf();let Gt;var Ut=_(yt);Q(ct=>{Gt=In(yt,1,"ml-2 text-xs font-semibold",null,Gt,ct),W(Ut,a(i))},[()=>({"text-green-700":a(i).startsWith("âœ…"),"text-red-600":a(i).startsWith("âŒ")})],ht),m(xe,yt)};T(De,xe=>{a(i)&&xe(he)})}N("click",we,u),N("click",ce,g),m(G,Z)};T(L,G=>{a(s).has_discussions?G(X):G(le,!1)})}var B=h(O,2);{var te=G=>{var Z=Vf(),we=_(Z);{var ce=he=>{var xe=qf();m(he,xe)},De=he=>{var xe=Ue("ðŸ’¬ Activate Messaging");m(he,xe)};T(we,he=>{a(r)?he(ce):he(De,!1)})}Q(()=>Z.disabled=a(r)),N("click",Z,l),m(G,Z)};T(B,G=>{a(s).has_messages||G(te)})}var V=h(B,2);{var pe=G=>{var Z=Hf();m(G,Z)},be=(G,Z)=>{{var we=ce=>{var De=Wf(),he=de(De),xe=h(_(he),2),yt=_(xe),Gt=h(_(yt)),Ut=h(yt,2),ct=h(_(Ut));Q(()=>{a(s),pr(()=>{})});var tn=_(ct);tn.value=(tn.__value="gitfs")==null?"":"gitfs";var nn=h(tn);nn.value=(nn.__value="s3")==null?"":"s3";var bn=h(nn);bn.value=(bn.__value="google_drive")==null?"":"google_drive";var wn=h(Ut,2),sn=h(_(wn));Q(()=>{a(s),pr(()=>{a(n)})});var _e=_(sn);_e.value=((_e.__value="")==null,"");var Te=h(_e);Tt(Te,1,()=>a(n).filter(oe=>oe.type===a(s).config.binary_storage_type),ls,(oe,Oe)=>{var x=Bf(),$={},I=_(x);Q(()=>{$!==($=a(Oe).url)&&(x.value=(x.__value=a(Oe).url)==null?"":a(Oe).url),W(I,a(Oe).url)}),m(oe,x)});var Ft=h(xe,2),zt=h(he,2),rn=h(zt,2);{var on=oe=>{Uf(oe,{$$events:{create:d,cancel:v}})};T(rn,oe=>{a(o)&&oe(on)})}nt(Gt,()=>a(s).config.commit_frequency_min,oe=>ke(s,a(s).config.commit_frequency_min=oe)),_r(ct,()=>a(s).config.binary_storage_type,oe=>ke(s,a(s).config.binary_storage_type=oe)),_r(sn,()=>a(s).config.storage_info.url,oe=>ke(s,a(s).config.storage_info.url=oe)),N("click",Ft,f),N("click",zt,()=>y(o,!0)),m(ce,De)};T(G,ce=>{a(s).has_messages&&a(s).config&&ce(we)},Z)}};T(V,G=>{a(s).has_discussions?G(be,!1):G(pe)})}Q(()=>{W(D,a(s).full_name),W(ee,` ${a(s).name??""}`),W(Y,` ${a(s).owner??""}`),Et(Ce,"href",a(s).url),W(Re,a(s).url),W(z,` ${(a(s).private?"ðŸ”’ Private":"ðŸŒ Public")??""}`),W(fe,` ${(a(s).has_messages?"ðŸ’¬ Available":"ðŸš« Not enabled")??""}`)}),m(w,R)},k=w=>{var R=Yf();m(w,R)};T(C,w=>{a(s)?w(M):w(k,!1)})}m(p,S)},$$slots:{default:!0}}),Ke()}var Zf=A('<p class="text-center mt-20">Loading...</p>');function Xf(e,t){We(t,!1);const[n,s]=Ws(),r=()=>gn(it,"$currentRoute",n),o=()=>gn(Ee,"$syncState",n);let i=j(null),c=null,l=j("");Dt.subscribe(C=>{C.isLoggedIn||(it.set("login"),y(i,null),c=null)}),gs(()=>{const C=wc();C?f(C):it.set("login")});async function f(C){y(l,"");const M=await mc(C);if(!M){localStorage.removeItem("skygit_token"),y(l,"Invalid token. Please check your PAT and try again."),it.set("login");return}y(i,C),c=M,bc(C),Dt.set({isLoggedIn:!0,token:a(i),user:c}),await cc(a(i),c.login)?(it.set("home"),await u()):it.set("consent")}async function d(){await uc(a(i)),it.set("home"),await u()}function v(){localStorage.removeItem("skygit_token"),it.set("login")}async function u(){try{console.log("[SkyGit] Initializing app state..."),await Ic(a(i))}catch(C){console.warn("[SkyGit] Failed to initialize startup state:",C)}}window.addEventListener("beforeunload",C=>{(Mc()||Pa())&&(Tn(),cs(),C.preventDefault(),C.returnValue="")}),vt(()=>(r(),o(),a(i)),()=>{if(r()==="home"&&o().phase==="idle"&&!o().paused)try{wr(a(i))}catch(C){console.warn("[SkyGit] Repo discovery failed:",C)}}),ds(),et();var g=Ae(),p=de(g);{var b=C=>{var M=Zf();m(C,M)},S=(C,M)=>{{var k=R=>{Uc(R,{onSubmit:f,get error(){return a(l)}})},w=(R,U)=>{{var D=H=>{Jc(H,{onApprove:d,onReject:v})},O=(H,ee)=>{{var q=me=>{Ju(me,{})},Y=(me,Ce)=>{{var Re=z=>{Lf(z,{})},$e=(z,ne)=>{{var fe=L=>{Qf(L,{})},P=L=>{Ru(L)};T(z,L=>{r()==="repos"?L(fe):L(P,!1)},ne)}};T(me,z=>{r()==="chats"?z(Re):z($e,!1)},Ce)}};T(H,me=>{r()==="settings"?me(q):me(Y,!1)},ee)}};T(R,H=>{r()==="consent"?H(D):H(O,!1)},U)}};T(C,R=>{r()==="login"?R(k):R(w,!1)},M)}};T(p,C=>{r()==="loading"?C(b):C(S,!1)})}m(e,g),Ke(),s()}Il(Xf,{target:document.getElementById("app")});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});
