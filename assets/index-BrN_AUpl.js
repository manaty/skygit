(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Bs=!1;var kr=Array.isArray,fi=Array.prototype.indexOf,ps=Array.from,mo=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,yo=Object.getOwnPropertyDescriptors,di=Object.prototype,vi=Array.prototype,hs=Object.getPrototypeOf,qs=Object.isExtensible;function Dn(e){return typeof e=="function"}const mn=()=>{};function pi(e){return e()}function dr(e){for(var t=0;t<e.length;t++)e[t]()}const dt=2,wo=4,Sr=8,gs=16,Nt=32,Sn=64,vr=128,st=256,pr=512,Ke=1024,It=2048,an=4096,Rt=8192,Cr=16384,hi=32768,$r=65536,xo=1<<17,gi=1<<19,ko=1<<20,ts=1<<21,kt=Symbol("$state"),So=Symbol("legacy props"),_i=Symbol("");function Co(e){return e===this.v}function _s(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function bs(e){return!_s(e,this.v)}function bi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function mi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function yi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function wi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function ki(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Si(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ci(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Cn=!1,$i=!1;function Pi(){Cn=!0}const ms=1,ys=2,$o=4,Ei=8,Ai=16,Ri=1,Oi=2,Po=4,Ti=8,Di=16,Eo=1,ji=2,We=Symbol(),Ni="http://www.w3.org/1999/xhtml",Ii="http://www.w3.org/2000/svg";function Ao(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let de=null;function Ws(e){de=e}function He(e,t=!1,n){var r=de={p:de,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Cn&&!t&&(de.l={s:null,u:null,r1:[],r2:yn(!1)}),ws(()=>{r.d=!0})}function Be(e){const t=de;if(t!==null){const i=t.e;if(i!==null){var n=ae,r=se;t.e=null;try{for(var s=0;s<i.length;s++){var o=i[s];Kt(o.effect),St(o.reaction),Pn(o.fn)}}finally{Kt(n),St(r)}}de=t.p,t.m=!0}return{}}function Qn(){return!Cn||de!==null&&de.l===null}function en(e,t){if(typeof e!="object"||e===null||kt in e)return e;const n=hs(e);if(n!==di&&n!==vi)return e;var r=new Map,s=kr(e),o=Jt(0),i=se,c=l=>{var u=se;St(i);var f;return f=l(),St(u),f};return s&&r.set("length",Jt(e.length)),new Proxy(e,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&ki();var d=r.get(u);return d===void 0?(d=c(()=>Jt(f.value)),r.set(u,d)):m(d,c(()=>en(f.value))),!0},deleteProperty(l,u){var f=r.get(u);if(f===void 0)u in l&&r.set(u,c(()=>Jt(We)));else{if(s&&typeof u=="string"){var d=r.get("length"),v=Number(u);Number.isInteger(v)&&v<d.v&&m(d,v)}m(f,We),Ks(o)}return!0},get(l,u,f){var g;if(u===kt)return e;var d=r.get(u),v=u in l;if(d===void 0&&(!v||(g=Wt(l,u))!=null&&g.writable)&&(d=c(()=>Jt(en(v?l[u]:We))),r.set(u,d)),d!==void 0){var _=a(d);return _===We?void 0:_}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var d=r.get(u);d&&(f.value=a(d))}else if(f===void 0){var v=r.get(u),_=v==null?void 0:v.v;if(v!==void 0&&_!==We)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return f},has(l,u){var _;if(u===kt)return!0;var f=r.get(u),d=f!==void 0&&f.v!==We||Reflect.has(l,u);if(f!==void 0||ae!==null&&(!d||(_=Wt(l,u))!=null&&_.writable)){f===void 0&&(f=c(()=>Jt(d?en(l[u]):We)),r.set(u,f));var v=a(f);if(v===We)return!1}return d},set(l,u,f,d){var w;var v=r.get(u),_=u in l;if(s&&u==="length")for(var g=f;g<v.v;g+=1){var y=r.get(g+"");y!==void 0?m(y,We):g in l&&(y=c(()=>Jt(We)),r.set(g+"",y))}v===void 0?(!_||(w=Wt(l,u))!=null&&w.writable)&&(v=c(()=>Jt(void 0)),m(v,c(()=>en(f))),r.set(u,v)):(_=v.v!==We,m(v,c(()=>en(f))));var x=Reflect.getOwnPropertyDescriptor(l,u);if(x!=null&&x.set&&x.set.call(d,f),!_){if(s&&typeof u=="string"){var O=r.get("length"),C=Number(u);Number.isInteger(C)&&C>=O.v&&m(O,C+1)}Ks(o)}return!0},ownKeys(l){a(o);var u=Reflect.ownKeys(l).filter(v=>{var _=r.get(v);return _===void 0||_.v!==We});for(var[f,d]of r)d.v!==We&&!(f in l)&&u.push(f);return u},setPrototypeOf(){Si()}})}function Ks(e,t=1){m(e,e.v+t)}function Ys(e){try{if(e!==null&&typeof e=="object"&&kt in e)return e[kt]}catch{}return e}function Mi(e,t){return Object.is(Ys(e),Ys(t))}const zn=new Map;function yn(e,t){var n={f:0,v:e,reactions:null,equals:Co,rv:0,wv:0};return n}function Jt(e,t){const n=yn(e);return Ki(n),n}function N(e,t=!1){var r;const n=yn(e);return t||(n.equals=bs),Cn&&de!==null&&de.l!==null&&((r=de.l).s??(r.s=[])).push(n),n}function he(e,t){return m(e,et(()=>a(e))),t}function m(e,t,n=!1){se!==null&&!xt&&Qn()&&(se.f&(dt|gs))!==0&&!(Ve!=null&&Ve.includes(e))&&Ci();let r=n?en(t):t;return Jn(e,r)}function Jn(e,t){if(!e.equals(t)){var n=e.v;er?zn.set(e,t):zn.set(e,n),e.v=t,e.wv=Vo(),Ro(e,It),Qn()&&ae!==null&&(ae.f&Ke)!==0&&(ae.f&(Nt|Sn))===0&&(nt===null?Yi([e]):nt.push(e))}return t}function Qs(e,t=1){var n=a(e),r=t===1?n++:n--;return m(e,n),r}function Ro(e,t){var n=e.reactions;if(n!==null)for(var r=Qn(),s=n.length,o=0;o<s;o++){var i=n[o],c=i.f;(c&It)===0&&(!r&&i===ae||(pt(i,t),(c&(Ke|st))!==0&&((c&dt)!==0?Ro(i,an):Tr(i))))}}let Li=!1;var Zs,Oo,To,Do;function Fi(){if(Zs===void 0){Zs=window,Oo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;To=Wt(t,"firstChild").get,Do=Wt(t,"nextSibling").get,qs(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),qs(n)&&(n.__t=void 0)}}function Zn(e=""){return document.createTextNode(e)}function At(e){return To.call(e)}function Pr(e){return Do.call(e)}function h(e,t){return At(e)}function fe(e,t){{var n=At(e);return n instanceof Comment&&n.data===""?Pr(n):n}}function p(e,t=1,n=!1){let r=e;for(;t--;)r=Pr(r);return r}function Gi(e){e.textContent=""}function Vn(e){var t=dt|It,n=se!==null&&(se.f&dt)!==0?se:null;return ae===null||n!==null&&(n.f&st)!==0?t|=st:ae.f|=ko,{ctx:de,deps:null,effects:null,equals:Co,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ae}}function vt(e){const t=Vn(e);return t.equals=bs,t}function jo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Tt(t[n])}}function Ui(e){for(var t=e.parent;t!==null;){if((t.f&dt)===0)return t;t=t.parent}return null}function zi(e){var t,n=ae;Kt(Ui(e));try{jo(e),t=Bo(e)}finally{Kt(n)}return t}function No(e){var t=zi(e),n=(Bt||(e.f&st)!==0)&&e.deps!==null?an:Ke;pt(e,n),e.equals(t)||(e.v=t,e.wv=Vo())}function Io(e){ae===null&&se===null&&yi(),se!==null&&(se.f&st)!==0&&ae===null&&mi(),er&&bi()}function Ji(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function $n(e,t,n,r=!0){var s=ae,o={ctx:de,deps:null,nodes_start:null,nodes_end:null,f:e|It,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Or(o),o.f|=hi}catch(l){throw Tt(o),l}else t!==null&&Tr(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(ko|vr))===0;if(!i&&r&&(s!==null&&Ji(o,s),se!==null&&(se.f&dt)!==0)){var c=se;(c.effects??(c.effects=[])).push(o)}return o}function ws(e){const t=$n(Sr,null,!1);return pt(t,Ke),t.teardown=e,t}function ns(e){Io();var t=ae!==null&&(ae.f&Nt)!==0&&de!==null&&!de.m;if(t){var n=de;(n.e??(n.e=[])).push({fn:e,effect:ae,reaction:se})}else{var r=Pn(e);return r}}function Vi(e){return Io(),ln(e)}function Hi(e){const t=$n(Sn,e,!0);return(n={})=>new Promise(r=>{n.outro?Hn(t,()=>{Tt(t),r(void 0)}):(Tt(t),r(void 0))})}function Pn(e){return $n(wo,e,!1)}function ct(e,t){var n=de,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=ln(()=>{e(),!r.ran&&(r.ran=!0,m(n.l.r2,!0),et(t))})}function Xn(){var e=de;ln(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Ke)!==0&&pt(n,an),En(n)&&Or(n),t.ran=!1}e.l.r2.v=!1}})}function ln(e){return $n(Sr,e,!0)}function Y(e,t=[],n=Vn){const r=t.map(n);return Er(()=>e(...r.map(a)))}function Er(e,t=0){return $n(Sr|gs|t,e,!0)}function wn(e,t=!0){return $n(Sr|Nt,e,!0,t)}function Mo(e){var t=e.teardown;if(t!==null){const n=er,r=se;eo(!0),St(null);try{t.call(null)}finally{eo(n),St(r)}}}function Lo(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&Sn)!==0?n.parent=null:Tt(n,t),n=r}}function Bi(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Nt)===0&&Tt(t),t=n}}function Tt(e,t=!0){var n=!1;if((t||(e.f&gi)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:Pr(r);r.remove(),r=o}n=!0}Lo(e,t&&!n),br(e,0),pt(e,Cr);var i=e.transitions;if(i!==null)for(const l of i)l.stop();Mo(e);var c=e.parent;c!==null&&c.first!==null&&Fo(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Fo(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function Hn(e,t){var n=[];xs(e,n,!0),Go(n,()=>{Tt(e),t&&t()})}function Go(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function xs(e,t,n){if((e.f&Rt)===0){if(e.f^=Rt,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&$r)!==0||(r.f&Nt)!==0;xs(r,t,o?n:!1),r=s}}}function Bn(e){Uo(e,!0)}function Uo(e,t){if((e.f&Rt)!==0){e.f^=Rt,(e.f&Ke)===0&&(e.f^=Ke),En(e)&&(pt(e,It),Tr(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&$r)!==0||(n.f&Nt)!==0;Uo(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let qn=[],rs=[];function zo(){var e=qn;qn=[],dr(e)}function qi(){var e=rs;rs=[],dr(e)}function Ar(e){qn.length===0&&queueMicrotask(zo),qn.push(e)}function Xs(){qn.length>0&&zo(),rs.length>0&&qi()}let cr=!1,hr=!1,gr=null,tn=!1,er=!1;function eo(e){er=e}let Fn=[];let se=null,xt=!1;function St(e){se=e}let ae=null;function Kt(e){ae=e}let Ve=null;function Wi(e){Ve=e}function Ki(e){se!==null&&se.f&ts&&(Ve===null?Wi([e]):Ve.push(e))}let ze=null,Qe=0,nt=null;function Yi(e){nt=e}let Jo=1,_r=0,Bt=!1,Ht=null;function Vo(){return++Jo}function En(e){var d;var t=e.f;if((t&It)!==0)return!0;if((t&an)!==0){var n=e.deps,r=(t&st)!==0;if(n!==null){var s,o,i=(t&pr)!==0,c=r&&ae!==null&&!Bt,l=n.length;if(i||c){var u=e,f=u.parent;for(s=0;s<l;s++)o=n[s],(i||!((d=o==null?void 0:o.reactions)!=null&&d.includes(u)))&&(o.reactions??(o.reactions=[])).push(u);i&&(u.f^=pr),c&&f!==null&&(f.f&st)===0&&(u.f^=st)}for(s=0;s<l;s++)if(o=n[s],En(o)&&No(o),o.wv>e.wv)return!0}(!r||ae!==null&&!Bt)&&pt(e,Ke)}return!1}function Qi(e,t){for(var n=t;n!==null;){if((n.f&vr)!==0)try{n.fn(e);return}catch{n.f^=vr}n=n.parent}throw cr=!1,e}function Zi(e){return(e.f&Cr)===0&&(e.parent===null||(e.parent.f&vr)===0)}function Rr(e,t,n,r){if(cr){if(n===null&&(cr=!1),Zi(t))throw e;return}n!==null&&(cr=!0);{Qi(e,t);return}}function Ho(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];Ve!=null&&Ve.includes(e)||((o.f&dt)!==0?Ho(o,t,!1):t===o&&(n?pt(o,It):(o.f&Ke)!==0&&pt(o,an),Tr(o)))}}function Bo(e){var _;var t=ze,n=Qe,r=nt,s=se,o=Bt,i=Ve,c=de,l=xt,u=e.f;ze=null,Qe=0,nt=null,Bt=(u&st)!==0&&(xt||!tn||se===null),se=(u&(Nt|Sn))===0?e:null,Ve=null,Ws(e.ctx),xt=!1,_r++,e.f|=ts;try{var f=(0,e.fn)(),d=e.deps;if(ze!==null){var v;if(br(e,Qe),d!==null&&Qe>0)for(d.length=Qe+ze.length,v=0;v<ze.length;v++)d[Qe+v]=ze[v];else e.deps=d=ze;if(!Bt)for(v=Qe;v<d.length;v++)((_=d[v]).reactions??(_.reactions=[])).push(e)}else d!==null&&Qe<d.length&&(br(e,Qe),d.length=Qe);if(Qn()&&nt!==null&&!xt&&d!==null&&(e.f&(dt|an|It))===0)for(v=0;v<nt.length;v++)Ho(nt[v],e);return s!==null&&(_r++,nt!==null&&(r===null?r=nt:r.push(...nt))),f}finally{ze=t,Qe=n,nt=r,se=s,Bt=o,Ve=i,Ws(c),xt=l,e.f^=ts}}function Xi(e,t){let n=t.reactions;if(n!==null){var r=fi.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&dt)!==0&&(ze===null||!ze.includes(t))&&(pt(t,an),(t.f&(st|pr))===0&&(t.f^=pr),jo(t),br(t,0))}function br(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)Xi(e,n[r])}function Or(e){var t=e.f;if((t&Cr)===0){pt(e,Ke);var n=ae,r=de,s=tn;ae=e,tn=!0;try{(t&gs)!==0?Bi(e):Lo(e),Mo(e);var o=Bo(e);e.teardown=typeof o=="function"?o:null,e.wv=Jo;var i=e.deps,c;Bs&&$i&&e.f&It}catch(l){Rr(l,e,n,r||e.ctx)}finally{tn=s,ae=n}}}function el(){try{wi()}catch(e){if(gr!==null)Rr(e,gr,null);else throw e}}function qo(){var e=tn;try{var t=0;for(tn=!0;Fn.length>0;){t++>1e3&&el();var n=Fn,r=n.length;Fn=[];for(var s=0;s<r;s++){var o=nl(n[s]);tl(o)}}}finally{hr=!1,tn=e,gr=null,zn.clear()}}function tl(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Cr|Rt))===0)try{En(r)&&(Or(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Fo(r):r.fn=null))}catch(s){Rr(s,r,null,r.ctx)}}}function Tr(e){hr||(hr=!0,queueMicrotask(qo));for(var t=gr=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(Sn|Nt))!==0){if((n&Ke)===0)return;t.f^=Ke}}Fn.push(t)}function nl(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Nt|Sn))!==0,o=s&&(r&Ke)!==0;if(!o&&(r&Rt)===0){if((r&wo)!==0)t.push(n);else if(s)n.f^=Ke;else{var i=se;try{se=n,En(n)&&Or(n)}catch(u){Rr(u,n,null,n.ctx)}finally{se=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function rl(e){var t;for(Xs();Fn.length>0;)hr=!0,qo(),Xs();return t}async function sl(){await Promise.resolve(),rl()}function a(e){var t=e.f,n=(t&dt)!==0;if(Ht!==null&&Ht.add(e),se!==null&&!xt){if(!(Ve!=null&&Ve.includes(e))){var r=se.deps;e.rv<_r&&(e.rv=_r,ze===null&&r!==null&&r[Qe]===e?Qe++:ze===null?ze=[e]:(!Bt||!ze.includes(e))&&ze.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&st)===0&&(s.f^=st)}return n&&(s=e,En(s)&&No(s)),er&&zn.has(e)?zn.get(e):e.v}function ol(e){var t=Ht;Ht=new Set;var n=Ht,r;try{if(et(e),t!==null)for(r of Ht)t.add(r)}finally{Ht=t}return n}function ss(e){var t=ol(()=>et(e));for(var n of t)if((n.f&xo)!==0)for(const r of n.deps||[])(r.f&dt)===0&&Jn(r,r.v);else Jn(n,n.v)}function et(e){var t=xt;try{return xt=!0,e()}finally{xt=t}}const al=-7169;function pt(e,t){e.f=e.f&al|t}function ks(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(kt in e)os(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&kt in n&&os(n)}}}function os(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{os(e[r],t)}catch{}const n=hs(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=yo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function il(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const ll=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function cl(e){return ll.includes(e)}const ul={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function fl(e){return e=e.toLowerCase(),ul[e]??e}const dl=["touchstart","touchmove"];function vl(e){return dl.includes(e)}function pl(e,t){if(t){const n=document.body;e.autofocus=!0,Ar(()=>{document.activeElement===n&&e.focus()})}}let to=!1;function hl(){to||(to=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function Wo(e){var t=se,n=ae;St(null),Kt(null);try{return e()}finally{St(t),Kt(n)}}function Ss(e,t,n,r=n){e.addEventListener(t,()=>Wo(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),hl()}const Ko=new Set,as=new Set;function Yo(e,t,n,r={}){function s(o){if(r.capture||Mn.call(t,o),!o.cancelBubble)return Wo(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Ar(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function F(e,t,n,r,s){var o={capture:r,passive:s},i=Yo(e,t,n,o);(t===document.body||t===window||t===document)&&ws(()=>{t.removeEventListener(e,i,o)})}function gl(e){for(var t=0;t<e.length;t++)Ko.add(e[t]);for(var n of as)n(e)}function Mn(e){var C;var t=this,n=t.ownerDocument,r=e.type,s=((C=e.composedPath)==null?void 0:C.call(e))||[],o=s[0]||e.target,i=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var u=s.indexOf(t);if(u===-1)return;l<=u&&(i=l)}if(o=s[i]||e.target,o!==t){mo(e,"currentTarget",{configurable:!0,get(){return o||n}});var f=se,d=ae;St(null),Kt(null);try{for(var v,_=[];o!==null;){var g=o.assignedSlot||o.parentNode||o.host||null;try{var y=o["__"+r];if(y!=null&&(!o.disabled||e.target===o))if(kr(y)){var[x,...O]=y;x.apply(o,[e,...O])}else y.call(o,e)}catch(w){v?_.push(w):v=w}if(e.cancelBubble||g===t||g===null)break;o=g}if(v){for(let w of _)queueMicrotask(()=>{throw w});throw v}}finally{e.__root=t,delete e.currentTarget,St(f),Kt(d)}}}function Qo(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function sn(e,t){var n=ae;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function E(e,t){var n=(t&Eo)!==0,r=(t&ji)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=Qo(o?e:"<!>"+e),n||(s=At(s)));var i=r||Oo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=At(i),l=i.lastChild;sn(c,l)}else sn(i,i);return i}}function Zo(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Eo)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=Qo(o),l=At(c);if(s)for(i=document.createDocumentFragment();At(l);)i.appendChild(At(l));else i=At(l)}var u=i.cloneNode(!0);if(s){var f=At(u),d=u.lastChild;sn(f,d)}else sn(u,u);return u}}function Ie(e=""){{var t=Zn(e+"");return sn(t,t),t}}function $e(){var e=document.createDocumentFragment(),t=document.createComment(""),n=Zn();return e.append(t,n),sn(t,n),e}function b(e,t){e!==null&&e.before(t)}function q(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function _l(e,t){return bl(e,t)}const hn=new Map;function bl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:i=!0}){Fi();var c=new Set,l=d=>{for(var v=0;v<d.length;v++){var _=d[v];if(!c.has(_)){c.add(_);var g=vl(_);t.addEventListener(_,Mn,{passive:g});var y=hn.get(_);y===void 0?(document.addEventListener(_,Mn,{passive:g}),hn.set(_,1)):hn.set(_,y+1)}}};l(ps(Ko)),as.add(l);var u=void 0,f=Hi(()=>{var d=n??t.appendChild(Zn());return wn(()=>{if(o){He({});var v=de;v.c=o}s&&(r.$$events=s),u=e(d,r)||{},o&&Be()}),()=>{var g;for(var v of c){t.removeEventListener(v,Mn);var _=hn.get(v);--_===0?(document.removeEventListener(v,Mn),hn.delete(v)):hn.set(v,_)}as.delete(l),d!==n&&((g=d.parentNode)==null||g.removeChild(d))}});return ml.set(u,f),u}let ml=new WeakMap;function j(e,t,[n,r]=[0,0]){var s=e,o=null,i=null,c=We,l=n>0?$r:0,u=!1;const f=(v,_=!0)=>{u=!0,d(_,v)},d=(v,_)=>{c!==(c=v)&&(c?(o?Bn(o):_&&(o=wn(()=>_(s))),i&&Hn(i,()=>{i=null})):(i?Bn(i):_&&(i=wn(()=>_(s,[n+1,r]))),o&&Hn(o,()=>{o=null})))};Er(()=>{u=!1,t(f),u||d(null,null)},l)}function Wn(e,t){return t}function yl(e,t,n,r){for(var s=[],o=t.length,i=0;i<o;i++)xs(t[i].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;Gi(l),l.append(n),r.clear(),Vt(e,t[0].prev,t[o-1].next)}Go(s,()=>{for(var u=0;u<o;u++){var f=t[u];c||(r.delete(f.k),Vt(e,f.prev,f.next)),Tt(f.e,!c)}})}function Dt(e,t,n,r,s,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&$o)!==0;if(l){var u=e;i=u.appendChild(Zn())}var f=null,d=!1,v=vt(()=>{var _=n();return kr(_)?_:_==null?[]:ps(_)});Er(()=>{var _=a(v),g=_.length;d&&g===0||(d=g===0,wl(_,c,i,s,t,r,n),o!==null&&(g===0?f?Bn(f):f=wn(()=>o(i)):f!==null&&Hn(f,()=>{f=null})),a(v))})}function wl(e,t,n,r,s,o,i){var be,xe,me,z;var c=(s&Ei)!==0,l=(s&(ms|ys))!==0,u=e.length,f=t.items,d=t.first,v=d,_,g=null,y,x=[],O=[],C,w,P,D;if(c)for(D=0;D<u;D+=1)C=e[D],w=o(C,D),P=f.get(w),P!==void 0&&((be=P.a)==null||be.measure(),(y??(y=new Set)).add(P));for(D=0;D<u;D+=1){if(C=e[D],w=o(C,D),P=f.get(w),P===void 0){var J=v?v.e.nodes_start:n;g=kl(J,t,g,g===null?t.first:g.next,C,w,D,r,s,i),f.set(w,g),x=[],O=[],v=g.next;continue}if(l&&xl(P,C,D,s),(P.e.f&Rt)!==0&&(Bn(P.e),c&&((xe=P.a)==null||xe.unfix(),(y??(y=new Set)).delete(P))),P!==v){if(_!==void 0&&_.has(P)){if(x.length<O.length){var V=O[0],M;g=V.prev;var Q=x[0],ie=x[x.length-1];for(M=0;M<x.length;M+=1)no(x[M],V,n);for(M=0;M<O.length;M+=1)_.delete(O[M]);Vt(t,Q.prev,ie.next),Vt(t,g,Q),Vt(t,ie,V),v=V,g=ie,D-=1,x=[],O=[]}else _.delete(P),no(P,v,n),Vt(t,P.prev,P.next),Vt(t,P,g===null?t.first:g.next),Vt(t,g,P),g=P;continue}for(x=[],O=[];v!==null&&v.k!==w;)(v.e.f&Rt)===0&&(_??(_=new Set)).add(v),O.push(v),v=v.next;if(v===null)continue;P=v}x.push(P),g=P,v=P.next}if(v!==null||_!==void 0){for(var _e=_===void 0?[]:ps(_);v!==null;)(v.e.f&Rt)===0&&_e.push(v),v=v.next;var we=_e.length;if(we>0){var ve=(s&$o)!==0&&u===0?n:null;if(c){for(D=0;D<we;D+=1)(me=_e[D].a)==null||me.measure();for(D=0;D<we;D+=1)(z=_e[D].a)==null||z.fix()}yl(t,_e,ve,f)}}c&&Ar(()=>{var ee;if(y!==void 0)for(P of y)(ee=P.a)==null||ee.apply()}),ae.first=t.first&&t.first.e,ae.last=g&&g.e}function xl(e,t,n,r){(r&ms)!==0&&Jn(e.v,t),(r&ys)!==0?Jn(e.i,n):e.i=n}function kl(e,t,n,r,s,o,i,c,l,u){var f=(l&ms)!==0,d=(l&Ai)===0,v=f?d?N(s):yn(s):s,_=(l&ys)===0?i:yn(i),g={i:_,v,k:o,a:null,e:null,prev:n,next:r};try{return g.e=wn(()=>c(e,v,_,u),Li),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?t.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function no(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var i=Pr(o);s.before(o),o=i}}function Vt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Mt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>r:r)}function Sl(e,t,n,r,s,o){var i,c,l=null,u=e,f;Er(()=>{const d=t()||null;var v=Ii;d!==i&&(f&&(d===null?Hn(f,()=>{f=null,c=null}):d===c?Bn(f):Tt(f)),d&&d!==c&&(f=wn(()=>{if(l=document.createElementNS(v,d),sn(l,l),r){var _=l.appendChild(Zn());r(l,_)}ae.nodes_end=l,u.before(l)})),i=d,i&&(c=i))},$r)}function Cl(e,t,n){Pn(()=>{var r=et(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};ln(()=>{var i=n();ks(i),s&&_s(o,i)&&(o=i,r.update(i))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function Xo(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Xo(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function $l(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Xo(e))&&(r&&(r+=" "),r+=t);return r}function Pl(e){return typeof e=="object"?$l(e):e??""}const ro=[...` 	
\r\f \v\uFEFF`];function El(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,i=0;(i=r.indexOf(s,i))>=0;){var c=i+o;(i===0||ro.includes(r[i-1]))&&(c===r.length||ro.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function so(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function qr(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Al(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(qr)),s&&l.push(...Object.keys(s).map(qr));var u=0,f=-1;const y=e.length;for(var d=0;d<y;d++){var v=e[d];if(c?v==="/"&&e[d-1]==="*"&&(c=!1):o?o===v&&(o=!1):v==="/"&&e[d+1]==="*"?c=!0:v==='"'||v==="'"?o=v:v==="("?i++:v===")"&&i--,!c&&o===!1&&i===0){if(v===":"&&f===-1)f=d;else if(v===";"||d===y-1){if(f!==-1){var _=qr(e.substring(u,f).trim());if(!l.includes(_)){v!==";"&&d++;var g=e.substring(u,d).trim();n+=" "+g+";"}}u=d+1,f=-1}}}}return r&&(n+=so(r)),s&&(n+=so(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function xn(e,t,n,r,s,o){var i=e.__className;if(i!==n){var c=El(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var u=!!o[l];(s==null||u!==!!s[l])&&e.classList.toggle(l,u)}return o}function Wr(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function ea(e,t,n,r){var s=e.__style;if(s!==t){var o=Al(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(Wr(e,n==null?void 0:n[0],r[0]),Wr(e,n==null?void 0:n[1],r[1],"important")):Wr(e,n,r));return r}const jn=Symbol("class"),Nn=Symbol("style"),ta=Symbol("is custom element"),na=Symbol("is html");function Rl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function qt(e,t,n,r){var s=ra(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[_i]=n),n==null?e.removeAttribute(t):typeof n!="string"&&sa(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function oo(e,t,n,r,s=!1){var o=ra(e),i=o[ta],c=!o[na],l=t||{},u=e.tagName==="OPTION";for(var f in t)f in n||(n[f]=null);n.class?n.class=Pl(n.class):n[jn]&&(n.class=null),n[Nn]&&(n.style??(n.style=null));var d=sa(e);for(const w in n){let P=n[w];if(u&&w==="value"&&P==null){e.value=e.__value="",l[w]=P;continue}if(w==="class"){var v=e.namespaceURI==="http://www.w3.org/1999/xhtml";xn(e,v,P,r,t==null?void 0:t[jn],n[jn]),l[w]=P,l[jn]=n[jn];continue}if(w==="style"){ea(e,P,t==null?void 0:t[Nn],n[Nn]),l[w]=P,l[Nn]=n[Nn];continue}var _=l[w];if(P!==_){l[w]=P;var g=w[0]+w[1];if(g!=="$$")if(g==="on"){const D={},J="$$"+w;let V=w.slice(2);var y=cl(V);if(il(V)&&(V=V.slice(0,-7),D.capture=!0),!y&&_){if(P!=null)continue;e.removeEventListener(V,l[J],D),l[J]=null}if(P!=null)if(y)e[`__${V}`]=P,gl([V]);else{let M=function(Q){l[w].call(this,Q)};var C=M;l[J]=Yo(V,e,M,D)}else y&&(e[`__${V}`]=void 0)}else if(w==="style")qt(e,w,P);else if(w==="autofocus")pl(e,!!P);else if(!i&&(w==="__value"||w==="value"&&P!=null))e.value=e.__value=P;else if(w==="selected"&&u)Rl(e,P);else{var x=w;c||(x=fl(x));var O=x==="defaultValue"||x==="defaultChecked";if(P==null&&!i&&!O)if(o[w]=null,x==="value"||x==="checked"){let D=e;const J=t===void 0;if(x==="value"){let V=D.defaultValue;D.removeAttribute(x),D.defaultValue=V,D.value=D.__value=J?V:null}else{let V=D.defaultChecked;D.removeAttribute(x),D.defaultChecked=V,D.checked=J?V:!1}}else e.removeAttribute(w);else O||d.includes(x)&&(i||typeof P!="string")?e[x]=P:typeof P!="function"&&qt(e,x,P)}}}return l}function ra(e){return e.__attributes??(e.__attributes={[ta]:e.nodeName.includes("-"),[na]:e.namespaceURI===Ni})}var ao=new Map;function sa(e){var t=ao.get(e.nodeName);if(t)return t;ao.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=yo(r);for(var o in n)n[o].set&&t.push(o);r=hs(r)}return t}function Ze(e,t,n=t){var r=Qn();Ss(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=Kr(e)?Yr(o):o,n(o),r&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),et(t)==null&&e.value&&n(Kr(e)?Yr(e.value):e.value),ln(()=>{var s=t();Kr(e)&&s===Yr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function ar(e,t,n=t){Ss(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),et(t)==null&&n(e.checked),ln(()=>{var r=t();e.checked=!!r})}function Kr(e){var t=e.type;return t==="number"||t==="range"}function Yr(e){return e===""?null:+e}function oa(e,t,n){if(e.multiple)return Tl(e,t);for(var r of e.options){var s=Gn(r);if(Mi(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Ol(e,t){Pn(()=>{var n=new MutationObserver(()=>{var r=e.__value;oa(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function is(e,t,n=t){var r=!0;Ss(e,"change",s=>{var o=s?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),Gn);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&Gn(c)}n(i)}),Pn(()=>{var s=t();if(oa(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=Gn(o),n(s))}e.__value=s,r=!1}),Ol(e)}function Tl(e,t){for(var n of e.options)n.selected=~t.indexOf(Gn(n))}function Gn(e){return"__value"in e?e.__value:e.value}function io(e,t){return e===t||(e==null?void 0:e[kt])===t}function Ln(e={},t,n,r){return Pn(()=>{var s,o;return ln(()=>{s=o,o=[],et(()=>{e!==n(...o)&&(t(e,...o),s&&io(n(...s),e)&&t(null,...s))})}),()=>{Ar(()=>{o&&io(n(...o),e)&&t(null,...o)})}}),e}function Dl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ye(e=!1){const t=de,n=t.l.u;if(!n)return;let r=()=>ks(t.s);if(e){let s=0,o={};const i=Vn(()=>{let c=!1;const l=t.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&s++,s});r=()=>a(i)}n.b.length&&Vi(()=>{lo(t,r),dr(n.b)}),ns(()=>{const s=et(()=>n.m.map(pi));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&ns(()=>{lo(t,r),dr(n.a)})}function lo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function aa(e,t,n){if(e==null)return t(void 0),mn;const r=et(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const gn=[];function at(e,t=mn){let n=null;const r=new Set;function s(c){if(_s(e,c)&&(e=c,n)){const l=!gn.length;for(const u of r)u[1](),gn.push(u,e);if(l){for(let u=0;u<gn.length;u+=2)gn[u][0](gn[u+1]);gn.length=0}}}function o(c){s(c(e))}function i(c,l=mn){const u=[c,l];return r.add(u),r.size===1&&(n=t(s,o)||mn),c(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function Me(e){let t;return aa(e,n=>t=n)(),t}let ir=!1,ls=Symbol();function on(e,t,n){const r=n[t]??(n[t]={store:null,source:N(void 0),unsubscribe:mn});if(r.store!==e&&!(ls in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=mn;else{var s=!0;r.unsubscribe=aa(e,o=>{s?r.source.v=o:m(r.source,o)}),s=!1}return e&&ls in n?Me(e):a(r.source)}function Dr(){const e={};function t(){ws(()=>{for(var n in e)e[n].unsubscribe();mo(e,ls,{enumerable:!1,value:!0})})}return[e,t]}function jl(e){var t=ir;try{return ir=!1,[e(),ir]}finally{ir=t}}const Nl={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=Xe({get[t](){return e.props[t]}},t,Po)),e.special[t](n),Qs(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),Qs(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function jt(e,t){return new Proxy({props:e,exclude:t,special:{},version:yn(0)},Nl)}const Il={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];Dn(s)&&(s=s());const o=Wt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Wt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===kt||t===So)return!1;for(let n of e.props)if(Dn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Dn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function cn(...e){return new Proxy({props:e},Il)}function co(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function Xe(e,t,n,r){var V;var s=(n&Ri)!==0,o=!Cn||(n&Oi)!==0,i=(n&Ti)!==0,c=(n&Di)!==0,l=!1,u;i?[u,l]=jl(()=>e[t]):u=e[t];var f=kt in e||So in e,d=i&&(((V=Wt(e,t))==null?void 0:V.set)??(f&&t in e&&(M=>e[t]=M)))||void 0,v=r,_=!0,g=!1,y=()=>(g=!0,_&&(_=!1,c?v=et(r):v=r),v);u===void 0&&r!==void 0&&(d&&o&&xi(),u=y(),d&&d(u));var x;if(o)x=()=>{var M=e[t];return M===void 0?y():(_=!0,g=!1,M)};else{var O=(s?Vn:vt)(()=>e[t]);O.f|=xo,x=()=>{var M=a(O);return M!==void 0&&(v=void 0),M===void 0?v:M}}if((n&Po)===0)return x;if(d){var C=e.$$legacy;return function(M,Q){return arguments.length>0?((!o||!Q||C||l)&&d(Q?x():M),M):x()}}var w=!1,P=!1,D=N(u),J=Vn(()=>{var M=x(),Q=a(D);return w?(w=!1,P=!0,Q):(P=!1,D.v=M)});return i&&a(J),s||(J.equals=bs),function(M,Q){if(Ht!==null&&(w=P,x(),a(D)),arguments.length>0){const ie=Q?a(J):o&&i?en(M):M;if(!J.equals(ie)){if(w=!0,m(D,ie),g&&v!==void 0&&(v=ie),co(J))return M;et(()=>a(J))}return M}return co(J)?J.v:a(J)}}function jr(e){de===null&&Ao(),Cn&&de.l!==null?Fl(de).m.push(e):ns(()=>{const t=et(e);if(typeof t=="function")return t})}function Ml(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function Ll(){const e=de;return e===null&&Ao(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const i=kr(s)?s.slice():[s],c=Ml(t,n,r);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function Fl(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const Gl="5";var bo;typeof window<"u"&&((bo=window.__svelte??(window.__svelte={})).v??(bo.v=new Set)).add(Gl);Pi();const Ot=at({isLoggedIn:!1,token:null,user:null});function Qr(){Ot.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const rt=at("home"),Nr=at(null),De=at({phase:"streaming",paused:!1,loadedCount:0,totalCount:null}),Ul="modulepreload",zl=function(e){return"/skygit/"+e},uo={},tr=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=zl(l),l in uo)return;uo[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Ul,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((v,_)=>{d.addEventListener("load",v),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function ia(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function cs(e,t){const n=await ia(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+i.byteLength);return c.set(r,0),c.set(new Uint8Array(i),r.byteLength),btoa(String.fromCharCode(...c))}async function Cs(e,t){const n=Uint8Array.from(atob(t),u=>u.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await ia(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(i);return JSON.parse(l)}const Jl="https://api.github.com",Vl="skygit-config";function la(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}async function ht(e){const t=await fetch(`${Jl}/user`,{headers:la(e)});if(!t.ok)throw new Error("Failed to fetch GitHub user");return(await t.json()).login}async function ca(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${Vl}`,{headers:la(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function ua(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function Ir(e,t){const n=await ht(e),r=`repositories/${t.owner}-${t.name}.json`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));let i=null;const c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:s});c.ok&&(i=(await c.json()).sha);const l={message:`Update repo ${t.full_name}`,content:o};i&&(l.sha=i);const u=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"PUT",headers:s,body:JSON.stringify(l)});if(!u.ok){const f=await u.text();throw new Error(`GitHub commit failed: ${f}`)}}async function $s(e){const n=`https://api.github.com/repos/${await ht(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){De.set({phase:"idle",loadedCount:0,totalCount:0,paused:!1});return}if(!s.ok){const c=await s.text();throw new Error(`Failed to load repository list: ${c}`)}const i=(await s.json()).filter(c=>c.name.endsWith(".json"));De.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:!1});for(const c of i){let l=!1;if(De.subscribe(u=>l=u.paused)(),l)break;try{const u=await fetch(c.url,{headers:r});if(!u.ok){console.warn(`[SkyGit] Skipped missing repo file: ${c.name} (${u.status})`);continue}const f=await u.json(),d=atob(f.content),v=JSON.parse(d);ba([v]),De.update(_=>({..._,loadedCount:_.loadedCount+1}))}catch(u){console.warn(`[SkyGit] Skipped malformed repo file: ${c.name}`,u);continue}}De.update(c=>({...c,phase:"idle"}))}async function fa(e){const n=`https://api.github.com/repos/${await ht(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const u=await fetch(l.url,{headers:r});if(!u.ok)continue;const f=await u.json(),d=JSON.parse(atob(f.content));c.push(d)}return c}async function da(e,t){const n=await ht(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function va(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),i=`https://api.github.com/repos/${t.full_name}/contents/.messages/config.json`;let c=null;try{const u=await fetch(i,{headers:n});if(u.ok)c=(await u.json()).sha;else if(u.status!==404){const f=await u.text();throw new Error(`Failed to check if config.json exists: ${f}`)}}catch(u){console.warn("Error checking for config.json",u)}const l=await fetch(i,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:s,...c&&{sha:c}})});if(!l.ok){const u=await l.text();throw new Error(`Failed to commit config.json: ${u}`)}t.has_messages=!0,t.config=r,await Ir(e,t)}async function pa(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),i=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let c=null;i.ok&&(c=(await i.json()).sha);const l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:o,...c&&{sha:c}})});if(!l.ok){const f=await l.text();throw new Error(`Failed to update config.json: ${f}`)}const{commitRepoToGitHub:u}=await tr(async()=>{const{commitRepoToGitHub:f}=await Promise.resolve().then(()=>Hl);return{commitRepoToGitHub:f}},void 0);await u(e,t)}async function Mr(e){const n=`https://api.github.com/repos/${await ht(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function Un(e,t,n=null){const s=`https://api.github.com/repos/${await ht(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const u=await l.text();throw new Error(`Failed to check secrets.json: ${u}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function ha(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials,s=await cs(e,r),{secrets:o,sha:i}=await Mr(e);o[n]=s,await Un(e,o,i)}const Hl=Object.freeze(Object.defineProperty({__proto__:null,activateMessagingForRepo:va,checkSkyGitRepoExists:ca,commitRepoToGitHub:Ir,createSkyGitRepo:ua,deleteRepoFromGitHub:da,getGitHubUsername:ht,getSecretsMap:Mr,saveSecretsMap:Un,storeEncryptedCredentials:ha,streamPersistedConversationsFromGitHub:fa,streamPersistedReposFromGitHub:$s,updateRepoMessagingConfig:pa},Symbol.toStringTag,{value:"Module"})),ga="skygit_repos",Bl=5*60*1e3,ql=10;let nn=[],mr=null;const Wl=JSON.parse(localStorage.getItem(ga)||"[]"),ut=at(Wl),Ps=at(0),Kn=at(null);ut.subscribe(e=>{localStorage.setItem(ga,JSON.stringify(e))});function _a(e){if(ut.update(n=>{const r=n.findIndex(s=>s.full_name===e.full_name);if(r>=0){const s=[...n];return s[r]=e,s}return[...n,e]}),nn.some(n=>n.full_name===e.full_name)||nn.push(e),nn.length>=ql){yr();return}mr||(mr=setTimeout(yr,Bl))}async function yr(){if(nn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...nn];nn=[],clearTimeout(mr),mr=null;for(const n of t)try{await Ir(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function ba(e){ut.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function ma(){return nn.length>0}function ya(e){let t;return ut.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const Kl=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Ps,flushRepoCommitQueue:yr,getRepoByFullName:ya,hasPendingRepoCommits:ma,queueRepoForCommit:_a,repoList:ut,selectedRepo:Kn,syncRepoListFromGitHub:ba},Symbol.toStringTag,{value:"Module"}));async function Yl(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function Ql(e){localStorage.setItem("skygit_token",e)}function Zl(){return localStorage.getItem("skygit_token")}const wa="skygit_conversations",Xl=JSON.parse(localStorage.getItem(wa)||"{}"),An=at(Xl),Es=at(null);An.subscribe(e=>{localStorage.setItem(wa,JSON.stringify(e))});function us(e,t){An.update(n=>({...n,[e]:t}))}function ec(e,t){An.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function xa(e,t,n){An.update(r=>{const o=(r[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...r,[t]:o}}),Es.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Oe=[];for(let e=0;e<256;++e)Oe.push((e+256).toString(16).slice(1));function tc(e,t=0){return(Oe[e[t+0]]+Oe[e[t+1]]+Oe[e[t+2]]+Oe[e[t+3]]+"-"+Oe[e[t+4]]+Oe[e[t+5]]+"-"+Oe[e[t+6]]+Oe[e[t+7]]+"-"+Oe[e[t+8]]+Oe[e[t+9]]+"-"+Oe[e[t+10]]+Oe[e[t+11]]+Oe[e[t+12]]+Oe[e[t+13]]+Oe[e[t+14]]+Oe[e[t+15]]).toLowerCase()}let Zr;const nc=new Uint8Array(16);function rc(){if(!Zr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zr=crypto.getRandomValues.bind(crypto)}return Zr(nc)}const sc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fo={randomUUID:sc};function oc(e,t,n){var s;if(fo.randomUUID&&!e)return fo.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??rc();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tc(r)}async function ac(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const i=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));us(t.full_name,i),t.conversations=i.map(c=>c.id),await Ir(e,t)}async function ka(e,t){console.log("[SkyGit] 📝 commitToSkyGitConversations() called"),console.log("⏩ Payload:",t);const n=await ht(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,i=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:i})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function ic(e,t,n){console.log("[SkyGit] 🔧 createConversation called for:",t.full_name,"with title:",n),await ht(e);const r=oc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,i={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const f=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${f}`)}try{console.log("[SkyGit] 📤 Now committing to skygit-config..."),await ka(e,i)}catch(f){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",f)}const u={id:r,name:s,path:o,repo:t.full_name,title:n};ec(u,t)}const _n=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let ur=!1;function lc(){ur=!0}async function fs(e){ur=!1;const t=new Set,n=[],r=await Xr("https://api.github.com/user/repos",_n(e));n.push(...r),De.update(o=>({...o,totalCount:n.length}));const s=await Xr("https://api.github.com/user/orgs",_n(e));for(const o of s){if(ur)return;const i=await Xr(`https://api.github.com/orgs/${o.login}/repos`,_n(e));n.push(...i),De.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(ur)return;const i=o.full_name;if(t.has(i)){De.update(f=>({...f,loadedCount:f.loadedCount+1}));continue}t.add(i);const c=await cc(e,i);let l=!1;try{const f=await fetch(`https://api.github.com/repos/${i}`,{headers:_n(e)});f.ok&&(l=(await f.json()).has_discussions===!0)}catch(f){console.warn(`[SkyGit] Failed to fetch discussion status for ${i}`,f)}const u={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(u.has_discussions)try{const f=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:_n(e)});if(f.ok){const d=await f.json();u.config=JSON.parse(atob(d.content)),await ac(e,u)}}catch(f){console.warn(`[SkyGit] Invalid config.json in ${i}`,f)}De.update(f=>({...f,loadedCount:f.loadedCount+1})),_a(u)}De.update(o=>({...o,phase:"idle"}))}async function Xr(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),s=i.length<100,r++):s=!0}return n}async function cc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:_n(e)})).status===200}catch{return!1}}const ds=at({config:null,secrets:{},secretsSha:null});async function uc(e){const t=await ht(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)us(o,s[o]);console.log("[SkyGit] ✅ Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,u]of Object.entries(i))try{c[l]=await Cs(e,u)}catch(f){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,f)}r.secrets=c,r.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}ds.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await $s(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await fa(e)||[],o={};for(const i of s)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)us(i,o[i])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let Yn=new Set,fr=new Map;const fc=10;function As(e,t){const n=`${e}::${t}`;if(Yn.add(n),Yn.size>=fc){wr();return}const r=dc(e);if(!fr.has(n)){const s=setTimeout(()=>{wr([n]),fr.delete(n)},r);fr.set(n,s)}}function dc(e){var s;const n=Me(ut).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function wr(e=null){const t=e||Array.from(Yn);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await ht(n);const r=Me(An);for(const s of t){Yn.delete(s),fr.delete(s);const[o,i]=s.split("::"),l=(r[o]||[]).find(f=>f.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const u={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await ka(n,u);const f=`.messages/conversation-${u.id}.json`,d=btoa(JSON.stringify(u,null,2)),v=await fetch(`https://api.github.com/repos/${o}/contents/${f}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${u.id}`,content:d})});if(!v.ok){const _=await v.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(f){console.error("[SkyGit] Conversation commit failed:",f)}}}function Sa(){return Yn.size>0}const Rs=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:wr,hasPendingConversationCommits:Sa,queueConversationForCommit:As},Symbol.toStringTag,{value:"Module"}));var vc=E('<p class="text-red-500 text-sm"> </p>'),pc=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticating…',1),hc=E('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Don’t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function gc(e,t){He(t,!1);let n=Xe(t,"onSubmit",8),r=Xe(t,"error",8,null),s=N(""),o=N(!1);async function i(){a(o)||(m(o,!0),await n()(a(s)),m(o,!1))}Ye();var c=hc(),l=p(h(c),2),u=p(l,2);{var f=y=>{var x=vc(),O=h(x);Y(()=>q(O,r())),b(y,x)};j(u,y=>{r()&&y(f)})}var d=p(u,2),v=h(d);{var _=y=>{var x=pc();b(y,x)},g=y=>{var x=Ie("Authenticate");b(y,x)};j(v,y=>{a(o)?y(_):y(g,!1)})}Y(()=>{l.disabled=a(o),d.disabled=a(o)}),Ze(l,()=>a(s),y=>m(s,y)),F("click",d,i),b(e,c),Be()}var _c=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),bc=E('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function mc(e,t){He(t,!1);let n=Xe(t,"onApprove",8),r=Xe(t,"onReject",8),s=N(!1);async function o(){a(s)||(m(s,!0),await n()(),m(s,!1))}Ye();var i=bc(),c=p(h(i),6),l=h(c),u=h(l);{var f=_=>{var g=_c();b(_,g)},d=_=>{var g=Ie("I Accept");b(_,g)};j(u,_=>{a(s)?_(f):_(d,!1)})}var v=p(l,2);Y(()=>{l.disabled=a(s),v.disabled=a(s)}),F("click",l,o),F("click",v,function(..._){var g;(g=r())==null||g.apply(this,_)}),b(e,i),Be()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const yc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var wc=Zo("<svg><!><!></svg>");function un(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]),r=jt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);He(t,!1);let s=Xe(t,"name",8,void 0),o=Xe(t,"color",8,"currentColor"),i=Xe(t,"size",8,24),c=Xe(t,"strokeWidth",8,2),l=Xe(t,"absoluteStrokeWidth",8,!1),u=Xe(t,"iconNode",24,()=>[]);const f=(...y)=>y.filter((x,O,C)=>!!x&&C.indexOf(x)===O).join(" ");Ye();var d=wc();let v;var _=h(d);Dt(_,1,u,Wn,(y,x)=>{let O=()=>a(x)[0],C=()=>a(x)[1];var w=$e(),P=fe(w);Sl(P,O,!0,(D,J)=>{let V;Y(()=>V=oo(D,V,{...C()}))}),b(y,w)});var g=p(_);Mt(g,t,"default",{}),Y((y,x)=>v=oo(d,v,{...yc,...r,width:i(),height:i(),stroke:o(),"stroke-width":y,class:x}),[()=>l()?Number(c())*24/Number(i()):c(),()=>f("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],vt),b(e,d),Be()}function xc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function kc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function vo(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Sc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Cc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function $c(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Pc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}var Ec=E('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),Ac=E('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),Rc=E('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></button>'),Oc=E('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),Tc=E('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function Dc(e,t){He(t,!1);const n=N();let r=N({});An.subscribe(u=>m(r,u));function s(u){Nr.set(u),Es.set(u),rt.set("chats")}ct(()=>a(r),()=>{m(n,Object.values(a(r)).flat().sort((u,f)=>{const d=new Date(u.updatedAt||u.createdAt||0).getTime();return new Date(f.updatedAt||f.createdAt||0).getTime()-d}))}),Xn(),Ye();var o=Tc(),i=h(o);Dt(i,1,()=>a(n),u=>u.id,(u,f)=>{var d=Rc(),v=h(d),_=h(v),g=p(v,2),y=h(g),x=p(g,2);{var O=w=>{var P=Ec(),D=h(P);Y(J=>q(D,J),[()=>a(f).messages.at(-1).content],vt),b(w,P)},C=w=>{var P=Ac();b(w,P)};j(x,w=>{a(f).messages&&a(f).messages.length>0?w(O):w(C,!1)})}Y(w=>{q(_,w),q(y,a(f).repo)},[()=>a(f).title||`Conversation ${a(f).id.slice(0,6)}`],vt),F("click",d,()=>s(a(f))),b(u,d)});var c=p(i,2);{var l=u=>{var f=Oc();b(u,f)};j(c,u=>{a(n).length===0&&u(l)})}b(e,o),Be()}var jc=E('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),Nc=E('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),Ic=E('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">✔️ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">🔄 Sync</button> <button class="text-blue-600 text-xs underline">🔍 Discover</button></div></div>'),Mc=E('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),Lc=E('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),Fc=E('<ul class="space-y-2"></ul>'),Gc=E('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),Uc=E('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),zc=E('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> 🔒 Private</label> <label><input type="checkbox"> 🌐 Public</label> <label><input type="checkbox"> 💬 With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function Jc(e,t){He(t,!1);const n=N(),r=N();let s=Xe(t,"search",8,""),o=N([]),i=N(),c=N(),l=N(!0),u=N(!0),f=N(!0),d=N(!0);ut.subscribe(S=>m(o,S)),De.subscribe(S=>m(i,S));function v(){De.update(S=>({...S,paused:!S.paused}))}function _(){if(a(i).paused){De.update(T=>({...T,paused:!1}));const S=localStorage.getItem("skygit_token");S&&fs(S)}else lc(),De.update(S=>({...S,paused:!0}))}async function g(S){const T=a(o).find(I=>I.full_name===S);if(T){ut.update(I=>I.filter(H=>H.full_name!==S));try{const I=localStorage.getItem("skygit_token");await da(I,T),console.log(`[SkyGit] Deleted ${S} from GitHub`)}catch(I){console.warn(`[SkyGit] Failed to delete ${S} from GitHub:`,I)}}}async function y(){const S=localStorage.getItem("skygit_token");if(S){De.update(I=>({...I,phase:"streaming",paused:!1,loadedCount:0})),await $s(S);const T=[];for(const I of a(o)){if(!I.has_discussions)try{const H=await fetch(`https://api.github.com/repos/${I.full_name}`,{headers:{Authorization:`token ${S}`,Accept:"application/vnd.github+json"}});H.ok&&(await H.json()).has_discussions&&(I.has_discussions=!0)}catch(H){console.warn("Failed to refresh discussions status for",I.full_name,H)}T.push(I)}ut.set(T),Kn.update(I=>{if(!I)return I;const H=T.find(W=>W.full_name===I.full_name);return H||I})}}async function x(){const S=localStorage.getItem("skygit_token");S&&(De.update(T=>({...T,phase:"discovery",paused:!1})),fs(S))}function O(S){Kn.set(S),Nr.set(S)}ct(()=>(a(o),ks(s()),a(l),a(u),a(f),a(d)),()=>{m(n,a(o).filter(S=>{const T=s().toLowerCase(),I=S.full_name.toLowerCase().includes(T)||S.name.toLowerCase().includes(T)||S.owner.toLowerCase().includes(T),H=S.private&&a(l)||!S.private&&a(u),W=S.has_messages&&a(f)||!S.has_messages&&a(d);return I&&H&&W}))}),ct(()=>a(n),()=>{Ps.set(a(n).length)}),ct(()=>a(o),()=>{m(r,a(o).some(S=>!S.has_discussions))}),Xn(),Ye();var C=zc(),w=fe(C);{var P=S=>{var T=jc(),I=h(T),H=h(I);vo(H,{class:"w-4 h-4 animate-spin text-blue-500"});var W=p(H,2),ne=h(W),le=p(I,2),oe=h(le);Y(()=>{q(ne,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),q(oe,a(i).paused?"Resume Syncing":"Pause Syncing")}),F("click",le,v),b(S,T)},D=(S,T)=>{{var I=W=>{var ne=Nc(),le=h(ne);vo(le,{class:"w-4 h-4 animate-spin text-blue-500"});var oe=p(le,2),Pe=h(oe),L=p(oe,2),K=h(L);Y(()=>{q(Pe,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),q(K,a(i).paused?"Resume Discovery":"Pause Discovery")}),F("click",L,_),b(W,ne)},H=(W,ne)=>{{var le=oe=>{var Pe=Ic(),L=p(h(Pe),2),K=h(L),ke=p(K,2);F("click",K,y),F("click",ke,x),b(oe,Pe)};j(W,oe=>{a(i).phase==="idle"&&oe(le)},ne)}};j(S,W=>{a(i).phase==="discovery"?W(I):W(H,!1)},T)}};j(w,S=>{a(i).phase==="streaming"?S(P):S(D,!1)})}var J=p(w,2),V=h(J),M=h(V),Q=p(V,2),ie=h(Q),_e=p(Q,2),we=h(_e),ve=p(_e,2),be=h(ve),xe=p(J,2);{var me=S=>{var T=Fc();Dt(T,5,()=>a(n),I=>I.full_name,(I,H)=>{var W=Lc(),ne=h(W),le=h(ne),oe=h(le),Pe=p(le,2),L=h(Pe),K=p(L);{var ke=pe=>{var Ee=Mc();b(pe,Ee)};j(K,pe=>{a(H).has_discussions||pe(ke)})}Ln(ne,pe=>m(c,pe),()=>a(c));var Se=p(ne,2),tt=h(Se);$c(tt,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),Y(()=>{q(oe,a(H).full_name),q(L,`${(a(H).has_messages?" | 💬 .messages":" | no messaging")??""} `)}),F("click",le,()=>O(a(H))),F("click",Se,()=>g(a(H).full_name)),b(I,W)}),b(S,T)},z=S=>{var T=Gc();b(S,T)};j(xe,S=>{a(n).length>0?S(me):S(z,!1)})}var ee=p(xe,2);{var Z=S=>{var T=Uc();b(S,T)};j(ee,S=>{a(r)&&S(Z)})}ar(M,()=>a(l),S=>m(l,S)),ar(ie,()=>a(u),S=>m(u,S)),ar(we,()=>a(f),S=>m(f,S)),ar(be,()=>a(d),S=>m(d,S)),b(e,C),Be()}var Vc=E('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function Hc(e){var t=Vc();b(e,t)}var Bc=E('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function qc(e){var t=Bc();b(e,t)}var Wc=E('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function Kc(e){var t=Wc();b(e,t)}function es(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Yc=E('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),Qc=E('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Zc=E('<button type="button"><div><!></div> <!> </button>'),Xc=E('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">⋯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function eu(e,t){He(t,!1);const[n,r]=Dr(),s=()=>on(rt,"$currentRoute",n),o=()=>on(Ps,"$filteredCount",n);let i=N(null),c=N(!1),l=N("");function u(){rt.set("settings")}function f(z){rt.set(z)}Ot.subscribe(z=>{m(i,z.user)});const d=[{id:"chats",icon:Sc,label:"Chats"},{id:"repos",icon:kc,label:"Repos"},{id:"calls",icon:Cc,label:"Calls"},{id:"contacts",icon:Pc,label:"Contacts"},{id:"notifications",icon:xc,label:"Notifs"}];function v(){m(c,!a(c))}function _(){m(c,!1)}Ye();var g=Xc(),y=h(g),x=h(y),O=h(x),C=p(O,2),w=h(C),P=h(w),D=p(w,2),J=h(D),V=p(x,2),M=p(V,2);{var Q=z=>{var ee=Yc(),Z=h(ee),S=p(Z,6);Cl(ee,(T,I)=>es==null?void 0:es(T,I),()=>_),F("click",Z,u),F("click",S,function(...T){Qr==null||Qr.apply(this,T)}),b(z,ee)};j(M,z=>{a(c)&&z(Q)})}var ie=p(y,2),_e=h(ie),we=p(ie,2);Dt(we,5,()=>d,Wn,(z,ee)=>{let Z=()=>a(ee).id,S=()=>a(ee).icon,T=()=>a(ee).label;var I=Zc();let H;var W=h(I),ne=h(W);S()(ne,{class:"w-5 h-5"});var le=p(W,2);{var oe=L=>{var K=Qc(),ke=h(K);Y(()=>q(ke,o())),b(L,K)};j(le,L=>{Z()==="repos"&&a(l).trim()!==""&&L(oe)})}var Pe=p(le);Y(L=>{H=xn(I,1,"relative flex flex-col items-center text-xs focus:outline-none",null,H,L),xn(W,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===Z()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),q(Pe,` ${T()??""}`)},[()=>({"text-blue-600":s()===Z()})],vt),F("click",I,()=>f(Z())),b(z,I)});var ve=p(we,2),be=h(ve);{var xe=z=>{Dc(z,{})},me=(z,ee)=>{{var Z=T=>{Jc(T,{get search(){return a(l)}})},S=(T,I)=>{{var H=ne=>{Hc(ne)},W=(ne,le)=>{{var oe=L=>{qc(L)},Pe=(L,K)=>{{var ke=Se=>{Kc(Se)};j(L,Se=>{s()==="notifications"&&Se(ke)},K)}};j(ne,L=>{s()==="contacts"?L(oe):L(Pe,!1)},le)}};j(T,ne=>{s()==="calls"?ne(H):ne(W,!1)},I)}};j(z,T=>{s()==="repos"?T(Z):T(S,!1)},ee)}};j(be,z=>{s()==="chats"?z(xe):z(me,!1)})}Y(()=>{var z,ee,Z,S;qt(O,"src",(z=a(i))==null?void 0:z.avatar_url),q(P,((ee=a(i))==null?void 0:ee.name)||((Z=a(i))==null?void 0:Z.login)),q(J,`@${((S=a(i))==null?void 0:S.login)??""}`)}),F("click",V,v),Ze(_e,()=>a(l),z=>m(l,z)),b(e,g),Be(),r()}var tu=E('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">←</button>'),nu=E('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Lr(e,t){He(t,!1);let n=N(!1);function r(g){m(n,g.detail.open)}Ot.subscribe(g=>{g.user}),jr(()=>{const g=()=>{window.innerWidth>=768&&m(n,!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)}),Nr.subscribe(g=>{g&&window.innerWidth<768&&m(n,!1)}),Ye();var s=nu(),o=h(s),i=h(o);{var c=g=>{var y=tu();F("click",y,()=>m(n,!0)),b(g,y)};j(i,g=>{a(n)||g(c)})}var l=p(o,2);let u;var f=h(l);eu(f,{$$events:{toggle:r}});var d=p(l,2);let v;var _=h(d);Mt(_,t,"default",{}),Y((g,y)=>{u=xn(l,1,"sidebar md:block svelte-scw01y",null,u,g),v=xn(d,1,"main w-full svelte-scw01y",null,v,y)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],vt),b(e,s),Be()}var ru=E('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function su(e){Lr(e,{children:(t,n)=>{var r=ru();b(t,r)},$$slots:{default:!0}})}var ou=E('<button title="Save">💾</button>'),au=E('<button title="Edit">✏️</button>'),iu=E('<button title="Hide">🙈</button> <!>',1),lu=E('<button title="Reveal">👁️</button>'),cu=E('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),uu=E('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),fu=E('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),du=E('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),vu=E('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">🗑️</button></td></tr> <!>',1),pu=E('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),hu=E('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),gu=E('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">🔐 Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">➕ Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">💾 Add Credential</button></div></div>');function _u(e,t){He(t,!1);let n=N({}),r=N({}),s=N(new Set),o=N(null),i=N(""),c=N("s3"),l=N({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),u=N({}),f=null;const d=localStorage.getItem("skygit_token");jr(async()=>{if(!d)return;const C=await Mr(d);m(n,C.secrets),f=C.sha});async function v(C){try{a(r)[C]||he(r,a(r)[C]=await Cs(d,a(n)[C])),m(s,new Set(a(s)).add(C))}catch{alert("❌ Failed to decrypt.")}}function _(C){m(s,new Set([...a(s)].filter(w=>w!==C))),a(o)===C&&m(o,null)}function g(C){a(s).has(C)||m(s,new Set(a(s)).add(C)),m(o,C),m(u,{...a(r)[C]})}async function y(C){const w=await cs(d,a(u));he(n,a(n)[C]=w),he(r,a(r)[C]=a(u)),m(s,new Set(a(s)).add(C)),m(o,null),await Un(d,a(n),f)}async function x(C){confirm(`Are you sure you want to delete the credential for:
${C}?`)&&(delete a(n)[C],delete a(r)[C],m(s,new Set([...a(s)].filter(w=>w!==C))),a(o)===C&&m(o,null),await Un(d,a(n),f))}async function O(){if(!a(i)||!a(c))return;const C=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},w=await cs(d,C);he(n,a(n)[a(i)]=w),he(r,a(r)[a(i)]=C),m(s,new Set(a(s)).add(a(i))),m(i,""),m(c,"s3"),m(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await Un(d,a(n),f)}Ye(),Lr(e,{children:(C,w)=>{var P=gu(),D=p(h(P),2),J=p(h(D));Dt(J,5,()=>Object.entries(a(n)),Wn,(Z,S)=>{let T=()=>a(S)[0],I=()=>a(S)[1];var H=vu(),W=fe(H),ne=h(W),le=h(ne),oe=p(ne),Pe=h(oe),L=p(oe),K=h(L);{var ke=ce=>{var Ce=Ie();Y(()=>q(Ce,a(r)[T()].type==="s3"?"S3":"Google Drive")),b(ce,Ce)},Se=ce=>{var Ce=Ie("?");b(ce,Ce)};j(K,ce=>{a(r)[T()]?ce(ke):ce(Se,!1)})}var tt=p(L),pe=h(tt);{var Ee=ce=>{var Ce=iu(),$t=fe(Ce),Yt=p($t,2);{var Gt=Ae=>{var Le=ou();F("click",Le,()=>y(T())),b(Ae,Le)},Pt=Ae=>{var Le=au();F("click",Le,()=>g(T())),b(Ae,Le)};j(Yt,Ae=>{a(o)===T()?Ae(Gt):Ae(Pt,!1)})}F("click",$t,()=>_(T())),b(ce,Ce)},gt=ce=>{var Ce=lu();F("click",Ce,()=>v(T())),b(ce,Ce)};j(pe,ce=>{a(s).has(T())?ce(Ee):ce(gt,!1)})}var Lt=p(pe,2),Ft=p(W,2);{var Ct=ce=>{var Ce=du(),$t=h(Ce),Yt=h($t);{var Gt=Ae=>{var Le=uu(),Et=fe(Le),k=p(h(Et),2),$=h(k),R={},U=h($),B=p(Et,2);Dt(B,1,()=>Object.entries(a(u)),Wn,(te,re)=>{let X=()=>a(re)[0];var Fe=$e(),_t=fe(Fe);{var Ge=bt=>{var Ut=cu(),Qt=h(Ut),Zt=h(Qt),fn=p(Qt,2);Y(()=>q(Zt,X())),Ze(fn,()=>a(u)[X()],dn=>he(u,a(u)[X()]=dn)),b(bt,Ut)};j(_t,bt=>{X()!=="type"&&bt(Ge)})}b(te,Fe)}),Y(()=>{R!==(R=a(u).type)&&($.value=($.__value=a(u).type)==null?"":a(u).type),q(U,a(u).type)}),b(Ae,Le)},Pt=Ae=>{var Le=fu(),Et=h(Le);Y(k=>q(Et,`${k??""}
                                    `),[()=>JSON.stringify(a(r)[T()],null,2)],vt),b(Ae,Le)};j(Yt,Ae=>{a(o)===T()?Ae(Gt):Ae(Pt,!1)})}b(ce,Ce)};j(Ft,ce=>{a(s).has(T())&&ce(Ct)})}Y(ce=>{q(le,T()),q(Pe,`${ce??""}...`)},[()=>I().slice(0,20)],vt),F("click",Lt,()=>x(T())),b(Z,H)});var V=p(D,2),M=p(h(V),2),Q=h(M),ie=p(h(Q)),_e=p(Q,2),we=p(h(_e));Y(()=>{a(c),ss(()=>{})});var ve=h(we);ve.value=(ve.__value="s3")==null?"":"s3";var be=p(ve);be.value=(be.__value="google_drive")==null?"":"google_drive";var xe=p(M,2);{var me=Z=>{var S=pu(),T=h(S),I=p(h(T)),H=p(T,2),W=p(h(H)),ne=p(H,2),le=p(h(ne));Ze(I,()=>a(l).accessKeyId,oe=>he(l,a(l).accessKeyId=oe)),Ze(W,()=>a(l).secretAccessKey,oe=>he(l,a(l).secretAccessKey=oe)),Ze(le,()=>a(l).region,oe=>he(l,a(l).region=oe)),b(Z,S)},z=(Z,S)=>{{var T=I=>{var H=hu(),W=h(H),ne=p(h(W)),le=p(W,2),oe=p(h(le)),Pe=p(le,2),L=p(h(Pe));Ze(ne,()=>a(l).client_id,K=>he(l,a(l).client_id=K)),Ze(oe,()=>a(l).client_secret,K=>he(l,a(l).client_secret=K)),Ze(L,()=>a(l).refresh_token,K=>he(l,a(l).refresh_token=K)),b(I,H)};j(Z,I=>{a(c)==="google_drive"&&I(T)},S)}};j(xe,Z=>{a(c)==="s3"?Z(me):Z(z,!1)})}var ee=p(xe,2);Ze(ie,()=>a(i),Z=>m(i,Z)),is(we,()=>a(c),Z=>m(c,Z)),F("click",ee,O),b(C,P)},$$slots:{default:!0}}),Be()}var bu=E('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),mu=E('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),yu=E('<div class="p-4 space-y-3"><!></div>');function wu(e,t){He(t,!1);const[n,r]=Dr(),s=()=>on(Es,"$selectedConversation",n),o=N(),i=N();ct(()=>s(),()=>{m(o,s())}),ct(()=>a(o),()=>{var d;m(i,((d=a(o))==null?void 0:d.messages)??[])}),ct(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),Xn(),Ye();var c=yu(),l=h(c);{var u=d=>{var v=$e(),_=fe(v);Dt(_,1,()=>a(i),g=>g.id||g.timestamp,(g,y)=>{var x=bu(),O=h(x),C=h(O),w=p(O,2),P=h(w),D=p(w,2),J=h(D);Y(V=>{q(C,a(y).sender),q(P,a(y).content),q(J,V)},[()=>new Date(a(y).timestamp).toLocaleString()],vt),b(g,x)}),b(d,v)},f=d=>{var v=mu();b(d,v)};j(l,d=>{a(i).length>0?d(u):d(f,!1)})}b(e,c),Be(),r()}const nr="https://api.github.com";async function Fr(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`${nr}/repos/${t}/discussions`,s=await fetch(r,{headers:n});if(!s.ok)throw new Error("Failed to list discussions");let i=(await s.json()).find(u=>u.title==="SkyGit Presence Channel");if(i)return i.number;const c=await fetch(r,{method:"POST",headers:n,body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."})});if(!c.ok)throw new Error("Failed to create presence discussion");return(await c.json()).number}function xu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function ku(e,t,n,r,s=null){const o=await Fr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${nr}/repos/${t}/discussions/${o}/comments`,l=new Date().toISOString();let u=l;const f=await fetch(c,{headers:i});let d=[];f.ok&&(d=await f.json());const v=d.find(y=>{try{const x=JSON.parse(y.body);return x.username===n&&x.session_id===r}catch{return!1}});if(v)try{const y=JSON.parse(v.body);y.join_timestamp&&(u=y.join_timestamp)}catch{}const _={username:n,session_id:r,join_timestamp:u,last_seen:l,signaling_info:s};let g=!1;if(v){let y;try{y=JSON.parse(v.body)}catch{y={}}const x=Math.abs(new Date(l)-new Date(y.last_seen));(!xu(y,_)||x>3e4)&&(g=!0)}if(v&&g){const y=`${c}/${v.id}`,x=await fetch(y,{method:"PATCH",headers:i,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] updated presence comment",x.status,x.statusText)}else if(!v){const y=await fetch(c,{method:"POST",headers:i,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] posted new presence comment",y.status,y.statusText)}for(const y of d)try{const x=JSON.parse(y.body);if(x.username===n&&x.session_id!==r){const O=`${c}/${y.id}`;await fetch(O,{method:"DELETE",headers:i}),console.log("[SkyGit][Presence] deleted old presence comment",y.id)}}catch{}}async function Su(e,t,n,r,s){const o=await Fr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${nr}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:i});if(!l.ok)return;const f=(await l.json()).find(d=>{try{const v=JSON.parse(d.body);return v.username===n&&v.session_id===r}catch{return!1}});if(f){let d;try{d=JSON.parse(f.body)}catch{d={}}d.pendingRemovalBy=s,d.pendingRemovalAt=new Date().toISOString();const v=`${c}/${f.id}`;await fetch(v,{method:"PATCH",headers:i,body:JSON.stringify({body:JSON.stringify(d)})}),console.log("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function Cu(e,t,n,r){const s=await Fr(e,t),o={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},i=`${nr}/repos/${t}/discussions/${s}/comments`,c=await fetch(i,{headers:o});if(!c.ok)return;const u=(await c.json()).find(f=>{try{const d=JSON.parse(f.body);return d.username===n&&d.session_id===r}catch{return!1}});if(u){let f;try{f=JSON.parse(u.body)}catch{f={}}if(f.pendingRemovalBy&&f.pendingRemovalAt&&Date.now()-new Date(f.pendingRemovalAt).getTime()>6e4){const v=`${i}/${u.id}`;await fetch(v,{method:"DELETE",headers:o}),console.log("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function $u(e,t){const n=await Fr(e,t),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=`${nr}/repos/${t}/discussions/${n}/comments`,o=await fetch(s,{headers:r});if(!o.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",o.status,o.statusText),[];const i=await o.json(),c=Date.now(),l=i.map(u=>{try{return JSON.parse(u.body)}catch{return null}}).filter(Boolean).filter(u=>u.last_seen&&c-new Date(u.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",l),l}async function xr(e,t,n,r,s=null){await ku(e,t,n,r,s)}async function Os(e,t){return await $u(e,t)}class Pu{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:u,onFileSendProgress:f}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=u,this.onFileSendProgress=f,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=f=>{if(f.target.readyState!==FileReader.DONE)return;const d=new Uint8Array(f.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(d)}),c++,i+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),i<t.size?u():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const u=()=>{const f=t.slice(i,i+r);l.readAsArrayBuffer(f)};u()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Te=at({}),ot=at([]);let ge=null,Je=null,ft=null,rn=null,Ca=null,bn=null,In=null,lr={token:null,repoFullName:null,username:null};function Eu({_token:e,_repoFullName:t,_username:n,_sessionId:r}){lr.token===e&&lr.repoFullName===t&&lr.username===n||(lr={token:e,repoFullName:t,username:n},Ou(),Te.set({}),ot.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),ft=e,Je=t,ge=n,rn=r,Os(ft,Je).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(i=>i.username!==ge);ot.set(o),Ts(s),$a(),Pa(),kn(s,ge)?Au():Ru()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function Au(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Je,"as",ge,"session",rn),xr(ft,Je,ge,rn),Ca=setInterval(()=>{xr(ft,Je,ge,rn)},3e4),bn=setInterval(async()=>{const e=await Os(ft,Je);console.log("[SkyGit][Presence] [Leader] polled peers:",e),ot.set(e.filter(t=>t.username!==ge)),Ts(e),$a(),Pa()},5e3)}function Ru(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Je,"as",ge,"session",rn);const e=async()=>{const n=await Os(ft,Je);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),ot.set(n.filter(r=>r.username!==ge)),Ts(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),bn=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Te.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&bn&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(bn),bn=null,t())})}function Ou(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(Ca),clearInterval(bn)}async function Ts(e){Te.update(t=>{const n={...t},r=Ds(e,ge);if(ge===r){for(const s of e)s.username!==ge&&(n[s.username]||(n[s.username]={status:"connecting",conn:null},ho(s,n)));Object.keys(n).forEach(s=>{s!==ge&&(e.some(o=>o.username===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.username===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null},ho(s,n))}return n});for(const t of e){if(t.username===ge)continue;const n=Me(Te);n[t.username]&&n[t.username].status==="connected"||(Su(ft,Je,t.username,t.session_id,ge),setTimeout(()=>{Cu(ft,Je,t.username,t.session_id)},6e4))}}function Ds(e,t){return e.map(r=>r.username).concat(t).sort()[0]}function kn(e,t){return Ds(e,t)===t}function Tu(e,t){if(!e||!e.conversationId||!e.content)return;xa(e.conversationId,Je,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=Me(ot);kn(n,ge)&&(As(Je,e.conversationId),Te.update(r=>(Object.entries(r).forEach(([s,{conn:o}])=>{s!==t&&o&&o.dataChannel&&o.send({type:"chat",...e})}),r)))}function Du(e,t){e&&Array.isArray(e.onlinePeers)&&ot.set(e.onlinePeers)}function ju(e,t){!e||!e.subtype||Te.update(n=>{var s;const r=(s=n[t])==null?void 0:s.conn;return r&&typeof r.handleSignal=="function"&&r.handleSignal(e),n})}function po(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function ho(e,t){const n=new Pu({token:ft,repoFullName:Je,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{xr(ft,Je,ge,rn,r)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":Tu(r,e.username);break;case"presence":Du(r,e.username);break;case"signal":ju(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{po(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{po(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{xr(ft,Je,ge,rn,r)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.username]={conn:n,status:"connected"},Te.set(t)}function $a(){const e=Me(ot);kn(e,ge)?In||(In=setInterval(()=>{const n=Me(ot);kn(n,ge)&&tr(()=>Promise.resolve().then(()=>Rs),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",go)):In&&(clearInterval(In),In=null,window.removeEventListener("beforeunload",go))}function go(e){const t=Me(ot);kn(t,ge)&&tr(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let _o=!1;function Pa(){const e=Me(ot),t=kn(e,ge);t&&!_o&&tr(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),_o=t}function vs(e,t){Te.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function Nu(e){Te.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var Iu=E('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function Mu(e,t){He(t,!1);let n=Xe(t,"conversation",8),r=N("");function s(){var g;if(!a(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(r).trim(),timestamp:Date.now()};xa(n().id,n().repo,l);const f=(g=Me(Ot).user)==null?void 0:g.login,d=Me(ot),v=Ds(d,f),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};f===v?(Nu({type:"chat",..._}),As(n().repo,n().id)):vs(v,{type:"chat",..._}),m(r,"")}Ye();var o=Iu(),i=h(o),c=p(i,2);Ze(i,()=>a(r),l=>m(r,l)),F("keydown",i,l=>l.key==="Enter"&&s()),F("click",c,s),b(e,o),Be()}var Lu=E(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),Fu=E('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),Gu=E('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),Uu=E('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),zu=E('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),Ju=E('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),Vu=E('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),Hu=E('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),Bu=E('<button class="bg-yellow-100 border px-3 py-1 rounded">🔄 Change Screen Source</button>'),qu=E("<span>🎤</span>"),Wu=E("<span>🔇</span>"),Ku=E("<span>📷</span>"),Yu=E("<span>🚫📷</span>"),Qu=E("<span>⏹️ Stop Recording</span>"),Zu=E("<span>⏺️ Start Recording</span>"),Xu=E('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>⏺️ Recording...</span></div>'),ef=E('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>⚠️ Peer is recording</span></div>'),tf=E('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">📎 Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),nf=E('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">×</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),rf=E('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),sf=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),of=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),af=E('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),lf=E('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function cf(e,t){He(t,!1);const[n,r]=Dr(),s=()=>on(Te,"$peerConnections",n),o=()=>on(ot,"$onlinePeers",n);let i=N(null),c=N(!1),l=N(null),u=N(null),f=null,d=N(!1),v=N(null),_=null,g=N(!1),y=N(null),x=N(!1),O=N(!0),C=N(!0),w=N(!0),P=N(!0),D=N(!0),J=N(!1),V=N(!1),M=null,Q=[],ie=N({x:0,y:0}),_e=!1,we={x:0,y:0},ve=N(),be=N(null),xe=N(!1),me=N(),z=N(),ee=N();function Z(){m(x,!0)}function S(){m(x,!1)}function T(k){m(x,!1),pe(!0,k)}function I(k){_e=!0,we={x:k.clientX-a(ie).x,y:k.clientY-a(ie).y},document.addEventListener("mousemove",H),document.addEventListener("mouseup",W)}function H(k){_e&&(he(ie,a(ie).x=k.clientX-we.x),he(ie,a(ie).y=k.clientY-we.y))}function W(){_e=!1,document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",W)}function ne(){m(O,!1)}function le(){m(O,!0)}function oe(){m(be,null),m(xe,!1)}async function Pe(){let k=a(i)&&a(i).repo,$=Me(ds).decrypted,R=null,U=null,B=null,te=null;if(k&&window.selectedRepo&&window.selectedRepo.config){const X=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;X&&$[X]&&($[X].type==="s3"&&(R=$[X]),$[X].type==="google_drive"&&(U=$[X]))}for(const X in $)$[X].type==="s3"&&!R&&(B=$[X]),$[X].type==="google_drive"&&!U&&(te=$[X]);const re=[];return(R||B)&&re.push("s3"),(U||te)&&re.push("google_drive"),re.length===2?(m(xe,!0),new Promise(X=>{const Fe=setInterval(()=>{a(be)&&(m(xe,!1),clearInterval(Fe),X(a(be)))},100)})):re.length===1?re[0]:null}Te.subscribe(k=>{Object.keys(k).filter($=>k[$].status==="connected").map($=>({username:$}))});let L=N(!1),K=N("");async function ke(k){const $=localStorage.getItem("skygit_token");if(!$||!k)return null;try{const R=await fetch(`https://api.github.com/repos/${k}`,{headers:{Authorization:`token ${$}`}});if(R.ok){const U=await R.json();return ut.update(B=>B.map(te=>te.full_name===k?{...te,has_discussions:U.has_discussions}:te)),U.has_discussions}}catch(R){console.warn("Failed to refresh Discussions status",R)}return null}Nr.subscribe(k=>{var te;console.log("[SkyGit][Presence] currentContent changed:",k),m(i,k),m(L,!1),m(K,"");const $=localStorage.getItem("skygit_token"),R=Me(Ot),U=((te=R==null?void 0:R.user)==null?void 0:te.login)||null,B=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",R),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",U,"repo",B,"selectedConversation",a(i)),$&&U&&B&&Eu({_token:$,_repoFullName:B,_username:U,_sessionId:crypto.randomUUID()}),a(i)&&a(i).repo){const re=ya(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&ke(a(i).repo).then(X=>{X?m(L,!1):m(L,!0)})}});function Se(){m(c,!1),f=null,a(l)&&(a(l).getTracks().forEach(k=>k.stop()),m(l,null)),m(u,null),f&&vs(f,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function tt(k){const $=k.target.files[0];!$||!a(c)||!f||Te.update(R=>{var B;const U=(B=R[f])==null?void 0:B.conn;return U&&typeof U.sendFile=="function"&&U.sendFile($),R})}async function pe(k=!0,$="screen"){try{let R={video:!0,audio:k};$==="tab"?R={video:{displaySurface:"browser",cursor:"always"},audio:k}:$==="window"?R={video:{displaySurface:"window",cursor:"always"},audio:k}:$==="screen"&&(R={video:{displaySurface:"monitor",cursor:"always"},audio:k}),m(v,await navigator.mediaDevices.getDisplayMedia(R)),m(d,!0),Te.update(U=>{var te;const B=(te=U[f])==null?void 0:te.conn;return B&&B.replaceVideoTrack&&(B.replaceVideoTrack(a(v).getVideoTracks()[0]),B.sendScreenShareSignal&&B.sendScreenShareSignal(!0,{audio:k})),U}),m(l,a(v)),a(v).getVideoTracks()[0].onended=Ee}catch(R){console.error("Screen share error:",R)}}function Ee(){a(v)&&(a(v).getTracks().forEach(k=>k.stop()),m(v,null)),m(d,!1),Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.replaceVideoTrack,k}),m(l,_)}async function gt(){if(a(d))try{const k=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Te.update($=>{var U;const R=(U=$[f])==null?void 0:U.conn;return R&&R.replaceVideoTrack&&R.replaceVideoTrack(k.getVideoTracks()[0]),$}),a(v)&&a(v).getTracks().forEach($=>$.stop()),m(v,k),m(l,k),k.getVideoTracks()[0].onended=Ee}catch(k){console.error("Change screen source error:",k)}}function Lt(){m(C,!a(C)),a(l)&&a(l).getAudioTracks().forEach(k=>k.enabled=a(C)),Ct()}function Ft(){m(w,!a(w)),a(l)&&a(l).getVideoTracks().forEach(k=>k.enabled=a(w)),Ct()}function Ct(){Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.send&&$.send({type:"media-status",micOn:a(C),cameraOn:a(w)}),k})}function ce(k){Te.update($=>{var U;const R=(U=$[f])==null?void 0:U.conn;return R&&R.send&&R.send({type:"recording-status",recording:k}),$})}function Ce(){a(l)&&(Q=[],M=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),M.ondataavailable=k=>{k.data.size>0&&Q.push(k.data)},M.onstop=Yt,M.start(),m(J,!0),ce(!0))}function $t(){M&&a(J)&&(M.stop(),m(J,!1),ce(!1))}async function Yt(){const k=new Blob(Q,{type:"video/webm"});await Pt(k)}typeof window<"u"&&(window.skygitOnRecordingStatus=k=>{m(V,!!k.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(k,$)=>{m(g,k),m(y,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=k=>{typeof k.micOn=="boolean"&&m(P,k.micOn),typeof k.cameraOn=="boolean"&&m(D,k.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(k,$,R)=>{k.name,$===R&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(k,$,R)=>{$===R&&setTimeout(()=>{},2e3)});async function Gt(k,$){const R=`skygit-recording-${Date.now()}.webm`,U=$.bucket,B=$.region;if(!U||!B)return alert("S3 credential missing bucket or region."),null;const te=$.endpoint||`https://${U}.s3.${B}.amazonaws.com/${R}`;return(await fetch(te,{method:"PUT",headers:{"Content-Type":"video/webm"},body:k})).ok?te.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function Pt(k){let $=Me(ds).decrypted,R=a(i)&&a(i).repo,U=null,B=null,te=null,re=null;if(R&&window.selectedRepo&&window.selectedRepo.config){const Ge=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Ge&&$[Ge]&&($[Ge].type==="s3"&&(U=$[Ge]),$[Ge].type==="google_drive"&&(B=$[Ge]))}for(const Ge in $)$[Ge].type==="s3"&&!U&&(te=$[Ge]),$[Ge].type==="google_drive"&&!B&&(re=$[Ge]);let X=null,Fe=await Pe();if(!Fe){alert("No upload destination (S3 or Google Drive) configured.");return}Fe==="s3"&&(X=U||te),Fe==="google_drive"&&(X=B||re);let _t=null;Fe==="s3"?_t=await Gt(k,X):Fe==="google_drive"&&(_t=await Ae(k,X)),_t&&(vs(f,{type:"chat",content:`📹 Recording: ${_t}`}),alert("Recording uploaded and link shared!"))}async function Ae(k,$){let R;try{R=await Le($)}catch(_t){return alert("Google Drive authentication failed: "+_t.message),null}const U={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},B=new FormData;B.append("metadata",new Blob([JSON.stringify(U)],{type:"application/json"})),B.append("file",k);const te=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+R},body:B});if(!te.ok)return alert("Failed to upload to Google Drive"),null;const re=await te.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+R,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Fe=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+R}})).json();return Fe.webViewLink||Fe.webContentLink}async function Le(k){const $=new URLSearchParams;$.append("client_id",k.client_id),$.append("client_secret",k.client_secret),$.append("refresh_token",k.refresh_token),$.append("grant_type","refresh_token");const R=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!R.ok)throw new Error("Failed to get Google access token");return(await R.json()).access_token}function Et(){var te;const k=localStorage.getItem("skygit_token"),$=Me(Ot),R=((te=$==null?void 0:$.user)==null?void 0:te.login)||null,U=a(i)?a(i).repo:null,B=window.skygitSessionId;k&&R&&U&&B&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:k,repoFullName:U,username:R,sessionId:B})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",Et),ct(()=>(a(me),a(l)),()=>{a(me)&&a(l)&&he(me,a(me).srcObject=a(l))}),ct(()=>(a(z),a(u)),()=>{a(z)&&a(u)&&he(z,a(z).srcObject=a(u))}),ct(()=>(a(ee),a(v)),()=>{a(ee)&&a(v)&&he(ee,a(ee).srcObject=a(v))}),Xn(),Ye(),Lr(e,{children:(k,$)=>{var R=$e(),U=fe(R);{var B=re=>{var X=$e(),Fe=fe(X);{var _t=bt=>{var Ut=Lu(),Qt=h(Ut),Zt=p(h(Qt),4),fn=p(Zt,2),dn=h(fn),Gr=p(dn,2);Y(()=>qt(Zt,"href",a(K))),F("click",dn,()=>m(L,!1)),F("click",Gr,async()=>{await ke(a(i).repo)}),b(bt,Ut)},Ge=bt=>{var Ut=af(),Qt=h(Ut),Zt=h(Qt),fn=h(Zt),dn=h(fn),Gr=p(fn,2),Ea=h(Gr),js=p(Zt,2),Aa=h(js),Ra=p(js,2),Ns=h(Ra);{var Oa=ue=>{var Re=$e(),mt=fe(Re);Dt(mt,1,()=>a(i).participants,qe=>qe,(qe,ye)=>{var je=$e(),Ue=fe(je);{var Rn=it=>{var yt=Fu();b(it,yt)},vn=it=>{var yt=$e(),Ur=fe(yt);{var zr=zt=>{var Xt=$e(),On=fe(Xt);{var pn=Ne=>{var lt=Gu(),Tn=p(h(lt));Y(()=>q(Tn,` ${a(ye)??""}`)),b(Ne,lt)},wt=Ne=>{var lt=Uu(),Tn=p(h(lt));Y(()=>q(Tn,` ${a(ye)??""}`)),b(Ne,lt)};j(On,Ne=>{s()[a(ye)].status==="connected"?Ne(pn):Ne(wt,!1)})}b(zt,Xt)},Jr=(zt,Xt)=>{{var On=wt=>{var Ne=zu(),lt=p(h(Ne));Y(()=>q(lt,` ${a(ye)??""}`)),b(wt,Ne)},pn=wt=>{var Ne=Ju(),lt=p(h(Ne));Y(()=>q(lt,` ${a(ye)??""}`)),b(wt,Ne)};j(zt,wt=>{o().find(Ne=>Ne.username===a(ye))?wt(On):wt(pn,!1)},Xt)}};j(Ur,zt=>{s()[a(ye)]?zt(zr):zt(Jr,!1)})}b(it,yt)};j(Ue,it=>{a(ye)===Me(Ot).user.login?it(Rn):it(vn,!1)})}b(qe,je)}),b(ue,Re)};j(Ns,ue=>{a(i).participants&&ue(Oa)})}var Ta=p(Ns,2);{var Da=ue=>{var Re=Vu();F("click",Re,Se),b(ue,Re)};j(Ta,ue=>{a(c)&&ue(Da)})}var Is=p(Qt,2);{var ja=ue=>{var Re=tf(),mt=fe(Re),qe=h(mt),ye=p(h(qe),2);ye.muted=!0,Ln(ye,A=>m(me,A),()=>a(me));var je=p(ye,2),Ue=h(je),Rn=h(Ue);{var vn=A=>{var G=Ie("🎤 Mic On");b(A,G)},it=A=>{var G=Ie("🔇 Mic Off");b(A,G)};j(Rn,A=>{a(C)?A(vn):A(it,!1)})}var yt=p(Ue,2),Ur=h(yt);{var zr=A=>{var G=Ie("📷 Cam On");b(A,G)},Jr=A=>{var G=Ie("🚫📷 Cam Off");b(A,G)};j(Ur,A=>{a(w)?A(zr):A(Jr,!1)})}var zt=p(qe,2),Xt=p(h(zt),2);Ln(Xt,A=>m(z,A),()=>a(z));var On=p(Xt,2),pn=h(On),wt=h(pn);{var Ne=A=>{var G=Ie("🎤 Mic On");b(A,G)},lt=A=>{var G=Ie("🔇 Mic Off");b(A,G)};j(wt,A=>{a(P)?A(Ne):A(lt,!1)})}var Tn=p(pn,2),Ua=h(Tn);{var za=A=>{var G=Ie("📷 Cam On");b(A,G)},Ja=A=>{var G=Ie("🚫📷 Cam Off");b(A,G)};j(Ua,A=>{a(D)?A(za):A(Ja,!1)})}var Us=p(mt,2);{var Va=A=>{var G=Hu(),li=h(G),ci=p(h(li));{var ui=Br=>{var or=Ie("(with audio)");b(Br,or)};j(ci,Br=>{var or;(or=a(y))!=null&&or.audio&&Br(ui)})}b(A,G)};j(Us,A=>{a(g)&&A(Va)})}var zs=p(Us,2),Js=h(zs),Ha=p(h(Js)),Vr=p(Js,2),Ba=h(Vr);{var qa=A=>{var G=Ie("🛑 Stop Sharing");b(A,G)},Wa=A=>{var G=Ie("🖥️ Share Screen");b(A,G)};j(Ba,A=>{a(d)?A(qa):A(Wa,!1)})}var Vs=p(Vr,2);{var Ka=A=>{var G=Bu();F("click",G,gt),b(A,G)};j(Vs,A=>{a(d)&&A(Ka)})}var rr=p(Vs,2),Ya=h(rr);{var Qa=A=>{var G=qu();b(A,G)},Za=A=>{var G=Wu();b(A,G)};j(Ya,A=>{a(C)?A(Qa):A(Za,!1)})}var sr=p(rr,2),Xa=h(sr);{var ei=A=>{var G=Ku();b(A,G)},ti=A=>{var G=Yu();b(A,G)};j(Xa,A=>{a(w)?A(ei):A(ti,!1)})}var Hr=p(sr,2),ni=h(Hr);{var ri=A=>{var G=Qu();b(A,G)},si=A=>{var G=Zu();b(A,G)};j(ni,A=>{a(J)?A(ri):A(si,!1)})}var Hs=p(zs,2);{var oi=A=>{var G=Xu();b(A,G)};j(Hs,A=>{a(J)&&A(oi)})}var ai=p(Hs,2);{var ii=A=>{var G=ef();b(A,G)};j(ai,A=>{a(V)&&A(ii)})}Y(()=>{qt(rr,"title",a(C)?"Mute Mic":"Unmute Mic"),qt(sr,"title",a(w)?"Turn Off Camera":"Turn On Camera"),qt(Hr,"title",a(J)?"Stop Recording":"Start Recording")}),F("change",Ha,tt),F("click",Vr,function(...A){var G;(G=a(d)?Ee:Z)==null||G.apply(this,A)}),F("click",rr,Lt),F("click",sr,Ft),F("click",Hr,function(...A){var G;(G=a(J)?$t:Ce)==null||G.apply(this,A)}),b(ue,Re)};j(Is,ue=>{a(c)&&ue(ja)})}var Ms=p(Is,2);{var Na=ue=>{var Re=$e(),mt=fe(Re);{var qe=je=>{var Ue=nf(),Rn=h(Ue),vn=h(Rn),it=p(vn,4);it.muted=!0,Ln(it,yt=>m(ee,yt),()=>a(ee)),Ln(Ue,yt=>m(ve,yt),()=>a(ve)),Y(()=>ea(Ue,`left: ${a(ie).x??""}px; top: ${a(ie).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),F("click",vn,Dl(ne)),F("mousedown",Ue,I),b(je,Ue)},ye=je=>{var Ue=rf();F("click",Ue,le),b(je,Ue)};j(mt,je=>{a(O)?je(qe):je(ye,!1)})}b(ue,Re)};j(Ms,ue=>{a(d)&&a(v)&&ue(Na)})}var Ls=p(Ms,2);{var Ia=ue=>{var Re=sf(),mt=h(Re),qe=p(h(mt),2),ye=p(qe,2),je=p(ye,2),Ue=p(je,2);F("click",qe,()=>T("screen")),F("click",ye,()=>T("window")),F("click",je,()=>T("tab")),F("click",Ue,S),b(ue,Re)};j(Ls,ue=>{a(x)&&ue(Ia)})}var Fs=p(Ls,2);{var Ma=ue=>{var Re=of(),mt=h(Re),qe=p(h(mt),2),ye=p(qe,2),je=p(ye,2);F("click",qe,()=>{m(be,"google_drive")}),F("click",ye,()=>{m(be,"s3")}),F("click",je,oe),b(ue,Re)};j(Fs,ue=>{a(xe)&&ue(Ma)})}var Gs=p(Fs,2),La=h(Gs);wu(La,{get conversation(){return a(i)}});var Fa=p(Gs,2),Ga=h(Fa);Mu(Ga,{get conversation(){return a(i)}}),Y(()=>{var ue;q(dn,a(i).title),q(Ea,a(i).repo),q(Aa,`${((ue=a(i).participants)==null?void 0:ue.length)??0} participants`)}),b(bt,Ut)};j(Fe,bt=>{a(L)?bt(_t):bt(Ge,!1)})}b(re,X)},te=re=>{var X=lf();b(re,X)};j(U,re=>{a(i)?re(B):re(te,!1)})}b(k,R)},$$slots:{default:!0}}),Be(),r()}var uf=E('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function ff(e,t){He(t,!1);const n=Ll();let r=N("");function s(){if(!a(r).trim()){alert("Title is required.");return}n("create",{title:a(r).trim()}),m(r,"")}function o(){n("cancel")}Ye();var i=uf(),c=h(i),l=p(h(c),2),u=p(l,2),f=h(u),d=p(f,2);Ze(l,()=>a(r),v=>m(r,v)),F("click",f,o),F("click",d,s),b(e,i),Be()}var df=E('<span class="text-green-700 font-semibold">✅ Enabled</span>'),vf=E("<span> </span>"),pf=E('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),hf=Zo('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),gf=E('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),_f=E('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>💬 New Conversation (Enable Discussions first)</button></div>'),bf=E("<option> </option>"),mf=E('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">🛠️ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>— Select a credential —</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💾 Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💬 New Conversation</button> <!>',1),yf=E('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),wf=E('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function xf(e,t){He(t,!1);let n=N([]),r=N(),s=N(!1),o=N(!1),i=N(""),c;Kn.subscribe(g=>m(r,g)),jr(async()=>{const g=localStorage.getItem("skygit_token");if(g)try{const{secrets:y}=await Mr(g),x=Object.keys(y),O=[];for(const C of x)try{const w=await Cs(g,y[C]);O.push({url:C,...w})}catch(w){console.warn("Failed to decrypt",C,w)}m(n,O)}catch(y){console.warn("Could not load secrets",y)}});async function l(){const g=localStorage.getItem("skygit_token");if(!(!a(r)||!g)){m(s,!0);try{await va(g,a(r)),he(r,a(r).has_messages=!0),tr(async()=>{const{selectedRepo:y}=await Promise.resolve().then(()=>Kl);return{selectedRepo:y}},void 0).then(({selectedRepo:y})=>{y.set({...a(r)})})}catch(y){alert("Failed to activate messaging."),console.warn(y)}finally{m(s,!1)}}}async function u(){const g=localStorage.getItem("skygit_token");if(!(!g||!a(r)))try{await pa(g,a(r)),alert("✅ Messaging config updated.");try{await ha(g,a(r))}catch(y){alert("❌ Failed to store credential."),console.warn(y)}}catch(y){alert("❌ Failed to update config."),console.warn(y)}}async function f(g){const y=g.detail.title,x=localStorage.getItem("skygit_token");console.log("[SkyGit] 🧪 handleCreate() called with title:",y),await ic(x,a(r),y),m(o,!1)}function d(){m(o,!1)}function v(){if(!a(r))return;const g=`https://github.com/${a(r).full_name}/settings/discussions`;window.open(g,"_blank")}async function _(){const g=localStorage.getItem("skygit_token");if(!g||!a(r))return;const y=await fetch(`https://api.github.com/repos/${a(r).full_name}`,{headers:{Authorization:`token ${g}`}});if(y.ok){const x=await y.json(),O=!a(r).has_discussions;he(r,a(r).has_discussions=x.has_discussions),Kn.set({...a(r)}),ut.update(C=>C.map(w=>w.full_name===a(r).full_name?{...a(r)}:w)),await sl(),O&&a(r).has_discussions?m(i,"✅ Discussions enabled! You can now use messaging."):a(r).has_discussions?m(i,""):m(i,"❌ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{m(i,"")},4e3)}}Ye(),Lr(e,{children:(g,y)=>{var x=$e(),O=fe(x);{var C=P=>{var D=yf(),J=h(D),V=h(J),M=p(J,2),Q=h(M),ie=p(h(Q)),_e=p(Q,2),we=p(h(_e)),ve=p(_e,2),be=p(h(ve),2),xe=h(be),me=p(ve,2),z=p(h(me)),ee=p(me,2),Z=p(h(ee)),S=p(ee,2),T=p(h(S),2);{var I=L=>{var K=df();b(L,K)},H=L=>{var K=pf(),ke=p(fe(K),2),Se=p(ke,2),tt=p(Se,2);{var pe=Ee=>{var gt=vf();let Lt;var Ft=h(gt);Y(Ct=>{Lt=xn(gt,1,"ml-2 text-xs font-semibold",null,Lt,Ct),q(Ft,a(i))},[()=>({"text-green-700":a(i).startsWith("✅"),"text-red-600":a(i).startsWith("❌")})],vt),b(Ee,gt)};j(tt,Ee=>{a(i)&&Ee(pe)})}F("click",ke,v),F("click",Se,_),b(L,K)};j(T,L=>{a(r).has_discussions?L(I):L(H,!1)})}var W=p(M,2);{var ne=L=>{var K=gf(),ke=h(K);{var Se=pe=>{var Ee=hf();b(pe,Ee)},tt=pe=>{var Ee=Ie("💬 Activate Messaging");b(pe,Ee)};j(ke,pe=>{a(s)?pe(Se):pe(tt,!1)})}Y(()=>K.disabled=a(s)),F("click",K,l),b(L,K)};j(W,L=>{a(r).has_messages||L(ne)})}var le=p(W,2);{var oe=L=>{var K=_f();b(L,K)},Pe=(L,K)=>{{var ke=Se=>{var tt=mf(),pe=fe(tt),Ee=p(h(pe),2),gt=h(Ee),Lt=p(h(gt)),Ft=p(gt,2),Ct=p(h(Ft));Y(()=>{a(r),ss(()=>{})});var ce=h(Ct);ce.value=(ce.__value="gitfs")==null?"":"gitfs";var Ce=p(ce);Ce.value=(Ce.__value="s3")==null?"":"s3";var $t=p(Ce);$t.value=($t.__value="google_drive")==null?"":"google_drive";var Yt=p(Ft,2),Gt=p(h(Yt));Y(()=>{a(r),ss(()=>{a(n)})});var Pt=h(Gt);Pt.value=((Pt.__value="")==null,"");var Ae=p(Pt);Dt(Ae,1,()=>a(n).filter(R=>R.type===a(r).config.binary_storage_type),Wn,(R,U)=>{var B=bf(),te={},re=h(B);Y(()=>{te!==(te=a(U).url)&&(B.value=(B.__value=a(U).url)==null?"":a(U).url),q(re,a(U).url)}),b(R,B)});var Le=p(Ee,2),Et=p(pe,2),k=p(Et,2);{var $=R=>{ff(R,{$$events:{create:f,cancel:d}})};j(k,R=>{a(o)&&R($)})}Ze(Lt,()=>a(r).config.commit_frequency_min,R=>he(r,a(r).config.commit_frequency_min=R)),is(Ct,()=>a(r).config.binary_storage_type,R=>he(r,a(r).config.binary_storage_type=R)),is(Gt,()=>a(r).config.storage_info.url,R=>he(r,a(r).config.storage_info.url=R)),F("click",Le,u),F("click",Et,()=>m(o,!0)),b(Se,tt)};j(L,Se=>{a(r).has_messages&&a(r).config&&Se(ke)},K)}};j(le,L=>{a(r).has_discussions?L(Pe,!1):L(oe)})}Y(()=>{q(V,a(r).full_name),q(ie,` ${a(r).name??""}`),q(we,` ${a(r).owner??""}`),qt(be,"href",a(r).url),q(xe,a(r).url),q(z,` ${(a(r).private?"🔒 Private":"🌐 Public")??""}`),q(Z,` ${(a(r).has_messages?"💬 Available":"🚫 Not enabled")??""}`)}),b(P,D)},w=P=>{var D=wf();b(P,D)};j(O,P=>{a(r)?P(C):P(w,!1)})}b(g,x)},$$slots:{default:!0}}),Be()}var kf=E('<p class="text-center mt-20">Loading...</p>');function Sf(e,t){He(t,!1);const[n,r]=Dr(),s=()=>on(rt,"$currentRoute",n),o=()=>on(De,"$syncState",n);let i=N(null),c=null,l=N("");Ot.subscribe(O=>{O.isLoggedIn||(rt.set("login"),m(i,null),c=null)}),jr(()=>{const O=Zl();O?u(O):rt.set("login")});async function u(O){m(l,"");const C=await Yl(O);if(!C){localStorage.removeItem("skygit_token"),m(l,"Invalid token. Please check your PAT and try again."),rt.set("login");return}m(i,O),c=C,Ql(O),Ot.set({isLoggedIn:!0,token:a(i),user:c}),await ca(a(i),c.login)?(rt.set("home"),await v()):rt.set("consent")}async function f(){await ua(a(i)),rt.set("home"),await v()}function d(){localStorage.removeItem("skygit_token"),rt.set("login")}async function v(){try{console.log("[SkyGit] Initializing app state..."),await uc(a(i))}catch(O){console.warn("[SkyGit] Failed to initialize startup state:",O)}}window.addEventListener("beforeunload",O=>{(Sa()||ma())&&(wr(),yr(),O.preventDefault(),O.returnValue="")}),ct(()=>(s(),o(),a(i)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{fs(a(i))}catch(O){console.warn("[SkyGit] Repo discovery failed:",O)}}),Xn(),Ye();var _=$e(),g=fe(_);{var y=O=>{var C=kf();b(O,C)},x=(O,C)=>{{var w=D=>{gc(D,{onSubmit:u,get error(){return a(l)}})},P=(D,J)=>{{var V=Q=>{mc(Q,{onApprove:f,onReject:d})},M=(Q,ie)=>{{var _e=ve=>{_u(ve,{})},we=(ve,be)=>{{var xe=z=>{cf(z,{})},me=(z,ee)=>{{var Z=T=>{xf(T,{})},S=T=>{su(T)};j(z,T=>{s()==="repos"?T(Z):T(S,!1)},ee)}};j(ve,z=>{s()==="chats"?z(xe):z(me,!1)},be)}};j(Q,ve=>{s()==="settings"?ve(_e):ve(we,!1)},ie)}};j(D,Q=>{s()==="consent"?Q(V):Q(M,!1)},J)}};j(O,D=>{s()==="login"?D(w):D(P,!1)},C)}};j(g,O=>{s()==="loading"?O(y):O(x,!1)})}b(e,_),Be(),r()}_l(Sf,{target:document.getElementById("app")});
