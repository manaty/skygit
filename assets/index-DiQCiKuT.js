(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const so=!1;var Lr=Array.isArray,Ai=Array.prototype.indexOf,ks=Array.from,No=Object.defineProperty,Yt=Object.getOwnPropertyDescriptor,Lo=Object.getOwnPropertyDescriptors,Ei=Object.prototype,Ri=Array.prototype,Cs=Object.getPrototypeOf,oo=Object.isExtensible;function qn(e){return typeof e=="function"}const An=()=>{};function Oi(e){return e()}function Cr(e){for(var t=0;t<e.length;t++)e[t]()}const pt=2,Go=4,Gr=8,$s=16,Mt=32,Tn=64,$r=128,it=256,Pr=512,Ye=1024,Nt=2048,gn=4096,Ot=8192,Fr=16384,Di=32768,Ur=65536,Fo=1<<17,Ii=1<<19,Uo=1<<20,ds=1<<21,St=Symbol("$state"),zo=Symbol("legacy props"),Ti=Symbol("");function Jo(e){return e===this.v}function zr(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function ji(e,t){return e!==t}function Ps(e){return!zr(e,this.v)}function Mi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ni(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Li(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Gi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Fi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ui(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function zi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ji(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let jn=!1,qi=!1;function Vi(){jn=!0}const As=1,Es=2,qo=4,Hi=8,Bi=16,Wi=1,Ki=2,Vo=4,Qi=8,Yi=16,Ho=1,Zi=2,Je=Symbol(),Xi="http://www.w3.org/1999/xhtml",el="http://www.w3.org/2000/svg";function Rs(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let pe=null;function ao(e){pe=e}function Be(e,t=!1,n){var r=pe={p:pe,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};jn&&!t&&(pe.l={s:null,u:null,r1:[],r2:Rn(!1)}),Os(()=>{r.d=!0})}function We(e){const t=pe;if(t!==null){const i=t.e;if(i!==null){var n=fe,r=oe;t.e=null;try{for(var s=0;s<i.length;s++){var o=i[s];Xt(o.effect),Ct(o.reaction),Ln(o.fn)}}finally{Xt(n),Ct(r)}}pe=t.p,t.m=!0}return{}}function Mn(){return!jn||pe!==null&&pe.l===null}function ln(e,t){if(typeof e!="object"||e===null||St in e)return e;const n=Cs(e);if(n!==Ei&&n!==Ri)return e;var r=new Map,s=Lr(e),o=Bt(0),i=oe,c=l=>{var f=oe;Ct(i);var d;return d=l(),Ct(f),d};return s&&r.set("length",Bt(e.length)),new Proxy(e,{defineProperty(l,f,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Ui();var v=r.get(f);return v===void 0?(v=c(()=>Bt(d.value)),r.set(f,v)):y(v,c(()=>ln(d.value))),!0},deleteProperty(l,f){var d=r.get(f);if(d===void 0)f in l&&r.set(f,c(()=>Bt(Je)));else{if(s&&typeof f=="string"){var v=r.get("length"),u=Number(f);Number.isInteger(u)&&u<v.v&&y(v,u)}y(d,Je),io(o)}return!0},get(l,f,d){var p;if(f===St)return e;var v=r.get(f),u=f in l;if(v===void 0&&(!u||(p=Yt(l,f))!=null&&p.writable)&&(v=c(()=>Bt(ln(u?l[f]:Je))),r.set(f,v)),v!==void 0){var _=a(v);return _===Je?void 0:_}return Reflect.get(l,f,d)},getOwnPropertyDescriptor(l,f){var d=Reflect.getOwnPropertyDescriptor(l,f);if(d&&"value"in d){var v=r.get(f);v&&(d.value=a(v))}else if(d===void 0){var u=r.get(f),_=u==null?void 0:u.v;if(u!==void 0&&_!==Je)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return d},has(l,f){var _;if(f===St)return!0;var d=r.get(f),v=d!==void 0&&d.v!==Je||Reflect.has(l,f);if(d!==void 0||fe!==null&&(!v||(_=Yt(l,f))!=null&&_.writable)){d===void 0&&(d=c(()=>Bt(v?ln(l[f]):Je)),r.set(f,d));var u=a(d);if(u===Je)return!1}return v},set(l,f,d,v){var S;var u=r.get(f),_=f in l;if(s&&f==="length")for(var p=d;p<u.v;p+=1){var b=r.get(p+"");b!==void 0?y(b,Je):p in l&&(b=c(()=>Bt(Je)),r.set(p+"",b))}u===void 0?(!_||(S=Yt(l,f))!=null&&S.writable)&&(u=c(()=>Bt(void 0)),y(u,c(()=>ln(d))),r.set(f,u)):(_=u.v!==Je,y(u,c(()=>ln(d))));var k=Reflect.getOwnPropertyDescriptor(l,f);if(k!=null&&k.set&&k.set.call(v,d),!_){if(s&&typeof f=="string"){var C=r.get("length"),M=Number(f);Number.isInteger(M)&&M>=C.v&&y(C,M+1)}io(o)}return!0},ownKeys(l){a(o);var f=Reflect.ownKeys(l).filter(u=>{var _=r.get(u);return _===void 0||_.v!==Je});for(var[d,v]of r)v.v!==Je&&!(d in l)&&f.push(d);return f},setPrototypeOf(){zi()}})}function io(e,t=1){y(e,e.v+t)}function lo(e){try{if(e!==null&&typeof e=="object"&&St in e)return e[St]}catch{}return e}function tl(e,t){return Object.is(lo(e),lo(t))}const nr=new Map;function Rn(e,t){var n={f:0,v:e,reactions:null,equals:Jo,rv:0,wv:0};return n}function Bt(e,t){const n=Rn(e);return vl(n),n}function j(e,t=!1){var r;const n=Rn(e);return t||(n.equals=Ps),jn&&pe!==null&&pe.l!==null&&((r=pe.l).s??(r.s=[])).push(n),n}function Se(e,t){return y(e,Ze(()=>a(e))),t}function y(e,t,n=!1){oe!==null&&!wt&&Mn()&&(oe.f&(pt|$s))!==0&&!(He!=null&&He.includes(e))&&Ji();let r=n?ln(t):t;return rr(e,r)}function rr(e,t){if(!e.equals(t)){var n=e.v;pr?nr.set(e,t):nr.set(e,n),e.v=t,e.wv=ia(),Bo(e,Nt),Mn()&&fe!==null&&(fe.f&Ye)!==0&&(fe.f&(Mt|Tn))===0&&(ot===null?pl([e]):ot.push(e))}return t}function co(e,t=1){var n=a(e),r=t===1?n++:n--;return y(e,n),r}function Bo(e,t){var n=e.reactions;if(n!==null)for(var r=Mn(),s=n.length,o=0;o<s;o++){var i=n[o],c=i.f;(c&Nt)===0&&(!r&&i===fe||(ht(i,t),(c&(Ye|it))!==0&&((c&pt)!==0?Bo(i,gn):Br(i))))}}let nl=!1;var uo,Wo,Ko,Qo;function rl(){if(uo===void 0){uo=window,Wo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Ko=Yt(t,"firstChild").get,Qo=Yt(t,"nextSibling").get,oo(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),oo(n)&&(n.__t=void 0)}}function fr(e=""){return document.createTextNode(e)}function Et(e){return Ko.call(e)}function Jr(e){return Qo.call(e)}function h(e,t){return Et(e)}function ve(e,t){{var n=Et(e);return n instanceof Comment&&n.data===""?Jr(n):n}}function g(e,t=1,n=!1){let r=e;for(;t--;)r=Jr(r);return r}function sl(e){e.textContent=""}function sr(e){var t=pt|Nt,n=oe!==null&&(oe.f&pt)!==0?oe:null;return fe===null||n!==null&&(n.f&it)!==0?t|=it:fe.f|=Uo,{ctx:pe,deps:null,effects:null,equals:Jo,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??fe}}function gt(e){const t=sr(e);return t.equals=Ps,t}function Yo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)It(t[n])}}function ol(e){for(var t=e.parent;t!==null;){if((t.f&pt)===0)return t;t=t.parent}return null}function al(e){var t,n=fe;Xt(ol(e));try{Yo(e),t=ca(e)}finally{Xt(n)}return t}function Zo(e){var t=al(e),n=(Qt||(e.f&it)!==0)&&e.deps!==null?gn:Ye;ht(e,n),e.equals(t)||(e.v=t,e.wv=ia())}function Xo(e){fe===null&&oe===null&&Li(),oe!==null&&(oe.f&it)!==0&&fe===null&&Ni(),pr&&Mi()}function il(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Nn(e,t,n,r=!0){var s=fe,o={ctx:pe,deps:null,nodes_start:null,nodes_end:null,f:e|Nt,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Hr(o),o.f|=Di}catch(l){throw It(o),l}else t!==null&&Br(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(Uo|$r))===0;if(!i&&r&&(s!==null&&il(o,s),oe!==null&&(oe.f&pt)!==0)){var c=oe;(c.effects??(c.effects=[])).push(o)}return o}function Os(e){const t=Nn(Gr,null,!1);return ht(t,Ye),t.teardown=e,t}function vs(e){Xo();var t=fe!==null&&(fe.f&Mt)!==0&&pe!==null&&!pe.m;if(t){var n=pe;(n.e??(n.e=[])).push({fn:e,effect:fe,reaction:oe})}else{var r=Ln(e);return r}}function ll(e){return Xo(),hn(e)}function cl(e){const t=Nn(Tn,e,!0);return(n={})=>new Promise(r=>{n.outro?On(t,()=>{It(t),r(void 0)}):(It(t),r(void 0))})}function Ln(e){return Nn(Go,e,!1)}function dt(e,t){var n=pe,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=hn(()=>{e(),!r.ran&&(r.ran=!0,y(n.l.r2,!0),Ze(t))})}function dr(){var e=pe;hn(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Ye)!==0&&ht(n,gn),Gn(n)&&Hr(n),t.ran=!1}e.l.r2.v=!1}})}function hn(e){return Nn(Gr,e,!0)}function Y(e,t=[],n=sr){const r=t.map(n);return vr(()=>e(...r.map(a)))}function vr(e,t=0){return Nn(Gr|$s|t,e,!0)}function dn(e,t=!0){return Nn(Gr|Mt,e,!0,t)}function ea(e){var t=e.teardown;if(t!==null){const n=pr,r=oe;vo(!0),Ct(null);try{t.call(null)}finally{vo(n),Ct(r)}}}function ta(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&Tn)!==0?n.parent=null:It(n,t),n=r}}function ul(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Mt)===0&&It(t),t=n}}function It(e,t=!0){var n=!1;if((t||(e.f&Ii)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:Jr(r);r.remove(),r=o}n=!0}ta(e,t&&!n),Or(e,0),ht(e,Fr);var i=e.transitions;if(i!==null)for(const l of i)l.stop();ea(e);var c=e.parent;c!==null&&c.first!==null&&na(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function na(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function On(e,t){var n=[];Ds(e,n,!0),ra(n,()=>{It(e),t&&t()})}function ra(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function Ds(e,t,n){if((e.f&Ot)===0){if(e.f^=Ot,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&Ur)!==0||(r.f&Mt)!==0;Ds(r,t,o?n:!1),r=s}}}function or(e){sa(e,!0)}function sa(e,t){if((e.f&Ot)!==0){e.f^=Ot,(e.f&Ye)===0&&(e.f^=Ye),Gn(e)&&(ht(e,Nt),Br(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&Ur)!==0||(n.f&Mt)!==0;sa(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let ar=[],ps=[];function oa(){var e=ar;ar=[],Cr(e)}function fl(){var e=ps;ps=[],Cr(e)}function qr(e){ar.length===0&&queueMicrotask(oa),ar.push(e)}function fo(){ar.length>0&&oa(),ps.length>0&&fl()}let wr=!1,Ar=!1,Er=null,un=!1,pr=!1;function vo(e){pr=e}let er=[];let oe=null,wt=!1;function Ct(e){oe=e}let fe=null;function Xt(e){fe=e}let He=null;function dl(e){He=e}function vl(e){oe!==null&&oe.f&ds&&(He===null?dl([e]):He.push(e))}let qe=null,et=0,ot=null;function pl(e){ot=e}let aa=1,Rr=0,Qt=!1,Kt=null;function ia(){return++aa}function Gn(e){var v;var t=e.f;if((t&Nt)!==0)return!0;if((t&gn)!==0){var n=e.deps,r=(t&it)!==0;if(n!==null){var s,o,i=(t&Pr)!==0,c=r&&fe!==null&&!Qt,l=n.length;if(i||c){var f=e,d=f.parent;for(s=0;s<l;s++)o=n[s],(i||!((v=o==null?void 0:o.reactions)!=null&&v.includes(f)))&&(o.reactions??(o.reactions=[])).push(f);i&&(f.f^=Pr),c&&d!==null&&(d.f&it)===0&&(f.f^=it)}for(s=0;s<l;s++)if(o=n[s],Gn(o)&&Zo(o),o.wv>e.wv)return!0}(!r||fe!==null&&!Qt)&&ht(e,Ye)}return!1}function gl(e,t){for(var n=t;n!==null;){if((n.f&$r)!==0)try{n.fn(e);return}catch{n.f^=$r}n=n.parent}throw wr=!1,e}function hl(e){return(e.f&Fr)===0&&(e.parent===null||(e.parent.f&$r)===0)}function Vr(e,t,n,r){if(wr){if(n===null&&(wr=!1),hl(t))throw e;return}n!==null&&(wr=!0);{gl(e,t);return}}function la(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];He!=null&&He.includes(e)||((o.f&pt)!==0?la(o,t,!1):t===o&&(n?ht(o,Nt):(o.f&Ye)!==0&&ht(o,gn),Br(o)))}}function ca(e){var _;var t=qe,n=et,r=ot,s=oe,o=Qt,i=He,c=pe,l=wt,f=e.f;qe=null,et=0,ot=null,Qt=(f&it)!==0&&(wt||!un||oe===null),oe=(f&(Mt|Tn))===0?e:null,He=null,ao(e.ctx),wt=!1,Rr++,e.f|=ds;try{var d=(0,e.fn)(),v=e.deps;if(qe!==null){var u;if(Or(e,et),v!==null&&et>0)for(v.length=et+qe.length,u=0;u<qe.length;u++)v[et+u]=qe[u];else e.deps=v=qe;if(!Qt)for(u=et;u<v.length;u++)((_=v[u]).reactions??(_.reactions=[])).push(e)}else v!==null&&et<v.length&&(Or(e,et),v.length=et);if(Mn()&&ot!==null&&!wt&&v!==null&&(e.f&(pt|gn|Nt))===0)for(u=0;u<ot.length;u++)la(ot[u],e);return s!==null&&(Rr++,ot!==null&&(r===null?r=ot:r.push(...ot))),d}finally{qe=t,et=n,ot=r,oe=s,Qt=o,He=i,ao(c),wt=l,e.f^=ds}}function _l(e,t){let n=t.reactions;if(n!==null){var r=Ai.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&pt)!==0&&(qe===null||!qe.includes(t))&&(ht(t,gn),(t.f&(it|Pr))===0&&(t.f^=Pr),Yo(t),Or(t,0))}function Or(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)_l(e,n[r])}function Hr(e){var t=e.f;if((t&Fr)===0){ht(e,Ye);var n=fe,r=pe,s=un;fe=e,un=!0;try{(t&$s)!==0?ul(e):ta(e),ea(e);var o=ca(e);e.teardown=typeof o=="function"?o:null,e.wv=aa;var i=e.deps,c;so&&qi&&e.f&Nt}catch(l){Vr(l,e,n,r||e.ctx)}finally{un=s,fe=n}}}function yl(){try{Gi()}catch(e){if(Er!==null)Vr(e,Er,null);else throw e}}function ua(){var e=un;try{var t=0;for(un=!0;er.length>0;){t++>1e3&&yl();var n=er,r=n.length;er=[];for(var s=0;s<r;s++){var o=bl(n[s]);ml(o)}}}finally{Ar=!1,un=e,Er=null,nr.clear()}}function ml(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Fr|Ot))===0)try{Gn(r)&&(Hr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?na(r):r.fn=null))}catch(s){Vr(s,r,null,r.ctx)}}}function Br(e){Ar||(Ar=!0,queueMicrotask(ua));for(var t=Er=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(Tn|Mt))!==0){if((n&Ye)===0)return;t.f^=Ye}}er.push(t)}function bl(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Mt|Tn))!==0,o=s&&(r&Ye)!==0;if(!o&&(r&Ot)===0){if((r&Go)!==0)t.push(n);else if(s)n.f^=Ye;else{var i=oe;try{oe=n,Gn(n)&&Hr(n)}catch(f){Vr(f,n,null,n.ctx)}finally{oe=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function wl(e){var t;for(fo();er.length>0;)Ar=!0,ua(),fo();return t}async function xl(){await Promise.resolve(),wl()}function a(e){var t=e.f,n=(t&pt)!==0;if(Kt!==null&&Kt.add(e),oe!==null&&!wt){if(!(He!=null&&He.includes(e))){var r=oe.deps;e.rv<Rr&&(e.rv=Rr,qe===null&&r!==null&&r[et]===e?et++:qe===null?qe=[e]:(!Qt||!qe.includes(e))&&qe.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&it)===0&&(s.f^=it)}return n&&(s=e,Gn(s)&&Zo(s)),pr&&nr.has(e)?nr.get(e):e.v}function Sl(e){var t=Kt;Kt=new Set;var n=Kt,r;try{if(Ze(e),t!==null)for(r of Kt)t.add(r)}finally{Kt=t}return n}function gs(e){var t=Sl(()=>Ze(e));for(var n of t)if((n.f&Fo)!==0)for(const r of n.deps||[])(r.f&pt)===0&&rr(r,r.v);else rr(n,n.v)}function Ze(e){var t=wt;try{return wt=!0,e()}finally{wt=t}}const kl=-7169;function ht(e,t){e.f=e.f&kl|t}function Is(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(St in e)hs(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&St in n&&hs(n)}}}function hs(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{hs(e[r],t)}catch{}const n=Cs(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Lo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function Cl(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const $l=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Pl(e){return $l.includes(e)}const Al={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function El(e){return e=e.toLowerCase(),Al[e]??e}const Rl=["touchstart","touchmove"];function Ol(e){return Rl.includes(e)}function Dl(e,t){if(t){const n=document.body;e.autofocus=!0,qr(()=>{document.activeElement===n&&e.focus()})}}let po=!1;function Il(){po||(po=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function fa(e){var t=oe,n=fe;Ct(null),Xt(null);try{return e()}finally{Ct(t),Xt(n)}}function Ts(e,t,n,r=n){e.addEventListener(t,()=>fa(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),Il()}const da=new Set,_s=new Set;function va(e,t,n,r={}){function s(o){if(r.capture||Kn.call(t,o),!o.cancelBubble)return fa(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?qr(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function N(e,t,n,r,s){var o={capture:r,passive:s},i=va(e,t,n,o);(t===document.body||t===window||t===document)&&Os(()=>{t.removeEventListener(e,i,o)})}function Tl(e){for(var t=0;t<e.length;t++)da.add(e[t]);for(var n of _s)n(e)}function Kn(e){var M;var t=this,n=t.ownerDocument,r=e.type,s=((M=e.composedPath)==null?void 0:M.call(e))||[],o=s[0]||e.target,i=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=s.indexOf(t);if(f===-1)return;l<=f&&(i=l)}if(o=s[i]||e.target,o!==t){No(e,"currentTarget",{configurable:!0,get(){return o||n}});var d=oe,v=fe;Ct(null),Xt(null);try{for(var u,_=[];o!==null;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var b=o["__"+r];if(b!=null&&(!o.disabled||e.target===o))if(Lr(b)){var[k,...C]=b;k.apply(o,[e,...C])}else b.call(o,e)}catch(S){u?_.push(S):u=S}if(e.cancelBubble||p===t||p===null)break;o=p}if(u){for(let S of _)queueMicrotask(()=>{throw S});throw u}}finally{e.__root=t,delete e.currentTarget,Ct(d),Xt(v)}}}function pa(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function vn(e,t){var n=fe;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function A(e,t){var n=(t&Ho)!==0,r=(t&Zi)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=pa(o?e:"<!>"+e),n||(s=Et(s)));var i=r||Wo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=Et(i),l=i.lastChild;vn(c,l)}else vn(i,i);return i}}function ga(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Ho)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=pa(o),l=Et(c);if(s)for(i=document.createDocumentFragment();Et(l);)i.appendChild(Et(l));else i=Et(l)}var f=i.cloneNode(!0);if(s){var d=Et(f),v=f.lastChild;vn(d,v)}else vn(f,f);return f}}function Fe(e=""){{var t=fr(e+"");return vn(t,t),t}}function Ae(){var e=document.createDocumentFragment(),t=document.createComment(""),n=fr();return e.append(t,n),vn(t,n),e}function m(e,t){e!==null&&e.before(t)}function K(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function jl(e,t){return Ml(e,t)}const Cn=new Map;function Ml(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:i=!0}){rl();var c=new Set,l=v=>{for(var u=0;u<v.length;u++){var _=v[u];if(!c.has(_)){c.add(_);var p=Ol(_);t.addEventListener(_,Kn,{passive:p});var b=Cn.get(_);b===void 0?(document.addEventListener(_,Kn,{passive:p}),Cn.set(_,1)):Cn.set(_,b+1)}}};l(ks(da)),_s.add(l);var f=void 0,d=cl(()=>{var v=n??t.appendChild(fr());return dn(()=>{if(o){Be({});var u=pe;u.c=o}s&&(r.$$events=s),f=e(v,r)||{},o&&We()}),()=>{var p;for(var u of c){t.removeEventListener(u,Kn);var _=Cn.get(u);--_===0?(document.removeEventListener(u,Kn),Cn.delete(u)):Cn.set(u,_)}_s.delete(l),v!==n&&((p=v.parentNode)==null||p.removeChild(v))}});return Nl.set(f,d),f}let Nl=new WeakMap;function T(e,t,[n,r]=[0,0]){var s=e,o=null,i=null,c=Je,l=n>0?Ur:0,f=!1;const d=(u,_=!0)=>{f=!0,v(_,u)},v=(u,_)=>{c!==(c=u)&&(c?(o?or(o):_&&(o=dn(()=>_(s))),i&&On(i,()=>{i=null})):(i?or(i):_&&(i=dn(()=>_(s,[n+1,r]))),o&&On(o,()=>{o=null})))};vr(()=>{f=!1,t(d),f||v(null,null)},l)}function Ll(e,t,n){var r=e,s=Je,o,i=Mn()?ji:zr;vr(()=>{i(s,s=t())&&(o&&On(o),o=dn(()=>n(r)))})}function ir(e,t){return t}function Gl(e,t,n,r){for(var s=[],o=t.length,i=0;i<o;i++)Ds(t[i].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;sl(l),l.append(n),r.clear(),Wt(e,t[0].prev,t[o-1].next)}ra(s,()=>{for(var f=0;f<o;f++){var d=t[f];c||(r.delete(d.k),Wt(e,d.prev,d.next)),It(d.e,!c)}})}function Tt(e,t,n,r,s,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&qo)!==0;if(l){var f=e;i=f.appendChild(fr())}var d=null,v=!1,u=gt(()=>{var _=n();return Lr(_)?_:_==null?[]:ks(_)});vr(()=>{var _=a(u),p=_.length;v&&p===0||(v=p===0,Fl(_,c,i,s,t,r,n),o!==null&&(p===0?d?or(d):d=dn(()=>o(i)):d!==null&&On(d,()=>{d=null})),a(u))})}function Fl(e,t,n,r,s,o,i){var Ce,Re,$e,J;var c=(s&Hi)!==0,l=(s&(As|Es))!==0,f=e.length,d=t.items,v=t.first,u=v,_,p=null,b,k=[],C=[],M,S,w,R;if(c)for(R=0;R<f;R+=1)M=e[R],S=o(M,R),w=d.get(S),w!==void 0&&((Ce=w.a)==null||Ce.measure(),(b??(b=new Set)).add(w));for(R=0;R<f;R+=1){if(M=e[R],S=o(M,R),w=d.get(S),w===void 0){var F=u?u.e.nodes_start:n;p=zl(F,t,p,p===null?t.first:p.next,M,S,R,r,s,i),d.set(S,p),k=[],C=[],u=p.next;continue}if(l&&Ul(w,M,R,s),(w.e.f&Ot)!==0&&(or(w.e),c&&((Re=w.a)==null||Re.unfix(),(b??(b=new Set)).delete(w))),w!==u){if(_!==void 0&&_.has(w)){if(k.length<C.length){var O=C[0],I;p=O.prev;var H=k[0],ee=k[k.length-1];for(I=0;I<k.length;I+=1)go(k[I],O,n);for(I=0;I<C.length;I+=1)_.delete(C[I]);Wt(t,H.prev,ee.next),Wt(t,p,H),Wt(t,ee,O),u=O,p=ee,R-=1,k=[],C=[]}else _.delete(w),go(w,u,n),Wt(t,w.prev,w.next),Wt(t,w,p===null?t.first:p.next),Wt(t,p,w),p=w;continue}for(k=[],C=[];u!==null&&u.k!==S;)(u.e.f&Ot)===0&&(_??(_=new Set)).add(u),C.push(u),u=u.next;if(u===null)continue;w=u}k.push(w),p=w,u=w.next}if(u!==null||_!==void 0){for(var q=_===void 0?[]:ks(_);u!==null;)(u.e.f&Ot)===0&&q.push(u),u=u.next;var Q=q.length;if(Q>0){var me=(s&qo)!==0&&f===0?n:null;if(c){for(R=0;R<Q;R+=1)($e=q[R].a)==null||$e.measure();for(R=0;R<Q;R+=1)(J=q[R].a)==null||J.fix()}Gl(t,q,me,d)}}c&&qr(()=>{var ne;if(b!==void 0)for(w of b)(ne=w.a)==null||ne.apply()}),fe.first=t.first&&t.first.e,fe.last=p&&p.e}function Ul(e,t,n,r){(r&As)!==0&&rr(e.v,t),(r&Es)!==0?rr(e.i,n):e.i=n}function zl(e,t,n,r,s,o,i,c,l,f){var d=(l&As)!==0,v=(l&Bi)===0,u=d?v?j(s):Rn(s):s,_=(l&Es)===0?i:Rn(i),p={i:_,v:u,k:o,a:null,e:null,prev:n,next:r};try{return p.e=dn(()=>c(e,u,_,f),nl),p.e.prev=n&&n.e,p.e.next=r&&r.e,n===null?t.first=p:(n.next=p,n.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function go(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var i=Jr(o);s.before(o),o=i}}function Wt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Lt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>r:r)}function Jl(e,t,n,r,s,o){var i,c,l=null,f=e,d;vr(()=>{const v=t()||null;var u=el;v!==i&&(d&&(v===null?On(d,()=>{d=null,c=null}):v===c?or(d):It(d)),v&&v!==c&&(d=dn(()=>{if(l=document.createElementNS(u,v),vn(l,l),r){var _=l.appendChild(fr());r(l,_)}fe.nodes_end=l,f.before(l)})),i=v,i&&(c=i))},Ur)}function ql(e,t,n){Ln(()=>{var r=Ze(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};hn(()=>{var i=n();Is(i),s&&zr(o,i)&&(o=i,r.update(i))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function ha(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=ha(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Vl(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=ha(e))&&(r&&(r+=" "),r+=t);return r}function Hl(e){return typeof e=="object"?Vl(e):e??""}const ho=[...` 	
\r\fÂ \v\uFEFF`];function Bl(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,i=0;(i=r.indexOf(s,i))>=0;){var c=i+o;(i===0||ho.includes(r[i-1]))&&(c===r.length||ho.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function _o(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function ss(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Wl(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(ss)),s&&l.push(...Object.keys(s).map(ss));var f=0,d=-1;const b=e.length;for(var v=0;v<b;v++){var u=e[v];if(c?u==="/"&&e[v-1]==="*"&&(c=!1):o?o===u&&(o=!1):u==="/"&&e[v+1]==="*"?c=!0:u==='"'||u==="'"?o=u:u==="("?i++:u===")"&&i--,!c&&o===!1&&i===0){if(u===":"&&d===-1)d=v;else if(u===";"||v===b-1){if(d!==-1){var _=ss(e.substring(f,d).trim());if(!l.includes(_)){u!==";"&&v++;var p=e.substring(f,v).trim();n+=" "+p+";"}}f=v+1,d=-1}}}}return r&&(n+=_o(r)),s&&(n+=_o(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function Dn(e,t,n,r,s,o){var i=e.__className;if(i!==n){var c=Bl(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var f=!!o[l];(s==null||f!==!!s[l])&&e.classList.toggle(l,f)}return o}function os(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function _a(e,t,n,r){var s=e.__style;if(s!==t){var o=Wl(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(os(e,n==null?void 0:n[0],r[0]),os(e,n==null?void 0:n[1],r[1],"important")):os(e,n,r));return r}const Vn=Symbol("class"),Hn=Symbol("style"),ya=Symbol("is custom element"),ma=Symbol("is html");function Kl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Rt(e,t,n,r){var s=ba(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[Ti]=n),n==null?e.removeAttribute(t):typeof n!="string"&&wa(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function yo(e,t,n,r,s=!1){var o=ba(e),i=o[ya],c=!o[ma],l=t||{},f=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=Hl(n.class):n[Vn]&&(n.class=null),n[Hn]&&(n.style??(n.style=null));var v=wa(e);for(const S in n){let w=n[S];if(f&&S==="value"&&w==null){e.value=e.__value="",l[S]=w;continue}if(S==="class"){var u=e.namespaceURI==="http://www.w3.org/1999/xhtml";Dn(e,u,w,r,t==null?void 0:t[Vn],n[Vn]),l[S]=w,l[Vn]=n[Vn];continue}if(S==="style"){_a(e,w,t==null?void 0:t[Hn],n[Hn]),l[S]=w,l[Hn]=n[Hn];continue}var _=l[S];if(w!==_){l[S]=w;var p=S[0]+S[1];if(p!=="$$")if(p==="on"){const R={},F="$$"+S;let O=S.slice(2);var b=Pl(O);if(Cl(O)&&(O=O.slice(0,-7),R.capture=!0),!b&&_){if(w!=null)continue;e.removeEventListener(O,l[F],R),l[F]=null}if(w!=null)if(b)e[`__${O}`]=w,Tl([O]);else{let I=function(H){l[S].call(this,H)};var M=I;l[F]=va(O,e,I,R)}else b&&(e[`__${O}`]=void 0)}else if(S==="style")Rt(e,S,w);else if(S==="autofocus")Dl(e,!!w);else if(!i&&(S==="__value"||S==="value"&&w!=null))e.value=e.__value=w;else if(S==="selected"&&f)Kl(e,w);else{var k=S;c||(k=El(k));var C=k==="defaultValue"||k==="defaultChecked";if(w==null&&!i&&!C)if(o[S]=null,k==="value"||k==="checked"){let R=e;const F=t===void 0;if(k==="value"){let O=R.defaultValue;R.removeAttribute(k),R.defaultValue=O,R.value=R.__value=F?O:null}else{let O=R.defaultChecked;R.removeAttribute(k),R.defaultChecked=O,R.checked=F?O:!1}}else e.removeAttribute(S);else C||v.includes(k)&&(i||typeof w!="string")?e[k]=w:typeof w!="function"&&Rt(e,k,w)}}}return l}function ba(e){return e.__attributes??(e.__attributes={[ya]:e.nodeName.includes("-"),[ma]:e.namespaceURI===Xi})}var mo=new Map;function wa(e){var t=mo.get(e.nodeName);if(t)return t;mo.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=Lo(r);for(var o in n)n[o].set&&t.push(o);r=Cs(r)}return t}function tt(e,t,n=t){var r=Mn();Ts(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=as(e)?is(o):o,n(o),r&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),Ze(t)==null&&e.value&&n(as(e)?is(e.value):e.value),hn(()=>{var s=t();as(e)&&s===is(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Qn(e,t,n=t){Ts(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),Ze(t)==null&&n(e.checked),hn(()=>{var r=t();e.checked=!!r})}function as(e){var t=e.type;return t==="number"||t==="range"}function is(e){return e===""?null:+e}function xa(e,t,n){if(e.multiple)return Yl(e,t);for(var r of e.options){var s=tr(r);if(tl(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Ql(e,t){Ln(()=>{var n=new MutationObserver(()=>{var r=e.__value;xa(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function ys(e,t,n=t){var r=!0;Ts(e,"change",s=>{var o=s?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),tr);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&tr(c)}n(i)}),Ln(()=>{var s=t();if(xa(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=tr(o),n(s))}e.__value=s,r=!1}),Ql(e)}function Yl(e,t){for(var n of e.options)n.selected=~t.indexOf(tr(n))}function tr(e){return"__value"in e?e.__value:e.value}function bo(e,t){return e===t||(e==null?void 0:e[St])===t}function Yn(e={},t,n,r){return Ln(()=>{var s,o;return hn(()=>{s=o,o=[],Ze(()=>{e!==n(...o)&&(t(e,...o),s&&bo(n(...s),e)&&t(null,...s))})}),()=>{qr(()=>{o&&bo(n(...o),e)&&t(null,...o)})}}),e}function Zl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Xe(e=!1){const t=pe,n=t.l.u;if(!n)return;let r=()=>Is(t.s);if(e){let s=0,o={};const i=sr(()=>{let c=!1;const l=t.s;for(const f in l)l[f]!==o[f]&&(o[f]=l[f],c=!0);return c&&s++,s});r=()=>a(i)}n.b.length&&ll(()=>{wo(t,r),Cr(n.b)}),vs(()=>{const s=Ze(()=>n.m.map(Oi));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&vs(()=>{wo(t,r),Cr(n.a)})}function wo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function Sa(e,t,n){if(e==null)return t(void 0),An;const r=Ze(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const $n=[];function st(e,t=An){let n=null;const r=new Set;function s(c){if(zr(e,c)&&(e=c,n)){const l=!$n.length;for(const f of r)f[1](),$n.push(f,e);if(l){for(let f=0;f<$n.length;f+=2)$n[f][0]($n[f+1]);$n.length=0}}}function o(c){s(c(e))}function i(c,l=An){const f=[c,l];return r.add(f),r.size===1&&(n=t(s,o)||An),c(e),()=>{r.delete(f),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function se(e){let t;return Sa(e,n=>t=n)(),t}let br=!1,ms=Symbol();function pn(e,t,n){const r=n[t]??(n[t]={store:null,source:j(void 0),unsubscribe:An});if(r.store!==e&&!(ms in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=An;else{var s=!0;r.unsubscribe=Sa(e,o=>{s?r.source.v=o:y(r.source,o)}),s=!1}return e&&ms in n?se(e):a(r.source)}function Wr(){const e={};function t(){Os(()=>{for(var n in e)e[n].unsubscribe();No(e,ms,{enumerable:!1,value:!0})})}return[e,t]}function Xl(e){var t=br;try{return br=!1,[e(),br]}finally{br=t}}const ec={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=nt({get[t](){return e.props[t]}},t,Vo)),e.special[t](n),co(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),co(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function jt(e,t){return new Proxy({props:e,exclude:t,special:{},version:Rn(0)},ec)}const tc={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(qn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];qn(s)&&(s=s());const o=Yt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(qn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Yt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===St||t===zo)return!1;for(let n of e.props)if(qn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){qn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function _n(...e){return new Proxy({props:e},tc)}function xo(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function nt(e,t,n,r){var O;var s=(n&Wi)!==0,o=!jn||(n&Ki)!==0,i=(n&Qi)!==0,c=(n&Yi)!==0,l=!1,f;i?[f,l]=Xl(()=>e[t]):f=e[t];var d=St in e||zo in e,v=i&&(((O=Yt(e,t))==null?void 0:O.set)??(d&&t in e&&(I=>e[t]=I)))||void 0,u=r,_=!0,p=!1,b=()=>(p=!0,_&&(_=!1,c?u=Ze(r):u=r),u);f===void 0&&r!==void 0&&(v&&o&&Fi(),f=b(),v&&v(f));var k;if(o)k=()=>{var I=e[t];return I===void 0?b():(_=!0,p=!1,I)};else{var C=(s?sr:gt)(()=>e[t]);C.f|=Fo,k=()=>{var I=a(C);return I!==void 0&&(u=void 0),I===void 0?u:I}}if((n&Vo)===0)return k;if(v){var M=e.$$legacy;return function(I,H){return arguments.length>0?((!o||!H||M||l)&&v(H?k():I),I):k()}}var S=!1,w=!1,R=j(f),F=sr(()=>{var I=k(),H=a(R);return S?(S=!1,w=!0,H):(w=!1,R.v=I)});return i&&a(F),s||(F.equals=Ps),function(I,H){if(Kt!==null&&(S=w,k(),a(R)),arguments.length>0){const ee=H?a(F):o&&i?ln(I):I;if(!F.equals(ee)){if(S=!0,y(R,ee),p&&u!==void 0&&(u=ee),xo(F))return I;Ze(()=>a(F))}return I}return xo(F)?F.v:a(F)}}function gr(e){pe===null&&Rs(),jn&&pe.l!==null?oc(pe).m.push(e):vs(()=>{const t=Ze(e);if(typeof t=="function")return t})}function nc(e){pe===null&&Rs(),gr(()=>()=>Ze(e))}function rc(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function sc(){const e=pe;return e===null&&Rs(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const i=Lr(s)?s.slice():[s],c=rc(t,n,r);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function oc(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const ac="5";var Mo;typeof window<"u"&&((Mo=window.__svelte??(window.__svelte={})).v??(Mo.v=new Set)).add(ac);Vi();const xt=st({isLoggedIn:!1,token:null,user:null});function ls(){xt.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const at=st("home"),Kr=st(null),Ee=st({phase:"streaming",paused:!0,loadedCount:0,totalCount:null}),ic="modulepreload",lc=function(e){return"/skygit/"+e},So={},hr=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=lc(l),l in So)return;So[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":ic,f||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),f)return new Promise((u,_)=>{v.addEventListener("load",u),v.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function ka(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function bs(e,t){const n=await ka(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+i.byteLength);return c.set(r,0),c.set(new Uint8Array(i),r.byteLength),btoa(String.fromCharCode(...c))}async function js(e,t){const n=Uint8Array.from(atob(t),f=>f.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await ka(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(i);return JSON.parse(l)}const En=new Map,Dr=new Map,cc="https://api.github.com",uc="skygit-config";function Ca(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}let Bn=null;async function Pt(e){return Bn||(Bn=(async()=>{const t=await fetch(`${cc}/user`,{headers:Ca(e)});if(!t.ok)throw Bn=null,new Error("Failed to fetch GitHub user");return(await t.json()).login})(),Bn)}async function fc(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${uc}`,{headers:Ca(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function dc(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function Ms(e,t,n=2){const r=await Pt(e),s=`repositories/${t.owner}-${t.name}.json`,o=En.get(s);if(o)return o;const i={Authorization:`token ${e}`,Accept:"application/vnd.github+json","Content-Type":"application/json"},c=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(Dr.get(s)===c)return;let f=0,d=null;const u=(async()=>{for(;f<=n;){let _=null;try{const C=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{headers:i});C.ok&&(_=(await C.json()).sha)}catch{}const p={message:`Update repo ${t.full_name}`,content:c,..._&&{sha:_}},b=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{method:"PUT",headers:i,body:JSON.stringify(p)});if(b.ok){Dr.set(s,c);return}if(d=await b.text(),b.status===409){f+=1;continue}break}throw new Error(`GitHub commit failed: ${d}`)})().finally(()=>En.delete(s));return En.set(s,u),u}async function $a(e){const n=`https://api.github.com/repos/${await Pt(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){const{paused:l}=se(Ee);Ee.set({phase:"idle",loadedCount:0,totalCount:0,paused:l});return}if(!s.ok){const l=await s.text();throw new Error(`Failed to load repository list: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),{paused:c}=se(Ee);Ee.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:c});for(const l of i){let f=!1;if(Ee.subscribe(d=>f=d.paused)(),f)break;try{const d=await fetch(l.url,{headers:r});if(!d.ok){console.warn(`[SkyGit] Skipped missing repo file: ${l.name} (${d.status})`);continue}const v=await d.json(),u=atob(v.content),_=JSON.parse(u);Ea([_]),Ee.update(p=>({...p,loadedCount:p.loadedCount+1}))}catch(d){console.warn(`[SkyGit] Skipped malformed repo file: ${l.name}`,d);continue}}Ee.update(l=>({...l,phase:"idle"}))}async function vc(e){const n=`https://api.github.com/repos/${await Pt(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const f=await fetch(l.url,{headers:r});if(!f.ok)continue;const d=await f.json(),v=JSON.parse(atob(d.content));c.push(v)}return c}async function pc(e,t){const n=await Pt(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function gc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2))));if(Dr.get(o)===i)return;const c=En.get(o);if(c)return c;const l=`https://api.github.com/repos/${t.full_name}/contents/${s}`;let f=null;try{const v=await fetch(l,{headers:n});if(v.ok)f=(await v.json()).sha;else if(v.status!==404){const u=await v.text();throw new Error(`Failed to check if config.json exists: ${u}`)}}catch(v){console.warn("Error checking for config.json",v)}const d=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:i,...f&&{sha:f}})});if(!d.ok){const v=await d.text();throw new Error(`Failed to commit config.json: ${v}`)}t.has_messages=!0,t.config=r,await Ms(e,t)}async function hc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),c=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let l=null;c.ok&&(l=(await c.json()).sha);const f=fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:i,...l&&{sha:l}})}).then(async v=>{if(!v.ok){const u=await v.text();throw new Error(`Failed to update config.json: ${u}`)}Dr.set(o,i)}).finally(()=>{En.delete(o)});En.set(o,f),await f;const{queueRepoForCommit:d}=await hr(async()=>{const{queueRepoForCommit:v}=await Promise.resolve().then(()=>Da);return{queueRepoForCommit:v}},void 0);await d(t)}async function Ns(e){const n=`https://api.github.com/repos/${await Pt(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function xr(e,t,n=null){const s=`https://api.github.com/repos/${await Pt(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const f=await l.text();throw new Error(`Failed to check secrets.json: ${f}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function _c(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials;if(!r||Object.keys(r).length===0)return;const s=await bs(e,r),{secrets:o,sha:i}=await Ns(e);o[n]=s,await xr(e,o,i)}const Pa="skygit_repos",yc=5*60*1e3,mc=10;let fn=[],Ir=null;const bc=JSON.parse(localStorage.getItem(Pa)||"[]"),$t=st(bc),Ls=st(0),Tr=st(null);$t.subscribe(e=>{localStorage.setItem(Pa,JSON.stringify(e))});function Aa(e){if($t.update(n=>{const r=n.findIndex(s=>s.full_name===e.full_name);if(r>=0){const s=[...n];return s[r]=e,s}return[...n,e]}),fn.some(n=>n.full_name===e.full_name)||fn.push(e),fn.length>=mc){lr();return}Ir||(Ir=setTimeout(lr,yc))}async function lr(){if(fn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...fn];fn=[],clearTimeout(Ir),Ir=null;for(const n of t)try{await Ms(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function Ea(e){$t.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function Ra(){return fn.length>0}function Oa(e){let t;return $t.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const Da=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Ls,flushRepoCommitQueue:lr,getRepoByFullName:Oa,hasPendingRepoCommits:Ra,queueRepoForCommit:Aa,repoList:$t,selectedRepo:Tr,syncRepoListFromGitHub:Ea},Symbol.toStringTag,{value:"Module"}));async function wc(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function xc(e){localStorage.setItem("skygit_token",e)}function Sc(){return localStorage.getItem("skygit_token")}const Ia="skygit_conversations",kc=JSON.parse(localStorage.getItem(Ia)||"{}"),Fn=st(kc),Gs=st(null);Fn.subscribe(e=>{localStorage.setItem(Ia,JSON.stringify(e))});function ws(e,t){Fn.update(n=>({...n,[e]:t}))}function Cc(e,t){Fn.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function Ta(e,t,n){Fn.update(r=>{const o=(r[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...r,[t]:o}}),Gs.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Ne=[];for(let e=0;e<256;++e)Ne.push((e+256).toString(16).slice(1));function $c(e,t=0){return(Ne[e[t+0]]+Ne[e[t+1]]+Ne[e[t+2]]+Ne[e[t+3]]+"-"+Ne[e[t+4]]+Ne[e[t+5]]+"-"+Ne[e[t+6]]+Ne[e[t+7]]+"-"+Ne[e[t+8]]+Ne[e[t+9]]+"-"+Ne[e[t+10]]+Ne[e[t+11]]+Ne[e[t+12]]+Ne[e[t+13]]+Ne[e[t+14]]+Ne[e[t+15]]).toLowerCase()}let cs;const Pc=new Uint8Array(16);function Ac(){if(!cs){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");cs=crypto.getRandomValues.bind(crypto)}return cs(Pc)}const Ec=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ko={randomUUID:Ec};function Rc(e,t,n){var s;if(ko.randomUUID&&!e)return ko.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??Ac();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,$c(r)}async function Oc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const i=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));ws(t.full_name,i),t.conversations=i.map(c=>c.id),await Ms(e,t)}async function ja(e,t){console.log("[SkyGit] ðŸ“ commitToSkyGitConversations() called"),console.log("â© Payload:",t);const n=await Pt(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,i=btoa(JSON.stringify(t,null,2));let c=null;try{const d=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});d.ok&&(c=(await d.json()).sha)}catch{}const l={message:`Add conversation ${t.id}`,content:i,...c&&{sha:c}},f=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(l)});if(!f.ok){const d=await f.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${f.status} ${d}`)}}async function Dc(e,t,n){console.log("[SkyGit] ðŸ”§ createConversation called for:",t.full_name,"with title:",n),await Pt(e);const r=Rc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,i={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const d=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${d}`)}try{console.log("[SkyGit] ðŸ“¤ Now committing to skygit-config..."),await ja(e,i)}catch(d){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",d)}const f={id:r,name:s,path:o,repo:t.full_name,title:n};Cc(f,t)}const Zn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let Sr=!1;function Ic(){Sr=!0}async function xs(e){Sr=!1;const t=new Set,n=[],r=await us("https://api.github.com/user/repos",Zn(e));n.push(...r),Ee.update(o=>({...o,totalCount:n.length}));const s=await us("https://api.github.com/user/orgs",Zn(e));for(const o of s){if(Sr)return;const i=await us(`https://api.github.com/orgs/${o.login}/repos`,Zn(e));n.push(...i),Ee.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(Sr)return;const i=o.full_name;if(t.has(i)){Ee.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(i);const c=await Tc(e,i),l=typeof o.has_discussions=="boolean"?o.has_discussions:!1,f={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(f.has_messages){try{const d=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:Zn(e)});if(d.ok){const v=await d.json();f.config=JSON.parse(atob(v.content))}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${i}`,d)}await Oc(e,f)}Ee.update(d=>({...d,loadedCount:d.loadedCount+1})),Aa(f)}try{await lr()}catch(o){console.warn("[SkyGit] Failed to flush repo commit queue:",o)}Ee.update(o=>({...o,phase:"idle"}))}async function us(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),s=i.length<100,r++):s=!0}return n}async function Tc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Zn(e)})).status===200}catch{return!1}}const Qe=st({config:null,secrets:{},secretsSha:null,cleanupMode:!1});async function jc(e){const t=await Pt(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null,cleanupMode:localStorage.getItem("skygit_cleanup_mode")==="true"};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)ws(o,s[o]);console.log("[SkyGit] âœ… Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,f]of Object.entries(i))try{c[l]=await js(e,f)}catch(d){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,d)}r.secrets=c,r.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}Qe.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await $a(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await vc(e)||[],o={};for(const i of s)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)ws(i,o[i])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let cr=new Set,kr=new Map;const Mc=10;function Fs(e,t){const n=`${e}::${t}`;if(cr.add(n),cr.size>=Mc){ur();return}const r=Nc(e);if(!kr.has(n)){const s=setTimeout(()=>{ur([n]),kr.delete(n)},r);kr.set(n,s)}}function Nc(e){var s;const n=se($t).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function ur(e=null){const t=e||Array.from(cr);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await Pt(n);const r=se(Fn);for(const s of t){cr.delete(s),kr.delete(s);const[o,i]=s.split("::"),l=(r[o]||[]).find(d=>d.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const f={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await ja(n,f);const d=`.messages/conversation-${f.id}.json`,v=btoa(JSON.stringify(f,null,2));let u=null;try{const b=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"}});b.ok&&(u=(await b.json()).sha)}catch{}const _={message:`Update conversation ${f.id}`,content:v,...u&&{sha:u}},p=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify(_)});if(!p.ok){const b=await p.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,b)}}catch(d){console.error("[SkyGit] Conversation commit failed:",d)}}}function Ma(){return cr.size>0}const Us=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:ur,hasPendingConversationCommits:Ma,queueConversationForCommit:Fs},Symbol.toStringTag,{value:"Module"}));var Lc=A('<p class="text-red-500 text-sm"> </p>'),Gc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticatingâ€¦',1),Fc=A('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Donâ€™t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function Uc(e,t){Be(t,!1);let n=nt(t,"onSubmit",8),r=nt(t,"error",8,null),s=j(""),o=j(!1);async function i(){a(o)||(y(o,!0),await n()(a(s)),y(o,!1))}Xe();var c=Fc(),l=g(h(c),2),f=g(l,2);{var d=b=>{var k=Lc(),C=h(k);Y(()=>K(C,r())),m(b,k)};T(f,b=>{r()&&b(d)})}var v=g(f,2),u=h(v);{var _=b=>{var k=Gc();m(b,k)},p=b=>{var k=Fe("Authenticate");m(b,k)};T(u,b=>{a(o)?b(_):b(p,!1)})}Y(()=>{l.disabled=a(o),v.disabled=a(o)}),tt(l,()=>a(s),b=>y(s,b)),N("click",v,i),m(e,c),We()}var zc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),Jc=A('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function qc(e,t){Be(t,!1);let n=nt(t,"onApprove",8),r=nt(t,"onReject",8),s=j(!1);async function o(){a(s)||(y(s,!0),await n()(),y(s,!1))}Xe();var i=Jc(),c=g(h(i),6),l=h(c),f=h(l);{var d=_=>{var p=zc();m(_,p)},v=_=>{var p=Fe("I Accept");m(_,p)};T(f,_=>{a(s)?_(d):_(v,!1)})}var u=g(l,2);Y(()=>{l.disabled=a(s),u.disabled=a(s)}),N("click",l,o),N("click",u,function(..._){var p;(p=r())==null||p.apply(this,_)}),m(e,i),We()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Vc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Hc=ga("<svg><!><!></svg>");function yn(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]),r=jt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Be(t,!1);let s=nt(t,"name",8,void 0),o=nt(t,"color",8,"currentColor"),i=nt(t,"size",8,24),c=nt(t,"strokeWidth",8,2),l=nt(t,"absoluteStrokeWidth",8,!1),f=nt(t,"iconNode",24,()=>[]);const d=(...b)=>b.filter((k,C,M)=>!!k&&M.indexOf(k)===C).join(" ");Xe();var v=Hc();let u;var _=h(v);Tt(_,1,f,ir,(b,k)=>{let C=()=>a(k)[0],M=()=>a(k)[1];var S=Ae(),w=ve(S);Jl(w,C,!0,(R,F)=>{let O;Y(()=>O=yo(R,O,{...M()}))}),m(b,S)});var p=g(_);Lt(p,t,"default",{}),Y((b,k)=>u=yo(v,u,{...Vc,...r,width:i(),height:i(),stroke:o(),"stroke-width":b,class:k}),[()=>l()?Number(c())*24/Number(i()):c(),()=>d("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],gt),m(e,v),We()}function Bc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Wc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Co(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Kc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Qc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Yc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Zc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Lt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}const jr=st({});function $o(e,t){jr.update(n=>({...n,[e]:t}))}var Xc=A('<span title="Presence paused" class="mt-0.5">â¸ï¸</span>'),eu=A('<span title="Presence active" class="mt-0.5">â–¶ï¸</span>'),tu=A('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),nu=A('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),ru=A('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left flex gap-2 items-start"><!> <div class="flex-1"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></div></button>'),su=A('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),ou=A('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function au(e,t){Be(t,!1);const n=j();let r=j({}),s=j({});Fn.subscribe(d=>y(r,d)),jr.subscribe(d=>y(s,d));function o(d){Kr.set(d),Gs.set(d),at.set("chats")}dt(()=>a(r),()=>{y(n,Object.values(a(r)).flat().sort((d,v)=>{const u=new Date(d.updatedAt||d.createdAt||0).getTime();return new Date(v.updatedAt||v.createdAt||0).getTime()-u}))}),dr(),Xe();var i=ou(),c=h(i);Tt(c,1,()=>a(n),d=>d.id,(d,v)=>{var u=Ae(),_=ve(u);Ll(_,()=>`${a(v).id}-${a(s)[a(v).repo]}`,p=>{var b=ru(),k=h(b);{var C=q=>{var Q=Xc();m(q,Q)},M=q=>{var Q=eu();m(q,Q)};T(k,q=>{a(s)[a(v).repo]===!1?q(C):q(M,!1)})}var S=g(k,2),w=h(S),R=h(w),F=g(w,2),O=h(F),I=g(F,2);{var H=q=>{var Q=tu(),me=h(Q);Y(Ce=>K(me,Ce),[()=>a(v).messages.at(-1).content],gt),m(q,Q)},ee=q=>{var Q=nu();m(q,Q)};T(I,q=>{a(v).messages&&a(v).messages.length>0?q(H):q(ee,!1)})}Y(q=>{K(R,q),K(O,a(v).repo)},[()=>a(v).title||`Conversation ${a(v).id.slice(0,6)}`],gt),N("click",b,()=>o(a(v))),m(p,b)}),m(d,u)});var l=g(c,2);{var f=d=>{var v=su();m(d,v)};T(l,d=>{a(n).length===0&&d(f)})}m(e,i),We()}var iu=A('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),lu=A('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),cu=A('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">âœ”ï¸ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">ðŸ”„ Sync</button> <button class="text-blue-600 text-xs underline">ðŸ” Discover</button></div></div>'),uu=A('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),fu=A('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),du=A('<ul class="space-y-2"></ul>'),vu=A('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),pu=A('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),gu=A('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> ðŸ”’ Private</label> <label><input type="checkbox"> ðŸŒ Public</label> <label><input type="checkbox"> ðŸ’¬ With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function hu(e,t){Be(t,!1);const n=j(),r=j();let s=nt(t,"search",8,""),o=j([]),i=j(),c=j(),l=j(!0),f=j(!0),d=j(!0),v=j(!0);$t.subscribe(P=>y(o,P)),Ee.subscribe(P=>y(i,P));function u(){Ee.update(P=>({...P,paused:!P.paused}))}function _(){if(a(i).paused){Ee.update(L=>({...L,paused:!1}));const P=localStorage.getItem("skygit_token");P&&xs(P)}else Ic(),Ee.update(P=>({...P,paused:!0}))}async function p(P){const L=a(o).find(X=>X.full_name===P);if(L){$t.update(X=>X.filter(le=>le.full_name!==P));try{const X=localStorage.getItem("skygit_token");await pc(X,L),console.log(`[SkyGit] Deleted ${P} from GitHub`)}catch(X){console.warn(`[SkyGit] Failed to delete ${P} from GitHub:`,X)}}}async function b(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"streaming",paused:!1,loadedCount:0})),await $a(P))}async function k(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"discovery",paused:!1})),xs(P))}function C(P){Tr.set(P),Kr.set(P)}dt(()=>(a(o),Is(s()),a(l),a(f),a(d),a(v)),()=>{y(n,a(o).filter(P=>{const L=s().toLowerCase(),X=P.full_name.toLowerCase().includes(L)||P.name.toLowerCase().includes(L)||P.owner.toLowerCase().includes(L),le=P.private&&a(l)||!P.private&&a(f),B=P.has_messages&&a(d)||!P.has_messages&&a(v);return X&&le&&B}))}),dt(()=>a(n),()=>{Ls.set(a(n).length)}),dt(()=>a(o),()=>{y(r,a(o).some(P=>!P.has_discussions))}),dr(),Xe();var M=gu(),S=ve(M);{var w=P=>{var L=iu(),X=h(L),le=h(X);Co(le,{class:"w-4 h-4 animate-spin text-blue-500"});var B=g(le,2),te=h(B),V=g(X,2),ge=h(V);Y(()=>{K(te,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),K(ge,a(i).paused?"Resume Syncing":"Pause Syncing")}),N("click",V,u),m(P,L)},R=(P,L)=>{{var X=B=>{var te=lu(),V=h(te);Co(V,{class:"w-4 h-4 animate-spin text-blue-500"});var ge=g(V,2),be=h(ge),G=g(ge,2),Z=h(G);Y(()=>{K(be,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),K(Z,a(i).paused?"Resume Discovery":"Pause Discovery")}),N("click",G,_),m(B,te)},le=(B,te)=>{{var V=ge=>{var be=cu(),G=g(h(be),2),Z=h(G),we=g(Z,2);N("click",Z,b),N("click",we,k),m(ge,be)};T(B,ge=>{a(i).phase==="idle"&&ge(V)},te)}};T(P,B=>{a(i).phase==="discovery"?B(X):B(le,!1)},L)}};T(S,P=>{a(i).phase==="streaming"?P(w):P(R,!1)})}var F=g(S,2),O=h(F),I=h(O),H=g(O,2),ee=h(H),q=g(H,2),Q=h(q),me=g(q,2),Ce=h(me),Re=g(F,2);{var $e=P=>{var L=du();Tt(L,5,()=>a(n),X=>X.full_name,(X,le)=>{var B=fu(),te=h(B),V=h(te),ge=h(V),be=g(V,2),G=h(be),Z=g(G);{var we=_e=>{var xe=uu();m(_e,xe)};T(Z,_e=>{a(le).has_discussions||_e(we)})}Yn(te,_e=>y(c,_e),()=>a(c));var ce=g(te,2),Oe=h(ce);Yc(Oe,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),Y(()=>{K(ge,a(le).full_name),K(G,`${(a(le).has_messages?" | ðŸ’¬ .messages":" | no messaging")??""} `)}),N("click",V,()=>C(a(le))),N("click",ce,()=>p(a(le).full_name)),m(X,B)}),m(P,L)},J=P=>{var L=vu();m(P,L)};T(Re,P=>{a(n).length>0?P($e):P(J,!1)})}var ne=g(Re,2);{var de=P=>{var L=pu();m(P,L)};T(ne,P=>{a(r)&&P(de)})}Qn(I,()=>a(l),P=>y(l,P)),Qn(ee,()=>a(f),P=>y(f,P)),Qn(Q,()=>a(d),P=>y(d,P)),Qn(Ce,()=>a(v),P=>y(v,P)),m(e,M),We()}var _u=A('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function yu(e){var t=_u();m(e,t)}var mu=A('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function bu(e){var t=mu();m(e,t)}var wu=A('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function xu(e){var t=wu();m(e,t)}function fs(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Su=A('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),ku=A('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Cu=A('<button type="button"><div><!></div> <!> </button>'),$u=A('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">â‹¯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function Pu(e,t){Be(t,!1);const[n,r]=Wr(),s=()=>pn(at,"$currentRoute",n),o=()=>pn(Ls,"$filteredCount",n);let i=j(null),c=j(!1),l=j("");function f(){at.set("settings")}function d(J){at.set(J)}xt.subscribe(J=>{y(i,J.user)});const v=[{id:"chats",icon:Kc,label:"Chats"},{id:"repos",icon:Wc,label:"Repos"},{id:"calls",icon:Qc,label:"Calls"},{id:"contacts",icon:Zc,label:"Contacts"},{id:"notifications",icon:Bc,label:"Notifs"}];function u(){y(c,!a(c))}function _(){y(c,!1)}Xe();var p=$u(),b=h(p),k=h(b),C=h(k),M=g(C,2),S=h(M),w=h(S),R=g(S,2),F=h(R),O=g(k,2),I=g(O,2);{var H=J=>{var ne=Su(),de=h(ne),P=g(de,6);ql(ne,(L,X)=>fs==null?void 0:fs(L,X),()=>_),N("click",de,f),N("click",P,function(...L){ls==null||ls.apply(this,L)}),m(J,ne)};T(I,J=>{a(c)&&J(H)})}var ee=g(b,2),q=h(ee),Q=g(ee,2);Tt(Q,5,()=>v,ir,(J,ne)=>{let de=()=>a(ne).id,P=()=>a(ne).icon,L=()=>a(ne).label;var X=Cu();let le;var B=h(X),te=h(B);P()(te,{class:"w-5 h-5"});var V=g(B,2);{var ge=G=>{var Z=ku(),we=h(Z);Y(()=>K(we,o())),m(G,Z)};T(V,G=>{de()==="repos"&&a(l).trim()!==""&&G(ge)})}var be=g(V);Y(G=>{le=Dn(X,1,"relative flex flex-col items-center text-xs focus:outline-none",null,le,G),Dn(B,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===de()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),K(be,` ${L()??""}`)},[()=>({"text-blue-600":s()===de()})],gt),N("click",X,()=>d(de())),m(J,X)});var me=g(Q,2),Ce=h(me);{var Re=J=>{au(J,{})},$e=(J,ne)=>{{var de=L=>{hu(L,{get search(){return a(l)}})},P=(L,X)=>{{var le=te=>{yu(te)},B=(te,V)=>{{var ge=G=>{bu(G)},be=(G,Z)=>{{var we=ce=>{xu(ce)};T(G,ce=>{s()==="notifications"&&ce(we)},Z)}};T(te,G=>{s()==="contacts"?G(ge):G(be,!1)},V)}};T(L,te=>{s()==="calls"?te(le):te(B,!1)},X)}};T(J,L=>{s()==="repos"?L(de):L(P,!1)},ne)}};T(Ce,J=>{s()==="chats"?J(Re):J($e,!1)})}Y(()=>{var J,ne,de,P;Rt(C,"src",(J=a(i))==null?void 0:J.avatar_url),K(w,((ne=a(i))==null?void 0:ne.name)||((de=a(i))==null?void 0:de.login)),K(F,`@${((P=a(i))==null?void 0:P.login)??""}`)}),N("click",O,u),tt(q,()=>a(l),J=>y(l,J)),m(e,p),We(),r()}var Au=A('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">â†</button>'),Eu=A('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Qr(e,t){Be(t,!1);let n=j(!1);function r(p){y(n,p.detail.open)}xt.subscribe(p=>{p.user}),gr(()=>{const p=()=>{window.innerWidth>=768&&y(n,!1)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)}),Kr.subscribe(p=>{p&&window.innerWidth<768&&y(n,!1)}),Xe();var s=Eu(),o=h(s),i=h(o);{var c=p=>{var b=Au();N("click",b,()=>y(n,!0)),m(p,b)};T(i,p=>{a(n)||p(c)})}var l=g(o,2);let f;var d=h(l);Pu(d,{$$events:{toggle:r}});var v=g(l,2);let u;var _=h(v);Lt(_,t,"default",{}),Y((p,b)=>{f=Dn(l,1,"sidebar md:block svelte-scw01y",null,f,p),u=Dn(v,1,"main w-full svelte-scw01y",null,u,b)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],gt),m(e,s),We()}var Ru=A('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function Ou(e){Qr(e,{children:(t,n)=>{var r=Ru();m(t,r)},$$slots:{default:!0}})}var Du=A('<button title="Save">ðŸ’¾</button>'),Iu=A('<button title="Edit">âœï¸</button>'),Tu=A('<button title="Hide">ðŸ™ˆ</button> <!>',1),ju=A('<button title="Reveal">ðŸ‘ï¸</button>'),Mu=A('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),Nu=A('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),Lu=A('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),Gu=A('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),Fu=A('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">ðŸ—‘ï¸</button></td></tr> <!>',1),Uu=A('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),zu=A('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Ju=A('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">ðŸ” Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">âž• Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">ðŸ’¾ Add Credential</button></div> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">App Settings</h3> <label class="flex items-center space-x-2"><input type="checkbox"> <span>Cleanup mode (delete old presence channels)</span></label></div></div>');function qu(e,t){Be(t,!1);let n=j({}),r=j({}),s=j(new Set),o=j(null),i=j(""),c=j("s3"),l=j({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),f=j({}),d=null,v=j(!1);const u=localStorage.getItem("skygit_token");gr(async()=>{if(y(v,se(Qe).cleanupMode||!1),!u)return;const w=await Ns(u);y(n,w.secrets),d=w.sha});async function _(w){try{a(r)[w]||Se(r,a(r)[w]=await js(u,a(n)[w])),y(s,new Set(a(s)).add(w))}catch{alert("âŒ Failed to decrypt.")}}function p(w){y(s,new Set([...a(s)].filter(R=>R!==w))),a(o)===w&&y(o,null)}function b(w){a(s).has(w)||y(s,new Set(a(s)).add(w)),y(o,w),y(f,{...a(r)[w]})}async function k(w){const R=await bs(u,a(f));Se(n,a(n)[w]=R),y(n,{...a(n)}),Se(r,a(r)[w]=a(f)),y(r,{...a(r)}),y(s,new Set(a(s)).add(w)),y(o,null),await xr(u,a(n),d)}async function C(w){confirm(`Are you sure you want to delete the credential for:
${w}?`)&&(delete a(n)[w],y(n,{...a(n)}),delete a(r)[w],y(r,{...a(r)}),y(s,new Set([...a(s)].filter(R=>R!==w))),a(o)===w&&y(o,null),await xr(u,a(n),d))}async function M(){if(!a(i)||!a(c))return;const w=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},R=await bs(u,w);Se(n,a(n)[a(i)]=R),y(n,{...a(n)}),Se(r,a(r)[a(i)]=w),y(r,{...a(r)}),y(s,new Set(a(s)).add(a(i))),y(i,""),y(c,"s3"),y(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await xr(u,a(n),d)}function S(){Qe.update(w=>({...w,cleanupMode:a(v)})),localStorage.setItem("skygit_cleanup_mode",a(v)?"true":"false")}Xe(),Qr(e,{children:(w,R)=>{var F=Ju(),O=g(h(F),2),I=g(h(O));Tt(I,5,()=>Object.entries(a(n)),ir,(B,te)=>{let V=()=>a(te)[0],ge=()=>a(te)[1];var be=Fu(),G=ve(be),Z=h(G),we=h(Z),ce=g(Z),Oe=h(ce),_e=g(ce),xe=h(_e);{var _t=ye=>{var Te=Fe();Y(()=>K(Te,a(r)[V()].type==="s3"?"S3":"Google Drive")),m(ye,Te)},Gt=ye=>{var Te=Fe("?");m(ye,Te)};T(xe,ye=>{a(r)[V()]?ye(_t):ye(Gt,!1)})}var Ft=g(_e),lt=h(Ft);{var en=ye=>{var Te=Tu(),Ut=ve(Te),zt=g(Ut,2);{var rn=ae=>{var De=Du();N("click",De,()=>k(V())),m(ae,De)},sn=ae=>{var De=Iu();N("click",De,()=>b(V())),m(ae,De)};T(zt,ae=>{a(o)===V()?ae(rn):ae(sn,!1)})}N("click",Ut,()=>p(V())),m(ye,Te)},tn=ye=>{var Te=ju();N("click",Te,()=>_(V())),m(ye,Te)};T(lt,ye=>{a(s).has(V())?ye(en):ye(tn,!1)})}var mn=g(lt,2),bn=g(G,2);{var nn=ye=>{var Te=Gu(),Ut=h(Te),zt=h(Ut);{var rn=ae=>{var De=Nu(),x=ve(De),$=g(h(x),2),D=h($),z={},W=h(D),ue=g(x,2);Tt(ue,1,()=>Object.entries(a(f)),ir,(re,ie)=>{let je=()=>a(ie)[0];var ct=Ae(),Ue=ve(ct);{var Jt=At=>{var on=Mu(),qt=h(on),wn=h(qt),xn=g(qt,2);Y(()=>K(wn,je())),tt(xn,()=>a(f)[je()],Vt=>Se(f,a(f)[je()]=Vt)),m(At,on)};T(Ue,At=>{je()!=="type"&&At(Jt)})}m(re,ct)}),Y(()=>{z!==(z=a(f).type)&&(D.value=(D.__value=a(f).type)==null?"":a(f).type),K(W,a(f).type)}),m(ae,De)},sn=ae=>{var De=Lu(),x=h(De);Y($=>K(x,`${$??""}
                                    `),[()=>JSON.stringify(a(r)[V()],null,2)],gt),m(ae,De)};T(zt,ae=>{a(o)===V()?ae(rn):ae(sn,!1)})}m(ye,Te)};T(bn,ye=>{a(s).has(V())&&ye(nn)})}Y(ye=>{K(we,V()),K(Oe,`${ye??""}...`)},[()=>ge().slice(0,20)],gt),N("click",mn,()=>C(V())),m(B,be)});var H=g(O,2),ee=g(h(H),2),q=h(ee),Q=g(h(q)),me=g(q,2),Ce=g(h(me));Y(()=>{a(c),gs(()=>{})});var Re=h(Ce);Re.value=(Re.__value="s3")==null?"":"s3";var $e=g(Re);$e.value=($e.__value="google_drive")==null?"":"google_drive";var J=g(ee,2);{var ne=B=>{var te=Uu(),V=h(te),ge=g(h(V)),be=g(V,2),G=g(h(be)),Z=g(be,2),we=g(h(Z));tt(ge,()=>a(l).accessKeyId,ce=>Se(l,a(l).accessKeyId=ce)),tt(G,()=>a(l).secretAccessKey,ce=>Se(l,a(l).secretAccessKey=ce)),tt(we,()=>a(l).region,ce=>Se(l,a(l).region=ce)),m(B,te)},de=(B,te)=>{{var V=ge=>{var be=zu(),G=h(be),Z=g(h(G)),we=g(G,2),ce=g(h(we)),Oe=g(we,2),_e=g(h(Oe));tt(Z,()=>a(l).client_id,xe=>Se(l,a(l).client_id=xe)),tt(ce,()=>a(l).client_secret,xe=>Se(l,a(l).client_secret=xe)),tt(_e,()=>a(l).refresh_token,xe=>Se(l,a(l).refresh_token=xe)),m(ge,be)};T(B,ge=>{a(c)==="google_drive"&&ge(V)},te)}};T(J,B=>{a(c)==="s3"?B(ne):B(de,!1)})}var P=g(J,2),L=g(H,2),X=g(h(L),2),le=h(X);tt(Q,()=>a(i),B=>y(i,B)),ys(Ce,()=>a(c),B=>y(c,B)),N("click",P,M),Qn(le,()=>a(v),B=>y(v,B)),N("change",le,S),m(w,F)},$$slots:{default:!0}}),We()}var Vu=A('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),Hu=A('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),Bu=A('<div class="p-4 space-y-3"><!></div>');function Wu(e,t){Be(t,!1);const[n,r]=Wr(),s=()=>pn(Gs,"$selectedConversation",n),o=j(),i=j();dt(()=>s(),()=>{y(o,s())}),dt(()=>a(o),()=>{var v;y(i,((v=a(o))==null?void 0:v.messages)??[])}),dt(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),dr(),Xe();var c=Bu(),l=h(c);{var f=v=>{var u=Ae(),_=ve(u);Tt(_,1,()=>a(i),p=>p.id||p.timestamp,(p,b)=>{var k=Vu(),C=h(k),M=h(C),S=g(C,2),w=h(S),R=g(S,2),F=h(R);Y(O=>{K(M,a(b).sender),K(w,a(b).content),K(F,O)},[()=>new Date(a(b).timestamp).toLocaleString()],gt),m(p,k)}),m(v,u)},d=v=>{var u=Hu();m(v,u)};T(l,v=>{a(i).length>0?v(f):v(d,!1)})}m(e,c),We(),r()}const Po="skygit_context_id";function Ku(){if(typeof window>"u")return"server";let e=localStorage.getItem(Po);return e||(e=crypto.randomUUID(),localStorage.setItem(Po,e)),e}const kt="https://api.github.com";let Mr=!1;async function Qu(e,t,n){const[r,s]=t.split("/");return(await Zt(e,`
    query($owner:String!,$name:String!,$number:Int!){
      repository(owner:$owner,name:$name){ discussion(number:$number){ id } }
    }`,{owner:r,name:s,number:n})).repository.discussion.id}async function Yu(e,t,n){await Zt(e,`
    mutation($id:ID!,$body:String!){
      addDiscussionComment(input:{discussionId:$id,body:$body}){ clientMutationId }
    }`,{id:t,body:n})}async function Na(e,t,n){await Zt(e,`
    mutation($cid:ID!,$body:String!){
      updateDiscussionComment(input:{commentId:$cid,body:$body}){ clientMutationId }
    }`,{cid:t,body:n})}async function La(e,t){await Zt(e,`
    mutation($cid:ID!){ deleteDiscussionComment(input:{id:$cid}){ clientMutationId } }`,{cid:t})}async function Ao(e,t){await Zt(e,`
    mutation($id:ID!){ deleteDiscussion(input:{id:$id}){ clientMutationId } }`,{id:t})}async function Zt(e,t,n={}){const r=await fetch(`${kt}/graphql`,{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})});if(!r.ok){const o=await r.text();throw new Error(`GraphQL API error (${r.status}): ${o}`)}const s=await r.json();if(s.errors&&s.errors.length)throw new Error(`GraphQL API returned errors: ${JSON.stringify(s.errors)}`);return s.data}function Wn(e){return`skygit_presence_discussion_${e}`}async function Yr(e,t,n=!1){var v;if(!n&&typeof window<"u"){const u=localStorage.getItem(Wn(t));if(u)try{if((await fetch(`${kt}/repos/${t}/discussions/${u}`,{headers:{Authorization:`token ${e}`}})).ok)return Number(u);localStorage.removeItem(Wn(t))}catch{}}const r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},s=`${kt}/repos/${t}/discussions?per_page=100`;let o=[];try{let u=1;for(;;){const _=await fetch(`${s}&page=${u}`,{headers:r});if(!_.ok)break;const p=await _.json();if(o=o.concat(p),p.length<100)break;u++}}catch{}const i=o.filter(u=>u.title==="SkyGit Presence Channel");if(n&&i.length){for(const u of i)try{await Ao(e,u.node_id)}catch{}typeof window<"u"&&localStorage.removeItem(Wn(t))}if(i.length&&!n){const u=i[0];if(i.length>1)for(const _ of i.slice(1))try{await Ao(e,_.node_id)}catch{}return typeof window<"u"&&localStorage.setItem(Wn(t),u.number),u.number}let c;try{const u=await fetch(`${kt}/repos/${t}/discussions/categories`,{headers:r});if(u.ok){const _=await u.json();_.length&&(c=((v=_.find(p=>p.slug==="general"))==null?void 0:v.id)||_[0].id)}}catch{}if(!c){const[u,_]=t.split("/");try{const b=(await Zt(e,`
        query($owner:String!,$name:String!){
          repository(owner:$owner,name:$name){
            discussionCategories(first:50){ nodes{ id slug name } }
          }
        }`,{owner:u,name:_})).repository.discussionCategories.nodes;b.length&&(c=(b.find(C=>C.slug==="general")||b[0]).id)}catch(p){console.warn("[SkyGit][Presence] GraphQL categories fallback failed",p)}}if(!c)throw new Error("Failed to resolve a discussion category id");if(typeof c=="string"&&c.startsWith("DIC_")){const[u,_]=t.split("/"),p=`
      mutation($repoId:ID!,$catId:ID!,$title:String!,$body:String!){
        createDiscussion(input:{repositoryId:$repoId,categoryId:$catId,title:$title,body:$body}){
          discussion{ number }
        }
      }`,k=(await Zt(e,"query($owner:String!,$name:String!){repository(owner:$owner,name:$name){id}}",{owner:u,name:_})).repository.id,C=await Zt(e,p,{repoId:k,catId:c,title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."});return l(C.createDiscussion.discussion.number)}function l(u){return typeof window<"u"&&localStorage.setItem(Wn(t),u),u}const f=await fetch(s,{method:"POST",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore.",category_id:c})});if(!f.ok){if(f.status===422||f.status===409){const u=await fetch(s,{headers:r});if(u.ok){const p=(await u.json()).find(b=>b.title==="SkyGit Presence Channel");if(p)return l(p.number)}}throw new Error("Failed to create presence discussion")}const d=await f.json();return l(d.number)}function Zu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function Xu(e,t,n,r,s=null,o=!1){const i=await Yr(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${kt}/repos/${t}/discussions/${i}/comments`;let f=null;async function d(){return f||(f=await Qu(e,t,i),f)}const v=new Date().toISOString();let u=v;const _=await fetch(l,{headers:c});let p=[];_.ok&&(p=await _.json());let b=null;if(typeof window<"u"&&(b=localStorage.getItem(C())),b&&!p.some(O=>String(O.id)===b))try{const O=await fetch(`${kt}/repos/${t}/discussions/comments/${b}`,{headers:c});if(O.ok){const I=await O.json();p.push(I)}else typeof window<"u"&&localStorage.removeItem(C()),b=null}catch{}const k=Ku();function C(){return`skygit_presence_comment_${t}_${k}`}const M=p.filter(O=>{try{const I=JSON.parse(O.body);return I.username===n&&I.context_id===k}catch{return!1}}),S=M.find(O=>{try{return JSON.parse(O.body).session_id===r}catch{return!1}});if(S)try{const O=JSON.parse(S.body);O.join_timestamp&&(u=O.join_timestamp)}catch{}const w={username:n,context_id:k,session_id:r,join_timestamp:u,last_seen:v,signaling_info:s};let R=!1;if(S){let O;try{O=JSON.parse(S.body)}catch{O={}}const I=Math.abs(new Date(v)-new Date(O.last_seen));(!Zu(O,w)||I>3e4)&&(R=!0)}if(S&&R){try{await Na(e,S.node_id,JSON.stringify(w)),typeof window<"u"&&localStorage.setItem(C(),String(S.id))}catch{const I=`${l}/${S.id}`;await fetch(I,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(w)})}),typeof window<"u"&&localStorage.setItem(C(),String(S.id))}Mr||Eo(t,S.id)}else if(!S)try{const O=await d();await Yu(e,O,JSON.stringify(w));const I=await fetch(l,{headers:c});if(I.ok){const ee=(await I.json()).find(q=>{try{const Q=JSON.parse(q.body);return Q.session_id===r&&Q.context_id===k}catch{return!1}});ee&&typeof window<"u"&&(localStorage.setItem(C(),String(ee.id)),Mr||Eo(t,ee.id))}}catch{await fetch(l,{method:"POST",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(w)})});try{const I=await fetch(l+"?per_page=1",{headers:c});if(I.ok){const H=await I.json();H.length&&typeof window<"u"&&localStorage.setItem(C(),String(H[0].id))}}catch{}}const F=10*60*1e3;for(const O of M)if(!(S&&O.id===S.id))try{const I=JSON.parse(O.body);Date.now()-new Date(I.last_seen||I.join_timestamp).getTime()>F&&(await La(e,O.node_id),typeof window<"u"&&b===String(O.id)&&localStorage.removeItem(C()))}catch{}}function Eo(e,t){typeof window>"u"||Mr||(Mr=!0,window.addEventListener("beforeunload",()=>{const n=`${kt}/repos/${e}/discussions/comments/${t}`,r={body:JSON.stringify({left_at:new Date().toISOString()})};fetch(n,{method:"PATCH",headers:{Authorization:`token ${localStorage.getItem("skygit_token")||""}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json","Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}).catch(()=>{})}))}async function ef(e,t,n,r,s,o=!1){const i=await Yr(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${kt}/repos/${t}/discussions/${i}/comments`,f=await fetch(l,{headers:c});if(!f.ok)return;const v=(await f.json()).find(u=>{try{const _=JSON.parse(u.body);return _.username===n&&_.session_id===r}catch{return!1}});if(v){let u;try{u=JSON.parse(v.body)}catch{u={}}u.pendingRemovalBy=s,u.pendingRemovalAt=new Date().toISOString();try{await Na(e,v.node_id,JSON.stringify(u))}catch{const p=`${l}/${v.id}`;await fetch(p,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(u)})})}console.debug("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function tf(e,t,n,r,s=!1){const o=await Yr(e,t,s),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},c=`${kt}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:i});if(!l.ok)return;const d=(await l.json()).find(v=>{try{const u=JSON.parse(v.body);return u.username===n&&u.session_id===r}catch{return!1}});if(d){let v;try{v=JSON.parse(d.body)}catch{v={}}if(v.pendingRemovalBy&&v.pendingRemovalAt&&Date.now()-new Date(v.pendingRemovalAt).getTime()>6e4){try{await La(e,d.node_id)}catch{const p=`${c}/${d.id}`;await fetch(p,{method:"DELETE",headers:i})}console.debug("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function nf(e,t,n=!1){const r=await Yr(e,t,n),s={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},o=`${kt}/repos/${t}/discussions/${r}/comments`,i=await fetch(o,{headers:s});if(!i.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",i.status,i.statusText),[];const c=await i.json(),l=Date.now(),f=c.map(d=>{try{return JSON.parse(d.body)}catch{return null}}).filter(Boolean).filter(d=>d.last_seen&&l-new Date(d.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",f),f}async function Nr(e,t,n,r,s=null,o=!1){await Xu(e,t,n,r,s,o)}async function zs(e,t,n=!1){return await nf(e,t,n)}class rf{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:f,onFileSendProgress:d}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=f,this.onFileSendProgress=d,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=d=>{if(d.target.readyState!==FileReader.DONE)return;const v=new Uint8Array(d.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(v)}),c++,i+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),i<t.size?f():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const f=()=>{const d=t.slice(i,i+r);l.readAsArrayBuffer(d)};f()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Ie=st({}),rt=st([]);let Dt=null,Ve=null,vt=null,ke=null;function sf(){return ke}let Ga=null,Pn=null,cn=null;function Ro(){Fa(),Ie.set({}),rt.set([]),clearInterval(cn),cn=null,Xn={token:null,repoFullName:null,username:null}}let Xn={token:null,repoFullName:null,username:null};function Oo({_token:e,_repoFullName:t,_username:n,_sessionId:r}){Xn.token===e&&Xn.repoFullName===t&&Xn.username===n||(Xn={token:e,repoFullName:t,username:n},Fa(),Ie.set({}),rt.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),vt=e,Ve=t,Dt=n,ke=r,zs(vt,Ve,se(Qe).cleanupMode).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(i=>i.username!==Dt);rt.set(o),Js(s),Ua(),za(),In(s,ke)?of():af()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function of(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Ve,"as",Dt,"session",ke),Nr(vt,Ve,Dt,ke,null,se(Qe).cleanupMode),Ga=setInterval(()=>{Nr(vt,Ve,Dt,ke,null,se(Qe).cleanupMode)},3e4),Pn=setInterval(async()=>{const e=await zs(vt,Ve,se(Qe).cleanupMode);console.log("[SkyGit][Presence] [Leader] polled peers:",e),rt.set(e.filter(t=>t.session_id!==ke)),Js(e),Ua(),za()},5e3)}function af(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Ve,"as",Dt,"session",ke);const e=async()=>{const n=await zs(vt,Ve,se(Qe).cleanupMode);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),rt.set(n.filter(r=>r.session_id!==ke)),Js(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),Pn=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Ie.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&Pn&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(Pn),Pn=null,t())})}function Fa(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(Ga),clearInterval(Pn)}async function Js(e){Ie.update(t=>{const n={...t},r=qs(e,ke);if(ke===r){for(const s of e)s.session_id!==ke&&(n[s.session_id]||(n[s.session_id]={status:"connecting",conn:null,username:s.username},Io(s,n)));Object.keys(n).forEach(s=>{s!==ke&&(e.some(o=>o.session_id===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.session_id===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null,username:s.username},Io(s,n))}return n});for(const t of e){if(t.session_id===ke)continue;const n=se(Ie);n[t.session_id]&&n[t.session_id].status==="connected"||(ef(vt,Ve,t.username,t.session_id,Dt,se(Qe).cleanupMode),setTimeout(()=>{tf(vt,Ve,t.username,t.session_id,se(Qe).cleanupMode)},6e4))}}function qs(e,t){return e.map(r=>r.session_id).concat(t).sort()[0]}function In(e,t){return qs(e,t)===t}function lf(e,t){if(!e||!e.conversationId||!e.content)return;Ta(e.conversationId,Ve,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=se(rt);In(n,ke)&&(Fs(Ve,e.conversationId),Ie.update(r=>(Object.values(r).forEach(({conn:s,username:o})=>{o!==t&&s&&s.dataChannel&&s.send({type:"chat",...e})}),r)))}function cf(e,t){e&&Array.isArray(e.onlinePeers)&&rt.set(e.onlinePeers)}function uf(e,t){!e||!e.subtype||Ie.update(n=>{const r=Object.values(n).find(o=>o.username===t),s=r==null?void 0:r.conn;return s&&typeof s.handleSignal=="function"&&s.handleSignal(e),n})}function Do(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function Io(e,t){const n=new rf({token:vt,repoFullName:Ve,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{Nr(vt,Ve,Dt,ke,r,se(Qe).cleanupMode)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":lf(r,e.username);break;case"presence":cf(r,e.username);break;case"signal":uf(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{Do(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{Do(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{Nr(vt,Ve,Dt,ke,r,se(Qe).cleanupMode)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.session_id]={conn:n,status:"connected",username:e.username},Ie.set(t)}function Ua(){const e=se(rt);In(e,ke)?cn||(cn=setInterval(()=>{const n=se(rt);In(n,ke)&&hr(()=>Promise.resolve().then(()=>Us),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",To)):cn&&(clearInterval(cn),cn=null,window.removeEventListener("beforeunload",To))}function To(e){const t=se(rt);In(t,ke)&&hr(()=>Promise.resolve().then(()=>Us),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let jo=!1;function za(){const e=se(rt),t=In(e,ke);t&&!jo&&hr(()=>Promise.resolve().then(()=>Us),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),jo=t}function Ss(e,t){Ie.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function ff(e){Ie.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var df=A('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function vf(e,t){Be(t,!1);let n=nt(t,"conversation",8),r=j("");function s(){var p;if(!a(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(r).trim(),timestamp:Date.now()};Ta(n().id,n().repo,l),(p=se(xt).user)==null||p.login;const d=se(rt),v=sf(),u=qs(d,v),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};v===u?(ff({type:"chat",..._}),Fs(n().repo,n().id)):Ss(u,{type:"chat",..._}),y(r,"")}Xe();var o=df(),i=h(o),c=g(i,2);tt(i,()=>a(r),l=>y(r,l)),N("keydown",i,l=>l.key==="Enter"&&s()),N("click",c,s),m(e,o),We()}var pf=A(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),gf=A('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),hf=A('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),_f=A('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),yf=A('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),mf=A('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),bf=A('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),wf=A('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),xf=A('<button class="bg-yellow-100 border px-3 py-1 rounded">ðŸ”„ Change Screen Source</button>'),Sf=A("<span>ðŸŽ¤</span>"),kf=A("<span>ðŸ”‡</span>"),Cf=A("<span>ðŸ“·</span>"),$f=A("<span>ðŸš«ðŸ“·</span>"),Pf=A("<span>â¹ï¸ Stop Recording</span>"),Af=A("<span>âºï¸ Start Recording</span>"),Ef=A('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>âºï¸ Recording...</span></div>'),Rf=A('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>âš ï¸ Peer is recording</span></div>'),Of=A('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">ðŸ“Ž Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),Df=A('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">Ã—</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),If=A('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),Tf=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),jf=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),Mf=A('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <button class="ml-4 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200"> </button> <button class="ml-2 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200" title="Commit and push messages now">ðŸ’¾ Commit Now</button> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),Nf=A('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function Lf(e,t){Be(t,!1);const[n,r]=Wr(),s=()=>pn(Ie,"$peerConnections",n),o=()=>pn(rt,"$onlinePeers",n);let i=j(null),c=j(!1),l=j(null),f=j(null),d=null,v=j(!1),u=j(null),_=null,p=j(!1),b=j(null),k=j(!1),C=j(!0),M=j(!0),S=j(!0),w=j(!0),R=j(!0),F=j(!1),O=j(!1),I=j(!0);const H=jr.subscribe(x=>{a(i)&&a(i).repo&&y(I,x[a(i).repo]!==!1)});let ee=null,q=[],Q=j({x:0,y:0}),me=!1,Ce={x:0,y:0},Re=j(),$e=j(null),J=j(!1),ne=j(),de=j(),P=j();function L(){y(k,!0)}function X(){y(k,!1)}function le(x){y(k,!1),Ft(!0,x)}function B(x){me=!0,Ce={x:x.clientX-a(Q).x,y:x.clientY-a(Q).y},document.addEventListener("mousemove",te),document.addEventListener("mouseup",V)}function te(x){me&&(Se(Q,a(Q).x=x.clientX-Ce.x),Se(Q,a(Q).y=x.clientY-Ce.y))}function V(){me=!1,document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",V)}function ge(){y(C,!1)}function be(){y(C,!0)}function G(){y($e,null),y(J,!1)}function Z(){var W;if(!a(i))return;const x=a(i).repo,$=localStorage.getItem("skygit_token"),D=se(xt),z=(W=D==null?void 0:D.user)==null?void 0:W.login;!$||!z||(a(I)?($o(x,!1),Ro()):($o(x,!0),Oo({_token:$,_repoFullName:x,_username:z,_sessionId:crypto.randomUUID()})))}function we(){if(!a(i))return;const x=`${a(i).repo}::${a(i).id}`;ur([x])}nc(()=>{H()});async function ce(){let x=a(i)&&a(i).repo,$=se(Qe).decrypted,D=null,z=null,W=null,ue=null;if(x&&window.selectedRepo&&window.selectedRepo.config){const ie=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;ie&&$[ie]&&($[ie].type==="s3"&&(D=$[ie]),$[ie].type==="google_drive"&&(z=$[ie]))}for(const ie in $)$[ie].type==="s3"&&!D&&(W=$[ie]),$[ie].type==="google_drive"&&!z&&(ue=$[ie]);const re=[];return(D||W)&&re.push("s3"),(z||ue)&&re.push("google_drive"),re.length===2?(y(J,!0),new Promise(ie=>{const je=setInterval(()=>{a($e)&&(y(J,!1),clearInterval(je),ie(a($e)))},100)})):re.length===1?re[0]:null}Ie.subscribe(x=>{Object.entries(x).filter(([$,D])=>D.status==="connected").map(([$,D])=>({session_id:$,username:D.username}))});let Oe=j(!1),_e=j("");async function xe(x){const $=localStorage.getItem("skygit_token");if(!$||!x)return null;try{const D=await fetch(`https://api.github.com/repos/${x}`,{headers:{Authorization:`token ${$}`}});if(D.ok){const z=await D.json();return $t.update(W=>W.map(ue=>ue.full_name===x?{...ue,has_discussions:z.has_discussions}:ue)),z.has_discussions}}catch(D){console.warn("Failed to refresh Discussions status",D)}return null}Kr.subscribe(x=>{var ue;console.log("[SkyGit][Presence] currentContent changed:",x),y(i,x),y(Oe,!1),y(_e,"");const $=localStorage.getItem("skygit_token"),D=se(xt),z=((ue=D==null?void 0:D.user)==null?void 0:ue.login)||null,W=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",D),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",z,"repo",W,"selectedConversation",a(i)),$&&z&&W){const re=se(jr);y(I,re[W]!==!1),a(I)?Oo({_token:$,_repoFullName:W,_username:z,_sessionId:crypto.randomUUID()}):Ro()}if(a(i)&&a(i).repo){const re=Oa(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&xe(a(i).repo).then(ie=>{ie?y(Oe,!1):y(Oe,!0)})}});function _t(){y(c,!1),d=null,a(l)&&(a(l).getTracks().forEach(x=>x.stop()),y(l,null)),y(f,null),d&&Ss(d,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function Gt(x){const $=x.target.files[0];!$||!a(c)||!d||Ie.update(D=>{var W;const z=(W=D[d])==null?void 0:W.conn;return z&&typeof z.sendFile=="function"&&z.sendFile($),D})}async function Ft(x=!0,$="screen"){try{let D={video:!0,audio:x};$==="tab"?D={video:{displaySurface:"browser",cursor:"always"},audio:x}:$==="window"?D={video:{displaySurface:"window",cursor:"always"},audio:x}:$==="screen"&&(D={video:{displaySurface:"monitor",cursor:"always"},audio:x}),y(u,await navigator.mediaDevices.getDisplayMedia(D)),y(v,!0),Ie.update(z=>{var ue;const W=(ue=z[d])==null?void 0:ue.conn;return W&&W.replaceVideoTrack&&(W.replaceVideoTrack(a(u).getVideoTracks()[0]),W.sendScreenShareSignal&&W.sendScreenShareSignal(!0,{audio:x})),z}),y(l,a(u)),a(u).getVideoTracks()[0].onended=lt}catch(D){console.error("Screen share error:",D)}}function lt(){a(u)&&(a(u).getTracks().forEach(x=>x.stop()),y(u,null)),y(v,!1),Ie.update(x=>{var D;const $=(D=x[d])==null?void 0:D.conn;return $&&$.replaceVideoTrack,x}),y(l,_)}async function en(){if(a(v))try{const x=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Ie.update($=>{var z;const D=(z=$[d])==null?void 0:z.conn;return D&&D.replaceVideoTrack&&D.replaceVideoTrack(x.getVideoTracks()[0]),$}),a(u)&&a(u).getTracks().forEach($=>$.stop()),y(u,x),y(l,x),x.getVideoTracks()[0].onended=lt}catch(x){console.error("Change screen source error:",x)}}function tn(){y(M,!a(M)),a(l)&&a(l).getAudioTracks().forEach(x=>x.enabled=a(M)),bn()}function mn(){y(S,!a(S)),a(l)&&a(l).getVideoTracks().forEach(x=>x.enabled=a(S)),bn()}function bn(){Ie.update(x=>{var D;const $=(D=x[d])==null?void 0:D.conn;return $&&$.send&&$.send({type:"media-status",micOn:a(M),cameraOn:a(S)}),x})}function nn(x){Ie.update($=>{var z;const D=(z=$[d])==null?void 0:z.conn;return D&&D.send&&D.send({type:"recording-status",recording:x}),$})}function ye(){a(l)&&(q=[],ee=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),ee.ondataavailable=x=>{x.data.size>0&&q.push(x.data)},ee.onstop=Ut,ee.start(),y(F,!0),nn(!0))}function Te(){ee&&a(F)&&(ee.stop(),y(F,!1),nn(!1))}async function Ut(){const x=new Blob(q,{type:"video/webm"});await rn(x)}typeof window<"u"&&(window.skygitOnRecordingStatus=x=>{y(O,!!x.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(x,$)=>{y(p,x),y(b,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=x=>{typeof x.micOn=="boolean"&&y(w,x.micOn),typeof x.cameraOn=="boolean"&&y(R,x.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(x,$,D)=>{x.name,$===D&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(x,$,D)=>{$===D&&setTimeout(()=>{},2e3)});async function zt(x,$){const D=`skygit-recording-${Date.now()}.webm`,z=$.bucket,W=$.region;if(!z||!W)return alert("S3 credential missing bucket or region."),null;const ue=$.endpoint||`https://${z}.s3.${W}.amazonaws.com/${D}`;return(await fetch(ue,{method:"PUT",headers:{"Content-Type":"video/webm"},body:x})).ok?ue.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function rn(x){let $=se(Qe).decrypted,D=a(i)&&a(i).repo,z=null,W=null,ue=null,re=null;if(D&&window.selectedRepo&&window.selectedRepo.config){const Ue=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Ue&&$[Ue]&&($[Ue].type==="s3"&&(z=$[Ue]),$[Ue].type==="google_drive"&&(W=$[Ue]))}for(const Ue in $)$[Ue].type==="s3"&&!z&&(ue=$[Ue]),$[Ue].type==="google_drive"&&!W&&(re=$[Ue]);let ie=null,je=await ce();if(!je){alert("No upload destination (S3 or Google Drive) configured.");return}je==="s3"&&(ie=z||ue),je==="google_drive"&&(ie=W||re);let ct=null;je==="s3"?ct=await zt(x,ie):je==="google_drive"&&(ct=await sn(x,ie)),ct&&(Ss(d,{type:"chat",content:`ðŸ“¹ Recording: ${ct}`}),alert("Recording uploaded and link shared!"))}async function sn(x,$){let D;try{D=await ae($)}catch(ct){return alert("Google Drive authentication failed: "+ct.message),null}const z={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},W=new FormData;W.append("metadata",new Blob([JSON.stringify(z)],{type:"application/json"})),W.append("file",x);const ue=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+D},body:W});if(!ue.ok)return alert("Failed to upload to Google Drive"),null;const re=await ue.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+D,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const je=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+D}})).json();return je.webViewLink||je.webContentLink}async function ae(x){const $=new URLSearchParams;$.append("client_id",x.client_id),$.append("client_secret",x.client_secret),$.append("refresh_token",x.refresh_token),$.append("grant_type","refresh_token");const D=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!D.ok)throw new Error("Failed to get Google access token");return(await D.json()).access_token}function De(){var ue;const x=localStorage.getItem("skygit_token"),$=se(xt),D=((ue=$==null?void 0:$.user)==null?void 0:ue.login)||null,z=a(i)?a(i).repo:null,W=window.skygitSessionId;x&&D&&z&&W&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:x,repoFullName:z,username:D,sessionId:W})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",De),dt(()=>(a(ne),a(l)),()=>{a(ne)&&a(l)&&Se(ne,a(ne).srcObject=a(l))}),dt(()=>(a(de),a(f)),()=>{a(de)&&a(f)&&Se(de,a(de).srcObject=a(f))}),dt(()=>(a(P),a(u)),()=>{a(P)&&a(u)&&Se(P,a(P).srcObject=a(u))}),dr(),Xe(),Qr(e,{children:(x,$)=>{var D=Ae(),z=ve(D);{var W=re=>{var ie=Ae(),je=ve(ie);{var ct=Jt=>{var At=pf(),on=h(At),qt=g(h(on),4),wn=g(qt,2),xn=h(wn),Vt=g(xn,2);Y(()=>Rt(qt,"href",a(_e))),N("click",xn,()=>y(Oe,!1)),N("click",Vt,async()=>{await xe(a(i).repo)}),m(Jt,At)},Ue=Jt=>{var At=Mf(),on=h(At),qt=h(on),wn=h(qt),xn=h(wn),Vt=g(wn,2),Ja=h(Vt),Vs=g(Vt,2),qa=g(Vs,2),Va=h(qa),Hs=g(qt,2),Ha=h(Hs),Ba=g(Hs,2),Bs=h(Ba);{var Wa=he=>{var Me=Ae(),yt=ve(Me);Tt(yt,1,()=>a(i).participants,Ke=>Ke,(Ke,Pe)=>{var Le=Ae(),ze=ve(Le);{var Un=ut=>{var mt=gf();m(ut,mt)},Sn=ut=>{var mt=Ae(),Zr=ve(mt);{var Xr=Ht=>{var an=Ae(),zn=ve(an);{var kn=Ge=>{var ft=hf(),Jn=g(h(ft));Y(()=>K(Jn,` ${a(Pe)??""}`)),m(Ge,ft)},bt=Ge=>{var ft=_f(),Jn=g(h(ft));Y(()=>K(Jn,` ${a(Pe)??""}`)),m(Ge,ft)};T(zn,Ge=>{s()[a(Pe)].status==="connected"?Ge(kn):Ge(bt,!1)})}m(Ht,an)},es=(Ht,an)=>{{var zn=bt=>{var Ge=yf(),ft=g(h(Ge));Y(()=>K(ft,` ${a(Pe)??""}`)),m(bt,Ge)},kn=bt=>{var Ge=mf(),ft=g(h(Ge));Y(()=>K(ft,` ${a(Pe)??""}`)),m(bt,Ge)};T(Ht,bt=>{o().find(Ge=>Ge.username===a(Pe))?bt(zn):bt(kn,!1)},an)}};T(Zr,Ht=>{s()[a(Pe)]?Ht(Xr):Ht(es,!1)})}m(ut,mt)};T(ze,ut=>{a(Pe)===se(xt).user.login?ut(Un):ut(Sn,!1)})}m(Ke,Le)}),m(he,Me)};T(Bs,he=>{a(i).participants&&he(Wa)})}var Ka=g(Bs,2);{var Qa=he=>{var Me=bf();N("click",Me,_t),m(he,Me)};T(Ka,he=>{a(c)&&he(Qa)})}var Ws=g(on,2);{var Ya=he=>{var Me=Of(),yt=ve(Me),Ke=h(yt),Pe=g(h(Ke),2);Pe.muted=!0,Yn(Pe,E=>y(ne,E),()=>a(ne));var Le=g(Pe,2),ze=h(Le),Un=h(ze);{var Sn=E=>{var U=Fe("ðŸŽ¤ Mic On");m(E,U)},ut=E=>{var U=Fe("ðŸ”‡ Mic Off");m(E,U)};T(Un,E=>{a(M)?E(Sn):E(ut,!1)})}var mt=g(ze,2),Zr=h(mt);{var Xr=E=>{var U=Fe("ðŸ“· Cam On");m(E,U)},es=E=>{var U=Fe("ðŸš«ðŸ“· Cam Off");m(E,U)};T(Zr,E=>{a(S)?E(Xr):E(es,!1)})}var Ht=g(Ke,2),an=g(h(Ht),2);Yn(an,E=>y(de,E),()=>a(de));var zn=g(an,2),kn=h(zn),bt=h(kn);{var Ge=E=>{var U=Fe("ðŸŽ¤ Mic On");m(E,U)},ft=E=>{var U=Fe("ðŸ”‡ Mic Off");m(E,U)};T(bt,E=>{a(w)?E(Ge):E(ft,!1)})}var Jn=g(kn,2),si=h(Jn);{var oi=E=>{var U=Fe("ðŸ“· Cam On");m(E,U)},ai=E=>{var U=Fe("ðŸš«ðŸ“· Cam Off");m(E,U)};T(si,E=>{a(R)?E(oi):E(ai,!1)})}var Xs=g(yt,2);{var ii=E=>{var U=wf(),Ci=h(U),$i=g(h(Ci));{var Pi=rs=>{var mr=Fe("(with audio)");m(rs,mr)};T($i,rs=>{var mr;(mr=a(b))!=null&&mr.audio&&rs(Pi)})}m(E,U)};T(Xs,E=>{a(p)&&E(ii)})}var eo=g(Xs,2),to=h(eo),li=g(h(to)),ts=g(to,2),ci=h(ts);{var ui=E=>{var U=Fe("ðŸ›‘ Stop Sharing");m(E,U)},fi=E=>{var U=Fe("ðŸ–¥ï¸ Share Screen");m(E,U)};T(ci,E=>{a(v)?E(ui):E(fi,!1)})}var no=g(ts,2);{var di=E=>{var U=xf();N("click",U,en),m(E,U)};T(no,E=>{a(v)&&E(di)})}var _r=g(no,2),vi=h(_r);{var pi=E=>{var U=Sf();m(E,U)},gi=E=>{var U=kf();m(E,U)};T(vi,E=>{a(M)?E(pi):E(gi,!1)})}var yr=g(_r,2),hi=h(yr);{var _i=E=>{var U=Cf();m(E,U)},yi=E=>{var U=$f();m(E,U)};T(hi,E=>{a(S)?E(_i):E(yi,!1)})}var ns=g(yr,2),mi=h(ns);{var bi=E=>{var U=Pf();m(E,U)},wi=E=>{var U=Af();m(E,U)};T(mi,E=>{a(F)?E(bi):E(wi,!1)})}var ro=g(eo,2);{var xi=E=>{var U=Ef();m(E,U)};T(ro,E=>{a(F)&&E(xi)})}var Si=g(ro,2);{var ki=E=>{var U=Rf();m(E,U)};T(Si,E=>{a(O)&&E(ki)})}Y(()=>{Rt(_r,"title",a(M)?"Mute Mic":"Unmute Mic"),Rt(yr,"title",a(S)?"Turn Off Camera":"Turn On Camera"),Rt(ns,"title",a(F)?"Stop Recording":"Start Recording")}),N("change",li,Gt),N("click",ts,function(...E){var U;(U=a(v)?lt:L)==null||U.apply(this,E)}),N("click",_r,tn),N("click",yr,mn),N("click",ns,function(...E){var U;(U=a(F)?Te:ye)==null||U.apply(this,E)}),m(he,Me)};T(Ws,he=>{a(c)&&he(Ya)})}var Ks=g(Ws,2);{var Za=he=>{var Me=Ae(),yt=ve(Me);{var Ke=Le=>{var ze=Df(),Un=h(ze),Sn=h(Un),ut=g(Sn,4);ut.muted=!0,Yn(ut,mt=>y(P,mt),()=>a(P)),Yn(ze,mt=>y(Re,mt),()=>a(Re)),Y(()=>_a(ze,`left: ${a(Q).x??""}px; top: ${a(Q).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),N("click",Sn,Zl(ge)),N("mousedown",ze,B),m(Le,ze)},Pe=Le=>{var ze=If();N("click",ze,be),m(Le,ze)};T(yt,Le=>{a(C)?Le(Ke):Le(Pe,!1)})}m(he,Me)};T(Ks,he=>{a(v)&&a(u)&&he(Za)})}var Qs=g(Ks,2);{var Xa=he=>{var Me=Tf(),yt=h(Me),Ke=g(h(yt),2),Pe=g(Ke,2),Le=g(Pe,2),ze=g(Le,2);N("click",Ke,()=>le("screen")),N("click",Pe,()=>le("window")),N("click",Le,()=>le("tab")),N("click",ze,X),m(he,Me)};T(Qs,he=>{a(k)&&he(Xa)})}var Ys=g(Qs,2);{var ei=he=>{var Me=jf(),yt=h(Me),Ke=g(h(yt),2),Pe=g(Ke,2),Le=g(Pe,2);N("click",Ke,()=>{y($e,"google_drive")}),N("click",Pe,()=>{y($e,"s3")}),N("click",Le,G),m(he,Me)};T(Ys,he=>{a(J)&&he(ei)})}var Zs=g(Ys,2),ti=h(Zs);Wu(ti,{get conversation(){return a(i)}});var ni=g(Zs,2),ri=h(ni);vf(ri,{get conversation(){return a(i)}}),Y(()=>{var he;K(xn,a(i).title),Rt(Vt,"title",a(I)?"Pause presence polling":"Start presence polling"),K(Ja,a(I)?"â¸ Pause Presence":"â–¶ Start Presence"),K(Va,a(i).repo),K(Ha,`${((he=a(i).participants)==null?void 0:he.length)??0} participants`)}),N("click",Vt,Z),N("click",Vs,we),m(Jt,At)};T(je,Jt=>{a(Oe)?Jt(ct):Jt(Ue,!1)})}m(re,ie)},ue=re=>{var ie=Nf();m(re,ie)};T(z,re=>{a(i)?re(W):re(ue,!1)})}m(x,D)},$$slots:{default:!0}}),We(),r()}var Gf=A('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function Ff(e,t){Be(t,!1);const n=sc();let r=j("");function s(){if(!a(r).trim()){alert("Title is required.");return}n("create",{title:a(r).trim()}),y(r,"")}function o(){n("cancel")}Xe();var i=Gf(),c=h(i),l=g(h(c),2),f=g(l,2),d=h(f),v=g(d,2);tt(l,()=>a(r),u=>y(r,u)),N("click",d,o),N("click",v,s),m(e,i),We()}var Uf=A('<span class="text-green-700 font-semibold">âœ… Enabled</span>'),zf=A("<span> </span>"),Jf=A('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),qf=ga('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),Vf=A('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),Hf=A('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>ðŸ’¬ New Conversation (Enable Discussions first)</button></div>'),Bf=A("<option> </option>"),Wf=A('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">ðŸ› ï¸ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>â€” Select a credential â€”</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¾ Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¬ New Conversation</button> <!>',1),Kf=A('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),Qf=A('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function Yf(e,t){Be(t,!1);let n=j([]),r=j(),s=j(!1),o=j(!1),i=j(""),c;Tr.subscribe(p=>y(r,p)),gr(async()=>{const p=localStorage.getItem("skygit_token");if(p)try{const{secrets:b}=await Ns(p),k=Object.keys(b),C=[];for(const M of k)try{const S=await js(p,b[M]);C.push({url:M,...S})}catch(S){console.warn("Failed to decrypt",M,S)}y(n,C)}catch(b){console.warn("Could not load secrets",b)}});async function l(){const p=localStorage.getItem("skygit_token");if(!(!a(r)||!p)){y(s,!0);try{await gc(p,a(r)),Se(r,a(r).has_messages=!0),hr(async()=>{const{selectedRepo:b}=await Promise.resolve().then(()=>Da);return{selectedRepo:b}},void 0).then(({selectedRepo:b})=>{b.set({...a(r)})})}catch(b){alert("Failed to activate messaging."),console.warn(b)}finally{y(s,!1)}}}async function f(){const p=localStorage.getItem("skygit_token");if(!(!p||!a(r)))try{await hc(p,a(r)),alert("âœ… Messaging config updated.");try{await _c(p,a(r))}catch(b){alert("âŒ Failed to store credential."),console.warn(b)}}catch(b){alert("âŒ Failed to update config."),console.warn(b)}}async function d(p){const b=p.detail.title,k=localStorage.getItem("skygit_token");console.log("[SkyGit] ðŸ§ª handleCreate() called with title:",b),await Dc(k,a(r),b),y(o,!1)}function v(){y(o,!1)}function u(){if(!a(r))return;const p=`https://github.com/${a(r).full_name}/settings/discussions`;window.open(p,"_blank")}async function _(){const p=localStorage.getItem("skygit_token");if(!p||!a(r))return;const b=await fetch(`https://api.github.com/repos/${a(r).full_name}`,{headers:{Authorization:`token ${p}`}});if(b.ok){const k=await b.json(),C=!a(r).has_discussions;Se(r,a(r).has_discussions=k.has_discussions),Tr.set({...a(r)}),$t.update(M=>M.map(S=>S.full_name===a(r).full_name?{...a(r)}:S)),await xl(),C&&a(r).has_discussions?y(i,"âœ… Discussions enabled! You can now use messaging."):a(r).has_discussions?y(i,""):y(i,"âŒ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{y(i,"")},4e3)}}Xe(),Qr(e,{children:(p,b)=>{var k=Ae(),C=ve(k);{var M=w=>{var R=Kf(),F=h(R),O=h(F),I=g(F,2),H=h(I),ee=g(h(H)),q=g(H,2),Q=g(h(q)),me=g(q,2),Ce=g(h(me),2),Re=h(Ce),$e=g(me,2),J=g(h($e)),ne=g($e,2),de=g(h(ne)),P=g(ne,2),L=g(h(P),2);{var X=G=>{var Z=Uf();m(G,Z)},le=G=>{var Z=Jf(),we=g(ve(Z),2),ce=g(we,2),Oe=g(ce,2);{var _e=xe=>{var _t=zf();let Gt;var Ft=h(_t);Y(lt=>{Gt=Dn(_t,1,"ml-2 text-xs font-semibold",null,Gt,lt),K(Ft,a(i))},[()=>({"text-green-700":a(i).startsWith("âœ…"),"text-red-600":a(i).startsWith("âŒ")})],gt),m(xe,_t)};T(Oe,xe=>{a(i)&&xe(_e)})}N("click",we,u),N("click",ce,_),m(G,Z)};T(L,G=>{a(r).has_discussions?G(X):G(le,!1)})}var B=g(I,2);{var te=G=>{var Z=Vf(),we=h(Z);{var ce=_e=>{var xe=qf();m(_e,xe)},Oe=_e=>{var xe=Fe("ðŸ’¬ Activate Messaging");m(_e,xe)};T(we,_e=>{a(s)?_e(ce):_e(Oe,!1)})}Y(()=>Z.disabled=a(s)),N("click",Z,l),m(G,Z)};T(B,G=>{a(r).has_messages||G(te)})}var V=g(B,2);{var ge=G=>{var Z=Hf();m(G,Z)},be=(G,Z)=>{{var we=ce=>{var Oe=Wf(),_e=ve(Oe),xe=g(h(_e),2),_t=h(xe),Gt=g(h(_t)),Ft=g(_t,2),lt=g(h(Ft));Y(()=>{a(r),gs(()=>{})});var en=h(lt);en.value=(en.__value="gitfs")==null?"":"gitfs";var tn=g(en);tn.value=(tn.__value="s3")==null?"":"s3";var mn=g(tn);mn.value=(mn.__value="google_drive")==null?"":"google_drive";var bn=g(Ft,2),nn=g(h(bn));Y(()=>{a(r),gs(()=>{a(n)})});var ye=h(nn);ye.value=((ye.__value="")==null,"");var Te=g(ye);Tt(Te,1,()=>a(n).filter(ae=>ae.type===a(r).config.binary_storage_type),ir,(ae,De)=>{var x=Bf(),$={},D=h(x);Y(()=>{$!==($=a(De).url)&&(x.value=(x.__value=a(De).url)==null?"":a(De).url),K(D,a(De).url)}),m(ae,x)});var Ut=g(xe,2),zt=g(_e,2),rn=g(zt,2);{var sn=ae=>{Ff(ae,{$$events:{create:d,cancel:v}})};T(rn,ae=>{a(o)&&ae(sn)})}tt(Gt,()=>a(r).config.commit_frequency_min,ae=>Se(r,a(r).config.commit_frequency_min=ae)),ys(lt,()=>a(r).config.binary_storage_type,ae=>Se(r,a(r).config.binary_storage_type=ae)),ys(nn,()=>a(r).config.storage_info.url,ae=>Se(r,a(r).config.storage_info.url=ae)),N("click",Ut,f),N("click",zt,()=>y(o,!0)),m(ce,Oe)};T(G,ce=>{a(r).has_messages&&a(r).config&&ce(we)},Z)}};T(V,G=>{a(r).has_discussions?G(be,!1):G(ge)})}Y(()=>{K(O,a(r).full_name),K(ee,` ${a(r).name??""}`),K(Q,` ${a(r).owner??""}`),Rt(Ce,"href",a(r).url),K(Re,a(r).url),K(J,` ${(a(r).private?"ðŸ”’ Private":"ðŸŒ Public")??""}`),K(de,` ${(a(r).has_messages?"ðŸ’¬ Available":"ðŸš« Not enabled")??""}`)}),m(w,R)},S=w=>{var R=Qf();m(w,R)};T(C,w=>{a(r)?w(M):w(S,!1)})}m(p,k)},$$slots:{default:!0}}),We()}var Zf=A('<p class="text-center mt-20">Loading...</p>');function Xf(e,t){Be(t,!1);const[n,r]=Wr(),s=()=>pn(at,"$currentRoute",n),o=()=>pn(Ee,"$syncState",n);let i=j(null),c=null,l=j("");xt.subscribe(C=>{C.isLoggedIn||(at.set("login"),y(i,null),c=null)}),gr(()=>{const C=Sc();C?f(C):at.set("login")});async function f(C){y(l,"");const M=await wc(C);if(!M){localStorage.removeItem("skygit_token"),y(l,"Invalid token. Please check your PAT and try again."),at.set("login");return}y(i,C),c=M,xc(C),xt.set({isLoggedIn:!0,token:a(i),user:c}),await fc(a(i),c.login)?(at.set("home"),await u()):at.set("consent")}async function d(){await dc(a(i)),at.set("home"),await u()}function v(){localStorage.removeItem("skygit_token"),at.set("login")}async function u(){try{console.log("[SkyGit] Initializing app state..."),await jc(a(i))}catch(C){console.warn("[SkyGit] Failed to initialize startup state:",C)}}window.addEventListener("beforeunload",C=>{(Ma()||Ra())&&(ur(),lr(),C.preventDefault(),C.returnValue="")}),dt(()=>(s(),o(),a(i)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{xs(a(i))}catch(C){console.warn("[SkyGit] Repo discovery failed:",C)}}),dr(),Xe();var _=Ae(),p=ve(_);{var b=C=>{var M=Zf();m(C,M)},k=(C,M)=>{{var S=R=>{Uc(R,{onSubmit:f,get error(){return a(l)}})},w=(R,F)=>{{var O=H=>{qc(H,{onApprove:d,onReject:v})},I=(H,ee)=>{{var q=me=>{qu(me,{})},Q=(me,Ce)=>{{var Re=J=>{Lf(J,{})},$e=(J,ne)=>{{var de=L=>{Yf(L,{})},P=L=>{Ou(L)};T(J,L=>{s()==="repos"?L(de):L(P,!1)},ne)}};T(me,J=>{s()==="chats"?J(Re):J($e,!1)},Ce)}};T(H,me=>{s()==="settings"?me(q):me(Q,!1)},ee)}};T(R,H=>{s()==="consent"?H(O):H(I,!1)},F)}};T(C,R=>{s()==="login"?R(S):R(w,!1)},M)}};T(p,C=>{s()==="loading"?C(b):C(k,!1)})}m(e,_),We(),r()}jl(Xf,{target:document.getElementById("app")});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});
