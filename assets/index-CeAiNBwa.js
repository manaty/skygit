(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Hs=!1;var kr=Array.isArray,fi=Array.prototype.indexOf,ps=Array.from,yo=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,mo=Object.getOwnPropertyDescriptors,di=Object.prototype,vi=Array.prototype,gs=Object.getPrototypeOf,Bs=Object.isExtensible;function Dn(e){return typeof e=="function"}const bn=()=>{};function pi(e){return e()}function dr(e){for(var t=0;t<e.length;t++)e[t]()}const ft=2,wo=4,Sr=8,hs=16,Nt=32,Sn=64,vr=128,st=256,pr=512,Ke=1024,It=2048,an=4096,Rt=8192,Cr=16384,gi=32768,$r=65536,xo=1<<17,hi=1<<19,ko=1<<20,ts=1<<21,xt=Symbol("$state"),So=Symbol("legacy props"),_i=Symbol("");function Co(e){return e===this.v}function _s(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function bs(e){return!_s(e,this.v)}function bi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function yi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function wi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function ki(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Si(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ci(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Cn=!1,$i=!1;function Pi(){Cn=!0}const ys=1,ms=2,$o=4,Ei=8,Ai=16,Ri=1,Oi=2,Po=4,Ti=8,Di=16,Eo=1,ji=2,We=Symbol(),Ni="http://www.w3.org/1999/xhtml",Ii="http://www.w3.org/2000/svg";function Ao(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let de=null;function Ws(e){de=e}function qe(e,t=!1,n){var r=de={p:de,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Cn&&!t&&(de.l={s:null,u:null,r1:[],r2:yn(!1)}),ws(()=>{r.d=!0})}function He(e){const t=de;if(t!==null){const i=t.e;if(i!==null){var n=ae,r=se;t.e=null;try{for(var s=0;s<i.length;s++){var o=i[s];Kt(o.effect),kt(o.reaction),Pn(o.fn)}}finally{Kt(n),kt(r)}}de=t.p,t.m=!0}return{}}function Zn(){return!Cn||de!==null&&de.l===null}function en(e,t){if(typeof e!="object"||e===null||xt in e)return e;const n=gs(e);if(n!==di&&n!==vi)return e;var r=new Map,s=kr(e),o=Jt(0),i=se,c=l=>{var u=se;kt(i);var f;return f=l(),kt(u),f};return s&&r.set("length",Jt(e.length)),new Proxy(e,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&ki();var v=r.get(u);return v===void 0?(v=c(()=>Jt(f.value)),r.set(u,v)):y(v,c(()=>en(f.value))),!0},deleteProperty(l,u){var f=r.get(u);if(f===void 0)u in l&&r.set(u,c(()=>Jt(We)));else{if(s&&typeof u=="string"){var v=r.get("length"),d=Number(u);Number.isInteger(d)&&d<v.v&&y(v,d)}y(f,We),Ks(o)}return!0},get(l,u,f){var h;if(u===xt)return e;var v=r.get(u),d=u in l;if(v===void 0&&(!d||(h=Wt(l,u))!=null&&h.writable)&&(v=c(()=>Jt(en(d?l[u]:We))),r.set(u,v)),v!==void 0){var _=a(v);return _===We?void 0:_}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var v=r.get(u);v&&(f.value=a(v))}else if(f===void 0){var d=r.get(u),_=d==null?void 0:d.v;if(d!==void 0&&_!==We)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return f},has(l,u){var _;if(u===xt)return!0;var f=r.get(u),v=f!==void 0&&f.v!==We||Reflect.has(l,u);if(f!==void 0||ae!==null&&(!v||(_=Wt(l,u))!=null&&_.writable)){f===void 0&&(f=c(()=>Jt(v?en(l[u]):We)),r.set(u,f));var d=a(f);if(d===We)return!1}return v},set(l,u,f,v){var w;var d=r.get(u),_=u in l;if(s&&u==="length")for(var h=f;h<d.v;h+=1){var m=r.get(h+"");m!==void 0?y(m,We):h in l&&(m=c(()=>Jt(We)),r.set(h+"",m))}d===void 0?(!_||(w=Wt(l,u))!=null&&w.writable)&&(d=c(()=>Jt(void 0)),y(d,c(()=>en(f))),r.set(u,d)):(_=d.v!==We,y(d,c(()=>en(f))));var x=Reflect.getOwnPropertyDescriptor(l,u);if(x!=null&&x.set&&x.set.call(v,f),!_){if(s&&typeof u=="string"){var O=r.get("length"),S=Number(u);Number.isInteger(S)&&S>=O.v&&y(O,S+1)}Ks(o)}return!0},ownKeys(l){a(o);var u=Reflect.ownKeys(l).filter(d=>{var _=r.get(d);return _===void 0||_.v!==We});for(var[f,v]of r)v.v!==We&&!(f in l)&&u.push(f);return u},setPrototypeOf(){Si()}})}function Ks(e,t=1){y(e,e.v+t)}function Ys(e){try{if(e!==null&&typeof e=="object"&&xt in e)return e[xt]}catch{}return e}function Mi(e,t){return Object.is(Ys(e),Ys(t))}const Jn=new Map;function yn(e,t){var n={f:0,v:e,reactions:null,equals:Co,rv:0,wv:0};return n}function Jt(e,t){const n=yn(e);return Ki(n),n}function N(e,t=!1){var r;const n=yn(e);return t||(n.equals=bs),Cn&&de!==null&&de.l!==null&&((r=de.l).s??(r.s=[])).push(n),n}function ge(e,t){return y(e,et(()=>a(e))),t}function y(e,t,n=!1){se!==null&&!wt&&Zn()&&(se.f&(ft|hs))!==0&&!(Ve!=null&&Ve.includes(e))&&Ci();let r=n?en(t):t;return Vn(e,r)}function Vn(e,t){if(!e.equals(t)){var n=e.v;tr?Jn.set(e,t):Jn.set(e,n),e.v=t,e.wv=Vo(),Ro(e,It),Zn()&&ae!==null&&(ae.f&Ke)!==0&&(ae.f&(Nt|Sn))===0&&(nt===null?Yi([e]):nt.push(e))}return t}function Qs(e,t=1){var n=a(e),r=t===1?n++:n--;return y(e,n),r}function Ro(e,t){var n=e.reactions;if(n!==null)for(var r=Zn(),s=n.length,o=0;o<s;o++){var i=n[o],c=i.f;(c&It)===0&&(!r&&i===ae||(vt(i,t),(c&(Ke|st))!==0&&((c&ft)!==0?Ro(i,an):Tr(i))))}}let Li=!1;var Zs,Oo,To,Do;function Fi(){if(Zs===void 0){Zs=window,Oo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;To=Wt(t,"firstChild").get,Do=Wt(t,"nextSibling").get,Bs(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Bs(n)&&(n.__t=void 0)}}function Xn(e=""){return document.createTextNode(e)}function At(e){return To.call(e)}function Pr(e){return Do.call(e)}function g(e,t){return At(e)}function fe(e,t){{var n=At(e);return n instanceof Comment&&n.data===""?Pr(n):n}}function p(e,t=1,n=!1){let r=e;for(;t--;)r=Pr(r);return r}function Gi(e){e.textContent=""}function qn(e){var t=ft|It,n=se!==null&&(se.f&ft)!==0?se:null;return ae===null||n!==null&&(n.f&st)!==0?t|=st:ae.f|=ko,{ctx:de,deps:null,effects:null,equals:Co,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ae}}function dt(e){const t=qn(e);return t.equals=bs,t}function jo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Tt(t[n])}}function Ui(e){for(var t=e.parent;t!==null;){if((t.f&ft)===0)return t;t=t.parent}return null}function zi(e){var t,n=ae;Kt(Ui(e));try{jo(e),t=Ho(e)}finally{Kt(n)}return t}function No(e){var t=zi(e),n=(Ht||(e.f&st)!==0)&&e.deps!==null?an:Ke;vt(e,n),e.equals(t)||(e.v=t,e.wv=Vo())}function Io(e){ae===null&&se===null&&mi(),se!==null&&(se.f&st)!==0&&ae===null&&yi(),tr&&bi()}function Ji(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function $n(e,t,n,r=!0){var s=ae,o={ctx:de,deps:null,nodes_start:null,nodes_end:null,f:e|It,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Or(o),o.f|=gi}catch(l){throw Tt(o),l}else t!==null&&Tr(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(ko|vr))===0;if(!i&&r&&(s!==null&&Ji(o,s),se!==null&&(se.f&ft)!==0)){var c=se;(c.effects??(c.effects=[])).push(o)}return o}function ws(e){const t=$n(Sr,null,!1);return vt(t,Ke),t.teardown=e,t}function ns(e){Io();var t=ae!==null&&(ae.f&Nt)!==0&&de!==null&&!de.m;if(t){var n=de;(n.e??(n.e=[])).push({fn:e,effect:ae,reaction:se})}else{var r=Pn(e);return r}}function Vi(e){return Io(),ln(e)}function qi(e){const t=$n(Sn,e,!0);return(n={})=>new Promise(r=>{n.outro?Hn(t,()=>{Tt(t),r(void 0)}):(Tt(t),r(void 0))})}function Pn(e){return $n(wo,e,!1)}function ct(e,t){var n=de,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=ln(()=>{e(),!r.ran&&(r.ran=!0,y(n.l.r2,!0),et(t))})}function er(){var e=de;ln(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Ke)!==0&&vt(n,an),En(n)&&Or(n),t.ran=!1}e.l.r2.v=!1}})}function ln(e){return $n(Sr,e,!0)}function W(e,t=[],n=qn){const r=t.map(n);return Er(()=>e(...r.map(a)))}function Er(e,t=0){return $n(Sr|hs|t,e,!0)}function mn(e,t=!0){return $n(Sr|Nt,e,!0,t)}function Mo(e){var t=e.teardown;if(t!==null){const n=tr,r=se;eo(!0),kt(null);try{t.call(null)}finally{eo(n),kt(r)}}}function Lo(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&Sn)!==0?n.parent=null:Tt(n,t),n=r}}function Hi(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Nt)===0&&Tt(t),t=n}}function Tt(e,t=!0){var n=!1;if((t||(e.f&hi)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:Pr(r);r.remove(),r=o}n=!0}Lo(e,t&&!n),br(e,0),vt(e,Cr);var i=e.transitions;if(i!==null)for(const l of i)l.stop();Mo(e);var c=e.parent;c!==null&&c.first!==null&&Fo(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Fo(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function Hn(e,t){var n=[];xs(e,n,!0),Go(n,()=>{Tt(e),t&&t()})}function Go(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function xs(e,t,n){if((e.f&Rt)===0){if(e.f^=Rt,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&$r)!==0||(r.f&Nt)!==0;xs(r,t,o?n:!1),r=s}}}function Bn(e){Uo(e,!0)}function Uo(e,t){if((e.f&Rt)!==0){e.f^=Rt,(e.f&Ke)===0&&(e.f^=Ke),En(e)&&(vt(e,It),Tr(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&$r)!==0||(n.f&Nt)!==0;Uo(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let Wn=[],rs=[];function zo(){var e=Wn;Wn=[],dr(e)}function Bi(){var e=rs;rs=[],dr(e)}function Ar(e){Wn.length===0&&queueMicrotask(zo),Wn.push(e)}function Xs(){Wn.length>0&&zo(),rs.length>0&&Bi()}let cr=!1,gr=!1,hr=null,tn=!1,tr=!1;function eo(e){tr=e}let Gn=[];let se=null,wt=!1;function kt(e){se=e}let ae=null;function Kt(e){ae=e}let Ve=null;function Wi(e){Ve=e}function Ki(e){se!==null&&se.f&ts&&(Ve===null?Wi([e]):Ve.push(e))}let ze=null,Qe=0,nt=null;function Yi(e){nt=e}let Jo=1,_r=0,Ht=!1,qt=null;function Vo(){return++Jo}function En(e){var v;var t=e.f;if((t&It)!==0)return!0;if((t&an)!==0){var n=e.deps,r=(t&st)!==0;if(n!==null){var s,o,i=(t&pr)!==0,c=r&&ae!==null&&!Ht,l=n.length;if(i||c){var u=e,f=u.parent;for(s=0;s<l;s++)o=n[s],(i||!((v=o==null?void 0:o.reactions)!=null&&v.includes(u)))&&(o.reactions??(o.reactions=[])).push(u);i&&(u.f^=pr),c&&f!==null&&(f.f&st)===0&&(u.f^=st)}for(s=0;s<l;s++)if(o=n[s],En(o)&&No(o),o.wv>e.wv)return!0}(!r||ae!==null&&!Ht)&&vt(e,Ke)}return!1}function Qi(e,t){for(var n=t;n!==null;){if((n.f&vr)!==0)try{n.fn(e);return}catch{n.f^=vr}n=n.parent}throw cr=!1,e}function Zi(e){return(e.f&Cr)===0&&(e.parent===null||(e.parent.f&vr)===0)}function Rr(e,t,n,r){if(cr){if(n===null&&(cr=!1),Zi(t))throw e;return}n!==null&&(cr=!0);{Qi(e,t);return}}function qo(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];Ve!=null&&Ve.includes(e)||((o.f&ft)!==0?qo(o,t,!1):t===o&&(n?vt(o,It):(o.f&Ke)!==0&&vt(o,an),Tr(o)))}}function Ho(e){var _;var t=ze,n=Qe,r=nt,s=se,o=Ht,i=Ve,c=de,l=wt,u=e.f;ze=null,Qe=0,nt=null,Ht=(u&st)!==0&&(wt||!tn||se===null),se=(u&(Nt|Sn))===0?e:null,Ve=null,Ws(e.ctx),wt=!1,_r++,e.f|=ts;try{var f=(0,e.fn)(),v=e.deps;if(ze!==null){var d;if(br(e,Qe),v!==null&&Qe>0)for(v.length=Qe+ze.length,d=0;d<ze.length;d++)v[Qe+d]=ze[d];else e.deps=v=ze;if(!Ht)for(d=Qe;d<v.length;d++)((_=v[d]).reactions??(_.reactions=[])).push(e)}else v!==null&&Qe<v.length&&(br(e,Qe),v.length=Qe);if(Zn()&&nt!==null&&!wt&&v!==null&&(e.f&(ft|an|It))===0)for(d=0;d<nt.length;d++)qo(nt[d],e);return s!==null&&(_r++,nt!==null&&(r===null?r=nt:r.push(...nt))),f}finally{ze=t,Qe=n,nt=r,se=s,Ht=o,Ve=i,Ws(c),wt=l,e.f^=ts}}function Xi(e,t){let n=t.reactions;if(n!==null){var r=fi.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&ft)!==0&&(ze===null||!ze.includes(t))&&(vt(t,an),(t.f&(st|pr))===0&&(t.f^=pr),jo(t),br(t,0))}function br(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)Xi(e,n[r])}function Or(e){var t=e.f;if((t&Cr)===0){vt(e,Ke);var n=ae,r=de,s=tn;ae=e,tn=!0;try{(t&hs)!==0?Hi(e):Lo(e),Mo(e);var o=Ho(e);e.teardown=typeof o=="function"?o:null,e.wv=Jo;var i=e.deps,c;Hs&&$i&&e.f&It}catch(l){Rr(l,e,n,r||e.ctx)}finally{tn=s,ae=n}}}function el(){try{wi()}catch(e){if(hr!==null)Rr(e,hr,null);else throw e}}function Bo(){var e=tn;try{var t=0;for(tn=!0;Gn.length>0;){t++>1e3&&el();var n=Gn,r=n.length;Gn=[];for(var s=0;s<r;s++){var o=nl(n[s]);tl(o)}}}finally{gr=!1,tn=e,hr=null,Jn.clear()}}function tl(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Cr|Rt))===0)try{En(r)&&(Or(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Fo(r):r.fn=null))}catch(s){Rr(s,r,null,r.ctx)}}}function Tr(e){gr||(gr=!0,queueMicrotask(Bo));for(var t=hr=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(Sn|Nt))!==0){if((n&Ke)===0)return;t.f^=Ke}}Gn.push(t)}function nl(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Nt|Sn))!==0,o=s&&(r&Ke)!==0;if(!o&&(r&Rt)===0){if((r&wo)!==0)t.push(n);else if(s)n.f^=Ke;else{var i=se;try{se=n,En(n)&&Or(n)}catch(u){Rr(u,n,null,n.ctx)}finally{se=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function rl(e){var t;for(Xs();Gn.length>0;)gr=!0,Bo(),Xs();return t}async function sl(){await Promise.resolve(),rl()}function a(e){var t=e.f,n=(t&ft)!==0;if(qt!==null&&qt.add(e),se!==null&&!wt){if(!(Ve!=null&&Ve.includes(e))){var r=se.deps;e.rv<_r&&(e.rv=_r,ze===null&&r!==null&&r[Qe]===e?Qe++:ze===null?ze=[e]:(!Ht||!ze.includes(e))&&ze.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&st)===0&&(s.f^=st)}return n&&(s=e,En(s)&&No(s)),tr&&Jn.has(e)?Jn.get(e):e.v}function ol(e){var t=qt;qt=new Set;var n=qt,r;try{if(et(e),t!==null)for(r of qt)t.add(r)}finally{qt=t}return n}function ss(e){var t=ol(()=>et(e));for(var n of t)if((n.f&xo)!==0)for(const r of n.deps||[])(r.f&ft)===0&&Vn(r,r.v);else Vn(n,n.v)}function et(e){var t=wt;try{return wt=!0,e()}finally{wt=t}}const al=-7169;function vt(e,t){e.f=e.f&al|t}function ks(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(xt in e)os(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&xt in n&&os(n)}}}function os(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{os(e[r],t)}catch{}const n=gs(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=mo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function il(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const ll=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function cl(e){return ll.includes(e)}const ul={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function fl(e){return e=e.toLowerCase(),ul[e]??e}const dl=["touchstart","touchmove"];function vl(e){return dl.includes(e)}function pl(e,t){if(t){const n=document.body;e.autofocus=!0,Ar(()=>{document.activeElement===n&&e.focus()})}}let to=!1;function gl(){to||(to=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function Wo(e){var t=se,n=ae;kt(null),Kt(null);try{return e()}finally{kt(t),Kt(n)}}function Ss(e,t,n,r=n){e.addEventListener(t,()=>Wo(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),gl()}const Ko=new Set,as=new Set;function Yo(e,t,n,r={}){function s(o){if(r.capture||Mn.call(t,o),!o.cancelBubble)return Wo(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Ar(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function L(e,t,n,r,s){var o={capture:r,passive:s},i=Yo(e,t,n,o);(t===document.body||t===window||t===document)&&ws(()=>{t.removeEventListener(e,i,o)})}function hl(e){for(var t=0;t<e.length;t++)Ko.add(e[t]);for(var n of as)n(e)}function Mn(e){var S;var t=this,n=t.ownerDocument,r=e.type,s=((S=e.composedPath)==null?void 0:S.call(e))||[],o=s[0]||e.target,i=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var u=s.indexOf(t);if(u===-1)return;l<=u&&(i=l)}if(o=s[i]||e.target,o!==t){yo(e,"currentTarget",{configurable:!0,get(){return o||n}});var f=se,v=ae;kt(null),Kt(null);try{for(var d,_=[];o!==null;){var h=o.assignedSlot||o.parentNode||o.host||null;try{var m=o["__"+r];if(m!=null&&(!o.disabled||e.target===o))if(kr(m)){var[x,...O]=m;x.apply(o,[e,...O])}else m.call(o,e)}catch(w){d?_.push(w):d=w}if(e.cancelBubble||h===t||h===null)break;o=h}if(d){for(let w of _)queueMicrotask(()=>{throw w});throw d}}finally{e.__root=t,delete e.currentTarget,kt(f),Kt(v)}}}function Qo(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function sn(e,t){var n=ae;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function E(e,t){var n=(t&Eo)!==0,r=(t&ji)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=Qo(o?e:"<!>"+e),n||(s=At(s)));var i=r||Oo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=At(i),l=i.lastChild;sn(c,l)}else sn(i,i);return i}}function Zo(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Eo)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=Qo(o),l=At(c);if(s)for(i=document.createDocumentFragment();At(l);)i.appendChild(At(l));else i=At(l)}var u=i.cloneNode(!0);if(s){var f=At(u),v=u.lastChild;sn(f,v)}else sn(u,u);return u}}function Ie(e=""){{var t=Xn(e+"");return sn(t,t),t}}function $e(){var e=document.createDocumentFragment(),t=document.createComment(""),n=Xn();return e.append(t,n),sn(t,n),e}function b(e,t){e!==null&&e.before(t)}function H(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function _l(e,t){return bl(e,t)}const gn=new Map;function bl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:i=!0}){Fi();var c=new Set,l=v=>{for(var d=0;d<v.length;d++){var _=v[d];if(!c.has(_)){c.add(_);var h=vl(_);t.addEventListener(_,Mn,{passive:h});var m=gn.get(_);m===void 0?(document.addEventListener(_,Mn,{passive:h}),gn.set(_,1)):gn.set(_,m+1)}}};l(ps(Ko)),as.add(l);var u=void 0,f=qi(()=>{var v=n??t.appendChild(Xn());return mn(()=>{if(o){qe({});var d=de;d.c=o}s&&(r.$$events=s),u=e(v,r)||{},o&&He()}),()=>{var h;for(var d of c){t.removeEventListener(d,Mn);var _=gn.get(d);--_===0?(document.removeEventListener(d,Mn),gn.delete(d)):gn.set(d,_)}as.delete(l),v!==n&&((h=v.parentNode)==null||h.removeChild(v))}});return yl.set(u,f),u}let yl=new WeakMap;function j(e,t,[n,r]=[0,0]){var s=e,o=null,i=null,c=We,l=n>0?$r:0,u=!1;const f=(d,_=!0)=>{u=!0,v(_,d)},v=(d,_)=>{c!==(c=d)&&(c?(o?Bn(o):_&&(o=mn(()=>_(s))),i&&Hn(i,()=>{i=null})):(i?Bn(i):_&&(i=mn(()=>_(s,[n+1,r]))),o&&Hn(o,()=>{o=null})))};Er(()=>{u=!1,t(f),u||v(null,null)},l)}function Kn(e,t){return t}function ml(e,t,n,r){for(var s=[],o=t.length,i=0;i<o;i++)xs(t[i].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;Gi(l),l.append(n),r.clear(),Vt(e,t[0].prev,t[o-1].next)}Go(s,()=>{for(var u=0;u<o;u++){var f=t[u];c||(r.delete(f.k),Vt(e,f.prev,f.next)),Tt(f.e,!c)}})}function Dt(e,t,n,r,s,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&$o)!==0;if(l){var u=e;i=u.appendChild(Xn())}var f=null,v=!1,d=dt(()=>{var _=n();return kr(_)?_:_==null?[]:ps(_)});Er(()=>{var _=a(d),h=_.length;v&&h===0||(v=h===0,wl(_,c,i,s,t,r,n),o!==null&&(h===0?f?Bn(f):f=mn(()=>o(i)):f!==null&&Hn(f,()=>{f=null})),a(d))})}function wl(e,t,n,r,s,o,i){var be,xe,ye,U;var c=(s&Ei)!==0,l=(s&(ys|ms))!==0,u=e.length,f=t.items,v=t.first,d=v,_,h=null,m,x=[],O=[],S,w,P,D;if(c)for(D=0;D<u;D+=1)S=e[D],w=o(S,D),P=f.get(w),P!==void 0&&((be=P.a)==null||be.measure(),(m??(m=new Set)).add(P));for(D=0;D<u;D+=1){if(S=e[D],w=o(S,D),P=f.get(w),P===void 0){var z=d?d.e.nodes_start:n;h=kl(z,t,h,h===null?t.first:h.next,S,w,D,r,s,i),f.set(w,h),x=[],O=[],d=h.next;continue}if(l&&xl(P,S,D,s),(P.e.f&Rt)!==0&&(Bn(P.e),c&&((xe=P.a)==null||xe.unfix(),(m??(m=new Set)).delete(P))),P!==d){if(_!==void 0&&_.has(P)){if(x.length<O.length){var J=O[0],I;h=J.prev;var K=x[0],ie=x[x.length-1];for(I=0;I<x.length;I+=1)no(x[I],J,n);for(I=0;I<O.length;I+=1)_.delete(O[I]);Vt(t,K.prev,ie.next),Vt(t,h,K),Vt(t,ie,J),d=J,h=ie,D-=1,x=[],O=[]}else _.delete(P),no(P,d,n),Vt(t,P.prev,P.next),Vt(t,P,h===null?t.first:h.next),Vt(t,h,P),h=P;continue}for(x=[],O=[];d!==null&&d.k!==w;)(d.e.f&Rt)===0&&(_??(_=new Set)).add(d),O.push(d),d=d.next;if(d===null)continue;P=d}x.push(P),h=P,d=P.next}if(d!==null||_!==void 0){for(var _e=_===void 0?[]:ps(_);d!==null;)(d.e.f&Rt)===0&&_e.push(d),d=d.next;var we=_e.length;if(we>0){var ve=(s&$o)!==0&&u===0?n:null;if(c){for(D=0;D<we;D+=1)(ye=_e[D].a)==null||ye.measure();for(D=0;D<we;D+=1)(U=_e[D].a)==null||U.fix()}ml(t,_e,ve,f)}}c&&Ar(()=>{var ee;if(m!==void 0)for(P of m)(ee=P.a)==null||ee.apply()}),ae.first=t.first&&t.first.e,ae.last=h&&h.e}function xl(e,t,n,r){(r&ys)!==0&&Vn(e.v,t),(r&ms)!==0?Vn(e.i,n):e.i=n}function kl(e,t,n,r,s,o,i,c,l,u){var f=(l&ys)!==0,v=(l&Ai)===0,d=f?v?N(s):yn(s):s,_=(l&ms)===0?i:yn(i),h={i:_,v:d,k:o,a:null,e:null,prev:n,next:r};try{return h.e=mn(()=>c(e,d,_,u),Li),h.e.prev=n&&n.e,h.e.next=r&&r.e,n===null?t.first=h:(n.next=h,n.e.next=h.e),r!==null&&(r.prev=h,r.e.prev=h.e),h}finally{}}function no(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var i=Pr(o);s.before(o),o=i}}function Vt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Mt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>r:r)}function Sl(e,t,n,r,s,o){var i,c,l=null,u=e,f;Er(()=>{const v=t()||null;var d=Ii;v!==i&&(f&&(v===null?Hn(f,()=>{f=null,c=null}):v===c?Bn(f):Tt(f)),v&&v!==c&&(f=mn(()=>{if(l=document.createElementNS(d,v),sn(l,l),r){var _=l.appendChild(Xn());r(l,_)}ae.nodes_end=l,u.before(l)})),i=v,i&&(c=i))},$r)}function Cl(e,t,n){Pn(()=>{var r=et(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};ln(()=>{var i=n();ks(i),s&&_s(o,i)&&(o=i,r.update(i))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function Xo(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Xo(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function $l(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Xo(e))&&(r&&(r+=" "),r+=t);return r}function Pl(e){return typeof e=="object"?$l(e):e??""}const ro=[...` 	
\r\f \v\uFEFF`];function El(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,i=0;(i=r.indexOf(s,i))>=0;){var c=i+o;(i===0||ro.includes(r[i-1]))&&(c===r.length||ro.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function so(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function Br(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Al(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(Br)),s&&l.push(...Object.keys(s).map(Br));var u=0,f=-1;const m=e.length;for(var v=0;v<m;v++){var d=e[v];if(c?d==="/"&&e[v-1]==="*"&&(c=!1):o?o===d&&(o=!1):d==="/"&&e[v+1]==="*"?c=!0:d==='"'||d==="'"?o=d:d==="("?i++:d===")"&&i--,!c&&o===!1&&i===0){if(d===":"&&f===-1)f=v;else if(d===";"||v===m-1){if(f!==-1){var _=Br(e.substring(u,f).trim());if(!l.includes(_)){d!==";"&&v++;var h=e.substring(u,v).trim();n+=" "+h+";"}}u=v+1,f=-1}}}}return r&&(n+=so(r)),s&&(n+=so(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function wn(e,t,n,r,s,o){var i=e.__className;if(i!==n){var c=El(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var u=!!o[l];(s==null||u!==!!s[l])&&e.classList.toggle(l,u)}return o}function Wr(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function ea(e,t,n,r){var s=e.__style;if(s!==t){var o=Al(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(Wr(e,n==null?void 0:n[0],r[0]),Wr(e,n==null?void 0:n[1],r[1],"important")):Wr(e,n,r));return r}const jn=Symbol("class"),Nn=Symbol("style"),ta=Symbol("is custom element"),na=Symbol("is html");function Rl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Bt(e,t,n,r){var s=ra(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[_i]=n),n==null?e.removeAttribute(t):typeof n!="string"&&sa(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function oo(e,t,n,r,s=!1){var o=ra(e),i=o[ta],c=!o[na],l=t||{},u=e.tagName==="OPTION";for(var f in t)f in n||(n[f]=null);n.class?n.class=Pl(n.class):n[jn]&&(n.class=null),n[Nn]&&(n.style??(n.style=null));var v=sa(e);for(const w in n){let P=n[w];if(u&&w==="value"&&P==null){e.value=e.__value="",l[w]=P;continue}if(w==="class"){var d=e.namespaceURI==="http://www.w3.org/1999/xhtml";wn(e,d,P,r,t==null?void 0:t[jn],n[jn]),l[w]=P,l[jn]=n[jn];continue}if(w==="style"){ea(e,P,t==null?void 0:t[Nn],n[Nn]),l[w]=P,l[Nn]=n[Nn];continue}var _=l[w];if(P!==_){l[w]=P;var h=w[0]+w[1];if(h!=="$$")if(h==="on"){const D={},z="$$"+w;let J=w.slice(2);var m=cl(J);if(il(J)&&(J=J.slice(0,-7),D.capture=!0),!m&&_){if(P!=null)continue;e.removeEventListener(J,l[z],D),l[z]=null}if(P!=null)if(m)e[`__${J}`]=P,hl([J]);else{let I=function(K){l[w].call(this,K)};var S=I;l[z]=Yo(J,e,I,D)}else m&&(e[`__${J}`]=void 0)}else if(w==="style")Bt(e,w,P);else if(w==="autofocus")pl(e,!!P);else if(!i&&(w==="__value"||w==="value"&&P!=null))e.value=e.__value=P;else if(w==="selected"&&u)Rl(e,P);else{var x=w;c||(x=fl(x));var O=x==="defaultValue"||x==="defaultChecked";if(P==null&&!i&&!O)if(o[w]=null,x==="value"||x==="checked"){let D=e;const z=t===void 0;if(x==="value"){let J=D.defaultValue;D.removeAttribute(x),D.defaultValue=J,D.value=D.__value=z?J:null}else{let J=D.defaultChecked;D.removeAttribute(x),D.defaultChecked=J,D.checked=z?J:!1}}else e.removeAttribute(w);else O||v.includes(x)&&(i||typeof P!="string")?e[x]=P:typeof P!="function"&&Bt(e,x,P)}}}return l}function ra(e){return e.__attributes??(e.__attributes={[ta]:e.nodeName.includes("-"),[na]:e.namespaceURI===Ni})}var ao=new Map;function sa(e){var t=ao.get(e.nodeName);if(t)return t;ao.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=mo(r);for(var o in n)n[o].set&&t.push(o);r=gs(r)}return t}function Ze(e,t,n=t){var r=Zn();Ss(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=Kr(e)?Yr(o):o,n(o),r&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),et(t)==null&&e.value&&n(Kr(e)?Yr(e.value):e.value),ln(()=>{var s=t();Kr(e)&&s===Yr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function ar(e,t,n=t){Ss(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),et(t)==null&&n(e.checked),ln(()=>{var r=t();e.checked=!!r})}function Kr(e){var t=e.type;return t==="number"||t==="range"}function Yr(e){return e===""?null:+e}function oa(e,t,n){if(e.multiple)return Tl(e,t);for(var r of e.options){var s=Un(r);if(Mi(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Ol(e,t){Pn(()=>{var n=new MutationObserver(()=>{var r=e.__value;oa(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function is(e,t,n=t){var r=!0;Ss(e,"change",s=>{var o=s?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),Un);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&Un(c)}n(i)}),Pn(()=>{var s=t();if(oa(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=Un(o),n(s))}e.__value=s,r=!1}),Ol(e)}function Tl(e,t){for(var n of e.options)n.selected=~t.indexOf(Un(n))}function Un(e){return"__value"in e?e.__value:e.value}function io(e,t){return e===t||(e==null?void 0:e[xt])===t}function Ln(e={},t,n,r){return Pn(()=>{var s,o;return ln(()=>{s=o,o=[],et(()=>{e!==n(...o)&&(t(e,...o),s&&io(n(...s),e)&&t(null,...s))})}),()=>{Ar(()=>{o&&io(n(...o),e)&&t(null,...o)})}}),e}function Dl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ye(e=!1){const t=de,n=t.l.u;if(!n)return;let r=()=>ks(t.s);if(e){let s=0,o={};const i=qn(()=>{let c=!1;const l=t.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&s++,s});r=()=>a(i)}n.b.length&&Vi(()=>{lo(t,r),dr(n.b)}),ns(()=>{const s=et(()=>n.m.map(pi));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&ns(()=>{lo(t,r),dr(n.a)})}function lo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function aa(e,t,n){if(e==null)return t(void 0),bn;const r=et(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const hn=[];function at(e,t=bn){let n=null;const r=new Set;function s(c){if(_s(e,c)&&(e=c,n)){const l=!hn.length;for(const u of r)u[1](),hn.push(u,e);if(l){for(let u=0;u<hn.length;u+=2)hn[u][0](hn[u+1]);hn.length=0}}}function o(c){s(c(e))}function i(c,l=bn){const u=[c,l];return r.add(u),r.size===1&&(n=t(s,o)||bn),c(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function Me(e){let t;return aa(e,n=>t=n)(),t}let ir=!1,ls=Symbol();function on(e,t,n){const r=n[t]??(n[t]={store:null,source:N(void 0),unsubscribe:bn});if(r.store!==e&&!(ls in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=bn;else{var s=!0;r.unsubscribe=aa(e,o=>{s?r.source.v=o:y(r.source,o)}),s=!1}return e&&ls in n?Me(e):a(r.source)}function Dr(){const e={};function t(){ws(()=>{for(var n in e)e[n].unsubscribe();yo(e,ls,{enumerable:!1,value:!0})})}return[e,t]}function jl(e){var t=ir;try{return ir=!1,[e(),ir]}finally{ir=t}}const Nl={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=Xe({get[t](){return e.props[t]}},t,Po)),e.special[t](n),Qs(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),Qs(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function jt(e,t){return new Proxy({props:e,exclude:t,special:{},version:yn(0)},Nl)}const Il={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];Dn(s)&&(s=s());const o=Wt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Dn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Wt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===xt||t===So)return!1;for(let n of e.props)if(Dn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Dn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function cn(...e){return new Proxy({props:e},Il)}function co(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function Xe(e,t,n,r){var J;var s=(n&Ri)!==0,o=!Cn||(n&Oi)!==0,i=(n&Ti)!==0,c=(n&Di)!==0,l=!1,u;i?[u,l]=jl(()=>e[t]):u=e[t];var f=xt in e||So in e,v=i&&(((J=Wt(e,t))==null?void 0:J.set)??(f&&t in e&&(I=>e[t]=I)))||void 0,d=r,_=!0,h=!1,m=()=>(h=!0,_&&(_=!1,c?d=et(r):d=r),d);u===void 0&&r!==void 0&&(v&&o&&xi(),u=m(),v&&v(u));var x;if(o)x=()=>{var I=e[t];return I===void 0?m():(_=!0,h=!1,I)};else{var O=(s?qn:dt)(()=>e[t]);O.f|=xo,x=()=>{var I=a(O);return I!==void 0&&(d=void 0),I===void 0?d:I}}if((n&Po)===0)return x;if(v){var S=e.$$legacy;return function(I,K){return arguments.length>0?((!o||!K||S||l)&&v(K?x():I),I):x()}}var w=!1,P=!1,D=N(u),z=qn(()=>{var I=x(),K=a(D);return w?(w=!1,P=!0,K):(P=!1,D.v=I)});return i&&a(z),s||(z.equals=bs),function(I,K){if(qt!==null&&(w=P,x(),a(D)),arguments.length>0){const ie=K?a(z):o&&i?en(I):I;if(!z.equals(ie)){if(w=!0,y(D,ie),h&&d!==void 0&&(d=ie),co(z))return I;et(()=>a(z))}return I}return co(z)?z.v:a(z)}}function jr(e){de===null&&Ao(),Cn&&de.l!==null?Fl(de).m.push(e):ns(()=>{const t=et(e);if(typeof t=="function")return t})}function Ml(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function Ll(){const e=de;return e===null&&Ao(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const i=kr(s)?s.slice():[s],c=Ml(t,n,r);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function Fl(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const Gl="5";var bo;typeof window<"u"&&((bo=window.__svelte??(window.__svelte={})).v??(bo.v=new Set)).add(Gl);Pi();const Ot=at({isLoggedIn:!1,token:null,user:null});function Qr(){Ot.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const rt=at("home"),Nr=at(null),De=at({phase:"streaming",paused:!1,loadedCount:0,totalCount:null}),Ul="modulepreload",zl=function(e){return"/skygit/"+e},uo={},nr=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=zl(l),l in uo)return;uo[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const v=document.createElement("link");if(v.rel=u?"stylesheet":Ul,u||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),u)return new Promise((d,_)=>{v.addEventListener("load",d),v.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function ia(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function cs(e,t){const n=await ia(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+i.byteLength);return c.set(r,0),c.set(new Uint8Array(i),r.byteLength),btoa(String.fromCharCode(...c))}async function Cs(e,t){const n=Uint8Array.from(atob(t),u=>u.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await ia(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(i);return JSON.parse(l)}const Jl="https://api.github.com",Vl="skygit-config";function la(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}async function pt(e){const t=await fetch(`${Jl}/user`,{headers:la(e)});if(!t.ok)throw new Error("Failed to fetch GitHub user");return(await t.json()).login}async function ca(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${Vl}`,{headers:la(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function ua(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function Ir(e,t){const n=await pt(e),r=`repositories/${t.owner}-${t.name}.json`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));let i=null;const c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:s});c.ok&&(i=(await c.json()).sha);const l={message:`Update repo ${t.full_name}`,content:o};i&&(l.sha=i);const u=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"PUT",headers:s,body:JSON.stringify(l)});if(!u.ok){const f=await u.text();throw new Error(`GitHub commit failed: ${f}`)}}async function $s(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){De.set({phase:"idle",loadedCount:0,totalCount:0,paused:!1});return}if(!s.ok){const c=await s.text();throw new Error(`Failed to load repository list: ${c}`)}const i=(await s.json()).filter(c=>c.name.endsWith(".json"));De.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:!1});for(const c of i){let l=!1;if(De.subscribe(u=>l=u.paused)(),l)break;try{const u=await fetch(c.url,{headers:r});if(!u.ok){console.warn(`[SkyGit] Skipped missing repo file: ${c.name} (${u.status})`);continue}const f=await u.json(),v=atob(f.content),d=JSON.parse(v);ba([d]),De.update(_=>({..._,loadedCount:_.loadedCount+1}))}catch(u){console.warn(`[SkyGit] Skipped malformed repo file: ${c.name}`,u);continue}}De.update(c=>({...c,phase:"idle"}))}async function fa(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const u=await fetch(l.url,{headers:r});if(!u.ok)continue;const f=await u.json(),v=JSON.parse(atob(f.content));c.push(v)}return c}async function da(e,t){const n=await pt(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function va(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),i=`https://api.github.com/repos/${t.full_name}/contents/.messages/config.json`;let c=null;try{const u=await fetch(i,{headers:n});if(u.ok)c=(await u.json()).sha;else if(u.status!==404){const f=await u.text();throw new Error(`Failed to check if config.json exists: ${f}`)}}catch(u){console.warn("Error checking for config.json",u)}const l=await fetch(i,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:s,...c&&{sha:c}})});if(!l.ok){const u=await l.text();throw new Error(`Failed to commit config.json: ${u}`)}t.has_messages=!0,t.config=r,await Ir(e,t)}async function pa(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),i=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let c=null;i.ok&&(c=(await i.json()).sha);const l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:o,...c&&{sha:c}})});if(!l.ok){const f=await l.text();throw new Error(`Failed to update config.json: ${f}`)}const{commitRepoToGitHub:u}=await nr(async()=>{const{commitRepoToGitHub:f}=await Promise.resolve().then(()=>ql);return{commitRepoToGitHub:f}},void 0);await u(e,t)}async function Mr(e){const n=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function zn(e,t,n=null){const s=`https://api.github.com/repos/${await pt(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const u=await l.text();throw new Error(`Failed to check secrets.json: ${u}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function ga(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials,s=await cs(e,r),{secrets:o,sha:i}=await Mr(e);o[n]=s,await zn(e,o,i)}const ql=Object.freeze(Object.defineProperty({__proto__:null,activateMessagingForRepo:va,checkSkyGitRepoExists:ca,commitRepoToGitHub:Ir,createSkyGitRepo:ua,deleteRepoFromGitHub:da,getGitHubUsername:pt,getSecretsMap:Mr,saveSecretsMap:zn,storeEncryptedCredentials:ga,streamPersistedConversationsFromGitHub:fa,streamPersistedReposFromGitHub:$s,updateRepoMessagingConfig:pa},Symbol.toStringTag,{value:"Module"})),ha="skygit_repos",Hl=5*60*1e3,Bl=10;let nn=[],yr=null;const Wl=JSON.parse(localStorage.getItem(ha)||"[]"),St=at(Wl),Ps=at(0),mr=at(null);St.subscribe(e=>{localStorage.setItem(ha,JSON.stringify(e))});function _a(e){if(St.update(n=>{const r=n.findIndex(s=>s.full_name===e.full_name);if(r>=0){const s=[...n];return s[r]=e,s}return[...n,e]}),nn.some(n=>n.full_name===e.full_name)||nn.push(e),nn.length>=Bl){Yn();return}yr||(yr=setTimeout(Yn,Hl))}async function Yn(){if(nn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...nn];nn=[],clearTimeout(yr),yr=null;for(const n of t)try{await Ir(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function ba(e){St.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function ya(){return nn.length>0}function ma(e){let t;return St.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const Kl=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Ps,flushRepoCommitQueue:Yn,getRepoByFullName:ma,hasPendingRepoCommits:ya,queueRepoForCommit:_a,repoList:St,selectedRepo:mr,syncRepoListFromGitHub:ba},Symbol.toStringTag,{value:"Module"}));async function Yl(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function Ql(e){localStorage.setItem("skygit_token",e)}function Zl(){return localStorage.getItem("skygit_token")}const wa="skygit_conversations",Xl=JSON.parse(localStorage.getItem(wa)||"{}"),An=at(Xl),Es=at(null);An.subscribe(e=>{localStorage.setItem(wa,JSON.stringify(e))});function us(e,t){An.update(n=>({...n,[e]:t}))}function ec(e,t){An.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function xa(e,t,n){An.update(r=>{const o=(r[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...r,[t]:o}}),Es.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Oe=[];for(let e=0;e<256;++e)Oe.push((e+256).toString(16).slice(1));function tc(e,t=0){return(Oe[e[t+0]]+Oe[e[t+1]]+Oe[e[t+2]]+Oe[e[t+3]]+"-"+Oe[e[t+4]]+Oe[e[t+5]]+"-"+Oe[e[t+6]]+Oe[e[t+7]]+"-"+Oe[e[t+8]]+Oe[e[t+9]]+"-"+Oe[e[t+10]]+Oe[e[t+11]]+Oe[e[t+12]]+Oe[e[t+13]]+Oe[e[t+14]]+Oe[e[t+15]]).toLowerCase()}let Zr;const nc=new Uint8Array(16);function rc(){if(!Zr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zr=crypto.getRandomValues.bind(crypto)}return Zr(nc)}const sc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fo={randomUUID:sc};function oc(e,t,n){var s;if(fo.randomUUID&&!e)return fo.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??rc();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tc(r)}async function ac(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const i=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));us(t.full_name,i),t.conversations=i.map(c=>c.id),await Ir(e,t)}async function ka(e,t){console.log("[SkyGit] 📝 commitToSkyGitConversations() called"),console.log("⏩ Payload:",t);const n=await pt(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,i=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:i})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function ic(e,t,n){console.log("[SkyGit] 🔧 createConversation called for:",t.full_name,"with title:",n),await pt(e);const r=oc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,i={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const f=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${f}`)}try{console.log("[SkyGit] 📤 Now committing to skygit-config..."),await ka(e,i)}catch(f){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",f)}const u={id:r,name:s,path:o,repo:t.full_name,title:n};ec(u,t)}const Fn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let ur=!1;function lc(){ur=!0}async function fs(e){ur=!1;const t=new Set,n=[],r=await Xr("https://api.github.com/user/repos",Fn(e));n.push(...r),De.update(o=>({...o,totalCount:n.length}));const s=await Xr("https://api.github.com/user/orgs",Fn(e));for(const o of s){if(ur)return;const i=await Xr(`https://api.github.com/orgs/${o.login}/repos`,Fn(e));n.push(...i),De.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(ur)return;const i=o.full_name;if(t.has(i)){De.update(f=>({...f,loadedCount:f.loadedCount+1}));continue}t.add(i);const c=await cc(e,i),l=typeof o.has_discussions=="boolean"?o.has_discussions:!1,u={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(u.has_messages){try{const f=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:Fn(e)});if(f.ok){const v=await f.json();u.config=JSON.parse(atob(v.content))}}catch(f){console.warn(`[SkyGit] Invalid config.json in ${i}`,f)}await ac(e,u)}De.update(f=>({...f,loadedCount:f.loadedCount+1})),_a(u)}try{await Yn()}catch(o){console.warn("[SkyGit] Failed to flush repo commit queue:",o)}De.update(o=>({...o,phase:"idle"}))}async function Xr(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),s=i.length<100,r++):s=!0}return n}async function cc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Fn(e)})).status===200}catch{return!1}}const ds=at({config:null,secrets:{},secretsSha:null});async function uc(e){const t=await pt(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)us(o,s[o]);console.log("[SkyGit] ✅ Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,u]of Object.entries(i))try{c[l]=await Cs(e,u)}catch(f){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,f)}r.secrets=c,r.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}ds.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await $s(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await fa(e)||[],o={};for(const i of s)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)us(i,o[i])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let Qn=new Set,fr=new Map;const fc=10;function As(e,t){const n=`${e}::${t}`;if(Qn.add(n),Qn.size>=fc){wr();return}const r=dc(e);if(!fr.has(n)){const s=setTimeout(()=>{wr([n]),fr.delete(n)},r);fr.set(n,s)}}function dc(e){var s;const n=Me(St).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function wr(e=null){const t=e||Array.from(Qn);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await pt(n);const r=Me(An);for(const s of t){Qn.delete(s),fr.delete(s);const[o,i]=s.split("::"),l=(r[o]||[]).find(f=>f.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const u={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await ka(n,u);const f=`.messages/conversation-${u.id}.json`,v=btoa(JSON.stringify(u,null,2)),d=await fetch(`https://api.github.com/repos/${o}/contents/${f}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${u.id}`,content:v})});if(!d.ok){const _=await d.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(f){console.error("[SkyGit] Conversation commit failed:",f)}}}function Sa(){return Qn.size>0}const Rs=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:wr,hasPendingConversationCommits:Sa,queueConversationForCommit:As},Symbol.toStringTag,{value:"Module"}));var vc=E('<p class="text-red-500 text-sm"> </p>'),pc=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticating…',1),gc=E('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Don’t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function hc(e,t){qe(t,!1);let n=Xe(t,"onSubmit",8),r=Xe(t,"error",8,null),s=N(""),o=N(!1);async function i(){a(o)||(y(o,!0),await n()(a(s)),y(o,!1))}Ye();var c=gc(),l=p(g(c),2),u=p(l,2);{var f=m=>{var x=vc(),O=g(x);W(()=>H(O,r())),b(m,x)};j(u,m=>{r()&&m(f)})}var v=p(u,2),d=g(v);{var _=m=>{var x=pc();b(m,x)},h=m=>{var x=Ie("Authenticate");b(m,x)};j(d,m=>{a(o)?m(_):m(h,!1)})}W(()=>{l.disabled=a(o),v.disabled=a(o)}),Ze(l,()=>a(s),m=>y(s,m)),L("click",v,i),b(e,c),He()}var _c=E('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),bc=E('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function yc(e,t){qe(t,!1);let n=Xe(t,"onApprove",8),r=Xe(t,"onReject",8),s=N(!1);async function o(){a(s)||(y(s,!0),await n()(),y(s,!1))}Ye();var i=bc(),c=p(g(i),6),l=g(c),u=g(l);{var f=_=>{var h=_c();b(_,h)},v=_=>{var h=Ie("I Accept");b(_,h)};j(u,_=>{a(s)?_(f):_(v,!1)})}var d=p(l,2);W(()=>{l.disabled=a(s),d.disabled=a(s)}),L("click",l,o),L("click",d,function(..._){var h;(h=r())==null||h.apply(this,_)}),b(e,i),He()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const mc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var wc=Zo("<svg><!><!></svg>");function un(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]),r=jt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);qe(t,!1);let s=Xe(t,"name",8,void 0),o=Xe(t,"color",8,"currentColor"),i=Xe(t,"size",8,24),c=Xe(t,"strokeWidth",8,2),l=Xe(t,"absoluteStrokeWidth",8,!1),u=Xe(t,"iconNode",24,()=>[]);const f=(...m)=>m.filter((x,O,S)=>!!x&&S.indexOf(x)===O).join(" ");Ye();var v=wc();let d;var _=g(v);Dt(_,1,u,Kn,(m,x)=>{let O=()=>a(x)[0],S=()=>a(x)[1];var w=$e(),P=fe(w);Sl(P,O,!0,(D,z)=>{let J;W(()=>J=oo(D,J,{...S()}))}),b(m,w)});var h=p(_);Mt(h,t,"default",{}),W((m,x)=>d=oo(v,d,{...mc,...r,width:i(),height:i(),stroke:o(),"stroke-width":m,class:x}),[()=>l()?Number(c())*24/Number(i()):c(),()=>f("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],dt),b(e,v),He()}function xc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function kc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function vo(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Sc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Cc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function $c(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}function Pc(e,t){const n=jt(t,["children","$$slots","$$events","$$legacy"]);un(e,cn({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var i=$e(),c=fe(i);Mt(c,t,"default",{}),b(s,i)},$$slots:{default:!0}}))}var Ec=E('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),Ac=E('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),Rc=E('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></button>'),Oc=E('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),Tc=E('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function Dc(e,t){qe(t,!1);const n=N();let r=N({});An.subscribe(u=>y(r,u));function s(u){Nr.set(u),Es.set(u),rt.set("chats")}ct(()=>a(r),()=>{y(n,Object.values(a(r)).flat().sort((u,f)=>{const v=new Date(u.updatedAt||u.createdAt||0).getTime();return new Date(f.updatedAt||f.createdAt||0).getTime()-v}))}),er(),Ye();var o=Tc(),i=g(o);Dt(i,1,()=>a(n),u=>u.id,(u,f)=>{var v=Rc(),d=g(v),_=g(d),h=p(d,2),m=g(h),x=p(h,2);{var O=w=>{var P=Ec(),D=g(P);W(z=>H(D,z),[()=>a(f).messages.at(-1).content],dt),b(w,P)},S=w=>{var P=Ac();b(w,P)};j(x,w=>{a(f).messages&&a(f).messages.length>0?w(O):w(S,!1)})}W(w=>{H(_,w),H(m,a(f).repo)},[()=>a(f).title||`Conversation ${a(f).id.slice(0,6)}`],dt),L("click",v,()=>s(a(f))),b(u,v)});var c=p(i,2);{var l=u=>{var f=Oc();b(u,f)};j(c,u=>{a(n).length===0&&u(l)})}b(e,o),He()}var jc=E('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),Nc=E('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),Ic=E('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">✔️ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">🔄 Sync</button> <button class="text-blue-600 text-xs underline">🔍 Discover</button></div></div>'),Mc=E('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),Lc=E('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),Fc=E('<ul class="space-y-2"></ul>'),Gc=E('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),Uc=E('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),zc=E('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> 🔒 Private</label> <label><input type="checkbox"> 🌐 Public</label> <label><input type="checkbox"> 💬 With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function Jc(e,t){qe(t,!1);const n=N(),r=N();let s=Xe(t,"search",8,""),o=N([]),i=N(),c=N(),l=N(!0),u=N(!0),f=N(!0),v=N(!0);St.subscribe(C=>y(o,C)),De.subscribe(C=>y(i,C));function d(){De.update(C=>({...C,paused:!C.paused}))}function _(){if(a(i).paused){De.update(T=>({...T,paused:!1}));const C=localStorage.getItem("skygit_token");C&&fs(C)}else lc(),De.update(C=>({...C,paused:!0}))}async function h(C){const T=a(o).find(q=>q.full_name===C);if(T){St.update(q=>q.filter(Q=>Q.full_name!==C));try{const q=localStorage.getItem("skygit_token");await da(q,T),console.log(`[SkyGit] Deleted ${C} from GitHub`)}catch(q){console.warn(`[SkyGit] Failed to delete ${C} from GitHub:`,q)}}}async function m(){const C=localStorage.getItem("skygit_token");C&&(De.update(T=>({...T,phase:"streaming",paused:!1,loadedCount:0})),await $s(C))}async function x(){const C=localStorage.getItem("skygit_token");C&&(De.update(T=>({...T,phase:"discovery",paused:!1})),fs(C))}function O(C){mr.set(C),Nr.set(C)}ct(()=>(a(o),ks(s()),a(l),a(u),a(f),a(v)),()=>{y(n,a(o).filter(C=>{const T=s().toLowerCase(),q=C.full_name.toLowerCase().includes(T)||C.name.toLowerCase().includes(T)||C.owner.toLowerCase().includes(T),Q=C.private&&a(l)||!C.private&&a(u),Z=C.has_messages&&a(f)||!C.has_messages&&a(v);return q&&Q&&Z}))}),ct(()=>a(n),()=>{Ps.set(a(n).length)}),ct(()=>a(o),()=>{y(r,a(o).some(C=>!C.has_discussions))}),er(),Ye();var S=zc(),w=fe(S);{var P=C=>{var T=jc(),q=g(T),Q=g(q);vo(Q,{class:"w-4 h-4 animate-spin text-blue-500"});var Z=p(Q,2),ne=g(Z),le=p(q,2),oe=g(le);W(()=>{H(ne,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),H(oe,a(i).paused?"Resume Syncing":"Pause Syncing")}),L("click",le,d),b(C,T)},D=(C,T)=>{{var q=Z=>{var ne=Nc(),le=g(ne);vo(le,{class:"w-4 h-4 animate-spin text-blue-500"});var oe=p(le,2),Pe=g(oe),M=p(oe,2),B=g(M);W(()=>{H(Pe,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),H(B,a(i).paused?"Resume Discovery":"Pause Discovery")}),L("click",M,_),b(Z,ne)},Q=(Z,ne)=>{{var le=oe=>{var Pe=Ic(),M=p(g(Pe),2),B=g(M),ke=p(B,2);L("click",B,m),L("click",ke,x),b(oe,Pe)};j(Z,oe=>{a(i).phase==="idle"&&oe(le)},ne)}};j(C,Z=>{a(i).phase==="discovery"?Z(q):Z(Q,!1)},T)}};j(w,C=>{a(i).phase==="streaming"?C(P):C(D,!1)})}var z=p(w,2),J=g(z),I=g(J),K=p(J,2),ie=g(K),_e=p(K,2),we=g(_e),ve=p(_e,2),be=g(ve),xe=p(z,2);{var ye=C=>{var T=Fc();Dt(T,5,()=>a(n),q=>q.full_name,(q,Q)=>{var Z=Lc(),ne=g(Z),le=g(ne),oe=g(le),Pe=p(le,2),M=g(Pe),B=p(M);{var ke=pe=>{var Ee=Mc();b(pe,Ee)};j(B,pe=>{a(Q).has_discussions||pe(ke)})}Ln(ne,pe=>y(c,pe),()=>a(c));var Se=p(ne,2),tt=g(Se);$c(tt,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),W(()=>{H(oe,a(Q).full_name),H(M,`${(a(Q).has_messages?" | 💬 .messages":" | no messaging")??""} `)}),L("click",le,()=>O(a(Q))),L("click",Se,()=>h(a(Q).full_name)),b(q,Z)}),b(C,T)},U=C=>{var T=Gc();b(C,T)};j(xe,C=>{a(n).length>0?C(ye):C(U,!1)})}var ee=p(xe,2);{var Y=C=>{var T=Uc();b(C,T)};j(ee,C=>{a(r)&&C(Y)})}ar(I,()=>a(l),C=>y(l,C)),ar(ie,()=>a(u),C=>y(u,C)),ar(we,()=>a(f),C=>y(f,C)),ar(be,()=>a(v),C=>y(v,C)),b(e,S),He()}var Vc=E('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function qc(e){var t=Vc();b(e,t)}var Hc=E('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function Bc(e){var t=Hc();b(e,t)}var Wc=E('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function Kc(e){var t=Wc();b(e,t)}function es(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Yc=E('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),Qc=E('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Zc=E('<button type="button"><div><!></div> <!> </button>'),Xc=E('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">⋯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function eu(e,t){qe(t,!1);const[n,r]=Dr(),s=()=>on(rt,"$currentRoute",n),o=()=>on(Ps,"$filteredCount",n);let i=N(null),c=N(!1),l=N("");function u(){rt.set("settings")}function f(U){rt.set(U)}Ot.subscribe(U=>{y(i,U.user)});const v=[{id:"chats",icon:Sc,label:"Chats"},{id:"repos",icon:kc,label:"Repos"},{id:"calls",icon:Cc,label:"Calls"},{id:"contacts",icon:Pc,label:"Contacts"},{id:"notifications",icon:xc,label:"Notifs"}];function d(){y(c,!a(c))}function _(){y(c,!1)}Ye();var h=Xc(),m=g(h),x=g(m),O=g(x),S=p(O,2),w=g(S),P=g(w),D=p(w,2),z=g(D),J=p(x,2),I=p(J,2);{var K=U=>{var ee=Yc(),Y=g(ee),C=p(Y,6);Cl(ee,(T,q)=>es==null?void 0:es(T,q),()=>_),L("click",Y,u),L("click",C,function(...T){Qr==null||Qr.apply(this,T)}),b(U,ee)};j(I,U=>{a(c)&&U(K)})}var ie=p(m,2),_e=g(ie),we=p(ie,2);Dt(we,5,()=>v,Kn,(U,ee)=>{let Y=()=>a(ee).id,C=()=>a(ee).icon,T=()=>a(ee).label;var q=Zc();let Q;var Z=g(q),ne=g(Z);C()(ne,{class:"w-5 h-5"});var le=p(Z,2);{var oe=M=>{var B=Qc(),ke=g(B);W(()=>H(ke,o())),b(M,B)};j(le,M=>{Y()==="repos"&&a(l).trim()!==""&&M(oe)})}var Pe=p(le);W(M=>{Q=wn(q,1,"relative flex flex-col items-center text-xs focus:outline-none",null,Q,M),wn(Z,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===Y()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),H(Pe,` ${T()??""}`)},[()=>({"text-blue-600":s()===Y()})],dt),L("click",q,()=>f(Y())),b(U,q)});var ve=p(we,2),be=g(ve);{var xe=U=>{Dc(U,{})},ye=(U,ee)=>{{var Y=T=>{Jc(T,{get search(){return a(l)}})},C=(T,q)=>{{var Q=ne=>{qc(ne)},Z=(ne,le)=>{{var oe=M=>{Bc(M)},Pe=(M,B)=>{{var ke=Se=>{Kc(Se)};j(M,Se=>{s()==="notifications"&&Se(ke)},B)}};j(ne,M=>{s()==="contacts"?M(oe):M(Pe,!1)},le)}};j(T,ne=>{s()==="calls"?ne(Q):ne(Z,!1)},q)}};j(U,T=>{s()==="repos"?T(Y):T(C,!1)},ee)}};j(be,U=>{s()==="chats"?U(xe):U(ye,!1)})}W(()=>{var U,ee,Y,C;Bt(O,"src",(U=a(i))==null?void 0:U.avatar_url),H(P,((ee=a(i))==null?void 0:ee.name)||((Y=a(i))==null?void 0:Y.login)),H(z,`@${((C=a(i))==null?void 0:C.login)??""}`)}),L("click",J,d),Ze(_e,()=>a(l),U=>y(l,U)),b(e,h),He(),r()}var tu=E('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">←</button>'),nu=E('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Lr(e,t){qe(t,!1);let n=N(!1);function r(h){y(n,h.detail.open)}Ot.subscribe(h=>{h.user}),jr(()=>{const h=()=>{window.innerWidth>=768&&y(n,!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)}),Nr.subscribe(h=>{h&&window.innerWidth<768&&y(n,!1)}),Ye();var s=nu(),o=g(s),i=g(o);{var c=h=>{var m=tu();L("click",m,()=>y(n,!0)),b(h,m)};j(i,h=>{a(n)||h(c)})}var l=p(o,2);let u;var f=g(l);eu(f,{$$events:{toggle:r}});var v=p(l,2);let d;var _=g(v);Mt(_,t,"default",{}),W((h,m)=>{u=wn(l,1,"sidebar md:block svelte-scw01y",null,u,h),d=wn(v,1,"main w-full svelte-scw01y",null,d,m)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],dt),b(e,s),He()}var ru=E('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function su(e){Lr(e,{children:(t,n)=>{var r=ru();b(t,r)},$$slots:{default:!0}})}var ou=E('<button title="Save">💾</button>'),au=E('<button title="Edit">✏️</button>'),iu=E('<button title="Hide">🙈</button> <!>',1),lu=E('<button title="Reveal">👁️</button>'),cu=E('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),uu=E('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),fu=E('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),du=E('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),vu=E('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">🗑️</button></td></tr> <!>',1),pu=E('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),gu=E('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),hu=E('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">🔐 Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">➕ Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">💾 Add Credential</button></div></div>');function _u(e,t){qe(t,!1);let n=N({}),r=N({}),s=N(new Set),o=N(null),i=N(""),c=N("s3"),l=N({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),u=N({}),f=null;const v=localStorage.getItem("skygit_token");jr(async()=>{if(!v)return;const S=await Mr(v);y(n,S.secrets),f=S.sha});async function d(S){try{a(r)[S]||ge(r,a(r)[S]=await Cs(v,a(n)[S])),y(s,new Set(a(s)).add(S))}catch{alert("❌ Failed to decrypt.")}}function _(S){y(s,new Set([...a(s)].filter(w=>w!==S))),a(o)===S&&y(o,null)}function h(S){a(s).has(S)||y(s,new Set(a(s)).add(S)),y(o,S),y(u,{...a(r)[S]})}async function m(S){const w=await cs(v,a(u));ge(n,a(n)[S]=w),ge(r,a(r)[S]=a(u)),y(s,new Set(a(s)).add(S)),y(o,null),await zn(v,a(n),f)}async function x(S){confirm(`Are you sure you want to delete the credential for:
${S}?`)&&(delete a(n)[S],delete a(r)[S],y(s,new Set([...a(s)].filter(w=>w!==S))),a(o)===S&&y(o,null),await zn(v,a(n),f))}async function O(){if(!a(i)||!a(c))return;const S=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},w=await cs(v,S);ge(n,a(n)[a(i)]=w),ge(r,a(r)[a(i)]=S),y(s,new Set(a(s)).add(a(i))),y(i,""),y(c,"s3"),y(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await zn(v,a(n),f)}Ye(),Lr(e,{children:(S,w)=>{var P=hu(),D=p(g(P),2),z=p(g(D));Dt(z,5,()=>Object.entries(a(n)),Kn,(Y,C)=>{let T=()=>a(C)[0],q=()=>a(C)[1];var Q=vu(),Z=fe(Q),ne=g(Z),le=g(ne),oe=p(ne),Pe=g(oe),M=p(oe),B=g(M);{var ke=ce=>{var Ce=Ie();W(()=>H(Ce,a(r)[T()].type==="s3"?"S3":"Google Drive")),b(ce,Ce)},Se=ce=>{var Ce=Ie("?");b(ce,Ce)};j(B,ce=>{a(r)[T()]?ce(ke):ce(Se,!1)})}var tt=p(M),pe=g(tt);{var Ee=ce=>{var Ce=iu(),$t=fe(Ce),Yt=p($t,2);{var Gt=Ae=>{var Le=ou();L("click",Le,()=>m(T())),b(Ae,Le)},Pt=Ae=>{var Le=au();L("click",Le,()=>h(T())),b(Ae,Le)};j(Yt,Ae=>{a(o)===T()?Ae(Gt):Ae(Pt,!1)})}L("click",$t,()=>_(T())),b(ce,Ce)},gt=ce=>{var Ce=lu();L("click",Ce,()=>d(T())),b(ce,Ce)};j(pe,ce=>{a(s).has(T())?ce(Ee):ce(gt,!1)})}var Lt=p(pe,2),Ft=p(Z,2);{var Ct=ce=>{var Ce=du(),$t=g(Ce),Yt=g($t);{var Gt=Ae=>{var Le=uu(),Et=fe(Le),k=p(g(Et),2),$=g(k),R={},G=g($),V=p(Et,2);Dt(V,1,()=>Object.entries(a(u)),Kn,(te,re)=>{let X=()=>a(re)[0];var Fe=$e(),ht=fe(Fe);{var Ge=_t=>{var Ut=cu(),Qt=g(Ut),Zt=g(Qt),fn=p(Qt,2);W(()=>H(Zt,X())),Ze(fn,()=>a(u)[X()],dn=>ge(u,a(u)[X()]=dn)),b(_t,Ut)};j(ht,_t=>{X()!=="type"&&_t(Ge)})}b(te,Fe)}),W(()=>{R!==(R=a(u).type)&&($.value=($.__value=a(u).type)==null?"":a(u).type),H(G,a(u).type)}),b(Ae,Le)},Pt=Ae=>{var Le=fu(),Et=g(Le);W(k=>H(Et,`${k??""}
                                    `),[()=>JSON.stringify(a(r)[T()],null,2)],dt),b(Ae,Le)};j(Yt,Ae=>{a(o)===T()?Ae(Gt):Ae(Pt,!1)})}b(ce,Ce)};j(Ft,ce=>{a(s).has(T())&&ce(Ct)})}W(ce=>{H(le,T()),H(Pe,`${ce??""}...`)},[()=>q().slice(0,20)],dt),L("click",Lt,()=>x(T())),b(Y,Q)});var J=p(D,2),I=p(g(J),2),K=g(I),ie=p(g(K)),_e=p(K,2),we=p(g(_e));W(()=>{a(c),ss(()=>{})});var ve=g(we);ve.value=(ve.__value="s3")==null?"":"s3";var be=p(ve);be.value=(be.__value="google_drive")==null?"":"google_drive";var xe=p(I,2);{var ye=Y=>{var C=pu(),T=g(C),q=p(g(T)),Q=p(T,2),Z=p(g(Q)),ne=p(Q,2),le=p(g(ne));Ze(q,()=>a(l).accessKeyId,oe=>ge(l,a(l).accessKeyId=oe)),Ze(Z,()=>a(l).secretAccessKey,oe=>ge(l,a(l).secretAccessKey=oe)),Ze(le,()=>a(l).region,oe=>ge(l,a(l).region=oe)),b(Y,C)},U=(Y,C)=>{{var T=q=>{var Q=gu(),Z=g(Q),ne=p(g(Z)),le=p(Z,2),oe=p(g(le)),Pe=p(le,2),M=p(g(Pe));Ze(ne,()=>a(l).client_id,B=>ge(l,a(l).client_id=B)),Ze(oe,()=>a(l).client_secret,B=>ge(l,a(l).client_secret=B)),Ze(M,()=>a(l).refresh_token,B=>ge(l,a(l).refresh_token=B)),b(q,Q)};j(Y,q=>{a(c)==="google_drive"&&q(T)},C)}};j(xe,Y=>{a(c)==="s3"?Y(ye):Y(U,!1)})}var ee=p(xe,2);Ze(ie,()=>a(i),Y=>y(i,Y)),is(we,()=>a(c),Y=>y(c,Y)),L("click",ee,O),b(S,P)},$$slots:{default:!0}}),He()}var bu=E('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),yu=E('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),mu=E('<div class="p-4 space-y-3"><!></div>');function wu(e,t){qe(t,!1);const[n,r]=Dr(),s=()=>on(Es,"$selectedConversation",n),o=N(),i=N();ct(()=>s(),()=>{y(o,s())}),ct(()=>a(o),()=>{var v;y(i,((v=a(o))==null?void 0:v.messages)??[])}),ct(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),er(),Ye();var c=mu(),l=g(c);{var u=v=>{var d=$e(),_=fe(d);Dt(_,1,()=>a(i),h=>h.id||h.timestamp,(h,m)=>{var x=bu(),O=g(x),S=g(O),w=p(O,2),P=g(w),D=p(w,2),z=g(D);W(J=>{H(S,a(m).sender),H(P,a(m).content),H(z,J)},[()=>new Date(a(m).timestamp).toLocaleString()],dt),b(h,x)}),b(v,d)},f=v=>{var d=yu();b(v,d)};j(l,v=>{a(i).length>0?v(u):v(f,!1)})}b(e,c),He(),r()}const xn="https://api.github.com";async function Fr(e,t){var v;const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},r=`${xn}/repos/${t}/discussions`;let s=[];try{const d=await fetch(r,{headers:n});d.ok&&(s=await d.json())}catch{}const o=s.find(d=>d.title==="SkyGit Presence Channel");if(o)return o.number;const i=await fetch(`${xn}/repos/${t}/discussions/categories`,{headers:n});if(!i.ok)throw new Error("Failed to fetch discussion categories");const c=await i.json();if(!c.length)throw new Error("No discussion categories found in repository");const l=((v=c.find(d=>d.slug==="general"))==null?void 0:v.id)||c[0].id,u=await fetch(r,{method:"POST",headers:n,body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore.",category_id:l})});if(!u.ok)throw new Error("Failed to create presence discussion");return(await u.json()).number}function xu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function ku(e,t,n,r,s=null){const o=await Fr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},c=`${xn}/repos/${t}/discussions/${o}/comments`,l=new Date().toISOString();let u=l;const f=await fetch(c,{headers:i});let v=[];f.ok&&(v=await f.json());const d=v.find(m=>{try{const x=JSON.parse(m.body);return x.username===n&&x.session_id===r}catch{return!1}});if(d)try{const m=JSON.parse(d.body);m.join_timestamp&&(u=m.join_timestamp)}catch{}const _={username:n,session_id:r,join_timestamp:u,last_seen:l,signaling_info:s};let h=!1;if(d){let m;try{m=JSON.parse(d.body)}catch{m={}}const x=Math.abs(new Date(l)-new Date(m.last_seen));(!xu(m,_)||x>3e4)&&(h=!0)}if(d&&h){const m=`${c}/${d.id}`,x=await fetch(m,{method:"PATCH",headers:i,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] updated presence comment",x.status,x.statusText)}else if(!d){const m=await fetch(c,{method:"POST",headers:i,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] posted new presence comment",m.status,m.statusText)}for(const m of v)try{const x=JSON.parse(m.body);if(x.username===n&&x.session_id!==r){const O=`${c}/${m.id}`;await fetch(O,{method:"DELETE",headers:i}),console.log("[SkyGit][Presence] deleted old presence comment",m.id)}}catch{}}async function Su(e,t,n,r,s){const o=await Fr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},c=`${xn}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:i});if(!l.ok)return;const f=(await l.json()).find(v=>{try{const d=JSON.parse(v.body);return d.username===n&&d.session_id===r}catch{return!1}});if(f){let v;try{v=JSON.parse(f.body)}catch{v={}}v.pendingRemovalBy=s,v.pendingRemovalAt=new Date().toISOString();const d=`${c}/${f.id}`;await fetch(d,{method:"PATCH",headers:i,body:JSON.stringify({body:JSON.stringify(v)})}),console.log("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function Cu(e,t,n,r){const s=await Fr(e,t),o={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},i=`${xn}/repos/${t}/discussions/${s}/comments`,c=await fetch(i,{headers:o});if(!c.ok)return;const u=(await c.json()).find(f=>{try{const v=JSON.parse(f.body);return v.username===n&&v.session_id===r}catch{return!1}});if(u){let f;try{f=JSON.parse(u.body)}catch{f={}}if(f.pendingRemovalBy&&f.pendingRemovalAt&&Date.now()-new Date(f.pendingRemovalAt).getTime()>6e4){const d=`${i}/${u.id}`;await fetch(d,{method:"DELETE",headers:o}),console.log("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function $u(e,t){const n=await Fr(e,t),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},s=`${xn}/repos/${t}/discussions/${n}/comments`,o=await fetch(s,{headers:r});if(!o.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",o.status,o.statusText),[];const i=await o.json(),c=Date.now(),l=i.map(u=>{try{return JSON.parse(u.body)}catch{return null}}).filter(Boolean).filter(u=>u.last_seen&&c-new Date(u.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",l),l}async function xr(e,t,n,r,s=null){await ku(e,t,n,r,s)}async function Os(e,t){return await $u(e,t)}class Pu{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:u,onFileSendProgress:f}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=u,this.onFileSendProgress=f,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=f=>{if(f.target.readyState!==FileReader.DONE)return;const v=new Uint8Array(f.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(v)}),c++,i+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),i<t.size?u():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const u=()=>{const f=t.slice(i,i+r);l.readAsArrayBuffer(f)};u()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Te=at({}),ot=at([]);let he=null,Je=null,ut=null,rn=null,Ca=null,_n=null,In=null,lr={token:null,repoFullName:null,username:null};function Eu({_token:e,_repoFullName:t,_username:n,_sessionId:r}){lr.token===e&&lr.repoFullName===t&&lr.username===n||(lr={token:e,repoFullName:t,username:n},Ou(),Te.set({}),ot.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),ut=e,Je=t,he=n,rn=r,Os(ut,Je).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(i=>i.username!==he);ot.set(o),Ts(s),$a(),Pa(),kn(s,he)?Au():Ru()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function Au(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Je,"as",he,"session",rn),xr(ut,Je,he,rn),Ca=setInterval(()=>{xr(ut,Je,he,rn)},3e4),_n=setInterval(async()=>{const e=await Os(ut,Je);console.log("[SkyGit][Presence] [Leader] polled peers:",e),ot.set(e.filter(t=>t.username!==he)),Ts(e),$a(),Pa()},5e3)}function Ru(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Je,"as",he,"session",rn);const e=async()=>{const n=await Os(ut,Je);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),ot.set(n.filter(r=>r.username!==he)),Ts(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),_n=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Te.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&_n&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(_n),_n=null,t())})}function Ou(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(Ca),clearInterval(_n)}async function Ts(e){Te.update(t=>{const n={...t},r=Ds(e,he);if(he===r){for(const s of e)s.username!==he&&(n[s.username]||(n[s.username]={status:"connecting",conn:null},go(s,n)));Object.keys(n).forEach(s=>{s!==he&&(e.some(o=>o.username===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.username===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null},go(s,n))}return n});for(const t of e){if(t.username===he)continue;const n=Me(Te);n[t.username]&&n[t.username].status==="connected"||(Su(ut,Je,t.username,t.session_id,he),setTimeout(()=>{Cu(ut,Je,t.username,t.session_id)},6e4))}}function Ds(e,t){return e.map(r=>r.username).concat(t).sort()[0]}function kn(e,t){return Ds(e,t)===t}function Tu(e,t){if(!e||!e.conversationId||!e.content)return;xa(e.conversationId,Je,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=Me(ot);kn(n,he)&&(As(Je,e.conversationId),Te.update(r=>(Object.entries(r).forEach(([s,{conn:o}])=>{s!==t&&o&&o.dataChannel&&o.send({type:"chat",...e})}),r)))}function Du(e,t){e&&Array.isArray(e.onlinePeers)&&ot.set(e.onlinePeers)}function ju(e,t){!e||!e.subtype||Te.update(n=>{var s;const r=(s=n[t])==null?void 0:s.conn;return r&&typeof r.handleSignal=="function"&&r.handleSignal(e),n})}function po(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function go(e,t){const n=new Pu({token:ut,repoFullName:Je,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{xr(ut,Je,he,rn,r)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":Tu(r,e.username);break;case"presence":Du(r,e.username);break;case"signal":ju(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{po(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{po(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{xr(ut,Je,he,rn,r)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.username]={conn:n,status:"connected"},Te.set(t)}function $a(){const e=Me(ot);kn(e,he)?In||(In=setInterval(()=>{const n=Me(ot);kn(n,he)&&nr(()=>Promise.resolve().then(()=>Rs),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",ho)):In&&(clearInterval(In),In=null,window.removeEventListener("beforeunload",ho))}function ho(e){const t=Me(ot);kn(t,he)&&nr(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let _o=!1;function Pa(){const e=Me(ot),t=kn(e,he);t&&!_o&&nr(()=>Promise.resolve().then(()=>Rs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),_o=t}function vs(e,t){Te.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function Nu(e){Te.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var Iu=E('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function Mu(e,t){qe(t,!1);let n=Xe(t,"conversation",8),r=N("");function s(){var h;if(!a(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(r).trim(),timestamp:Date.now()};xa(n().id,n().repo,l);const f=(h=Me(Ot).user)==null?void 0:h.login,v=Me(ot),d=Ds(v,f),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};f===d?(Nu({type:"chat",..._}),As(n().repo,n().id)):vs(d,{type:"chat",..._}),y(r,"")}Ye();var o=Iu(),i=g(o),c=p(i,2);Ze(i,()=>a(r),l=>y(r,l)),L("keydown",i,l=>l.key==="Enter"&&s()),L("click",c,s),b(e,o),He()}var Lu=E(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),Fu=E('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),Gu=E('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),Uu=E('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),zu=E('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),Ju=E('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),Vu=E('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),qu=E('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),Hu=E('<button class="bg-yellow-100 border px-3 py-1 rounded">🔄 Change Screen Source</button>'),Bu=E("<span>🎤</span>"),Wu=E("<span>🔇</span>"),Ku=E("<span>📷</span>"),Yu=E("<span>🚫📷</span>"),Qu=E("<span>⏹️ Stop Recording</span>"),Zu=E("<span>⏺️ Start Recording</span>"),Xu=E('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>⏺️ Recording...</span></div>'),ef=E('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>⚠️ Peer is recording</span></div>'),tf=E('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">📎 Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),nf=E('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">×</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),rf=E('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),sf=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),of=E('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),af=E('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),lf=E('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function cf(e,t){qe(t,!1);const[n,r]=Dr(),s=()=>on(Te,"$peerConnections",n),o=()=>on(ot,"$onlinePeers",n);let i=N(null),c=N(!1),l=N(null),u=N(null),f=null,v=N(!1),d=N(null),_=null,h=N(!1),m=N(null),x=N(!1),O=N(!0),S=N(!0),w=N(!0),P=N(!0),D=N(!0),z=N(!1),J=N(!1),I=null,K=[],ie=N({x:0,y:0}),_e=!1,we={x:0,y:0},ve=N(),be=N(null),xe=N(!1),ye=N(),U=N(),ee=N();function Y(){y(x,!0)}function C(){y(x,!1)}function T(k){y(x,!1),pe(!0,k)}function q(k){_e=!0,we={x:k.clientX-a(ie).x,y:k.clientY-a(ie).y},document.addEventListener("mousemove",Q),document.addEventListener("mouseup",Z)}function Q(k){_e&&(ge(ie,a(ie).x=k.clientX-we.x),ge(ie,a(ie).y=k.clientY-we.y))}function Z(){_e=!1,document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Z)}function ne(){y(O,!1)}function le(){y(O,!0)}function oe(){y(be,null),y(xe,!1)}async function Pe(){let k=a(i)&&a(i).repo,$=Me(ds).decrypted,R=null,G=null,V=null,te=null;if(k&&window.selectedRepo&&window.selectedRepo.config){const X=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;X&&$[X]&&($[X].type==="s3"&&(R=$[X]),$[X].type==="google_drive"&&(G=$[X]))}for(const X in $)$[X].type==="s3"&&!R&&(V=$[X]),$[X].type==="google_drive"&&!G&&(te=$[X]);const re=[];return(R||V)&&re.push("s3"),(G||te)&&re.push("google_drive"),re.length===2?(y(xe,!0),new Promise(X=>{const Fe=setInterval(()=>{a(be)&&(y(xe,!1),clearInterval(Fe),X(a(be)))},100)})):re.length===1?re[0]:null}Te.subscribe(k=>{Object.keys(k).filter($=>k[$].status==="connected").map($=>({username:$}))});let M=N(!1),B=N("");async function ke(k){const $=localStorage.getItem("skygit_token");if(!$||!k)return null;try{const R=await fetch(`https://api.github.com/repos/${k}`,{headers:{Authorization:`token ${$}`}});if(R.ok){const G=await R.json();return St.update(V=>V.map(te=>te.full_name===k?{...te,has_discussions:G.has_discussions}:te)),G.has_discussions}}catch(R){console.warn("Failed to refresh Discussions status",R)}return null}Nr.subscribe(k=>{var te;console.log("[SkyGit][Presence] currentContent changed:",k),y(i,k),y(M,!1),y(B,"");const $=localStorage.getItem("skygit_token"),R=Me(Ot),G=((te=R==null?void 0:R.user)==null?void 0:te.login)||null,V=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",R),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",G,"repo",V,"selectedConversation",a(i)),$&&G&&V&&Eu({_token:$,_repoFullName:V,_username:G,_sessionId:crypto.randomUUID()}),a(i)&&a(i).repo){const re=ma(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&ke(a(i).repo).then(X=>{X?y(M,!1):y(M,!0)})}});function Se(){y(c,!1),f=null,a(l)&&(a(l).getTracks().forEach(k=>k.stop()),y(l,null)),y(u,null),f&&vs(f,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function tt(k){const $=k.target.files[0];!$||!a(c)||!f||Te.update(R=>{var V;const G=(V=R[f])==null?void 0:V.conn;return G&&typeof G.sendFile=="function"&&G.sendFile($),R})}async function pe(k=!0,$="screen"){try{let R={video:!0,audio:k};$==="tab"?R={video:{displaySurface:"browser",cursor:"always"},audio:k}:$==="window"?R={video:{displaySurface:"window",cursor:"always"},audio:k}:$==="screen"&&(R={video:{displaySurface:"monitor",cursor:"always"},audio:k}),y(d,await navigator.mediaDevices.getDisplayMedia(R)),y(v,!0),Te.update(G=>{var te;const V=(te=G[f])==null?void 0:te.conn;return V&&V.replaceVideoTrack&&(V.replaceVideoTrack(a(d).getVideoTracks()[0]),V.sendScreenShareSignal&&V.sendScreenShareSignal(!0,{audio:k})),G}),y(l,a(d)),a(d).getVideoTracks()[0].onended=Ee}catch(R){console.error("Screen share error:",R)}}function Ee(){a(d)&&(a(d).getTracks().forEach(k=>k.stop()),y(d,null)),y(v,!1),Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.replaceVideoTrack,k}),y(l,_)}async function gt(){if(a(v))try{const k=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Te.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.replaceVideoTrack&&R.replaceVideoTrack(k.getVideoTracks()[0]),$}),a(d)&&a(d).getTracks().forEach($=>$.stop()),y(d,k),y(l,k),k.getVideoTracks()[0].onended=Ee}catch(k){console.error("Change screen source error:",k)}}function Lt(){y(S,!a(S)),a(l)&&a(l).getAudioTracks().forEach(k=>k.enabled=a(S)),Ct()}function Ft(){y(w,!a(w)),a(l)&&a(l).getVideoTracks().forEach(k=>k.enabled=a(w)),Ct()}function Ct(){Te.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.send&&$.send({type:"media-status",micOn:a(S),cameraOn:a(w)}),k})}function ce(k){Te.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.send&&R.send({type:"recording-status",recording:k}),$})}function Ce(){a(l)&&(K=[],I=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),I.ondataavailable=k=>{k.data.size>0&&K.push(k.data)},I.onstop=Yt,I.start(),y(z,!0),ce(!0))}function $t(){I&&a(z)&&(I.stop(),y(z,!1),ce(!1))}async function Yt(){const k=new Blob(K,{type:"video/webm"});await Pt(k)}typeof window<"u"&&(window.skygitOnRecordingStatus=k=>{y(J,!!k.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(k,$)=>{y(h,k),y(m,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=k=>{typeof k.micOn=="boolean"&&y(P,k.micOn),typeof k.cameraOn=="boolean"&&y(D,k.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(k,$,R)=>{k.name,$===R&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(k,$,R)=>{$===R&&setTimeout(()=>{},2e3)});async function Gt(k,$){const R=`skygit-recording-${Date.now()}.webm`,G=$.bucket,V=$.region;if(!G||!V)return alert("S3 credential missing bucket or region."),null;const te=$.endpoint||`https://${G}.s3.${V}.amazonaws.com/${R}`;return(await fetch(te,{method:"PUT",headers:{"Content-Type":"video/webm"},body:k})).ok?te.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function Pt(k){let $=Me(ds).decrypted,R=a(i)&&a(i).repo,G=null,V=null,te=null,re=null;if(R&&window.selectedRepo&&window.selectedRepo.config){const Ge=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Ge&&$[Ge]&&($[Ge].type==="s3"&&(G=$[Ge]),$[Ge].type==="google_drive"&&(V=$[Ge]))}for(const Ge in $)$[Ge].type==="s3"&&!G&&(te=$[Ge]),$[Ge].type==="google_drive"&&!V&&(re=$[Ge]);let X=null,Fe=await Pe();if(!Fe){alert("No upload destination (S3 or Google Drive) configured.");return}Fe==="s3"&&(X=G||te),Fe==="google_drive"&&(X=V||re);let ht=null;Fe==="s3"?ht=await Gt(k,X):Fe==="google_drive"&&(ht=await Ae(k,X)),ht&&(vs(f,{type:"chat",content:`📹 Recording: ${ht}`}),alert("Recording uploaded and link shared!"))}async function Ae(k,$){let R;try{R=await Le($)}catch(ht){return alert("Google Drive authentication failed: "+ht.message),null}const G={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},V=new FormData;V.append("metadata",new Blob([JSON.stringify(G)],{type:"application/json"})),V.append("file",k);const te=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+R},body:V});if(!te.ok)return alert("Failed to upload to Google Drive"),null;const re=await te.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+R,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Fe=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+R}})).json();return Fe.webViewLink||Fe.webContentLink}async function Le(k){const $=new URLSearchParams;$.append("client_id",k.client_id),$.append("client_secret",k.client_secret),$.append("refresh_token",k.refresh_token),$.append("grant_type","refresh_token");const R=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!R.ok)throw new Error("Failed to get Google access token");return(await R.json()).access_token}function Et(){var te;const k=localStorage.getItem("skygit_token"),$=Me(Ot),R=((te=$==null?void 0:$.user)==null?void 0:te.login)||null,G=a(i)?a(i).repo:null,V=window.skygitSessionId;k&&R&&G&&V&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:k,repoFullName:G,username:R,sessionId:V})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",Et),ct(()=>(a(ye),a(l)),()=>{a(ye)&&a(l)&&ge(ye,a(ye).srcObject=a(l))}),ct(()=>(a(U),a(u)),()=>{a(U)&&a(u)&&ge(U,a(U).srcObject=a(u))}),ct(()=>(a(ee),a(d)),()=>{a(ee)&&a(d)&&ge(ee,a(ee).srcObject=a(d))}),er(),Ye(),Lr(e,{children:(k,$)=>{var R=$e(),G=fe(R);{var V=re=>{var X=$e(),Fe=fe(X);{var ht=_t=>{var Ut=Lu(),Qt=g(Ut),Zt=p(g(Qt),4),fn=p(Zt,2),dn=g(fn),Gr=p(dn,2);W(()=>Bt(Zt,"href",a(B))),L("click",dn,()=>y(M,!1)),L("click",Gr,async()=>{await ke(a(i).repo)}),b(_t,Ut)},Ge=_t=>{var Ut=af(),Qt=g(Ut),Zt=g(Qt),fn=g(Zt),dn=g(fn),Gr=p(fn,2),Ea=g(Gr),js=p(Zt,2),Aa=g(js),Ra=p(js,2),Ns=g(Ra);{var Oa=ue=>{var Re=$e(),bt=fe(Re);Dt(bt,1,()=>a(i).participants,Be=>Be,(Be,me)=>{var je=$e(),Ue=fe(je);{var Rn=it=>{var yt=Fu();b(it,yt)},vn=it=>{var yt=$e(),Ur=fe(yt);{var zr=zt=>{var Xt=$e(),On=fe(Xt);{var pn=Ne=>{var lt=Gu(),Tn=p(g(lt));W(()=>H(Tn,` ${a(me)??""}`)),b(Ne,lt)},mt=Ne=>{var lt=Uu(),Tn=p(g(lt));W(()=>H(Tn,` ${a(me)??""}`)),b(Ne,lt)};j(On,Ne=>{s()[a(me)].status==="connected"?Ne(pn):Ne(mt,!1)})}b(zt,Xt)},Jr=(zt,Xt)=>{{var On=mt=>{var Ne=zu(),lt=p(g(Ne));W(()=>H(lt,` ${a(me)??""}`)),b(mt,Ne)},pn=mt=>{var Ne=Ju(),lt=p(g(Ne));W(()=>H(lt,` ${a(me)??""}`)),b(mt,Ne)};j(zt,mt=>{o().find(Ne=>Ne.username===a(me))?mt(On):mt(pn,!1)},Xt)}};j(Ur,zt=>{s()[a(me)]?zt(zr):zt(Jr,!1)})}b(it,yt)};j(Ue,it=>{a(me)===Me(Ot).user.login?it(Rn):it(vn,!1)})}b(Be,je)}),b(ue,Re)};j(Ns,ue=>{a(i).participants&&ue(Oa)})}var Ta=p(Ns,2);{var Da=ue=>{var Re=Vu();L("click",Re,Se),b(ue,Re)};j(Ta,ue=>{a(c)&&ue(Da)})}var Is=p(Qt,2);{var ja=ue=>{var Re=tf(),bt=fe(Re),Be=g(bt),me=p(g(Be),2);me.muted=!0,Ln(me,A=>y(ye,A),()=>a(ye));var je=p(me,2),Ue=g(je),Rn=g(Ue);{var vn=A=>{var F=Ie("🎤 Mic On");b(A,F)},it=A=>{var F=Ie("🔇 Mic Off");b(A,F)};j(Rn,A=>{a(S)?A(vn):A(it,!1)})}var yt=p(Ue,2),Ur=g(yt);{var zr=A=>{var F=Ie("📷 Cam On");b(A,F)},Jr=A=>{var F=Ie("🚫📷 Cam Off");b(A,F)};j(Ur,A=>{a(w)?A(zr):A(Jr,!1)})}var zt=p(Be,2),Xt=p(g(zt),2);Ln(Xt,A=>y(U,A),()=>a(U));var On=p(Xt,2),pn=g(On),mt=g(pn);{var Ne=A=>{var F=Ie("🎤 Mic On");b(A,F)},lt=A=>{var F=Ie("🔇 Mic Off");b(A,F)};j(mt,A=>{a(P)?A(Ne):A(lt,!1)})}var Tn=p(pn,2),Ua=g(Tn);{var za=A=>{var F=Ie("📷 Cam On");b(A,F)},Ja=A=>{var F=Ie("🚫📷 Cam Off");b(A,F)};j(Ua,A=>{a(D)?A(za):A(Ja,!1)})}var Us=p(bt,2);{var Va=A=>{var F=qu(),li=g(F),ci=p(g(li));{var ui=Hr=>{var or=Ie("(with audio)");b(Hr,or)};j(ci,Hr=>{var or;(or=a(m))!=null&&or.audio&&Hr(ui)})}b(A,F)};j(Us,A=>{a(h)&&A(Va)})}var zs=p(Us,2),Js=g(zs),qa=p(g(Js)),Vr=p(Js,2),Ha=g(Vr);{var Ba=A=>{var F=Ie("🛑 Stop Sharing");b(A,F)},Wa=A=>{var F=Ie("🖥️ Share Screen");b(A,F)};j(Ha,A=>{a(v)?A(Ba):A(Wa,!1)})}var Vs=p(Vr,2);{var Ka=A=>{var F=Hu();L("click",F,gt),b(A,F)};j(Vs,A=>{a(v)&&A(Ka)})}var rr=p(Vs,2),Ya=g(rr);{var Qa=A=>{var F=Bu();b(A,F)},Za=A=>{var F=Wu();b(A,F)};j(Ya,A=>{a(S)?A(Qa):A(Za,!1)})}var sr=p(rr,2),Xa=g(sr);{var ei=A=>{var F=Ku();b(A,F)},ti=A=>{var F=Yu();b(A,F)};j(Xa,A=>{a(w)?A(ei):A(ti,!1)})}var qr=p(sr,2),ni=g(qr);{var ri=A=>{var F=Qu();b(A,F)},si=A=>{var F=Zu();b(A,F)};j(ni,A=>{a(z)?A(ri):A(si,!1)})}var qs=p(zs,2);{var oi=A=>{var F=Xu();b(A,F)};j(qs,A=>{a(z)&&A(oi)})}var ai=p(qs,2);{var ii=A=>{var F=ef();b(A,F)};j(ai,A=>{a(J)&&A(ii)})}W(()=>{Bt(rr,"title",a(S)?"Mute Mic":"Unmute Mic"),Bt(sr,"title",a(w)?"Turn Off Camera":"Turn On Camera"),Bt(qr,"title",a(z)?"Stop Recording":"Start Recording")}),L("change",qa,tt),L("click",Vr,function(...A){var F;(F=a(v)?Ee:Y)==null||F.apply(this,A)}),L("click",rr,Lt),L("click",sr,Ft),L("click",qr,function(...A){var F;(F=a(z)?$t:Ce)==null||F.apply(this,A)}),b(ue,Re)};j(Is,ue=>{a(c)&&ue(ja)})}var Ms=p(Is,2);{var Na=ue=>{var Re=$e(),bt=fe(Re);{var Be=je=>{var Ue=nf(),Rn=g(Ue),vn=g(Rn),it=p(vn,4);it.muted=!0,Ln(it,yt=>y(ee,yt),()=>a(ee)),Ln(Ue,yt=>y(ve,yt),()=>a(ve)),W(()=>ea(Ue,`left: ${a(ie).x??""}px; top: ${a(ie).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),L("click",vn,Dl(ne)),L("mousedown",Ue,q),b(je,Ue)},me=je=>{var Ue=rf();L("click",Ue,le),b(je,Ue)};j(bt,je=>{a(O)?je(Be):je(me,!1)})}b(ue,Re)};j(Ms,ue=>{a(v)&&a(d)&&ue(Na)})}var Ls=p(Ms,2);{var Ia=ue=>{var Re=sf(),bt=g(Re),Be=p(g(bt),2),me=p(Be,2),je=p(me,2),Ue=p(je,2);L("click",Be,()=>T("screen")),L("click",me,()=>T("window")),L("click",je,()=>T("tab")),L("click",Ue,C),b(ue,Re)};j(Ls,ue=>{a(x)&&ue(Ia)})}var Fs=p(Ls,2);{var Ma=ue=>{var Re=of(),bt=g(Re),Be=p(g(bt),2),me=p(Be,2),je=p(me,2);L("click",Be,()=>{y(be,"google_drive")}),L("click",me,()=>{y(be,"s3")}),L("click",je,oe),b(ue,Re)};j(Fs,ue=>{a(xe)&&ue(Ma)})}var Gs=p(Fs,2),La=g(Gs);wu(La,{get conversation(){return a(i)}});var Fa=p(Gs,2),Ga=g(Fa);Mu(Ga,{get conversation(){return a(i)}}),W(()=>{var ue;H(dn,a(i).title),H(Ea,a(i).repo),H(Aa,`${((ue=a(i).participants)==null?void 0:ue.length)??0} participants`)}),b(_t,Ut)};j(Fe,_t=>{a(M)?_t(ht):_t(Ge,!1)})}b(re,X)},te=re=>{var X=lf();b(re,X)};j(G,re=>{a(i)?re(V):re(te,!1)})}b(k,R)},$$slots:{default:!0}}),He(),r()}var uf=E('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function ff(e,t){qe(t,!1);const n=Ll();let r=N("");function s(){if(!a(r).trim()){alert("Title is required.");return}n("create",{title:a(r).trim()}),y(r,"")}function o(){n("cancel")}Ye();var i=uf(),c=g(i),l=p(g(c),2),u=p(l,2),f=g(u),v=p(f,2);Ze(l,()=>a(r),d=>y(r,d)),L("click",f,o),L("click",v,s),b(e,i),He()}var df=E('<span class="text-green-700 font-semibold">✅ Enabled</span>'),vf=E("<span> </span>"),pf=E('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),gf=Zo('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),hf=E('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),_f=E('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>💬 New Conversation (Enable Discussions first)</button></div>'),bf=E("<option> </option>"),yf=E('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">🛠️ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>— Select a credential —</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💾 Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💬 New Conversation</button> <!>',1),mf=E('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),wf=E('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function xf(e,t){qe(t,!1);let n=N([]),r=N(),s=N(!1),o=N(!1),i=N(""),c;mr.subscribe(h=>y(r,h)),jr(async()=>{const h=localStorage.getItem("skygit_token");if(h)try{const{secrets:m}=await Mr(h),x=Object.keys(m),O=[];for(const S of x)try{const w=await Cs(h,m[S]);O.push({url:S,...w})}catch(w){console.warn("Failed to decrypt",S,w)}y(n,O)}catch(m){console.warn("Could not load secrets",m)}});async function l(){const h=localStorage.getItem("skygit_token");if(!(!a(r)||!h)){y(s,!0);try{await va(h,a(r)),ge(r,a(r).has_messages=!0),nr(async()=>{const{selectedRepo:m}=await Promise.resolve().then(()=>Kl);return{selectedRepo:m}},void 0).then(({selectedRepo:m})=>{m.set({...a(r)})})}catch(m){alert("Failed to activate messaging."),console.warn(m)}finally{y(s,!1)}}}async function u(){const h=localStorage.getItem("skygit_token");if(!(!h||!a(r)))try{await pa(h,a(r)),alert("✅ Messaging config updated.");try{await ga(h,a(r))}catch(m){alert("❌ Failed to store credential."),console.warn(m)}}catch(m){alert("❌ Failed to update config."),console.warn(m)}}async function f(h){const m=h.detail.title,x=localStorage.getItem("skygit_token");console.log("[SkyGit] 🧪 handleCreate() called with title:",m),await ic(x,a(r),m),y(o,!1)}function v(){y(o,!1)}function d(){if(!a(r))return;const h=`https://github.com/${a(r).full_name}/settings/discussions`;window.open(h,"_blank")}async function _(){const h=localStorage.getItem("skygit_token");if(!h||!a(r))return;const m=await fetch(`https://api.github.com/repos/${a(r).full_name}`,{headers:{Authorization:`token ${h}`}});if(m.ok){const x=await m.json(),O=!a(r).has_discussions;ge(r,a(r).has_discussions=x.has_discussions),mr.set({...a(r)}),St.update(S=>S.map(w=>w.full_name===a(r).full_name?{...a(r)}:w)),await sl(),O&&a(r).has_discussions?y(i,"✅ Discussions enabled! You can now use messaging."):a(r).has_discussions?y(i,""):y(i,"❌ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{y(i,"")},4e3)}}Ye(),Lr(e,{children:(h,m)=>{var x=$e(),O=fe(x);{var S=P=>{var D=mf(),z=g(D),J=g(z),I=p(z,2),K=g(I),ie=p(g(K)),_e=p(K,2),we=p(g(_e)),ve=p(_e,2),be=p(g(ve),2),xe=g(be),ye=p(ve,2),U=p(g(ye)),ee=p(ye,2),Y=p(g(ee)),C=p(ee,2),T=p(g(C),2);{var q=M=>{var B=df();b(M,B)},Q=M=>{var B=pf(),ke=p(fe(B),2),Se=p(ke,2),tt=p(Se,2);{var pe=Ee=>{var gt=vf();let Lt;var Ft=g(gt);W(Ct=>{Lt=wn(gt,1,"ml-2 text-xs font-semibold",null,Lt,Ct),H(Ft,a(i))},[()=>({"text-green-700":a(i).startsWith("✅"),"text-red-600":a(i).startsWith("❌")})],dt),b(Ee,gt)};j(tt,Ee=>{a(i)&&Ee(pe)})}L("click",ke,d),L("click",Se,_),b(M,B)};j(T,M=>{a(r).has_discussions?M(q):M(Q,!1)})}var Z=p(I,2);{var ne=M=>{var B=hf(),ke=g(B);{var Se=pe=>{var Ee=gf();b(pe,Ee)},tt=pe=>{var Ee=Ie("💬 Activate Messaging");b(pe,Ee)};j(ke,pe=>{a(s)?pe(Se):pe(tt,!1)})}W(()=>B.disabled=a(s)),L("click",B,l),b(M,B)};j(Z,M=>{a(r).has_messages||M(ne)})}var le=p(Z,2);{var oe=M=>{var B=_f();b(M,B)},Pe=(M,B)=>{{var ke=Se=>{var tt=yf(),pe=fe(tt),Ee=p(g(pe),2),gt=g(Ee),Lt=p(g(gt)),Ft=p(gt,2),Ct=p(g(Ft));W(()=>{a(r),ss(()=>{})});var ce=g(Ct);ce.value=(ce.__value="gitfs")==null?"":"gitfs";var Ce=p(ce);Ce.value=(Ce.__value="s3")==null?"":"s3";var $t=p(Ce);$t.value=($t.__value="google_drive")==null?"":"google_drive";var Yt=p(Ft,2),Gt=p(g(Yt));W(()=>{a(r),ss(()=>{a(n)})});var Pt=g(Gt);Pt.value=((Pt.__value="")==null,"");var Ae=p(Pt);Dt(Ae,1,()=>a(n).filter(R=>R.type===a(r).config.binary_storage_type),Kn,(R,G)=>{var V=bf(),te={},re=g(V);W(()=>{te!==(te=a(G).url)&&(V.value=(V.__value=a(G).url)==null?"":a(G).url),H(re,a(G).url)}),b(R,V)});var Le=p(Ee,2),Et=p(pe,2),k=p(Et,2);{var $=R=>{ff(R,{$$events:{create:f,cancel:v}})};j(k,R=>{a(o)&&R($)})}Ze(Lt,()=>a(r).config.commit_frequency_min,R=>ge(r,a(r).config.commit_frequency_min=R)),is(Ct,()=>a(r).config.binary_storage_type,R=>ge(r,a(r).config.binary_storage_type=R)),is(Gt,()=>a(r).config.storage_info.url,R=>ge(r,a(r).config.storage_info.url=R)),L("click",Le,u),L("click",Et,()=>y(o,!0)),b(Se,tt)};j(M,Se=>{a(r).has_messages&&a(r).config&&Se(ke)},B)}};j(le,M=>{a(r).has_discussions?M(Pe,!1):M(oe)})}W(()=>{H(J,a(r).full_name),H(ie,` ${a(r).name??""}`),H(we,` ${a(r).owner??""}`),Bt(be,"href",a(r).url),H(xe,a(r).url),H(U,` ${(a(r).private?"🔒 Private":"🌐 Public")??""}`),H(Y,` ${(a(r).has_messages?"💬 Available":"🚫 Not enabled")??""}`)}),b(P,D)},w=P=>{var D=wf();b(P,D)};j(O,P=>{a(r)?P(S):P(w,!1)})}b(h,x)},$$slots:{default:!0}}),He()}var kf=E('<p class="text-center mt-20">Loading...</p>');function Sf(e,t){qe(t,!1);const[n,r]=Dr(),s=()=>on(rt,"$currentRoute",n),o=()=>on(De,"$syncState",n);let i=N(null),c=null,l=N("");Ot.subscribe(O=>{O.isLoggedIn||(rt.set("login"),y(i,null),c=null)}),jr(()=>{const O=Zl();O?u(O):rt.set("login")});async function u(O){y(l,"");const S=await Yl(O);if(!S){localStorage.removeItem("skygit_token"),y(l,"Invalid token. Please check your PAT and try again."),rt.set("login");return}y(i,O),c=S,Ql(O),Ot.set({isLoggedIn:!0,token:a(i),user:c}),await ca(a(i),c.login)?(rt.set("home"),await d()):rt.set("consent")}async function f(){await ua(a(i)),rt.set("home"),await d()}function v(){localStorage.removeItem("skygit_token"),rt.set("login")}async function d(){try{console.log("[SkyGit] Initializing app state..."),await uc(a(i))}catch(O){console.warn("[SkyGit] Failed to initialize startup state:",O)}}window.addEventListener("beforeunload",O=>{(Sa()||ya())&&(wr(),Yn(),O.preventDefault(),O.returnValue="")}),ct(()=>(s(),o(),a(i)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{fs(a(i))}catch(O){console.warn("[SkyGit] Repo discovery failed:",O)}}),er(),Ye();var _=$e(),h=fe(_);{var m=O=>{var S=kf();b(O,S)},x=(O,S)=>{{var w=D=>{hc(D,{onSubmit:u,get error(){return a(l)}})},P=(D,z)=>{{var J=K=>{yc(K,{onApprove:f,onReject:v})},I=(K,ie)=>{{var _e=ve=>{_u(ve,{})},we=(ve,be)=>{{var xe=U=>{cf(U,{})},ye=(U,ee)=>{{var Y=T=>{xf(T,{})},C=T=>{su(T)};j(U,T=>{s()==="repos"?T(Y):T(C,!1)},ee)}};j(ve,U=>{s()==="chats"?U(xe):U(ye,!1)},be)}};j(K,ve=>{s()==="settings"?ve(_e):ve(we,!1)},ie)}};j(D,K=>{s()==="consent"?K(J):K(I,!1)},z)}};j(O,D=>{s()==="login"?D(w):D(P,!1)},S)}};j(h,O=>{s()==="loading"?O(m):O(x,!1)})}b(e,_),He(),r()}_l(Sf,{target:document.getElementById("app")});
