(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const ro=!1;var Nr=Array.isArray,$i=Array.prototype.indexOf,ks=Array.from,Mo=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,No=Object.getOwnPropertyDescriptors,Pi=Object.prototype,Ai=Array.prototype,Cs=Object.getPrototypeOf,so=Object.isExtensible;function Jn(e){return typeof e=="function"}const Pn=()=>{};function Ei(e){return e()}function Sr(e){for(var t=0;t<e.length;t++)e[t]()}const dt=2,Lo=4,Lr=8,$s=16,jt=32,In=64,kr=128,it=256,Cr=512,Qe=1024,Mt=2048,gn=4096,Rt=8192,Gr=16384,Ri=32768,Fr=65536,Go=1<<17,Oi=1<<19,Fo=1<<20,ds=1<<21,xt=Symbol("$state"),Uo=Symbol("legacy props"),Di=Symbol("");function zo(e){return e===this.v}function Ur(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Ii(e,t){return e!==t}function Ps(e){return!Ur(e,this.v)}function Ti(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ji(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Mi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ni(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Li(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Gi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Fi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ui(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Tn=!1,zi=!1;function Ji(){Tn=!0}const As=1,Es=2,Jo=4,qi=8,Vi=16,Hi=1,Bi=2,qo=4,Wi=8,Ki=16,Vo=1,Qi=2,Ue=Symbol(),Yi="http://www.w3.org/1999/xhtml",Zi="http://www.w3.org/2000/svg";function Rs(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let pe=null;function oo(e){pe=e}function Ve(e,t=!1,n){var r=pe={p:pe,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Tn&&!t&&(pe.l={s:null,u:null,r1:[],r2:En(!1)}),Os(()=>{r.d=!0})}function He(e){const t=pe;if(t!==null){const i=t.e;if(i!==null){var n=fe,r=ae;t.e=null;try{for(var s=0;s<i.length;s++){var o=i[s];Zt(o.effect),kt(o.reaction),Nn(o.fn)}}finally{Zt(n),kt(r)}}pe=t.p,t.m=!0}return{}}function jn(){return!Tn||pe!==null&&pe.l===null}function ln(e,t){if(typeof e!="object"||e===null||xt in e)return e;const n=Cs(e);if(n!==Pi&&n!==Ai)return e;var r=new Map,s=Nr(e),o=Ht(0),i=ae,c=l=>{var f=ae;kt(i);var d;return d=l(),kt(f),d};return s&&r.set("length",Ht(e.length)),new Proxy(e,{defineProperty(l,f,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Gi();var v=r.get(f);return v===void 0?(v=c(()=>Ht(d.value)),r.set(f,v)):y(v,c(()=>ln(d.value))),!0},deleteProperty(l,f){var d=r.get(f);if(d===void 0)f in l&&r.set(f,c(()=>Ht(Ue)));else{if(s&&typeof f=="string"){var v=r.get("length"),u=Number(f);Number.isInteger(u)&&u<v.v&&y(v,u)}y(d,Ue),ao(o)}return!0},get(l,f,d){var p;if(f===xt)return e;var v=r.get(f),u=f in l;if(v===void 0&&(!u||(p=Qt(l,f))!=null&&p.writable)&&(v=c(()=>Ht(ln(u?l[f]:Ue))),r.set(f,v)),v!==void 0){var _=a(v);return _===Ue?void 0:_}return Reflect.get(l,f,d)},getOwnPropertyDescriptor(l,f){var d=Reflect.getOwnPropertyDescriptor(l,f);if(d&&"value"in d){var v=r.get(f);v&&(d.value=a(v))}else if(d===void 0){var u=r.get(f),_=u==null?void 0:u.v;if(u!==void 0&&_!==Ue)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return d},has(l,f){var _;if(f===xt)return!0;var d=r.get(f),v=d!==void 0&&d.v!==Ue||Reflect.has(l,f);if(d!==void 0||fe!==null&&(!v||(_=Qt(l,f))!=null&&_.writable)){d===void 0&&(d=c(()=>Ht(v?ln(l[f]):Ue)),r.set(f,d));var u=a(d);if(u===Ue)return!1}return v},set(l,f,d,v){var S;var u=r.get(f),_=f in l;if(s&&f==="length")for(var p=d;p<u.v;p+=1){var w=r.get(p+"");w!==void 0?y(w,Ue):p in l&&(w=c(()=>Ht(Ue)),r.set(p+"",w))}u===void 0?(!_||(S=Qt(l,f))!=null&&S.writable)&&(u=c(()=>Ht(void 0)),y(u,c(()=>ln(d))),r.set(f,u)):(_=u.v!==Ue,y(u,c(()=>ln(d))));var k=Reflect.getOwnPropertyDescriptor(l,f);if(k!=null&&k.set&&k.set.call(v,d),!_){if(s&&typeof f=="string"){var $=r.get("length"),M=Number(f);Number.isInteger(M)&&M>=$.v&&y($,M+1)}ao(o)}return!0},ownKeys(l){a(o);var f=Reflect.ownKeys(l).filter(u=>{var _=r.get(u);return _===void 0||_.v!==Ue});for(var[d,v]of r)v.v!==Ue&&!(d in l)&&f.push(d);return f},setPrototypeOf(){Fi()}})}function ao(e,t=1){y(e,e.v+t)}function io(e){try{if(e!==null&&typeof e=="object"&&xt in e)return e[xt]}catch{}return e}function Xi(e,t){return Object.is(io(e),io(t))}const tr=new Map;function En(e,t){var n={f:0,v:e,reactions:null,equals:zo,rv:0,wv:0};return n}function Ht(e,t){const n=En(e);return fl(n),n}function j(e,t=!1){var r;const n=En(e);return t||(n.equals=Ps),Tn&&pe!==null&&pe.l!==null&&((r=pe.l).s??(r.s=[])).push(n),n}function Se(e,t){return y(e,Ye(()=>a(e))),t}function y(e,t,n=!1){ae!==null&&!bt&&jn()&&(ae.f&(dt|$s))!==0&&!(qe!=null&&qe.includes(e))&&Ui();let r=n?ln(t):t;return nr(e,r)}function nr(e,t){if(!e.equals(t)){var n=e.v;dr?tr.set(e,t):tr.set(e,n),e.v=t,e.wv=aa(),Ho(e,Mt),jn()&&fe!==null&&(fe.f&Qe)!==0&&(fe.f&(jt|In))===0&&(ot===null?dl([e]):ot.push(e))}return t}function lo(e,t=1){var n=a(e),r=t===1?n++:n--;return y(e,n),r}function Ho(e,t){var n=e.reactions;if(n!==null)for(var r=jn(),s=n.length,o=0;o<s;o++){var i=n[o],c=i.f;(c&Mt)===0&&(!r&&i===fe||(pt(i,t),(c&(Qe|it))!==0&&((c&dt)!==0?Ho(i,gn):Hr(i))))}}let el=!1;var co,Bo,Wo,Ko;function tl(){if(co===void 0){co=window,Bo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Wo=Qt(t,"firstChild").get,Ko=Qt(t,"nextSibling").get,so(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),so(n)&&(n.__t=void 0)}}function cr(e=""){return document.createTextNode(e)}function At(e){return Wo.call(e)}function zr(e){return Ko.call(e)}function h(e,t){return At(e)}function ve(e,t){{var n=At(e);return n instanceof Comment&&n.data===""?zr(n):n}}function g(e,t=1,n=!1){let r=e;for(;t--;)r=zr(r);return r}function nl(e){e.textContent=""}function rr(e){var t=dt|Mt,n=ae!==null&&(ae.f&dt)!==0?ae:null;return fe===null||n!==null&&(n.f&it)!==0?t|=it:fe.f|=Fo,{ctx:pe,deps:null,effects:null,equals:zo,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??fe}}function vt(e){const t=rr(e);return t.equals=Ps,t}function Qo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Dt(t[n])}}function rl(e){for(var t=e.parent;t!==null;){if((t.f&dt)===0)return t;t=t.parent}return null}function sl(e){var t,n=fe;Zt(rl(e));try{Qo(e),t=la(e)}finally{Zt(n)}return t}function Yo(e){var t=sl(e),n=(Kt||(e.f&it)!==0)&&e.deps!==null?gn:Qe;pt(e,n),e.equals(t)||(e.v=t,e.wv=aa())}function Zo(e){fe===null&&ae===null&&Mi(),ae!==null&&(ae.f&it)!==0&&fe===null&&ji(),dr&&Ti()}function ol(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Mn(e,t,n,r=!0){var s=fe,o={ctx:pe,deps:null,nodes_start:null,nodes_end:null,f:e|Mt,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Vr(o),o.f|=Ri}catch(l){throw Dt(o),l}else t!==null&&Hr(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(Fo|kr))===0;if(!i&&r&&(s!==null&&ol(o,s),ae!==null&&(ae.f&dt)!==0)){var c=ae;(c.effects??(c.effects=[])).push(o)}return o}function Os(e){const t=Mn(Lr,null,!1);return pt(t,Qe),t.teardown=e,t}function vs(e){Zo();var t=fe!==null&&(fe.f&jt)!==0&&pe!==null&&!pe.m;if(t){var n=pe;(n.e??(n.e=[])).push({fn:e,effect:fe,reaction:ae})}else{var r=Nn(e);return r}}function al(e){return Zo(),hn(e)}function il(e){const t=Mn(In,e,!0);return(n={})=>new Promise(r=>{n.outro?Rn(t,()=>{Dt(t),r(void 0)}):(Dt(t),r(void 0))})}function Nn(e){return Mn(Lo,e,!1)}function ut(e,t){var n=pe,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=hn(()=>{e(),!r.ran&&(r.ran=!0,y(n.l.r2,!0),Ye(t))})}function ur(){var e=pe;hn(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Qe)!==0&&pt(n,gn),Ln(n)&&Vr(n),t.ran=!1}e.l.r2.v=!1}})}function hn(e){return Mn(Lr,e,!0)}function Y(e,t=[],n=rr){const r=t.map(n);return fr(()=>e(...r.map(a)))}function fr(e,t=0){return Mn(Lr|$s|t,e,!0)}function dn(e,t=!0){return Mn(Lr|jt,e,!0,t)}function Xo(e){var t=e.teardown;if(t!==null){const n=dr,r=ae;fo(!0),kt(null);try{t.call(null)}finally{fo(n),kt(r)}}}function ea(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&In)!==0?n.parent=null:Dt(n,t),n=r}}function ll(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&jt)===0&&Dt(t),t=n}}function Dt(e,t=!0){var n=!1;if((t||(e.f&Oi)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:zr(r);r.remove(),r=o}n=!0}ea(e,t&&!n),Er(e,0),pt(e,Gr);var i=e.transitions;if(i!==null)for(const l of i)l.stop();Xo(e);var c=e.parent;c!==null&&c.first!==null&&ta(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function ta(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function Rn(e,t){var n=[];Ds(e,n,!0),na(n,()=>{Dt(e),t&&t()})}function na(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function Ds(e,t,n){if((e.f&Rt)===0){if(e.f^=Rt,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&Fr)!==0||(r.f&jt)!==0;Ds(r,t,o?n:!1),r=s}}}function sr(e){ra(e,!0)}function ra(e,t){if((e.f&Rt)!==0){e.f^=Rt,(e.f&Qe)===0&&(e.f^=Qe),Ln(e)&&(pt(e,Mt),Hr(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&Fr)!==0||(n.f&jt)!==0;ra(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let or=[],ps=[];function sa(){var e=or;or=[],Sr(e)}function cl(){var e=ps;ps=[],Sr(e)}function Jr(e){or.length===0&&queueMicrotask(sa),or.push(e)}function uo(){or.length>0&&sa(),ps.length>0&&cl()}let mr=!1,$r=!1,Pr=null,un=!1,dr=!1;function fo(e){dr=e}let Xn=[];let ae=null,bt=!1;function kt(e){ae=e}let fe=null;function Zt(e){fe=e}let qe=null;function ul(e){qe=e}function fl(e){ae!==null&&ae.f&ds&&(qe===null?ul([e]):qe.push(e))}let ze=null,et=0,ot=null;function dl(e){ot=e}let oa=1,Ar=0,Kt=!1,Wt=null;function aa(){return++oa}function Ln(e){var v;var t=e.f;if((t&Mt)!==0)return!0;if((t&gn)!==0){var n=e.deps,r=(t&it)!==0;if(n!==null){var s,o,i=(t&Cr)!==0,c=r&&fe!==null&&!Kt,l=n.length;if(i||c){var f=e,d=f.parent;for(s=0;s<l;s++)o=n[s],(i||!((v=o==null?void 0:o.reactions)!=null&&v.includes(f)))&&(o.reactions??(o.reactions=[])).push(f);i&&(f.f^=Cr),c&&d!==null&&(d.f&it)===0&&(f.f^=it)}for(s=0;s<l;s++)if(o=n[s],Ln(o)&&Yo(o),o.wv>e.wv)return!0}(!r||fe!==null&&!Kt)&&pt(e,Qe)}return!1}function vl(e,t){for(var n=t;n!==null;){if((n.f&kr)!==0)try{n.fn(e);return}catch{n.f^=kr}n=n.parent}throw mr=!1,e}function pl(e){return(e.f&Gr)===0&&(e.parent===null||(e.parent.f&kr)===0)}function qr(e,t,n,r){if(mr){if(n===null&&(mr=!1),pl(t))throw e;return}n!==null&&(mr=!0);{vl(e,t);return}}function ia(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];qe!=null&&qe.includes(e)||((o.f&dt)!==0?ia(o,t,!1):t===o&&(n?pt(o,Mt):(o.f&Qe)!==0&&pt(o,gn),Hr(o)))}}function la(e){var _;var t=ze,n=et,r=ot,s=ae,o=Kt,i=qe,c=pe,l=bt,f=e.f;ze=null,et=0,ot=null,Kt=(f&it)!==0&&(bt||!un||ae===null),ae=(f&(jt|In))===0?e:null,qe=null,oo(e.ctx),bt=!1,Ar++,e.f|=ds;try{var d=(0,e.fn)(),v=e.deps;if(ze!==null){var u;if(Er(e,et),v!==null&&et>0)for(v.length=et+ze.length,u=0;u<ze.length;u++)v[et+u]=ze[u];else e.deps=v=ze;if(!Kt)for(u=et;u<v.length;u++)((_=v[u]).reactions??(_.reactions=[])).push(e)}else v!==null&&et<v.length&&(Er(e,et),v.length=et);if(jn()&&ot!==null&&!bt&&v!==null&&(e.f&(dt|gn|Mt))===0)for(u=0;u<ot.length;u++)ia(ot[u],e);return s!==null&&(Ar++,ot!==null&&(r===null?r=ot:r.push(...ot))),d}finally{ze=t,et=n,ot=r,ae=s,Kt=o,qe=i,oo(c),bt=l,e.f^=ds}}function gl(e,t){let n=t.reactions;if(n!==null){var r=$i.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&dt)!==0&&(ze===null||!ze.includes(t))&&(pt(t,gn),(t.f&(it|Cr))===0&&(t.f^=Cr),Qo(t),Er(t,0))}function Er(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)gl(e,n[r])}function Vr(e){var t=e.f;if((t&Gr)===0){pt(e,Qe);var n=fe,r=pe,s=un;fe=e,un=!0;try{(t&$s)!==0?ll(e):ea(e),Xo(e);var o=la(e);e.teardown=typeof o=="function"?o:null,e.wv=oa;var i=e.deps,c;ro&&zi&&e.f&Mt}catch(l){qr(l,e,n,r||e.ctx)}finally{un=s,fe=n}}}function hl(){try{Ni()}catch(e){if(Pr!==null)qr(e,Pr,null);else throw e}}function ca(){var e=un;try{var t=0;for(un=!0;Xn.length>0;){t++>1e3&&hl();var n=Xn,r=n.length;Xn=[];for(var s=0;s<r;s++){var o=yl(n[s]);_l(o)}}}finally{$r=!1,un=e,Pr=null,tr.clear()}}function _l(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Gr|Rt))===0)try{Ln(r)&&(Vr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?ta(r):r.fn=null))}catch(s){qr(s,r,null,r.ctx)}}}function Hr(e){$r||($r=!0,queueMicrotask(ca));for(var t=Pr=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(In|jt))!==0){if((n&Qe)===0)return;t.f^=Qe}}Xn.push(t)}function yl(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(jt|In))!==0,o=s&&(r&Qe)!==0;if(!o&&(r&Rt)===0){if((r&Lo)!==0)t.push(n);else if(s)n.f^=Qe;else{var i=ae;try{ae=n,Ln(n)&&Vr(n)}catch(f){qr(f,n,null,n.ctx)}finally{ae=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function ml(e){var t;for(uo();Xn.length>0;)$r=!0,ca(),uo();return t}async function bl(){await Promise.resolve(),ml()}function a(e){var t=e.f,n=(t&dt)!==0;if(Wt!==null&&Wt.add(e),ae!==null&&!bt){if(!(qe!=null&&qe.includes(e))){var r=ae.deps;e.rv<Ar&&(e.rv=Ar,ze===null&&r!==null&&r[et]===e?et++:ze===null?ze=[e]:(!Kt||!ze.includes(e))&&ze.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&it)===0&&(s.f^=it)}return n&&(s=e,Ln(s)&&Yo(s)),dr&&tr.has(e)?tr.get(e):e.v}function wl(e){var t=Wt;Wt=new Set;var n=Wt,r;try{if(Ye(e),t!==null)for(r of Wt)t.add(r)}finally{Wt=t}return n}function gs(e){var t=wl(()=>Ye(e));for(var n of t)if((n.f&Go)!==0)for(const r of n.deps||[])(r.f&dt)===0&&nr(r,r.v);else nr(n,n.v)}function Ye(e){var t=bt;try{return bt=!0,e()}finally{bt=t}}const xl=-7169;function pt(e,t){e.f=e.f&xl|t}function Is(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(xt in e)hs(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&xt in n&&hs(n)}}}function hs(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{hs(e[r],t)}catch{}const n=Cs(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=No(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function Sl(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const kl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Cl(e){return kl.includes(e)}const $l={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Pl(e){return e=e.toLowerCase(),$l[e]??e}const Al=["touchstart","touchmove"];function El(e){return Al.includes(e)}function Rl(e,t){if(t){const n=document.body;e.autofocus=!0,Jr(()=>{document.activeElement===n&&e.focus()})}}let vo=!1;function Ol(){vo||(vo=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function ua(e){var t=ae,n=fe;kt(null),Zt(null);try{return e()}finally{kt(t),Zt(n)}}function Ts(e,t,n,r=n){e.addEventListener(t,()=>ua(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),Ol()}const fa=new Set,_s=new Set;function da(e,t,n,r={}){function s(o){if(r.capture||Wn.call(t,o),!o.cancelBubble)return ua(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Jr(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function N(e,t,n,r,s){var o={capture:r,passive:s},i=da(e,t,n,o);(t===document.body||t===window||t===document)&&Os(()=>{t.removeEventListener(e,i,o)})}function Dl(e){for(var t=0;t<e.length;t++)fa.add(e[t]);for(var n of _s)n(e)}function Wn(e){var M;var t=this,n=t.ownerDocument,r=e.type,s=((M=e.composedPath)==null?void 0:M.call(e))||[],o=s[0]||e.target,i=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=s.indexOf(t);if(f===-1)return;l<=f&&(i=l)}if(o=s[i]||e.target,o!==t){Mo(e,"currentTarget",{configurable:!0,get(){return o||n}});var d=ae,v=fe;kt(null),Zt(null);try{for(var u,_=[];o!==null;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var w=o["__"+r];if(w!=null&&(!o.disabled||e.target===o))if(Nr(w)){var[k,...$]=w;k.apply(o,[e,...$])}else w.call(o,e)}catch(S){u?_.push(S):u=S}if(e.cancelBubble||p===t||p===null)break;o=p}if(u){for(let S of _)queueMicrotask(()=>{throw S});throw u}}finally{e.__root=t,delete e.currentTarget,kt(d),Zt(v)}}}function va(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function vn(e,t){var n=fe;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function A(e,t){var n=(t&Vo)!==0,r=(t&Qi)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=va(o?e:"<!>"+e),n||(s=At(s)));var i=r||Bo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=At(i),l=i.lastChild;vn(c,l)}else vn(i,i);return i}}function pa(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Vo)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=va(o),l=At(c);if(s)for(i=document.createDocumentFragment();At(l);)i.appendChild(At(l));else i=At(l)}var f=i.cloneNode(!0);if(s){var d=At(f),v=f.lastChild;vn(d,v)}else vn(f,f);return f}}function Le(e=""){{var t=cr(e+"");return vn(t,t),t}}function Ae(){var e=document.createDocumentFragment(),t=document.createComment(""),n=cr();return e.append(t,n),vn(t,n),e}function m(e,t){e!==null&&e.before(t)}function K(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function Il(e,t){return Tl(e,t)}const kn=new Map;function Tl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:i=!0}){tl();var c=new Set,l=v=>{for(var u=0;u<v.length;u++){var _=v[u];if(!c.has(_)){c.add(_);var p=El(_);t.addEventListener(_,Wn,{passive:p});var w=kn.get(_);w===void 0?(document.addEventListener(_,Wn,{passive:p}),kn.set(_,1)):kn.set(_,w+1)}}};l(ks(fa)),_s.add(l);var f=void 0,d=il(()=>{var v=n??t.appendChild(cr());return dn(()=>{if(o){Ve({});var u=pe;u.c=o}s&&(r.$$events=s),f=e(v,r)||{},o&&He()}),()=>{var p;for(var u of c){t.removeEventListener(u,Wn);var _=kn.get(u);--_===0?(document.removeEventListener(u,Wn),kn.delete(u)):kn.set(u,_)}_s.delete(l),v!==n&&((p=v.parentNode)==null||p.removeChild(v))}});return jl.set(f,d),f}let jl=new WeakMap;function T(e,t,[n,r]=[0,0]){var s=e,o=null,i=null,c=Ue,l=n>0?Fr:0,f=!1;const d=(u,_=!0)=>{f=!0,v(_,u)},v=(u,_)=>{c!==(c=u)&&(c?(o?sr(o):_&&(o=dn(()=>_(s))),i&&Rn(i,()=>{i=null})):(i?sr(i):_&&(i=dn(()=>_(s,[n+1,r]))),o&&Rn(o,()=>{o=null})))};fr(()=>{f=!1,t(d),f||v(null,null)},l)}function Ml(e,t,n){var r=e,s=Ue,o,i=jn()?Ii:Ur;fr(()=>{i(s,s=t())&&(o&&Rn(o),o=dn(()=>n(r)))})}function ar(e,t){return t}function Nl(e,t,n,r){for(var s=[],o=t.length,i=0;i<o;i++)Ds(t[i].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;nl(l),l.append(n),r.clear(),Bt(e,t[0].prev,t[o-1].next)}na(s,()=>{for(var f=0;f<o;f++){var d=t[f];c||(r.delete(d.k),Bt(e,d.prev,d.next)),Dt(d.e,!c)}})}function It(e,t,n,r,s,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&Jo)!==0;if(l){var f=e;i=f.appendChild(cr())}var d=null,v=!1,u=vt(()=>{var _=n();return Nr(_)?_:_==null?[]:ks(_)});fr(()=>{var _=a(u),p=_.length;v&&p===0||(v=p===0,Ll(_,c,i,s,t,r,n),o!==null&&(p===0?d?sr(d):d=dn(()=>o(i)):d!==null&&Rn(d,()=>{d=null})),a(u))})}function Ll(e,t,n,r,s,o,i){var Ce,Re,$e,J;var c=(s&qi)!==0,l=(s&(As|Es))!==0,f=e.length,d=t.items,v=t.first,u=v,_,p=null,w,k=[],$=[],M,S,b,R;if(c)for(R=0;R<f;R+=1)M=e[R],S=o(M,R),b=d.get(S),b!==void 0&&((Ce=b.a)==null||Ce.measure(),(w??(w=new Set)).add(b));for(R=0;R<f;R+=1){if(M=e[R],S=o(M,R),b=d.get(S),b===void 0){var F=u?u.e.nodes_start:n;p=Fl(F,t,p,p===null?t.first:p.next,M,S,R,r,s,i),d.set(S,p),k=[],$=[],u=p.next;continue}if(l&&Gl(b,M,R,s),(b.e.f&Rt)!==0&&(sr(b.e),c&&((Re=b.a)==null||Re.unfix(),(w??(w=new Set)).delete(b))),b!==u){if(_!==void 0&&_.has(b)){if(k.length<$.length){var D=$[0],I;p=D.prev;var B=k[0],ee=k[k.length-1];for(I=0;I<k.length;I+=1)po(k[I],D,n);for(I=0;I<$.length;I+=1)_.delete($[I]);Bt(t,B.prev,ee.next),Bt(t,p,B),Bt(t,ee,D),u=D,p=ee,R-=1,k=[],$=[]}else _.delete(b),po(b,u,n),Bt(t,b.prev,b.next),Bt(t,b,p===null?t.first:p.next),Bt(t,p,b),p=b;continue}for(k=[],$=[];u!==null&&u.k!==S;)(u.e.f&Rt)===0&&(_??(_=new Set)).add(u),$.push(u),u=u.next;if(u===null)continue;b=u}k.push(b),p=b,u=b.next}if(u!==null||_!==void 0){for(var q=_===void 0?[]:ks(_);u!==null;)(u.e.f&Rt)===0&&q.push(u),u=u.next;var Q=q.length;if(Q>0){var me=(s&Jo)!==0&&f===0?n:null;if(c){for(R=0;R<Q;R+=1)($e=q[R].a)==null||$e.measure();for(R=0;R<Q;R+=1)(J=q[R].a)==null||J.fix()}Nl(t,q,me,d)}}c&&Jr(()=>{var re;if(w!==void 0)for(b of w)(re=b.a)==null||re.apply()}),fe.first=t.first&&t.first.e,fe.last=p&&p.e}function Gl(e,t,n,r){(r&As)!==0&&nr(e.v,t),(r&Es)!==0?nr(e.i,n):e.i=n}function Fl(e,t,n,r,s,o,i,c,l,f){var d=(l&As)!==0,v=(l&Vi)===0,u=d?v?j(s):En(s):s,_=(l&Es)===0?i:En(i),p={i:_,v:u,k:o,a:null,e:null,prev:n,next:r};try{return p.e=dn(()=>c(e,u,_,f),el),p.e.prev=n&&n.e,p.e.next=r&&r.e,n===null?t.first=p:(n.next=p,n.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function po(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var i=zr(o);s.before(o),o=i}}function Bt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Nt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>r:r)}function Ul(e,t,n,r,s,o){var i,c,l=null,f=e,d;fr(()=>{const v=t()||null;var u=Zi;v!==i&&(d&&(v===null?Rn(d,()=>{d=null,c=null}):v===c?sr(d):Dt(d)),v&&v!==c&&(d=dn(()=>{if(l=document.createElementNS(u,v),vn(l,l),r){var _=l.appendChild(cr());r(l,_)}fe.nodes_end=l,f.before(l)})),i=v,i&&(c=i))},Fr)}function zl(e,t,n){Nn(()=>{var r=Ye(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};hn(()=>{var i=n();Is(i),s&&Ur(o,i)&&(o=i,r.update(i))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function ga(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=ga(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Jl(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=ga(e))&&(r&&(r+=" "),r+=t);return r}function ql(e){return typeof e=="object"?Jl(e):e??""}const go=[...` 	
\r\f \v\uFEFF`];function Vl(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,i=0;(i=r.indexOf(s,i))>=0;){var c=i+o;(i===0||go.includes(r[i-1]))&&(c===r.length||go.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function ho(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function ss(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Hl(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(ss)),s&&l.push(...Object.keys(s).map(ss));var f=0,d=-1;const w=e.length;for(var v=0;v<w;v++){var u=e[v];if(c?u==="/"&&e[v-1]==="*"&&(c=!1):o?o===u&&(o=!1):u==="/"&&e[v+1]==="*"?c=!0:u==='"'||u==="'"?o=u:u==="("?i++:u===")"&&i--,!c&&o===!1&&i===0){if(u===":"&&d===-1)d=v;else if(u===";"||v===w-1){if(d!==-1){var _=ss(e.substring(f,d).trim());if(!l.includes(_)){u!==";"&&v++;var p=e.substring(f,v).trim();n+=" "+p+";"}}f=v+1,d=-1}}}}return r&&(n+=ho(r)),s&&(n+=ho(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function On(e,t,n,r,s,o){var i=e.__className;if(i!==n){var c=Vl(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var f=!!o[l];(s==null||f!==!!s[l])&&e.classList.toggle(l,f)}return o}function os(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function ha(e,t,n,r){var s=e.__style;if(s!==t){var o=Hl(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(os(e,n==null?void 0:n[0],r[0]),os(e,n==null?void 0:n[1],r[1],"important")):os(e,n,r));return r}const qn=Symbol("class"),Vn=Symbol("style"),_a=Symbol("is custom element"),ya=Symbol("is html");function Bl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Et(e,t,n,r){var s=ma(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[Di]=n),n==null?e.removeAttribute(t):typeof n!="string"&&ba(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function _o(e,t,n,r,s=!1){var o=ma(e),i=o[_a],c=!o[ya],l=t||{},f=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=ql(n.class):n[qn]&&(n.class=null),n[Vn]&&(n.style??(n.style=null));var v=ba(e);for(const S in n){let b=n[S];if(f&&S==="value"&&b==null){e.value=e.__value="",l[S]=b;continue}if(S==="class"){var u=e.namespaceURI==="http://www.w3.org/1999/xhtml";On(e,u,b,r,t==null?void 0:t[qn],n[qn]),l[S]=b,l[qn]=n[qn];continue}if(S==="style"){ha(e,b,t==null?void 0:t[Vn],n[Vn]),l[S]=b,l[Vn]=n[Vn];continue}var _=l[S];if(b!==_){l[S]=b;var p=S[0]+S[1];if(p!=="$$")if(p==="on"){const R={},F="$$"+S;let D=S.slice(2);var w=Cl(D);if(Sl(D)&&(D=D.slice(0,-7),R.capture=!0),!w&&_){if(b!=null)continue;e.removeEventListener(D,l[F],R),l[F]=null}if(b!=null)if(w)e[`__${D}`]=b,Dl([D]);else{let I=function(B){l[S].call(this,B)};var M=I;l[F]=da(D,e,I,R)}else w&&(e[`__${D}`]=void 0)}else if(S==="style")Et(e,S,b);else if(S==="autofocus")Rl(e,!!b);else if(!i&&(S==="__value"||S==="value"&&b!=null))e.value=e.__value=b;else if(S==="selected"&&f)Bl(e,b);else{var k=S;c||(k=Pl(k));var $=k==="defaultValue"||k==="defaultChecked";if(b==null&&!i&&!$)if(o[S]=null,k==="value"||k==="checked"){let R=e;const F=t===void 0;if(k==="value"){let D=R.defaultValue;R.removeAttribute(k),R.defaultValue=D,R.value=R.__value=F?D:null}else{let D=R.defaultChecked;R.removeAttribute(k),R.defaultChecked=D,R.checked=F?D:!1}}else e.removeAttribute(S);else $||v.includes(k)&&(i||typeof b!="string")?e[k]=b:typeof b!="function"&&Et(e,k,b)}}}return l}function ma(e){return e.__attributes??(e.__attributes={[_a]:e.nodeName.includes("-"),[ya]:e.namespaceURI===Yi})}var yo=new Map;function ba(e){var t=yo.get(e.nodeName);if(t)return t;yo.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=No(r);for(var o in n)n[o].set&&t.push(o);r=Cs(r)}return t}function tt(e,t,n=t){var r=jn();Ts(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=as(e)?is(o):o,n(o),r&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),Ye(t)==null&&e.value&&n(as(e)?is(e.value):e.value),hn(()=>{var s=t();as(e)&&s===is(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Kn(e,t,n=t){Ts(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),Ye(t)==null&&n(e.checked),hn(()=>{var r=t();e.checked=!!r})}function as(e){var t=e.type;return t==="number"||t==="range"}function is(e){return e===""?null:+e}function wa(e,t,n){if(e.multiple)return Kl(e,t);for(var r of e.options){var s=er(r);if(Xi(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Wl(e,t){Nn(()=>{var n=new MutationObserver(()=>{var r=e.__value;wa(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function ys(e,t,n=t){var r=!0;Ts(e,"change",s=>{var o=s?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),er);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&er(c)}n(i)}),Nn(()=>{var s=t();if(wa(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=er(o),n(s))}e.__value=s,r=!1}),Wl(e)}function Kl(e,t){for(var n of e.options)n.selected=~t.indexOf(er(n))}function er(e){return"__value"in e?e.__value:e.value}function mo(e,t){return e===t||(e==null?void 0:e[xt])===t}function Qn(e={},t,n,r){return Nn(()=>{var s,o;return hn(()=>{s=o,o=[],Ye(()=>{e!==n(...o)&&(t(e,...o),s&&mo(n(...s),e)&&t(null,...s))})}),()=>{Jr(()=>{o&&mo(n(...o),e)&&t(null,...o)})}}),e}function Ql(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ze(e=!1){const t=pe,n=t.l.u;if(!n)return;let r=()=>Is(t.s);if(e){let s=0,o={};const i=rr(()=>{let c=!1;const l=t.s;for(const f in l)l[f]!==o[f]&&(o[f]=l[f],c=!0);return c&&s++,s});r=()=>a(i)}n.b.length&&al(()=>{bo(t,r),Sr(n.b)}),vs(()=>{const s=Ye(()=>n.m.map(Ei));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&vs(()=>{bo(t,r),Sr(n.a)})}function bo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function xa(e,t,n){if(e==null)return t(void 0),Pn;const r=Ye(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const Cn=[];function st(e,t=Pn){let n=null;const r=new Set;function s(c){if(Ur(e,c)&&(e=c,n)){const l=!Cn.length;for(const f of r)f[1](),Cn.push(f,e);if(l){for(let f=0;f<Cn.length;f+=2)Cn[f][0](Cn[f+1]);Cn.length=0}}}function o(c){s(c(e))}function i(c,l=Pn){const f=[c,l];return r.add(f),r.size===1&&(n=t(s,o)||Pn),c(e),()=>{r.delete(f),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function oe(e){let t;return xa(e,n=>t=n)(),t}let yr=!1,ms=Symbol();function pn(e,t,n){const r=n[t]??(n[t]={store:null,source:j(void 0),unsubscribe:Pn});if(r.store!==e&&!(ms in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Pn;else{var s=!0;r.unsubscribe=xa(e,o=>{s?r.source.v=o:y(r.source,o)}),s=!1}return e&&ms in n?oe(e):a(r.source)}function Br(){const e={};function t(){Os(()=>{for(var n in e)e[n].unsubscribe();Mo(e,ms,{enumerable:!1,value:!0})})}return[e,t]}function Yl(e){var t=yr;try{return yr=!1,[e(),yr]}finally{yr=t}}const Zl={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=nt({get[t](){return e.props[t]}},t,qo)),e.special[t](n),lo(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),lo(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function Tt(e,t){return new Proxy({props:e,exclude:t,special:{},version:En(0)},Zl)}const Xl={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Jn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];Jn(s)&&(s=s());const o=Qt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Jn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Qt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===xt||t===Uo)return!1;for(let n of e.props)if(Jn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Jn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function _n(...e){return new Proxy({props:e},Xl)}function wo(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function nt(e,t,n,r){var D;var s=(n&Hi)!==0,o=!Tn||(n&Bi)!==0,i=(n&Wi)!==0,c=(n&Ki)!==0,l=!1,f;i?[f,l]=Yl(()=>e[t]):f=e[t];var d=xt in e||Uo in e,v=i&&(((D=Qt(e,t))==null?void 0:D.set)??(d&&t in e&&(I=>e[t]=I)))||void 0,u=r,_=!0,p=!1,w=()=>(p=!0,_&&(_=!1,c?u=Ye(r):u=r),u);f===void 0&&r!==void 0&&(v&&o&&Li(),f=w(),v&&v(f));var k;if(o)k=()=>{var I=e[t];return I===void 0?w():(_=!0,p=!1,I)};else{var $=(s?rr:vt)(()=>e[t]);$.f|=Go,k=()=>{var I=a($);return I!==void 0&&(u=void 0),I===void 0?u:I}}if((n&qo)===0)return k;if(v){var M=e.$$legacy;return function(I,B){return arguments.length>0?((!o||!B||M||l)&&v(B?k():I),I):k()}}var S=!1,b=!1,R=j(f),F=rr(()=>{var I=k(),B=a(R);return S?(S=!1,b=!0,B):(b=!1,R.v=I)});return i&&a(F),s||(F.equals=Ps),function(I,B){if(Wt!==null&&(S=b,k(),a(R)),arguments.length>0){const ee=B?a(F):o&&i?ln(I):I;if(!F.equals(ee)){if(S=!0,y(R,ee),p&&u!==void 0&&(u=ee),wo(F))return I;Ye(()=>a(F))}return I}return wo(F)?F.v:a(F)}}function vr(e){pe===null&&Rs(),Tn&&pe.l!==null?rc(pe).m.push(e):vs(()=>{const t=Ye(e);if(typeof t=="function")return t})}function ec(e){pe===null&&Rs(),vr(()=>()=>Ye(e))}function tc(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function nc(){const e=pe;return e===null&&Rs(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const i=Nr(s)?s.slice():[s],c=tc(t,n,r);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function rc(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const sc="5";var jo;typeof window<"u"&&((jo=window.__svelte??(window.__svelte={})).v??(jo.v=new Set)).add(sc);Ji();const wt=st({isLoggedIn:!1,token:null,user:null});function ls(){wt.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const at=st("home"),Wr=st(null),Ee=st({phase:"streaming",paused:!0,loadedCount:0,totalCount:null}),oc="modulepreload",ac=function(e){return"/skygit/"+e},xo={},pr=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=ac(l),l in xo)return;xo[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":oc,f||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),f)return new Promise((u,_)=>{v.addEventListener("load",u),v.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function Sa(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function bs(e,t){const n=await Sa(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+i.byteLength);return c.set(r,0),c.set(new Uint8Array(i),r.byteLength),btoa(String.fromCharCode(...c))}async function js(e,t){const n=Uint8Array.from(atob(t),f=>f.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await Sa(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(i);return JSON.parse(l)}const An=new Map,Rr=new Map,ic="https://api.github.com",lc="skygit-config";function ka(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}let Hn=null;async function $t(e){return Hn||(Hn=(async()=>{const t=await fetch(`${ic}/user`,{headers:ka(e)});if(!t.ok)throw Hn=null,new Error("Failed to fetch GitHub user");return(await t.json()).login})(),Hn)}async function cc(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${lc}`,{headers:ka(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function uc(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function Ms(e,t,n=2){const r=await $t(e),s=`repositories/${t.owner}-${t.name}.json`,o=An.get(s);if(o)return o;const i={Authorization:`token ${e}`,Accept:"application/vnd.github+json","Content-Type":"application/json"},c=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(Rr.get(s)===c)return;let f=0,d=null;const u=(async()=>{for(;f<=n;){let _=null;try{const $=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{headers:i});$.ok&&(_=(await $.json()).sha)}catch{}const p={message:`Update repo ${t.full_name}`,content:c,..._&&{sha:_}},w=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{method:"PUT",headers:i,body:JSON.stringify(p)});if(w.ok){Rr.set(s,c);return}if(d=await w.text(),w.status===409){f+=1;continue}break}throw new Error(`GitHub commit failed: ${d}`)})().finally(()=>An.delete(s));return An.set(s,u),u}async function Ca(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){const{paused:l}=oe(Ee);Ee.set({phase:"idle",loadedCount:0,totalCount:0,paused:l});return}if(!s.ok){const l=await s.text();throw new Error(`Failed to load repository list: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),{paused:c}=oe(Ee);Ee.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:c});for(const l of i){let f=!1;if(Ee.subscribe(d=>f=d.paused)(),f)break;try{const d=await fetch(l.url,{headers:r});if(!d.ok){console.warn(`[SkyGit] Skipped missing repo file: ${l.name} (${d.status})`);continue}const v=await d.json(),u=atob(v.content),_=JSON.parse(u);Aa([_]),Ee.update(p=>({...p,loadedCount:p.loadedCount+1}))}catch(d){console.warn(`[SkyGit] Skipped malformed repo file: ${l.name}`,d);continue}}Ee.update(l=>({...l,phase:"idle"}))}async function fc(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const f=await fetch(l.url,{headers:r});if(!f.ok)continue;const d=await f.json(),v=JSON.parse(atob(d.content));c.push(v)}return c}async function dc(e,t){const n=await $t(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function vc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2))));if(Rr.get(o)===i)return;const c=An.get(o);if(c)return c;const l=`https://api.github.com/repos/${t.full_name}/contents/${s}`;let f=null;try{const v=await fetch(l,{headers:n});if(v.ok)f=(await v.json()).sha;else if(v.status!==404){const u=await v.text();throw new Error(`Failed to check if config.json exists: ${u}`)}}catch(v){console.warn("Error checking for config.json",v)}const d=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:i,...f&&{sha:f}})});if(!d.ok){const v=await d.text();throw new Error(`Failed to commit config.json: ${v}`)}t.has_messages=!0,t.config=r,await Ms(e,t)}async function pc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),c=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let l=null;c.ok&&(l=(await c.json()).sha);const f=fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:i,...l&&{sha:l}})}).then(async v=>{if(!v.ok){const u=await v.text();throw new Error(`Failed to update config.json: ${u}`)}Rr.set(o,i)}).finally(()=>{An.delete(o)});An.set(o,f),await f;const{queueRepoForCommit:d}=await pr(async()=>{const{queueRepoForCommit:v}=await Promise.resolve().then(()=>Oa);return{queueRepoForCommit:v}},void 0);await d(t)}async function Ns(e){const n=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function br(e,t,n=null){const s=`https://api.github.com/repos/${await $t(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const f=await l.text();throw new Error(`Failed to check secrets.json: ${f}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function gc(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials;if(!r||Object.keys(r).length===0)return;const s=await bs(e,r),{secrets:o,sha:i}=await Ns(e);o[n]=s,await br(e,o,i)}const $a="skygit_repos",hc=5*60*1e3,_c=10;let fn=[],Or=null;const yc=JSON.parse(localStorage.getItem($a)||"[]"),Ct=st(yc),Ls=st(0),Dr=st(null);Ct.subscribe(e=>{localStorage.setItem($a,JSON.stringify(e))});function Pa(e){if(Ct.update(n=>{const r=n.findIndex(s=>s.full_name===e.full_name);if(r>=0){const s=[...n];return s[r]=e,s}return[...n,e]}),fn.some(n=>n.full_name===e.full_name)||fn.push(e),fn.length>=_c){ir();return}Or||(Or=setTimeout(ir,hc))}async function ir(){if(fn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...fn];fn=[],clearTimeout(Or),Or=null;for(const n of t)try{await Ms(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function Aa(e){Ct.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function Ea(){return fn.length>0}function Ra(e){let t;return Ct.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const Oa=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Ls,flushRepoCommitQueue:ir,getRepoByFullName:Ra,hasPendingRepoCommits:Ea,queueRepoForCommit:Pa,repoList:Ct,selectedRepo:Dr,syncRepoListFromGitHub:Aa},Symbol.toStringTag,{value:"Module"}));async function mc(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function bc(e){localStorage.setItem("skygit_token",e)}function wc(){return localStorage.getItem("skygit_token")}const Da="skygit_conversations",xc=JSON.parse(localStorage.getItem(Da)||"{}"),Gn=st(xc),Gs=st(null);Gn.subscribe(e=>{localStorage.setItem(Da,JSON.stringify(e))});function ws(e,t){Gn.update(n=>({...n,[e]:t}))}function Sc(e,t){Gn.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function Ia(e,t,n){Gn.update(r=>{const o=(r[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...r,[t]:o}}),Gs.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Te=[];for(let e=0;e<256;++e)Te.push((e+256).toString(16).slice(1));function kc(e,t=0){return(Te[e[t+0]]+Te[e[t+1]]+Te[e[t+2]]+Te[e[t+3]]+"-"+Te[e[t+4]]+Te[e[t+5]]+"-"+Te[e[t+6]]+Te[e[t+7]]+"-"+Te[e[t+8]]+Te[e[t+9]]+"-"+Te[e[t+10]]+Te[e[t+11]]+Te[e[t+12]]+Te[e[t+13]]+Te[e[t+14]]+Te[e[t+15]]).toLowerCase()}let cs;const Cc=new Uint8Array(16);function $c(){if(!cs){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");cs=crypto.getRandomValues.bind(crypto)}return cs(Cc)}const Pc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),So={randomUUID:Pc};function Ac(e,t,n){var s;if(So.randomUUID&&!e)return So.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??$c();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,kc(r)}async function Ec(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const i=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));ws(t.full_name,i),t.conversations=i.map(c=>c.id),await Ms(e,t)}async function Ta(e,t){console.log("[SkyGit] 📝 commitToSkyGitConversations() called"),console.log("⏩ Payload:",t);const n=await $t(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,i=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:i})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function Rc(e,t,n){console.log("[SkyGit] 🔧 createConversation called for:",t.full_name,"with title:",n),await $t(e);const r=Ac();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,i={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const d=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${d}`)}try{console.log("[SkyGit] 📤 Now committing to skygit-config..."),await Ta(e,i)}catch(d){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",d)}const f={id:r,name:s,path:o,repo:t.full_name,title:n};Sc(f,t)}const Yn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let wr=!1;function Oc(){wr=!0}async function xs(e){wr=!1;const t=new Set,n=[],r=await us("https://api.github.com/user/repos",Yn(e));n.push(...r),Ee.update(o=>({...o,totalCount:n.length}));const s=await us("https://api.github.com/user/orgs",Yn(e));for(const o of s){if(wr)return;const i=await us(`https://api.github.com/orgs/${o.login}/repos`,Yn(e));n.push(...i),Ee.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(wr)return;const i=o.full_name;if(t.has(i)){Ee.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(i);const c=await Dc(e,i),l=typeof o.has_discussions=="boolean"?o.has_discussions:!1,f={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(f.has_messages){try{const d=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:Yn(e)});if(d.ok){const v=await d.json();f.config=JSON.parse(atob(v.content))}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${i}`,d)}await Ec(e,f)}Ee.update(d=>({...d,loadedCount:d.loadedCount+1})),Pa(f)}try{await ir()}catch(o){console.warn("[SkyGit] Failed to flush repo commit queue:",o)}Ee.update(o=>({...o,phase:"idle"}))}async function us(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),s=i.length<100,r++):s=!0}return n}async function Dc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Yn(e)})).status===200}catch{return!1}}const Ke=st({config:null,secrets:{},secretsSha:null,cleanupMode:!1});async function Ic(e){const t=await $t(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null,cleanupMode:localStorage.getItem("skygit_cleanup_mode")==="true"};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)ws(o,s[o]);console.log("[SkyGit] ✅ Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,f]of Object.entries(i))try{c[l]=await js(e,f)}catch(d){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,d)}r.secrets=c,r.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}Ke.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await Ca(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await fc(e)||[],o={};for(const i of s)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)ws(i,o[i])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let lr=new Set,xr=new Map;const Tc=10;function Fs(e,t){const n=`${e}::${t}`;if(lr.add(n),lr.size>=Tc){Ir();return}const r=jc(e);if(!xr.has(n)){const s=setTimeout(()=>{Ir([n]),xr.delete(n)},r);xr.set(n,s)}}function jc(e){var s;const n=oe(Ct).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function Ir(e=null){const t=e||Array.from(lr);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await $t(n);const r=oe(Gn);for(const s of t){lr.delete(s),xr.delete(s);const[o,i]=s.split("::"),l=(r[o]||[]).find(d=>d.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const f={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await Ta(n,f);const d=`.messages/conversation-${f.id}.json`,v=btoa(JSON.stringify(f,null,2)),u=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${f.id}`,content:v})});if(!u.ok){const _=await u.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(d){console.error("[SkyGit] Conversation commit failed:",d)}}}function ja(){return lr.size>0}const Us=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:Ir,hasPendingConversationCommits:ja,queueConversationForCommit:Fs},Symbol.toStringTag,{value:"Module"}));var Mc=A('<p class="text-red-500 text-sm"> </p>'),Nc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticating…',1),Lc=A('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Don’t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function Gc(e,t){Ve(t,!1);let n=nt(t,"onSubmit",8),r=nt(t,"error",8,null),s=j(""),o=j(!1);async function i(){a(o)||(y(o,!0),await n()(a(s)),y(o,!1))}Ze();var c=Lc(),l=g(h(c),2),f=g(l,2);{var d=w=>{var k=Mc(),$=h(k);Y(()=>K($,r())),m(w,k)};T(f,w=>{r()&&w(d)})}var v=g(f,2),u=h(v);{var _=w=>{var k=Nc();m(w,k)},p=w=>{var k=Le("Authenticate");m(w,k)};T(u,w=>{a(o)?w(_):w(p,!1)})}Y(()=>{l.disabled=a(o),v.disabled=a(o)}),tt(l,()=>a(s),w=>y(s,w)),N("click",v,i),m(e,c),He()}var Fc=A('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),Uc=A('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function zc(e,t){Ve(t,!1);let n=nt(t,"onApprove",8),r=nt(t,"onReject",8),s=j(!1);async function o(){a(s)||(y(s,!0),await n()(),y(s,!1))}Ze();var i=Uc(),c=g(h(i),6),l=h(c),f=h(l);{var d=_=>{var p=Fc();m(_,p)},v=_=>{var p=Le("I Accept");m(_,p)};T(f,_=>{a(s)?_(d):_(v,!1)})}var u=g(l,2);Y(()=>{l.disabled=a(s),u.disabled=a(s)}),N("click",l,o),N("click",u,function(..._){var p;(p=r())==null||p.apply(this,_)}),m(e,i),He()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Jc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var qc=pa("<svg><!><!></svg>");function yn(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]),r=Tt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let s=nt(t,"name",8,void 0),o=nt(t,"color",8,"currentColor"),i=nt(t,"size",8,24),c=nt(t,"strokeWidth",8,2),l=nt(t,"absoluteStrokeWidth",8,!1),f=nt(t,"iconNode",24,()=>[]);const d=(...w)=>w.filter((k,$,M)=>!!k&&M.indexOf(k)===$).join(" ");Ze();var v=qc();let u;var _=h(v);It(_,1,f,ar,(w,k)=>{let $=()=>a(k)[0],M=()=>a(k)[1];var S=Ae(),b=ve(S);Ul(b,$,!0,(R,F)=>{let D;Y(()=>D=_o(R,D,{...M()}))}),m(w,S)});var p=g(_);Nt(p,t,"default",{}),Y((w,k)=>u=_o(v,u,{...Jc,...r,width:i(),height:i(),stroke:o(),"stroke-width":w,class:k}),[()=>l()?Number(c())*24/Number(i()):c(),()=>d("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],vt),m(e,v),He()}function Vc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Hc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function ko(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Bc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Wc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Kc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}function Qc(e,t){const n=Tt(t,["children","$$slots","$$events","$$legacy"]);yn(e,_n({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var i=Ae(),c=ve(i);Nt(c,t,"default",{}),m(s,i)},$$slots:{default:!0}}))}const Tr=st({});function Co(e,t){Tr.update(n=>({...n,[e]:t}))}var Yc=A('<span title="Presence paused" class="mt-0.5">⏸️</span>'),Zc=A('<span title="Presence active" class="mt-0.5">▶️</span>'),Xc=A('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),eu=A('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),tu=A('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left flex gap-2 items-start"><!> <div class="flex-1"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></div></button>'),nu=A('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),ru=A('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function su(e,t){Ve(t,!1);const n=j();let r=j({}),s=j({});Gn.subscribe(d=>y(r,d)),Tr.subscribe(d=>y(s,d));function o(d){Wr.set(d),Gs.set(d),at.set("chats")}ut(()=>a(r),()=>{y(n,Object.values(a(r)).flat().sort((d,v)=>{const u=new Date(d.updatedAt||d.createdAt||0).getTime();return new Date(v.updatedAt||v.createdAt||0).getTime()-u}))}),ur(),Ze();var i=ru(),c=h(i);It(c,1,()=>a(n),d=>d.id,(d,v)=>{var u=Ae(),_=ve(u);Ml(_,()=>`${a(v).id}-${a(s)[a(v).repo]}`,p=>{var w=tu(),k=h(w);{var $=q=>{var Q=Yc();m(q,Q)},M=q=>{var Q=Zc();m(q,Q)};T(k,q=>{a(s)[a(v).repo]===!1?q($):q(M,!1)})}var S=g(k,2),b=h(S),R=h(b),F=g(b,2),D=h(F),I=g(F,2);{var B=q=>{var Q=Xc(),me=h(Q);Y(Ce=>K(me,Ce),[()=>a(v).messages.at(-1).content],vt),m(q,Q)},ee=q=>{var Q=eu();m(q,Q)};T(I,q=>{a(v).messages&&a(v).messages.length>0?q(B):q(ee,!1)})}Y(q=>{K(R,q),K(D,a(v).repo)},[()=>a(v).title||`Conversation ${a(v).id.slice(0,6)}`],vt),N("click",w,()=>o(a(v))),m(p,w)}),m(d,u)});var l=g(c,2);{var f=d=>{var v=nu();m(d,v)};T(l,d=>{a(n).length===0&&d(f)})}m(e,i),He()}var ou=A('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),au=A('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),iu=A('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">✔️ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">🔄 Sync</button> <button class="text-blue-600 text-xs underline">🔍 Discover</button></div></div>'),lu=A('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),cu=A('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),uu=A('<ul class="space-y-2"></ul>'),fu=A('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),du=A('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),vu=A('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> 🔒 Private</label> <label><input type="checkbox"> 🌐 Public</label> <label><input type="checkbox"> 💬 With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function pu(e,t){Ve(t,!1);const n=j(),r=j();let s=nt(t,"search",8,""),o=j([]),i=j(),c=j(),l=j(!0),f=j(!0),d=j(!0),v=j(!0);Ct.subscribe(P=>y(o,P)),Ee.subscribe(P=>y(i,P));function u(){Ee.update(P=>({...P,paused:!P.paused}))}function _(){if(a(i).paused){Ee.update(L=>({...L,paused:!1}));const P=localStorage.getItem("skygit_token");P&&xs(P)}else Oc(),Ee.update(P=>({...P,paused:!0}))}async function p(P){const L=a(o).find(X=>X.full_name===P);if(L){Ct.update(X=>X.filter(ce=>ce.full_name!==P));try{const X=localStorage.getItem("skygit_token");await dc(X,L),console.log(`[SkyGit] Deleted ${P} from GitHub`)}catch(X){console.warn(`[SkyGit] Failed to delete ${P} from GitHub:`,X)}}}async function w(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"streaming",paused:!1,loadedCount:0})),await Ca(P))}async function k(){const P=localStorage.getItem("skygit_token");P&&(Ee.update(L=>({...L,phase:"discovery",paused:!1})),xs(P))}function $(P){Dr.set(P),Wr.set(P)}ut(()=>(a(o),Is(s()),a(l),a(f),a(d),a(v)),()=>{y(n,a(o).filter(P=>{const L=s().toLowerCase(),X=P.full_name.toLowerCase().includes(L)||P.name.toLowerCase().includes(L)||P.owner.toLowerCase().includes(L),ce=P.private&&a(l)||!P.private&&a(f),W=P.has_messages&&a(d)||!P.has_messages&&a(v);return X&&ce&&W}))}),ut(()=>a(n),()=>{Ls.set(a(n).length)}),ut(()=>a(o),()=>{y(r,a(o).some(P=>!P.has_discussions))}),ur(),Ze();var M=vu(),S=ve(M);{var b=P=>{var L=ou(),X=h(L),ce=h(X);ko(ce,{class:"w-4 h-4 animate-spin text-blue-500"});var W=g(ce,2),te=h(W),V=g(X,2),ge=h(V);Y(()=>{K(te,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),K(ge,a(i).paused?"Resume Syncing":"Pause Syncing")}),N("click",V,u),m(P,L)},R=(P,L)=>{{var X=W=>{var te=au(),V=h(te);ko(V,{class:"w-4 h-4 animate-spin text-blue-500"});var ge=g(V,2),be=h(ge),G=g(ge,2),Z=h(G);Y(()=>{K(be,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),K(Z,a(i).paused?"Resume Discovery":"Pause Discovery")}),N("click",G,_),m(W,te)},ce=(W,te)=>{{var V=ge=>{var be=iu(),G=g(h(be),2),Z=h(G),we=g(Z,2);N("click",Z,w),N("click",we,k),m(ge,be)};T(W,ge=>{a(i).phase==="idle"&&ge(V)},te)}};T(P,W=>{a(i).phase==="discovery"?W(X):W(ce,!1)},L)}};T(S,P=>{a(i).phase==="streaming"?P(b):P(R,!1)})}var F=g(S,2),D=h(F),I=h(D),B=g(D,2),ee=h(B),q=g(B,2),Q=h(q),me=g(q,2),Ce=h(me),Re=g(F,2);{var $e=P=>{var L=uu();It(L,5,()=>a(n),X=>X.full_name,(X,ce)=>{var W=cu(),te=h(W),V=h(te),ge=h(V),be=g(V,2),G=h(be),Z=g(G);{var we=_e=>{var xe=lu();m(_e,xe)};T(Z,_e=>{a(ce).has_discussions||_e(we)})}Qn(te,_e=>y(c,_e),()=>a(c));var ne=g(te,2),Ge=h(ne);Kc(Ge,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),Y(()=>{K(ge,a(ce).full_name),K(G,`${(a(ce).has_messages?" | 💬 .messages":" | no messaging")??""} `)}),N("click",V,()=>$(a(ce))),N("click",ne,()=>p(a(ce).full_name)),m(X,W)}),m(P,L)},J=P=>{var L=fu();m(P,L)};T(Re,P=>{a(n).length>0?P($e):P(J,!1)})}var re=g(Re,2);{var de=P=>{var L=du();m(P,L)};T(re,P=>{a(r)&&P(de)})}Kn(I,()=>a(l),P=>y(l,P)),Kn(ee,()=>a(f),P=>y(f,P)),Kn(Q,()=>a(d),P=>y(d,P)),Kn(Ce,()=>a(v),P=>y(v,P)),m(e,M),He()}var gu=A('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function hu(e){var t=gu();m(e,t)}var _u=A('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function yu(e){var t=_u();m(e,t)}var mu=A('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function bu(e){var t=mu();m(e,t)}function fs(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var wu=A('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),xu=A('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Su=A('<button type="button"><div><!></div> <!> </button>'),ku=A('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">⋯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function Cu(e,t){Ve(t,!1);const[n,r]=Br(),s=()=>pn(at,"$currentRoute",n),o=()=>pn(Ls,"$filteredCount",n);let i=j(null),c=j(!1),l=j("");function f(){at.set("settings")}function d(J){at.set(J)}wt.subscribe(J=>{y(i,J.user)});const v=[{id:"chats",icon:Bc,label:"Chats"},{id:"repos",icon:Hc,label:"Repos"},{id:"calls",icon:Wc,label:"Calls"},{id:"contacts",icon:Qc,label:"Contacts"},{id:"notifications",icon:Vc,label:"Notifs"}];function u(){y(c,!a(c))}function _(){y(c,!1)}Ze();var p=ku(),w=h(p),k=h(w),$=h(k),M=g($,2),S=h(M),b=h(S),R=g(S,2),F=h(R),D=g(k,2),I=g(D,2);{var B=J=>{var re=wu(),de=h(re),P=g(de,6);zl(re,(L,X)=>fs==null?void 0:fs(L,X),()=>_),N("click",de,f),N("click",P,function(...L){ls==null||ls.apply(this,L)}),m(J,re)};T(I,J=>{a(c)&&J(B)})}var ee=g(w,2),q=h(ee),Q=g(ee,2);It(Q,5,()=>v,ar,(J,re)=>{let de=()=>a(re).id,P=()=>a(re).icon,L=()=>a(re).label;var X=Su();let ce;var W=h(X),te=h(W);P()(te,{class:"w-5 h-5"});var V=g(W,2);{var ge=G=>{var Z=xu(),we=h(Z);Y(()=>K(we,o())),m(G,Z)};T(V,G=>{de()==="repos"&&a(l).trim()!==""&&G(ge)})}var be=g(V);Y(G=>{ce=On(X,1,"relative flex flex-col items-center text-xs focus:outline-none",null,ce,G),On(W,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===de()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),K(be,` ${L()??""}`)},[()=>({"text-blue-600":s()===de()})],vt),N("click",X,()=>d(de())),m(J,X)});var me=g(Q,2),Ce=h(me);{var Re=J=>{su(J,{})},$e=(J,re)=>{{var de=L=>{pu(L,{get search(){return a(l)}})},P=(L,X)=>{{var ce=te=>{hu(te)},W=(te,V)=>{{var ge=G=>{yu(G)},be=(G,Z)=>{{var we=ne=>{bu(ne)};T(G,ne=>{s()==="notifications"&&ne(we)},Z)}};T(te,G=>{s()==="contacts"?G(ge):G(be,!1)},V)}};T(L,te=>{s()==="calls"?te(ce):te(W,!1)},X)}};T(J,L=>{s()==="repos"?L(de):L(P,!1)},re)}};T(Ce,J=>{s()==="chats"?J(Re):J($e,!1)})}Y(()=>{var J,re,de,P;Et($,"src",(J=a(i))==null?void 0:J.avatar_url),K(b,((re=a(i))==null?void 0:re.name)||((de=a(i))==null?void 0:de.login)),K(F,`@${((P=a(i))==null?void 0:P.login)??""}`)}),N("click",D,u),tt(q,()=>a(l),J=>y(l,J)),m(e,p),He(),r()}var $u=A('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">←</button>'),Pu=A('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Kr(e,t){Ve(t,!1);let n=j(!1);function r(p){y(n,p.detail.open)}wt.subscribe(p=>{p.user}),vr(()=>{const p=()=>{window.innerWidth>=768&&y(n,!1)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)}),Wr.subscribe(p=>{p&&window.innerWidth<768&&y(n,!1)}),Ze();var s=Pu(),o=h(s),i=h(o);{var c=p=>{var w=$u();N("click",w,()=>y(n,!0)),m(p,w)};T(i,p=>{a(n)||p(c)})}var l=g(o,2);let f;var d=h(l);Cu(d,{$$events:{toggle:r}});var v=g(l,2);let u;var _=h(v);Nt(_,t,"default",{}),Y((p,w)=>{f=On(l,1,"sidebar md:block svelte-scw01y",null,f,p),u=On(v,1,"main w-full svelte-scw01y",null,u,w)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],vt),m(e,s),He()}var Au=A('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function Eu(e){Kr(e,{children:(t,n)=>{var r=Au();m(t,r)},$$slots:{default:!0}})}var Ru=A('<button title="Save">💾</button>'),Ou=A('<button title="Edit">✏️</button>'),Du=A('<button title="Hide">🙈</button> <!>',1),Iu=A('<button title="Reveal">👁️</button>'),Tu=A('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),ju=A('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),Mu=A('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),Nu=A('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),Lu=A('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">🗑️</button></td></tr> <!>',1),Gu=A('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Fu=A('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Uu=A('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">🔐 Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">➕ Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">💾 Add Credential</button></div> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">App Settings</h3> <label class="flex items-center space-x-2"><input type="checkbox"> <span>Cleanup mode (delete old presence channels)</span></label></div></div>');function zu(e,t){Ve(t,!1);let n=j({}),r=j({}),s=j(new Set),o=j(null),i=j(""),c=j("s3"),l=j({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),f=j({}),d=null,v=j(!1);const u=localStorage.getItem("skygit_token");vr(async()=>{if(y(v,oe(Ke).cleanupMode||!1),!u)return;const b=await Ns(u);y(n,b.secrets),d=b.sha});async function _(b){try{a(r)[b]||Se(r,a(r)[b]=await js(u,a(n)[b])),y(s,new Set(a(s)).add(b))}catch{alert("❌ Failed to decrypt.")}}function p(b){y(s,new Set([...a(s)].filter(R=>R!==b))),a(o)===b&&y(o,null)}function w(b){a(s).has(b)||y(s,new Set(a(s)).add(b)),y(o,b),y(f,{...a(r)[b]})}async function k(b){const R=await bs(u,a(f));Se(n,a(n)[b]=R),y(n,{...a(n)}),Se(r,a(r)[b]=a(f)),y(r,{...a(r)}),y(s,new Set(a(s)).add(b)),y(o,null),await br(u,a(n),d)}async function $(b){confirm(`Are you sure you want to delete the credential for:
${b}?`)&&(delete a(n)[b],y(n,{...a(n)}),delete a(r)[b],y(r,{...a(r)}),y(s,new Set([...a(s)].filter(R=>R!==b))),a(o)===b&&y(o,null),await br(u,a(n),d))}async function M(){if(!a(i)||!a(c))return;const b=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},R=await bs(u,b);Se(n,a(n)[a(i)]=R),y(n,{...a(n)}),Se(r,a(r)[a(i)]=b),y(r,{...a(r)}),y(s,new Set(a(s)).add(a(i))),y(i,""),y(c,"s3"),y(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await br(u,a(n),d)}function S(){Ke.update(b=>({...b,cleanupMode:a(v)})),localStorage.setItem("skygit_cleanup_mode",a(v)?"true":"false")}Ze(),Kr(e,{children:(b,R)=>{var F=Uu(),D=g(h(F),2),I=g(h(D));It(I,5,()=>Object.entries(a(n)),ar,(W,te)=>{let V=()=>a(te)[0],ge=()=>a(te)[1];var be=Lu(),G=ve(be),Z=h(G),we=h(Z),ne=g(Z),Ge=h(ne),_e=g(ne),xe=h(_e);{var gt=ye=>{var De=Le();Y(()=>K(De,a(r)[V()].type==="s3"?"S3":"Google Drive")),m(ye,De)},Lt=ye=>{var De=Le("?");m(ye,De)};T(xe,ye=>{a(r)[V()]?ye(gt):ye(Lt,!1)})}var ht=g(_e),Pt=h(ht);{var Xt=ye=>{var De=Du(),Gt=ve(De),Ft=g(Gt,2);{var nn=ie=>{var x=Ru();N("click",x,()=>k(V())),m(ie,x)},rn=ie=>{var x=Ou();N("click",x,()=>w(V())),m(ie,x)};T(Ft,ie=>{a(o)===V()?ie(nn):ie(rn,!1)})}N("click",Gt,()=>p(V())),m(ye,De)},en=ye=>{var De=Iu();N("click",De,()=>_(V())),m(ye,De)};T(Pt,ye=>{a(s).has(V())?ye(Xt):ye(en,!1)})}var tn=g(Pt,2),mn=g(G,2);{var bn=ye=>{var De=Nu(),Gt=h(De),Ft=h(Gt);{var nn=ie=>{var x=ju(),C=ve(x),O=g(h(C),2),U=h(O),H={},ue=h(U),se=g(C,2);It(se,1,()=>Object.entries(a(f)),ar,(le,Be)=>{let Xe=()=>a(Be)[0];var je=Ae(),Ut=ve(je);{var sn=zt=>{var Jt=Tu(),on=h(Jt),wn=h(on),qt=g(on,2);Y(()=>K(wn,Xe())),tt(qt,()=>a(f)[Xe()],Yr=>Se(f,a(f)[Xe()]=Yr)),m(zt,Jt)};T(Ut,zt=>{Xe()!=="type"&&zt(sn)})}m(le,je)}),Y(()=>{H!==(H=a(f).type)&&(U.value=(U.__value=a(f).type)==null?"":a(f).type),K(ue,a(f).type)}),m(ie,x)},rn=ie=>{var x=Mu(),C=h(x);Y(O=>K(C,`${O??""}
                                    `),[()=>JSON.stringify(a(r)[V()],null,2)],vt),m(ie,x)};T(Ft,ie=>{a(o)===V()?ie(nn):ie(rn,!1)})}m(ye,De)};T(mn,ye=>{a(s).has(V())&&ye(bn)})}Y(ye=>{K(we,V()),K(Ge,`${ye??""}...`)},[()=>ge().slice(0,20)],vt),N("click",tn,()=>$(V())),m(W,be)});var B=g(D,2),ee=g(h(B),2),q=h(ee),Q=g(h(q)),me=g(q,2),Ce=g(h(me));Y(()=>{a(c),gs(()=>{})});var Re=h(Ce);Re.value=(Re.__value="s3")==null?"":"s3";var $e=g(Re);$e.value=($e.__value="google_drive")==null?"":"google_drive";var J=g(ee,2);{var re=W=>{var te=Gu(),V=h(te),ge=g(h(V)),be=g(V,2),G=g(h(be)),Z=g(be,2),we=g(h(Z));tt(ge,()=>a(l).accessKeyId,ne=>Se(l,a(l).accessKeyId=ne)),tt(G,()=>a(l).secretAccessKey,ne=>Se(l,a(l).secretAccessKey=ne)),tt(we,()=>a(l).region,ne=>Se(l,a(l).region=ne)),m(W,te)},de=(W,te)=>{{var V=ge=>{var be=Fu(),G=h(be),Z=g(h(G)),we=g(G,2),ne=g(h(we)),Ge=g(we,2),_e=g(h(Ge));tt(Z,()=>a(l).client_id,xe=>Se(l,a(l).client_id=xe)),tt(ne,()=>a(l).client_secret,xe=>Se(l,a(l).client_secret=xe)),tt(_e,()=>a(l).refresh_token,xe=>Se(l,a(l).refresh_token=xe)),m(ge,be)};T(W,ge=>{a(c)==="google_drive"&&ge(V)},te)}};T(J,W=>{a(c)==="s3"?W(re):W(de,!1)})}var P=g(J,2),L=g(B,2),X=g(h(L),2),ce=h(X);tt(Q,()=>a(i),W=>y(i,W)),ys(Ce,()=>a(c),W=>y(c,W)),N("click",P,M),Kn(ce,()=>a(v),W=>y(v,W)),N("change",ce,S),m(b,F)},$$slots:{default:!0}}),He()}var Ju=A('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),qu=A('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),Vu=A('<div class="p-4 space-y-3"><!></div>');function Hu(e,t){Ve(t,!1);const[n,r]=Br(),s=()=>pn(Gs,"$selectedConversation",n),o=j(),i=j();ut(()=>s(),()=>{y(o,s())}),ut(()=>a(o),()=>{var v;y(i,((v=a(o))==null?void 0:v.messages)??[])}),ut(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),ur(),Ze();var c=Vu(),l=h(c);{var f=v=>{var u=Ae(),_=ve(u);It(_,1,()=>a(i),p=>p.id||p.timestamp,(p,w)=>{var k=Ju(),$=h(k),M=h($),S=g($,2),b=h(S),R=g(S,2),F=h(R);Y(D=>{K(M,a(w).sender),K(b,a(w).content),K(F,D)},[()=>new Date(a(w).timestamp).toLocaleString()],vt),m(p,k)}),m(v,u)},d=v=>{var u=qu();m(v,u)};T(l,v=>{a(i).length>0?v(f):v(d,!1)})}m(e,c),He(),r()}const $o="skygit_context_id";function Bu(){if(typeof window>"u")return"server";let e=localStorage.getItem($o);return e||(e=crypto.randomUUID(),localStorage.setItem($o,e)),e}const St="https://api.github.com";let jr=!1;async function Wu(e,t,n){const[r,s]=t.split("/");return(await Yt(e,`
    query($owner:String!,$name:String!,$number:Int!){
      repository(owner:$owner,name:$name){ discussion(number:$number){ id } }
    }`,{owner:r,name:s,number:n})).repository.discussion.id}async function Ku(e,t,n){await Yt(e,`
    mutation($id:ID!,$body:String!){
      addDiscussionComment(input:{discussionId:$id,body:$body}){ clientMutationId }
    }`,{id:t,body:n})}async function Ma(e,t,n){await Yt(e,`
    mutation($cid:ID!,$body:String!){
      updateDiscussionComment(input:{commentId:$cid,body:$body}){ clientMutationId }
    }`,{cid:t,body:n})}async function Na(e,t){await Yt(e,`
    mutation($cid:ID!){ deleteDiscussionComment(input:{id:$cid}){ clientMutationId } }`,{cid:t})}async function Po(e,t){await Yt(e,`
    mutation($id:ID!){ deleteDiscussion(input:{id:$id}){ clientMutationId } }`,{id:t})}async function Yt(e,t,n={}){const r=await fetch(`${St}/graphql`,{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})});if(!r.ok){const o=await r.text();throw new Error(`GraphQL API error (${r.status}): ${o}`)}const s=await r.json();if(s.errors&&s.errors.length)throw new Error(`GraphQL API returned errors: ${JSON.stringify(s.errors)}`);return s.data}function Bn(e){return`skygit_presence_discussion_${e}`}async function Qr(e,t,n=!1){var v;if(!n&&typeof window<"u"){const u=localStorage.getItem(Bn(t));if(u)try{if((await fetch(`${St}/repos/${t}/discussions/${u}`,{headers:{Authorization:`token ${e}`}})).ok)return Number(u);localStorage.removeItem(Bn(t))}catch{}}const r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},s=`${St}/repos/${t}/discussions?per_page=100`;let o=[];try{let u=1;for(;;){const _=await fetch(`${s}&page=${u}`,{headers:r});if(!_.ok)break;const p=await _.json();if(o=o.concat(p),p.length<100)break;u++}}catch{}const i=o.filter(u=>u.title==="SkyGit Presence Channel");if(n&&i.length){for(const u of i)try{await Po(e,u.node_id)}catch{}typeof window<"u"&&localStorage.removeItem(Bn(t))}if(i.length&&!n){const u=i[0];if(i.length>1)for(const _ of i.slice(1))try{await Po(e,_.node_id)}catch{}return typeof window<"u"&&localStorage.setItem(Bn(t),u.number),u.number}let c;try{const u=await fetch(`${St}/repos/${t}/discussions/categories`,{headers:r});if(u.ok){const _=await u.json();_.length&&(c=((v=_.find(p=>p.slug==="general"))==null?void 0:v.id)||_[0].id)}}catch{}if(!c){const[u,_]=t.split("/");try{const w=(await Yt(e,`
        query($owner:String!,$name:String!){
          repository(owner:$owner,name:$name){
            discussionCategories(first:50){ nodes{ id slug name } }
          }
        }`,{owner:u,name:_})).repository.discussionCategories.nodes;w.length&&(c=(w.find($=>$.slug==="general")||w[0]).id)}catch(p){console.warn("[SkyGit][Presence] GraphQL categories fallback failed",p)}}if(!c)throw new Error("Failed to resolve a discussion category id");if(typeof c=="string"&&c.startsWith("DIC_")){const[u,_]=t.split("/"),p=`
      mutation($repoId:ID!,$catId:ID!,$title:String!,$body:String!){
        createDiscussion(input:{repositoryId:$repoId,categoryId:$catId,title:$title,body:$body}){
          discussion{ number }
        }
      }`,k=(await Yt(e,"query($owner:String!,$name:String!){repository(owner:$owner,name:$name){id}}",{owner:u,name:_})).repository.id,$=await Yt(e,p,{repoId:k,catId:c,title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."});return l($.createDiscussion.discussion.number)}function l(u){return typeof window<"u"&&localStorage.setItem(Bn(t),u),u}const f=await fetch(s,{method:"POST",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore.",category_id:c})});if(!f.ok){if(f.status===422||f.status===409){const u=await fetch(s,{headers:r});if(u.ok){const p=(await u.json()).find(w=>w.title==="SkyGit Presence Channel");if(p)return l(p.number)}}throw new Error("Failed to create presence discussion")}const d=await f.json();return l(d.number)}function Qu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function Yu(e,t,n,r,s=null,o=!1){const i=await Qr(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${St}/repos/${t}/discussions/${i}/comments`;let f=null;async function d(){return f||(f=await Wu(e,t,i),f)}const v=new Date().toISOString();let u=v;const _=await fetch(l,{headers:c});let p=[];_.ok&&(p=await _.json());let w=null;if(typeof window<"u"&&(w=localStorage.getItem($())),w&&!p.some(D=>String(D.id)===w))try{const D=await fetch(`${St}/repos/${t}/discussions/comments/${w}`,{headers:c});if(D.ok){const I=await D.json();p.push(I)}else typeof window<"u"&&localStorage.removeItem($()),w=null}catch{}const k=Bu();function $(){return`skygit_presence_comment_${t}_${k}`}const M=p.filter(D=>{try{const I=JSON.parse(D.body);return I.username===n&&I.context_id===k}catch{return!1}}),S=M.find(D=>{try{return JSON.parse(D.body).session_id===r}catch{return!1}});if(S)try{const D=JSON.parse(S.body);D.join_timestamp&&(u=D.join_timestamp)}catch{}const b={username:n,context_id:k,session_id:r,join_timestamp:u,last_seen:v,signaling_info:s};let R=!1;if(S){let D;try{D=JSON.parse(S.body)}catch{D={}}const I=Math.abs(new Date(v)-new Date(D.last_seen));(!Qu(D,b)||I>3e4)&&(R=!0)}if(S&&R){try{await Ma(e,S.node_id,JSON.stringify(b)),typeof window<"u"&&localStorage.setItem($(),String(S.id))}catch{const I=`${l}/${S.id}`;await fetch(I,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(b)})}),typeof window<"u"&&localStorage.setItem($(),String(S.id))}jr||Ao(t,S.id)}else if(!S)try{const D=await d();await Ku(e,D,JSON.stringify(b));const I=await fetch(l,{headers:c});if(I.ok){const ee=(await I.json()).find(q=>{try{const Q=JSON.parse(q.body);return Q.session_id===r&&Q.context_id===k}catch{return!1}});ee&&typeof window<"u"&&(localStorage.setItem($(),String(ee.id)),jr||Ao(t,ee.id))}}catch{await fetch(l,{method:"POST",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(b)})});try{const I=await fetch(l+"?per_page=1",{headers:c});if(I.ok){const B=await I.json();B.length&&typeof window<"u"&&localStorage.setItem($(),String(B[0].id))}}catch{}}const F=10*60*1e3;for(const D of M)if(!(S&&D.id===S.id))try{const I=JSON.parse(D.body);Date.now()-new Date(I.last_seen||I.join_timestamp).getTime()>F&&(await Na(e,D.node_id),typeof window<"u"&&w===String(D.id)&&localStorage.removeItem($()))}catch{}}function Ao(e,t){typeof window>"u"||jr||(jr=!0,window.addEventListener("beforeunload",()=>{const n=`${St}/repos/${e}/discussions/comments/${t}`,r={body:JSON.stringify({left_at:new Date().toISOString()})};fetch(n,{method:"PATCH",headers:{Authorization:`token ${localStorage.getItem("skygit_token")||""}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json","Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}).catch(()=>{})}))}async function Zu(e,t,n,r,s,o=!1){const i=await Qr(e,t,o),c={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},l=`${St}/repos/${t}/discussions/${i}/comments`,f=await fetch(l,{headers:c});if(!f.ok)return;const v=(await f.json()).find(u=>{try{const _=JSON.parse(u.body);return _.username===n&&_.session_id===r}catch{return!1}});if(v){let u;try{u=JSON.parse(v.body)}catch{u={}}u.pendingRemovalBy=s,u.pendingRemovalAt=new Date().toISOString();try{await Ma(e,v.node_id,JSON.stringify(u))}catch{const p=`${l}/${v.id}`;await fetch(p,{method:"PATCH",headers:{...c,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(u)})})}console.debug("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function Xu(e,t,n,r,s=!1){const o=await Qr(e,t,s),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},c=`${St}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:i});if(!l.ok)return;const d=(await l.json()).find(v=>{try{const u=JSON.parse(v.body);return u.username===n&&u.session_id===r}catch{return!1}});if(d){let v;try{v=JSON.parse(d.body)}catch{v={}}if(v.pendingRemovalBy&&v.pendingRemovalAt&&Date.now()-new Date(v.pendingRemovalAt).getTime()>6e4){try{await Na(e,d.node_id)}catch{const p=`${c}/${d.id}`;await fetch(p,{method:"DELETE",headers:i})}console.debug("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function ef(e,t,n=!1){const r=await Qr(e,t,n),s={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},o=`${St}/repos/${t}/discussions/${r}/comments`,i=await fetch(o,{headers:s});if(!i.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",i.status,i.statusText),[];const c=await i.json(),l=Date.now(),f=c.map(d=>{try{return JSON.parse(d.body)}catch{return null}}).filter(Boolean).filter(d=>d.last_seen&&l-new Date(d.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",f),f}async function Mr(e,t,n,r,s=null,o=!1){await Yu(e,t,n,r,s,o)}async function zs(e,t,n=!1){return await ef(e,t,n)}class tf{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:f,onFileSendProgress:d}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=f,this.onFileSendProgress=d,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=d=>{if(d.target.readyState!==FileReader.DONE)return;const v=new Uint8Array(d.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(v)}),c++,i+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),i<t.size?f():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const f=()=>{const d=t.slice(i,i+r);l.readAsArrayBuffer(d)};f()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Oe=st({}),rt=st([]);let Ot=null,Je=null,ft=null,ke=null;function nf(){return ke}let La=null,$n=null,cn=null;function Eo(){Ga(),Oe.set({}),rt.set([]),clearInterval(cn),cn=null,Zn={token:null,repoFullName:null,username:null}}let Zn={token:null,repoFullName:null,username:null};function Ro({_token:e,_repoFullName:t,_username:n,_sessionId:r}){Zn.token===e&&Zn.repoFullName===t&&Zn.username===n||(Zn={token:e,repoFullName:t,username:n},Ga(),Oe.set({}),rt.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),ft=e,Je=t,Ot=n,ke=r,zs(ft,Je,oe(Ke).cleanupMode).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(i=>i.username!==Ot);rt.set(o),Js(s),Fa(),Ua(),Dn(s,ke)?rf():sf()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function rf(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Je,"as",Ot,"session",ke),Mr(ft,Je,Ot,ke,null,oe(Ke).cleanupMode),La=setInterval(()=>{Mr(ft,Je,Ot,ke,null,oe(Ke).cleanupMode)},3e4),$n=setInterval(async()=>{const e=await zs(ft,Je,oe(Ke).cleanupMode);console.log("[SkyGit][Presence] [Leader] polled peers:",e),rt.set(e.filter(t=>t.session_id!==ke)),Js(e),Fa(),Ua()},5e3)}function sf(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Je,"as",Ot,"session",ke);const e=async()=>{const n=await zs(ft,Je,oe(Ke).cleanupMode);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),rt.set(n.filter(r=>r.session_id!==ke)),Js(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),$n=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Oe.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&$n&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval($n),$n=null,t())})}function Ga(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(La),clearInterval($n)}async function Js(e){Oe.update(t=>{const n={...t},r=qs(e,ke);if(ke===r){for(const s of e)s.session_id!==ke&&(n[s.session_id]||(n[s.session_id]={status:"connecting",conn:null,username:s.username},Do(s,n)));Object.keys(n).forEach(s=>{s!==ke&&(e.some(o=>o.session_id===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.session_id===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null,username:s.username},Do(s,n))}return n});for(const t of e){if(t.session_id===ke)continue;const n=oe(Oe);n[t.session_id]&&n[t.session_id].status==="connected"||(Zu(ft,Je,t.username,t.session_id,Ot,oe(Ke).cleanupMode),setTimeout(()=>{Xu(ft,Je,t.username,t.session_id,oe(Ke).cleanupMode)},6e4))}}function qs(e,t){return e.map(r=>r.session_id).concat(t).sort()[0]}function Dn(e,t){return qs(e,t)===t}function of(e,t){if(!e||!e.conversationId||!e.content)return;Ia(e.conversationId,Je,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=oe(rt);Dn(n,ke)&&(Fs(Je,e.conversationId),Oe.update(r=>(Object.values(r).forEach(({conn:s,username:o})=>{o!==t&&s&&s.dataChannel&&s.send({type:"chat",...e})}),r)))}function af(e,t){e&&Array.isArray(e.onlinePeers)&&rt.set(e.onlinePeers)}function lf(e,t){!e||!e.subtype||Oe.update(n=>{const r=Object.values(n).find(o=>o.username===t),s=r==null?void 0:r.conn;return s&&typeof s.handleSignal=="function"&&s.handleSignal(e),n})}function Oo(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function Do(e,t){const n=new tf({token:ft,repoFullName:Je,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{Mr(ft,Je,Ot,ke,r,oe(Ke).cleanupMode)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":of(r,e.username);break;case"presence":af(r,e.username);break;case"signal":lf(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{Oo(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{Oo(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{Mr(ft,Je,Ot,ke,r,oe(Ke).cleanupMode)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.session_id]={conn:n,status:"connected",username:e.username},Oe.set(t)}function Fa(){const e=oe(rt);Dn(e,ke)?cn||(cn=setInterval(()=>{const n=oe(rt);Dn(n,ke)&&pr(()=>Promise.resolve().then(()=>Us),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",Io)):cn&&(clearInterval(cn),cn=null,window.removeEventListener("beforeunload",Io))}function Io(e){const t=oe(rt);Dn(t,ke)&&pr(()=>Promise.resolve().then(()=>Us),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let To=!1;function Ua(){const e=oe(rt),t=Dn(e,ke);t&&!To&&pr(()=>Promise.resolve().then(()=>Us),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),To=t}function Ss(e,t){Oe.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function cf(e){Oe.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var uf=A('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function ff(e,t){Ve(t,!1);let n=nt(t,"conversation",8),r=j("");function s(){var p;if(!a(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(r).trim(),timestamp:Date.now()};Ia(n().id,n().repo,l),(p=oe(wt).user)==null||p.login;const d=oe(rt),v=nf(),u=qs(d,v),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};v===u?(cf({type:"chat",..._}),Fs(n().repo,n().id)):Ss(u,{type:"chat",..._}),y(r,"")}Ze();var o=uf(),i=h(o),c=g(i,2);tt(i,()=>a(r),l=>y(r,l)),N("keydown",i,l=>l.key==="Enter"&&s()),N("click",c,s),m(e,o),He()}var df=A(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),vf=A('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),pf=A('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),gf=A('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),hf=A('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),_f=A('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),yf=A('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),mf=A('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),bf=A('<button class="bg-yellow-100 border px-3 py-1 rounded">🔄 Change Screen Source</button>'),wf=A("<span>🎤</span>"),xf=A("<span>🔇</span>"),Sf=A("<span>📷</span>"),kf=A("<span>🚫📷</span>"),Cf=A("<span>⏹️ Stop Recording</span>"),$f=A("<span>⏺️ Start Recording</span>"),Pf=A('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>⏺️ Recording...</span></div>'),Af=A('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>⚠️ Peer is recording</span></div>'),Ef=A('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">📎 Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),Rf=A('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">×</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),Of=A('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),Df=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),If=A('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),Tf=A('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <button class="ml-4 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200"> </button> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),jf=A('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function Mf(e,t){Ve(t,!1);const[n,r]=Br(),s=()=>pn(Oe,"$peerConnections",n),o=()=>pn(rt,"$onlinePeers",n);let i=j(null),c=j(!1),l=j(null),f=j(null),d=null,v=j(!1),u=j(null),_=null,p=j(!1),w=j(null),k=j(!1),$=j(!0),M=j(!0),S=j(!0),b=j(!0),R=j(!0),F=j(!1),D=j(!1),I=j(!0);const B=Tr.subscribe(x=>{a(i)&&a(i).repo&&y(I,x[a(i).repo]!==!1)});let ee=null,q=[],Q=j({x:0,y:0}),me=!1,Ce={x:0,y:0},Re=j(),$e=j(null),J=j(!1),re=j(),de=j(),P=j();function L(){y(k,!0)}function X(){y(k,!1)}function ce(x){y(k,!1),Lt(!0,x)}function W(x){me=!0,Ce={x:x.clientX-a(Q).x,y:x.clientY-a(Q).y},document.addEventListener("mousemove",te),document.addEventListener("mouseup",V)}function te(x){me&&(Se(Q,a(Q).x=x.clientX-Ce.x),Se(Q,a(Q).y=x.clientY-Ce.y))}function V(){me=!1,document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",V)}function ge(){y($,!1)}function be(){y($,!0)}function G(){y($e,null),y(J,!1)}function Z(){var H;if(!a(i))return;const x=a(i).repo,C=localStorage.getItem("skygit_token"),O=oe(wt),U=(H=O==null?void 0:O.user)==null?void 0:H.login;!C||!U||(a(I)?(Co(x,!1),Eo()):(Co(x,!0),Ro({_token:C,_repoFullName:x,_username:U,_sessionId:crypto.randomUUID()})))}ec(()=>{B()});async function we(){let x=a(i)&&a(i).repo,C=oe(Ke).decrypted,O=null,U=null,H=null,ue=null;if(x&&window.selectedRepo&&window.selectedRepo.config){const le=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;le&&C[le]&&(C[le].type==="s3"&&(O=C[le]),C[le].type==="google_drive"&&(U=C[le]))}for(const le in C)C[le].type==="s3"&&!O&&(H=C[le]),C[le].type==="google_drive"&&!U&&(ue=C[le]);const se=[];return(O||H)&&se.push("s3"),(U||ue)&&se.push("google_drive"),se.length===2?(y(J,!0),new Promise(le=>{const Be=setInterval(()=>{a($e)&&(y(J,!1),clearInterval(Be),le(a($e)))},100)})):se.length===1?se[0]:null}Oe.subscribe(x=>{Object.entries(x).filter(([C,O])=>O.status==="connected").map(([C,O])=>({session_id:C,username:O.username}))});let ne=j(!1),Ge=j("");async function _e(x){const C=localStorage.getItem("skygit_token");if(!C||!x)return null;try{const O=await fetch(`https://api.github.com/repos/${x}`,{headers:{Authorization:`token ${C}`}});if(O.ok){const U=await O.json();return Ct.update(H=>H.map(ue=>ue.full_name===x?{...ue,has_discussions:U.has_discussions}:ue)),U.has_discussions}}catch(O){console.warn("Failed to refresh Discussions status",O)}return null}Wr.subscribe(x=>{var ue;console.log("[SkyGit][Presence] currentContent changed:",x),y(i,x),y(ne,!1),y(Ge,"");const C=localStorage.getItem("skygit_token"),O=oe(wt),U=((ue=O==null?void 0:O.user)==null?void 0:ue.login)||null,H=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",O),console.log("[SkyGit][Presence] onConversationSelect: token",C,"username",U,"repo",H,"selectedConversation",a(i)),C&&U&&H){const se=oe(Tr);y(I,se[H]!==!1),a(I)?Ro({_token:C,_repoFullName:H,_username:U,_sessionId:crypto.randomUUID()}):Eo()}if(a(i)&&a(i).repo){const se=Ra(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",se,"has_discussions:",se==null?void 0:se.has_discussions),se&&se.has_discussions===!1&&_e(a(i).repo).then(le=>{le?y(ne,!1):y(ne,!0)})}});function xe(){y(c,!1),d=null,a(l)&&(a(l).getTracks().forEach(x=>x.stop()),y(l,null)),y(f,null),d&&Ss(d,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function gt(x){const C=x.target.files[0];!C||!a(c)||!d||Oe.update(O=>{var H;const U=(H=O[d])==null?void 0:H.conn;return U&&typeof U.sendFile=="function"&&U.sendFile(C),O})}async function Lt(x=!0,C="screen"){try{let O={video:!0,audio:x};C==="tab"?O={video:{displaySurface:"browser",cursor:"always"},audio:x}:C==="window"?O={video:{displaySurface:"window",cursor:"always"},audio:x}:C==="screen"&&(O={video:{displaySurface:"monitor",cursor:"always"},audio:x}),y(u,await navigator.mediaDevices.getDisplayMedia(O)),y(v,!0),Oe.update(U=>{var ue;const H=(ue=U[d])==null?void 0:ue.conn;return H&&H.replaceVideoTrack&&(H.replaceVideoTrack(a(u).getVideoTracks()[0]),H.sendScreenShareSignal&&H.sendScreenShareSignal(!0,{audio:x})),U}),y(l,a(u)),a(u).getVideoTracks()[0].onended=ht}catch(O){console.error("Screen share error:",O)}}function ht(){a(u)&&(a(u).getTracks().forEach(x=>x.stop()),y(u,null)),y(v,!1),Oe.update(x=>{var O;const C=(O=x[d])==null?void 0:O.conn;return C&&C.replaceVideoTrack,x}),y(l,_)}async function Pt(){if(a(v))try{const x=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Oe.update(C=>{var U;const O=(U=C[d])==null?void 0:U.conn;return O&&O.replaceVideoTrack&&O.replaceVideoTrack(x.getVideoTracks()[0]),C}),a(u)&&a(u).getTracks().forEach(C=>C.stop()),y(u,x),y(l,x),x.getVideoTracks()[0].onended=ht}catch(x){console.error("Change screen source error:",x)}}function Xt(){y(M,!a(M)),a(l)&&a(l).getAudioTracks().forEach(x=>x.enabled=a(M)),tn()}function en(){y(S,!a(S)),a(l)&&a(l).getVideoTracks().forEach(x=>x.enabled=a(S)),tn()}function tn(){Oe.update(x=>{var O;const C=(O=x[d])==null?void 0:O.conn;return C&&C.send&&C.send({type:"media-status",micOn:a(M),cameraOn:a(S)}),x})}function mn(x){Oe.update(C=>{var U;const O=(U=C[d])==null?void 0:U.conn;return O&&O.send&&O.send({type:"recording-status",recording:x}),C})}function bn(){a(l)&&(q=[],ee=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),ee.ondataavailable=x=>{x.data.size>0&&q.push(x.data)},ee.onstop=De,ee.start(),y(F,!0),mn(!0))}function ye(){ee&&a(F)&&(ee.stop(),y(F,!1),mn(!1))}async function De(){const x=new Blob(q,{type:"video/webm"});await Ft(x)}typeof window<"u"&&(window.skygitOnRecordingStatus=x=>{y(D,!!x.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(x,C)=>{y(p,x),y(w,C||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=x=>{typeof x.micOn=="boolean"&&y(b,x.micOn),typeof x.cameraOn=="boolean"&&y(R,x.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(x,C,O)=>{x.name,C===O&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(x,C,O)=>{C===O&&setTimeout(()=>{},2e3)});async function Gt(x,C){const O=`skygit-recording-${Date.now()}.webm`,U=C.bucket,H=C.region;if(!U||!H)return alert("S3 credential missing bucket or region."),null;const ue=C.endpoint||`https://${U}.s3.${H}.amazonaws.com/${O}`;return(await fetch(ue,{method:"PUT",headers:{"Content-Type":"video/webm"},body:x})).ok?ue.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function Ft(x){let C=oe(Ke).decrypted,O=a(i)&&a(i).repo,U=null,H=null,ue=null,se=null;if(O&&window.selectedRepo&&window.selectedRepo.config){const je=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;je&&C[je]&&(C[je].type==="s3"&&(U=C[je]),C[je].type==="google_drive"&&(H=C[je]))}for(const je in C)C[je].type==="s3"&&!U&&(ue=C[je]),C[je].type==="google_drive"&&!H&&(se=C[je]);let le=null,Be=await we();if(!Be){alert("No upload destination (S3 or Google Drive) configured.");return}Be==="s3"&&(le=U||ue),Be==="google_drive"&&(le=H||se);let Xe=null;Be==="s3"?Xe=await Gt(x,le):Be==="google_drive"&&(Xe=await nn(x,le)),Xe&&(Ss(d,{type:"chat",content:`📹 Recording: ${Xe}`}),alert("Recording uploaded and link shared!"))}async function nn(x,C){let O;try{O=await rn(C)}catch(Xe){return alert("Google Drive authentication failed: "+Xe.message),null}const U={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},H=new FormData;H.append("metadata",new Blob([JSON.stringify(U)],{type:"application/json"})),H.append("file",x);const ue=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+O},body:H});if(!ue.ok)return alert("Failed to upload to Google Drive"),null;const se=await ue.json();await fetch(`https://www.googleapis.com/drive/v3/files/${se.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+O,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Be=await(await fetch(`https://www.googleapis.com/drive/v3/files/${se.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+O}})).json();return Be.webViewLink||Be.webContentLink}async function rn(x){const C=new URLSearchParams;C.append("client_id",x.client_id),C.append("client_secret",x.client_secret),C.append("refresh_token",x.refresh_token),C.append("grant_type","refresh_token");const O=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:C.toString()});if(!O.ok)throw new Error("Failed to get Google access token");return(await O.json()).access_token}function ie(){var ue;const x=localStorage.getItem("skygit_token"),C=oe(wt),O=((ue=C==null?void 0:C.user)==null?void 0:ue.login)||null,U=a(i)?a(i).repo:null,H=window.skygitSessionId;x&&O&&U&&H&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:x,repoFullName:U,username:O,sessionId:H})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",ie),ut(()=>(a(re),a(l)),()=>{a(re)&&a(l)&&Se(re,a(re).srcObject=a(l))}),ut(()=>(a(de),a(f)),()=>{a(de)&&a(f)&&Se(de,a(de).srcObject=a(f))}),ut(()=>(a(P),a(u)),()=>{a(P)&&a(u)&&Se(P,a(P).srcObject=a(u))}),ur(),Ze(),Kr(e,{children:(x,C)=>{var O=Ae(),U=ve(O);{var H=se=>{var le=Ae(),Be=ve(le);{var Xe=Ut=>{var sn=df(),zt=h(sn),Jt=g(h(zt),4),on=g(Jt,2),wn=h(on),qt=g(wn,2);Y(()=>Et(Jt,"href",a(Ge))),N("click",wn,()=>y(ne,!1)),N("click",qt,async()=>{await _e(a(i).repo)}),m(Ut,sn)},je=Ut=>{var sn=Tf(),zt=h(sn),Jt=h(zt),on=h(Jt),wn=h(on),qt=g(on,2),Yr=h(qt),za=g(qt,2),Ja=h(za),Vs=g(Jt,2),qa=h(Vs),Va=g(Vs,2),Hs=h(Va);{var Ha=he=>{var Ie=Ae(),_t=ve(Ie);It(_t,1,()=>a(i).participants,We=>We,(We,Pe)=>{var Me=Ae(),Fe=ve(Me);{var Fn=lt=>{var yt=vf();m(lt,yt)},xn=lt=>{var yt=Ae(),Zr=ve(yt);{var Xr=Vt=>{var an=Ae(),Un=ve(an);{var Sn=Ne=>{var ct=pf(),zn=g(h(ct));Y(()=>K(zn,` ${a(Pe)??""}`)),m(Ne,ct)},mt=Ne=>{var ct=gf(),zn=g(h(ct));Y(()=>K(zn,` ${a(Pe)??""}`)),m(Ne,ct)};T(Un,Ne=>{s()[a(Pe)].status==="connected"?Ne(Sn):Ne(mt,!1)})}m(Vt,an)},es=(Vt,an)=>{{var Un=mt=>{var Ne=hf(),ct=g(h(Ne));Y(()=>K(ct,` ${a(Pe)??""}`)),m(mt,Ne)},Sn=mt=>{var Ne=_f(),ct=g(h(Ne));Y(()=>K(ct,` ${a(Pe)??""}`)),m(mt,Ne)};T(Vt,mt=>{o().find(Ne=>Ne.username===a(Pe))?mt(Un):mt(Sn,!1)},an)}};T(Zr,Vt=>{s()[a(Pe)]?Vt(Xr):Vt(es,!1)})}m(lt,yt)};T(Fe,lt=>{a(Pe)===oe(wt).user.login?lt(Fn):lt(xn,!1)})}m(We,Me)}),m(he,Ie)};T(Hs,he=>{a(i).participants&&he(Ha)})}var Ba=g(Hs,2);{var Wa=he=>{var Ie=yf();N("click",Ie,xe),m(he,Ie)};T(Ba,he=>{a(c)&&he(Wa)})}var Bs=g(zt,2);{var Ka=he=>{var Ie=Ef(),_t=ve(Ie),We=h(_t),Pe=g(h(We),2);Pe.muted=!0,Qn(Pe,E=>y(re,E),()=>a(re));var Me=g(Pe,2),Fe=h(Me),Fn=h(Fe);{var xn=E=>{var z=Le("🎤 Mic On");m(E,z)},lt=E=>{var z=Le("🔇 Mic Off");m(E,z)};T(Fn,E=>{a(M)?E(xn):E(lt,!1)})}var yt=g(Fe,2),Zr=h(yt);{var Xr=E=>{var z=Le("📷 Cam On");m(E,z)},es=E=>{var z=Le("🚫📷 Cam Off");m(E,z)};T(Zr,E=>{a(S)?E(Xr):E(es,!1)})}var Vt=g(We,2),an=g(h(Vt),2);Qn(an,E=>y(de,E),()=>a(de));var Un=g(an,2),Sn=h(Un),mt=h(Sn);{var Ne=E=>{var z=Le("🎤 Mic On");m(E,z)},ct=E=>{var z=Le("🔇 Mic Off");m(E,z)};T(mt,E=>{a(b)?E(Ne):E(ct,!1)})}var zn=g(Sn,2),ni=h(zn);{var ri=E=>{var z=Le("📷 Cam On");m(E,z)},si=E=>{var z=Le("🚫📷 Cam Off");m(E,z)};T(ni,E=>{a(R)?E(ri):E(si,!1)})}var Zs=g(_t,2);{var oi=E=>{var z=mf(),Si=h(z),ki=g(h(Si));{var Ci=rs=>{var _r=Le("(with audio)");m(rs,_r)};T(ki,rs=>{var _r;(_r=a(w))!=null&&_r.audio&&rs(Ci)})}m(E,z)};T(Zs,E=>{a(p)&&E(oi)})}var Xs=g(Zs,2),eo=h(Xs),ai=g(h(eo)),ts=g(eo,2),ii=h(ts);{var li=E=>{var z=Le("🛑 Stop Sharing");m(E,z)},ci=E=>{var z=Le("🖥️ Share Screen");m(E,z)};T(ii,E=>{a(v)?E(li):E(ci,!1)})}var to=g(ts,2);{var ui=E=>{var z=bf();N("click",z,Pt),m(E,z)};T(to,E=>{a(v)&&E(ui)})}var gr=g(to,2),fi=h(gr);{var di=E=>{var z=wf();m(E,z)},vi=E=>{var z=xf();m(E,z)};T(fi,E=>{a(M)?E(di):E(vi,!1)})}var hr=g(gr,2),pi=h(hr);{var gi=E=>{var z=Sf();m(E,z)},hi=E=>{var z=kf();m(E,z)};T(pi,E=>{a(S)?E(gi):E(hi,!1)})}var ns=g(hr,2),_i=h(ns);{var yi=E=>{var z=Cf();m(E,z)},mi=E=>{var z=$f();m(E,z)};T(_i,E=>{a(F)?E(yi):E(mi,!1)})}var no=g(Xs,2);{var bi=E=>{var z=Pf();m(E,z)};T(no,E=>{a(F)&&E(bi)})}var wi=g(no,2);{var xi=E=>{var z=Af();m(E,z)};T(wi,E=>{a(D)&&E(xi)})}Y(()=>{Et(gr,"title",a(M)?"Mute Mic":"Unmute Mic"),Et(hr,"title",a(S)?"Turn Off Camera":"Turn On Camera"),Et(ns,"title",a(F)?"Stop Recording":"Start Recording")}),N("change",ai,gt),N("click",ts,function(...E){var z;(z=a(v)?ht:L)==null||z.apply(this,E)}),N("click",gr,Xt),N("click",hr,en),N("click",ns,function(...E){var z;(z=a(F)?ye:bn)==null||z.apply(this,E)}),m(he,Ie)};T(Bs,he=>{a(c)&&he(Ka)})}var Ws=g(Bs,2);{var Qa=he=>{var Ie=Ae(),_t=ve(Ie);{var We=Me=>{var Fe=Rf(),Fn=h(Fe),xn=h(Fn),lt=g(xn,4);lt.muted=!0,Qn(lt,yt=>y(P,yt),()=>a(P)),Qn(Fe,yt=>y(Re,yt),()=>a(Re)),Y(()=>ha(Fe,`left: ${a(Q).x??""}px; top: ${a(Q).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),N("click",xn,Ql(ge)),N("mousedown",Fe,W),m(Me,Fe)},Pe=Me=>{var Fe=Of();N("click",Fe,be),m(Me,Fe)};T(_t,Me=>{a($)?Me(We):Me(Pe,!1)})}m(he,Ie)};T(Ws,he=>{a(v)&&a(u)&&he(Qa)})}var Ks=g(Ws,2);{var Ya=he=>{var Ie=Df(),_t=h(Ie),We=g(h(_t),2),Pe=g(We,2),Me=g(Pe,2),Fe=g(Me,2);N("click",We,()=>ce("screen")),N("click",Pe,()=>ce("window")),N("click",Me,()=>ce("tab")),N("click",Fe,X),m(he,Ie)};T(Ks,he=>{a(k)&&he(Ya)})}var Qs=g(Ks,2);{var Za=he=>{var Ie=If(),_t=h(Ie),We=g(h(_t),2),Pe=g(We,2),Me=g(Pe,2);N("click",We,()=>{y($e,"google_drive")}),N("click",Pe,()=>{y($e,"s3")}),N("click",Me,G),m(he,Ie)};T(Qs,he=>{a(J)&&he(Za)})}var Ys=g(Qs,2),Xa=h(Ys);Hu(Xa,{get conversation(){return a(i)}});var ei=g(Ys,2),ti=h(ei);ff(ti,{get conversation(){return a(i)}}),Y(()=>{var he;K(wn,a(i).title),Et(qt,"title",a(I)?"Pause presence polling":"Start presence polling"),K(Yr,a(I)?"⏸ Pause Presence":"▶ Start Presence"),K(Ja,a(i).repo),K(qa,`${((he=a(i).participants)==null?void 0:he.length)??0} participants`)}),N("click",qt,Z),m(Ut,sn)};T(Be,Ut=>{a(ne)?Ut(Xe):Ut(je,!1)})}m(se,le)},ue=se=>{var le=jf();m(se,le)};T(U,se=>{a(i)?se(H):se(ue,!1)})}m(x,O)},$$slots:{default:!0}}),He(),r()}var Nf=A('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function Lf(e,t){Ve(t,!1);const n=nc();let r=j("");function s(){if(!a(r).trim()){alert("Title is required.");return}n("create",{title:a(r).trim()}),y(r,"")}function o(){n("cancel")}Ze();var i=Nf(),c=h(i),l=g(h(c),2),f=g(l,2),d=h(f),v=g(d,2);tt(l,()=>a(r),u=>y(r,u)),N("click",d,o),N("click",v,s),m(e,i),He()}var Gf=A('<span class="text-green-700 font-semibold">✅ Enabled</span>'),Ff=A("<span> </span>"),Uf=A('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),zf=pa('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),Jf=A('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),qf=A('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>💬 New Conversation (Enable Discussions first)</button></div>'),Vf=A("<option> </option>"),Hf=A('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">🛠️ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>— Select a credential —</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💾 Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💬 New Conversation</button> <!>',1),Bf=A('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),Wf=A('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function Kf(e,t){Ve(t,!1);let n=j([]),r=j(),s=j(!1),o=j(!1),i=j(""),c;Dr.subscribe(p=>y(r,p)),vr(async()=>{const p=localStorage.getItem("skygit_token");if(p)try{const{secrets:w}=await Ns(p),k=Object.keys(w),$=[];for(const M of k)try{const S=await js(p,w[M]);$.push({url:M,...S})}catch(S){console.warn("Failed to decrypt",M,S)}y(n,$)}catch(w){console.warn("Could not load secrets",w)}});async function l(){const p=localStorage.getItem("skygit_token");if(!(!a(r)||!p)){y(s,!0);try{await vc(p,a(r)),Se(r,a(r).has_messages=!0),pr(async()=>{const{selectedRepo:w}=await Promise.resolve().then(()=>Oa);return{selectedRepo:w}},void 0).then(({selectedRepo:w})=>{w.set({...a(r)})})}catch(w){alert("Failed to activate messaging."),console.warn(w)}finally{y(s,!1)}}}async function f(){const p=localStorage.getItem("skygit_token");if(!(!p||!a(r)))try{await pc(p,a(r)),alert("✅ Messaging config updated.");try{await gc(p,a(r))}catch(w){alert("❌ Failed to store credential."),console.warn(w)}}catch(w){alert("❌ Failed to update config."),console.warn(w)}}async function d(p){const w=p.detail.title,k=localStorage.getItem("skygit_token");console.log("[SkyGit] 🧪 handleCreate() called with title:",w),await Rc(k,a(r),w),y(o,!1)}function v(){y(o,!1)}function u(){if(!a(r))return;const p=`https://github.com/${a(r).full_name}/settings/discussions`;window.open(p,"_blank")}async function _(){const p=localStorage.getItem("skygit_token");if(!p||!a(r))return;const w=await fetch(`https://api.github.com/repos/${a(r).full_name}`,{headers:{Authorization:`token ${p}`}});if(w.ok){const k=await w.json(),$=!a(r).has_discussions;Se(r,a(r).has_discussions=k.has_discussions),Dr.set({...a(r)}),Ct.update(M=>M.map(S=>S.full_name===a(r).full_name?{...a(r)}:S)),await bl(),$&&a(r).has_discussions?y(i,"✅ Discussions enabled! You can now use messaging."):a(r).has_discussions?y(i,""):y(i,"❌ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{y(i,"")},4e3)}}Ze(),Kr(e,{children:(p,w)=>{var k=Ae(),$=ve(k);{var M=b=>{var R=Bf(),F=h(R),D=h(F),I=g(F,2),B=h(I),ee=g(h(B)),q=g(B,2),Q=g(h(q)),me=g(q,2),Ce=g(h(me),2),Re=h(Ce),$e=g(me,2),J=g(h($e)),re=g($e,2),de=g(h(re)),P=g(re,2),L=g(h(P),2);{var X=G=>{var Z=Gf();m(G,Z)},ce=G=>{var Z=Uf(),we=g(ve(Z),2),ne=g(we,2),Ge=g(ne,2);{var _e=xe=>{var gt=Ff();let Lt;var ht=h(gt);Y(Pt=>{Lt=On(gt,1,"ml-2 text-xs font-semibold",null,Lt,Pt),K(ht,a(i))},[()=>({"text-green-700":a(i).startsWith("✅"),"text-red-600":a(i).startsWith("❌")})],vt),m(xe,gt)};T(Ge,xe=>{a(i)&&xe(_e)})}N("click",we,u),N("click",ne,_),m(G,Z)};T(L,G=>{a(r).has_discussions?G(X):G(ce,!1)})}var W=g(I,2);{var te=G=>{var Z=Jf(),we=h(Z);{var ne=_e=>{var xe=zf();m(_e,xe)},Ge=_e=>{var xe=Le("💬 Activate Messaging");m(_e,xe)};T(we,_e=>{a(s)?_e(ne):_e(Ge,!1)})}Y(()=>Z.disabled=a(s)),N("click",Z,l),m(G,Z)};T(W,G=>{a(r).has_messages||G(te)})}var V=g(W,2);{var ge=G=>{var Z=qf();m(G,Z)},be=(G,Z)=>{{var we=ne=>{var Ge=Hf(),_e=ve(Ge),xe=g(h(_e),2),gt=h(xe),Lt=g(h(gt)),ht=g(gt,2),Pt=g(h(ht));Y(()=>{a(r),gs(()=>{})});var Xt=h(Pt);Xt.value=(Xt.__value="gitfs")==null?"":"gitfs";var en=g(Xt);en.value=(en.__value="s3")==null?"":"s3";var tn=g(en);tn.value=(tn.__value="google_drive")==null?"":"google_drive";var mn=g(ht,2),bn=g(h(mn));Y(()=>{a(r),gs(()=>{a(n)})});var ye=h(bn);ye.value=((ye.__value="")==null,"");var De=g(ye);It(De,1,()=>a(n).filter(ie=>ie.type===a(r).config.binary_storage_type),ar,(ie,x)=>{var C=Vf(),O={},U=h(C);Y(()=>{O!==(O=a(x).url)&&(C.value=(C.__value=a(x).url)==null?"":a(x).url),K(U,a(x).url)}),m(ie,C)});var Gt=g(xe,2),Ft=g(_e,2),nn=g(Ft,2);{var rn=ie=>{Lf(ie,{$$events:{create:d,cancel:v}})};T(nn,ie=>{a(o)&&ie(rn)})}tt(Lt,()=>a(r).config.commit_frequency_min,ie=>Se(r,a(r).config.commit_frequency_min=ie)),ys(Pt,()=>a(r).config.binary_storage_type,ie=>Se(r,a(r).config.binary_storage_type=ie)),ys(bn,()=>a(r).config.storage_info.url,ie=>Se(r,a(r).config.storage_info.url=ie)),N("click",Gt,f),N("click",Ft,()=>y(o,!0)),m(ne,Ge)};T(G,ne=>{a(r).has_messages&&a(r).config&&ne(we)},Z)}};T(V,G=>{a(r).has_discussions?G(be,!1):G(ge)})}Y(()=>{K(D,a(r).full_name),K(ee,` ${a(r).name??""}`),K(Q,` ${a(r).owner??""}`),Et(Ce,"href",a(r).url),K(Re,a(r).url),K(J,` ${(a(r).private?"🔒 Private":"🌐 Public")??""}`),K(de,` ${(a(r).has_messages?"💬 Available":"🚫 Not enabled")??""}`)}),m(b,R)},S=b=>{var R=Wf();m(b,R)};T($,b=>{a(r)?b(M):b(S,!1)})}m(p,k)},$$slots:{default:!0}}),He()}var Qf=A('<p class="text-center mt-20">Loading...</p>');function Yf(e,t){Ve(t,!1);const[n,r]=Br(),s=()=>pn(at,"$currentRoute",n),o=()=>pn(Ee,"$syncState",n);let i=j(null),c=null,l=j("");wt.subscribe($=>{$.isLoggedIn||(at.set("login"),y(i,null),c=null)}),vr(()=>{const $=wc();$?f($):at.set("login")});async function f($){y(l,"");const M=await mc($);if(!M){localStorage.removeItem("skygit_token"),y(l,"Invalid token. Please check your PAT and try again."),at.set("login");return}y(i,$),c=M,bc($),wt.set({isLoggedIn:!0,token:a(i),user:c}),await cc(a(i),c.login)?(at.set("home"),await u()):at.set("consent")}async function d(){await uc(a(i)),at.set("home"),await u()}function v(){localStorage.removeItem("skygit_token"),at.set("login")}async function u(){try{console.log("[SkyGit] Initializing app state..."),await Ic(a(i))}catch($){console.warn("[SkyGit] Failed to initialize startup state:",$)}}window.addEventListener("beforeunload",$=>{(ja()||Ea())&&(Ir(),ir(),$.preventDefault(),$.returnValue="")}),ut(()=>(s(),o(),a(i)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{xs(a(i))}catch($){console.warn("[SkyGit] Repo discovery failed:",$)}}),ur(),Ze();var _=Ae(),p=ve(_);{var w=$=>{var M=Qf();m($,M)},k=($,M)=>{{var S=R=>{Gc(R,{onSubmit:f,get error(){return a(l)}})},b=(R,F)=>{{var D=B=>{zc(B,{onApprove:d,onReject:v})},I=(B,ee)=>{{var q=me=>{zu(me,{})},Q=(me,Ce)=>{{var Re=J=>{Mf(J,{})},$e=(J,re)=>{{var de=L=>{Kf(L,{})},P=L=>{Eu(L)};T(J,L=>{s()==="repos"?L(de):L(P,!1)},re)}};T(me,J=>{s()==="chats"?J(Re):J($e,!1)},Ce)}};T(B,me=>{s()==="settings"?me(q):me(Q,!1)},ee)}};T(R,B=>{s()==="consent"?B(D):B(I,!1)},F)}};T($,R=>{s()==="login"?R(S):R(b,!1)},M)}};T(p,$=>{s()==="loading"?$(w):$(k,!1)})}m(e,_),He(),r()}Il(Yf,{target:document.getElementById("app")});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});
