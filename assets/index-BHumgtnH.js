(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Js=!1;var wr=Array.isArray,li=Array.prototype.indexOf,ds=Array.from,_o=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,bo=Object.getOwnPropertyDescriptors,ci=Object.prototype,ui=Array.prototype,vs=Object.getPrototypeOf,Vs=Object.isExtensible;function On(e){return typeof e=="function"}const gn=()=>{};function fi(e){return e()}function ur(e){for(var t=0;t<e.length;t++)e[t]()}const ct=2,mo=4,xr=8,ps=16,Nt=32,xn=64,fr=128,st=256,dr=512,We=1024,It=2048,on=4096,Pt=8192,kr=16384,di=32768,Sr=65536,yo=1<<17,vi=1<<19,wo=1<<20,Xr=1<<21,yt=Symbol("$state"),xo=Symbol("legacy props"),pi=Symbol("");function ko(e){return e===this.v}function hs(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function gs(e){return!hs(e,this.v)}function hi(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function gi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function _i(e){throw new Error("https://svelte.dev/e/effect_orphan")}function bi(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function mi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function yi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function wi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function xi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let kn=!1,ki=!1;function Si(){kn=!0}const _s=1,bs=2,So=4,Ci=8,$i=16,Ei=1,Pi=2,Co=4,Ai=8,Ri=16,$o=1,Oi=2,qe=Symbol(),Ti="http://www.w3.org/1999/xhtml",Di="http://www.w3.org/2000/svg";function Eo(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let de=null;function Hs(e){de=e}function Ve(e,t=!1,n){var r=de={p:de,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};kn&&!t&&(de.l={s:null,u:null,r1:[],r2:bn(!1)}),ms(()=>{r.d=!0})}function He(e){const t=de;if(t!==null){const a=t.e;if(a!==null){var n=ie,r=se;t.e=null;try{for(var s=0;s<a.length;s++){var o=a[s];Kt(o.effect),wt(o.reaction),Cn(o.fn)}}finally{Kt(n),wt(r)}}de=t.p,t.m=!0}return{}}function Yn(){return!kn||de!==null&&de.l===null}function en(e,t){if(typeof e!="object"||e===null||yt in e)return e;const n=vs(e);if(n!==ci&&n!==ui)return e;var r=new Map,s=wr(e),o=Jt(0),a=se,c=l=>{var u=se;wt(a);var f;return f=l(),wt(u),f};return s&&r.set("length",Jt(e.length)),new Proxy(e,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&yi();var d=r.get(u);return d===void 0?(d=c(()=>Jt(f.value)),r.set(u,d)):m(d,c(()=>en(f.value))),!0},deleteProperty(l,u){var f=r.get(u);if(f===void 0)u in l&&r.set(u,c(()=>Jt(qe)));else{if(s&&typeof u=="string"){var d=r.get("length"),v=Number(u);Number.isInteger(v)&&v<d.v&&m(d,v)}m(f,qe),Bs(o)}return!0},get(l,u,f){var g;if(u===yt)return e;var d=r.get(u),v=u in l;if(d===void 0&&(!v||(g=Wt(l,u))!=null&&g.writable)&&(d=c(()=>Jt(en(v?l[u]:qe))),r.set(u,d)),d!==void 0){var _=i(d);return _===qe?void 0:_}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var d=r.get(u);d&&(f.value=i(d))}else if(f===void 0){var v=r.get(u),_=v==null?void 0:v.v;if(v!==void 0&&_!==qe)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return f},has(l,u){var _;if(u===yt)return!0;var f=r.get(u),d=f!==void 0&&f.v!==qe||Reflect.has(l,u);if(f!==void 0||ie!==null&&(!d||(_=Wt(l,u))!=null&&_.writable)){f===void 0&&(f=c(()=>Jt(d?en(l[u]):qe)),r.set(u,f));var v=i(f);if(v===qe)return!1}return d},set(l,u,f,d){var x;var v=r.get(u),_=u in l;if(s&&u==="length")for(var g=f;g<v.v;g+=1){var y=r.get(g+"");y!==void 0?m(y,qe):g in l&&(y=c(()=>Jt(qe)),r.set(g+"",y))}v===void 0?(!_||(x=Wt(l,u))!=null&&x.writable)&&(v=c(()=>Jt(void 0)),m(v,c(()=>en(f))),r.set(u,v)):(_=v.v!==qe,m(v,c(()=>en(f))));var w=Reflect.getOwnPropertyDescriptor(l,u);if(w!=null&&w.set&&w.set.call(d,f),!_){if(s&&typeof u=="string"){var O=r.get("length"),S=Number(u);Number.isInteger(S)&&S>=O.v&&m(O,S+1)}Bs(o)}return!0},ownKeys(l){i(o);var u=Reflect.ownKeys(l).filter(v=>{var _=r.get(v);return _===void 0||_.v!==qe});for(var[f,d]of r)d.v!==qe&&!(f in l)&&u.push(f);return u},setPrototypeOf(){wi()}})}function Bs(e,t=1){m(e,e.v+t)}function qs(e){try{if(e!==null&&typeof e=="object"&&yt in e)return e[yt]}catch{}return e}function ji(e,t){return Object.is(qs(e),qs(t))}const Un=new Map;function bn(e,t){var n={f:0,v:e,reactions:null,equals:ko,rv:0,wv:0};return n}function Jt(e,t){const n=bn(e);return Bi(n),n}function N(e,t=!1){var r;const n=bn(e);return t||(n.equals=gs),kn&&de!==null&&de.l!==null&&((r=de.l).s??(r.s=[])).push(n),n}function he(e,t){return m(e,Xe(()=>i(e))),t}function m(e,t,n=!1){se!==null&&!mt&&Yn()&&(se.f&(ct|ps))!==0&&!(Je!=null&&Je.includes(e))&&xi();let r=n?en(t):t;return zn(e,r)}function zn(e,t){if(!e.equals(t)){var n=e.v;Xn?Un.set(e,t):Un.set(e,n),e.v=t,e.wv=zo(),Po(e,It),Yn()&&ie!==null&&(ie.f&We)!==0&&(ie.f&(Nt|xn))===0&&(tt===null?qi([e]):tt.push(e))}return t}function Ws(e,t=1){var n=i(e),r=t===1?n++:n--;return m(e,n),r}function Po(e,t){var n=e.reactions;if(n!==null)for(var r=Yn(),s=n.length,o=0;o<s;o++){var a=n[o],c=a.f;(c&It)===0&&(!r&&a===ie||(ft(a,t),(c&(We|st))!==0&&((c&ct)!==0?Po(a,on):Rr(a))))}}let Ni=!1;var Ks,Ao,Ro,Oo;function Ii(){if(Ks===void 0){Ks=window,Ao=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Ro=Wt(t,"firstChild").get,Oo=Wt(t,"nextSibling").get,Vs(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Vs(n)&&(n.__t=void 0)}}function Qn(e=""){return document.createTextNode(e)}function Et(e){return Ro.call(e)}function Cr(e){return Oo.call(e)}function h(e,t){return Et(e)}function fe(e,t){{var n=Et(e);return n instanceof Comment&&n.data===""?Cr(n):n}}function p(e,t=1,n=!1){let r=e;for(;t--;)r=Cr(r);return r}function Mi(e){e.textContent=""}function Jn(e){var t=ct|It,n=se!==null&&(se.f&ct)!==0?se:null;return ie===null||n!==null&&(n.f&st)!==0?t|=st:ie.f|=wo,{ctx:de,deps:null,effects:null,equals:ko,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ie}}function ut(e){const t=Jn(e);return t.equals=gs,t}function To(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Ot(t[n])}}function Li(e){for(var t=e.parent;t!==null;){if((t.f&ct)===0)return t;t=t.parent}return null}function Fi(e){var t,n=ie;Kt(Li(e));try{To(e),t=Vo(e)}finally{Kt(n)}return t}function Do(e){var t=Fi(e),n=(Bt||(e.f&st)!==0)&&e.deps!==null?on:We;ft(e,n),e.equals(t)||(e.v=t,e.wv=zo())}function jo(e){ie===null&&se===null&&_i(),se!==null&&(se.f&st)!==0&&ie===null&&gi(),Xn&&hi()}function Gi(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Sn(e,t,n,r=!0){var s=ie,o={ctx:de,deps:null,nodes_start:null,nodes_end:null,f:e|It,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Ar(o),o.f|=di}catch(l){throw Ot(o),l}else t!==null&&Rr(o);var a=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(wo|fr))===0;if(!a&&r&&(s!==null&&Gi(o,s),se!==null&&(se.f&ct)!==0)){var c=se;(c.effects??(c.effects=[])).push(o)}return o}function ms(e){const t=Sn(xr,null,!1);return ft(t,We),t.teardown=e,t}function es(e){jo();var t=ie!==null&&(ie.f&Nt)!==0&&de!==null&&!de.m;if(t){var n=de;(n.e??(n.e=[])).push({fn:e,effect:ie,reaction:se})}else{var r=Cn(e);return r}}function Ui(e){return jo(),an(e)}function zi(e){const t=Sn(xn,e,!0);return(n={})=>new Promise(r=>{n.outro?Vn(t,()=>{Ot(t),r(void 0)}):(Ot(t),r(void 0))})}function Cn(e){return Sn(mo,e,!1)}function lt(e,t){var n=de,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=an(()=>{e(),!r.ran&&(r.ran=!0,m(n.l.r2,!0),Xe(t))})}function Zn(){var e=de;an(()=>{if(i(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&We)!==0&&ft(n,on),$n(n)&&Ar(n),t.ran=!1}e.l.r2.v=!1}})}function an(e){return Sn(xr,e,!0)}function W(e,t=[],n=Jn){const r=t.map(n);return $r(()=>e(...r.map(i)))}function $r(e,t=0){return Sn(xr|ps|t,e,!0)}function mn(e,t=!0){return Sn(xr|Nt,e,!0,t)}function No(e){var t=e.teardown;if(t!==null){const n=Xn,r=se;Qs(!0),wt(null);try{t.call(null)}finally{Qs(n),wt(r)}}}function Io(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&xn)!==0?n.parent=null:Ot(n,t),n=r}}function Ji(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Nt)===0&&Ot(t),t=n}}function Ot(e,t=!0){var n=!1;if((t||(e.f&vi)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:Cr(r);r.remove(),r=o}n=!0}Io(e,t&&!n),gr(e,0),ft(e,kr);var a=e.transitions;if(a!==null)for(const l of a)l.stop();No(e);var c=e.parent;c!==null&&c.first!==null&&Mo(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Mo(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function Vn(e,t){var n=[];ys(e,n,!0),Lo(n,()=>{Ot(e),t&&t()})}function Lo(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function ys(e,t,n){if((e.f&Pt)===0){if(e.f^=Pt,e.transitions!==null)for(const a of e.transitions)(a.is_global||n)&&t.push(a);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&Sr)!==0||(r.f&Nt)!==0;ys(r,t,o?n:!1),r=s}}}function Hn(e){Fo(e,!0)}function Fo(e,t){if((e.f&Pt)!==0){e.f^=Pt,(e.f&We)===0&&(e.f^=We),$n(e)&&(ft(e,It),Rr(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&Sr)!==0||(n.f&Nt)!==0;Fo(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let Bn=[],ts=[];function Go(){var e=Bn;Bn=[],ur(e)}function Vi(){var e=ts;ts=[],ur(e)}function Er(e){Bn.length===0&&queueMicrotask(Go),Bn.push(e)}function Ys(){Bn.length>0&&Go(),ts.length>0&&Vi()}let ir=!1,vr=!1,pr=null,tn=!1,Xn=!1;function Qs(e){Xn=e}let Ln=[];let se=null,mt=!1;function wt(e){se=e}let ie=null;function Kt(e){ie=e}let Je=null;function Hi(e){Je=e}function Bi(e){se!==null&&se.f&Xr&&(Je===null?Hi([e]):Je.push(e))}let ze=null,Ye=0,tt=null;function qi(e){tt=e}let Uo=1,hr=0,Bt=!1,Ht=null;function zo(){return++Uo}function $n(e){var d;var t=e.f;if((t&It)!==0)return!0;if((t&on)!==0){var n=e.deps,r=(t&st)!==0;if(n!==null){var s,o,a=(t&dr)!==0,c=r&&ie!==null&&!Bt,l=n.length;if(a||c){var u=e,f=u.parent;for(s=0;s<l;s++)o=n[s],(a||!((d=o==null?void 0:o.reactions)!=null&&d.includes(u)))&&(o.reactions??(o.reactions=[])).push(u);a&&(u.f^=dr),c&&f!==null&&(f.f&st)===0&&(u.f^=st)}for(s=0;s<l;s++)if(o=n[s],$n(o)&&Do(o),o.wv>e.wv)return!0}(!r||ie!==null&&!Bt)&&ft(e,We)}return!1}function Wi(e,t){for(var n=t;n!==null;){if((n.f&fr)!==0)try{n.fn(e);return}catch{n.f^=fr}n=n.parent}throw ir=!1,e}function Ki(e){return(e.f&kr)===0&&(e.parent===null||(e.parent.f&fr)===0)}function Pr(e,t,n,r){if(ir){if(n===null&&(ir=!1),Ki(t))throw e;return}n!==null&&(ir=!0);{Wi(e,t);return}}function Jo(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];Je!=null&&Je.includes(e)||((o.f&ct)!==0?Jo(o,t,!1):t===o&&(n?ft(o,It):(o.f&We)!==0&&ft(o,on),Rr(o)))}}function Vo(e){var _;var t=ze,n=Ye,r=tt,s=se,o=Bt,a=Je,c=de,l=mt,u=e.f;ze=null,Ye=0,tt=null,Bt=(u&st)!==0&&(mt||!tn||se===null),se=(u&(Nt|xn))===0?e:null,Je=null,Hs(e.ctx),mt=!1,hr++,e.f|=Xr;try{var f=(0,e.fn)(),d=e.deps;if(ze!==null){var v;if(gr(e,Ye),d!==null&&Ye>0)for(d.length=Ye+ze.length,v=0;v<ze.length;v++)d[Ye+v]=ze[v];else e.deps=d=ze;if(!Bt)for(v=Ye;v<d.length;v++)((_=d[v]).reactions??(_.reactions=[])).push(e)}else d!==null&&Ye<d.length&&(gr(e,Ye),d.length=Ye);if(Yn()&&tt!==null&&!mt&&d!==null&&(e.f&(ct|on|It))===0)for(v=0;v<tt.length;v++)Jo(tt[v],e);return s!==null&&(hr++,tt!==null&&(r===null?r=tt:r.push(...tt))),f}finally{ze=t,Ye=n,tt=r,se=s,Bt=o,Je=a,Hs(c),mt=l,e.f^=Xr}}function Yi(e,t){let n=t.reactions;if(n!==null){var r=li.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&ct)!==0&&(ze===null||!ze.includes(t))&&(ft(t,on),(t.f&(st|dr))===0&&(t.f^=dr),To(t),gr(t,0))}function gr(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)Yi(e,n[r])}function Ar(e){var t=e.f;if((t&kr)===0){ft(e,We);var n=ie,r=de,s=tn;ie=e,tn=!0;try{(t&ps)!==0?Ji(e):Io(e),No(e);var o=Vo(e);e.teardown=typeof o=="function"?o:null,e.wv=Uo;var a=e.deps,c;Js&&ki&&e.f&It}catch(l){Pr(l,e,n,r||e.ctx)}finally{tn=s,ie=n}}}function Qi(){try{bi()}catch(e){if(pr!==null)Pr(e,pr,null);else throw e}}function Ho(){var e=tn;try{var t=0;for(tn=!0;Ln.length>0;){t++>1e3&&Qi();var n=Ln,r=n.length;Ln=[];for(var s=0;s<r;s++){var o=Xi(n[s]);Zi(o)}}}finally{vr=!1,tn=e,pr=null,Un.clear()}}function Zi(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(kr|Pt))===0)try{$n(r)&&(Ar(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Mo(r):r.fn=null))}catch(s){Pr(s,r,null,r.ctx)}}}function Rr(e){vr||(vr=!0,queueMicrotask(Ho));for(var t=pr=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(xn|Nt))!==0){if((n&We)===0)return;t.f^=We}}Ln.push(t)}function Xi(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Nt|xn))!==0,o=s&&(r&We)!==0;if(!o&&(r&Pt)===0){if((r&mo)!==0)t.push(n);else if(s)n.f^=We;else{var a=se;try{se=n,$n(n)&&Ar(n)}catch(u){Pr(u,n,null,n.ctx)}finally{se=a}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function el(e){var t;for(Ys();Ln.length>0;)vr=!0,Ho(),Ys();return t}async function tl(){await Promise.resolve(),el()}function i(e){var t=e.f,n=(t&ct)!==0;if(Ht!==null&&Ht.add(e),se!==null&&!mt){if(!(Je!=null&&Je.includes(e))){var r=se.deps;e.rv<hr&&(e.rv=hr,ze===null&&r!==null&&r[Ye]===e?Ye++:ze===null?ze=[e]:(!Bt||!ze.includes(e))&&ze.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&st)===0&&(s.f^=st)}return n&&(s=e,$n(s)&&Do(s)),Xn&&Un.has(e)?Un.get(e):e.v}function nl(e){var t=Ht;Ht=new Set;var n=Ht,r;try{if(Xe(e),t!==null)for(r of Ht)t.add(r)}finally{Ht=t}return n}function ns(e){var t=nl(()=>Xe(e));for(var n of t)if((n.f&yo)!==0)for(const r of n.deps||[])(r.f&ct)===0&&zn(r,r.v);else zn(n,n.v)}function Xe(e){var t=mt;try{return mt=!0,e()}finally{mt=t}}const rl=-7169;function ft(e,t){e.f=e.f&rl|t}function ws(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(yt in e)rs(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&yt in n&&rs(n)}}}function rs(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{rs(e[r],t)}catch{}const n=vs(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=bo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function sl(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const ol=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function al(e){return ol.includes(e)}const il={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function ll(e){return e=e.toLowerCase(),il[e]??e}const cl=["touchstart","touchmove"];function ul(e){return cl.includes(e)}function fl(e,t){if(t){const n=document.body;e.autofocus=!0,Er(()=>{document.activeElement===n&&e.focus()})}}let Zs=!1;function dl(){Zs||(Zs=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function Bo(e){var t=se,n=ie;wt(null),Kt(null);try{return e()}finally{wt(t),Kt(n)}}function xs(e,t,n,r=n){e.addEventListener(t,()=>Bo(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),dl()}const qo=new Set,ss=new Set;function Wo(e,t,n,r={}){function s(o){if(r.capture||Nn.call(t,o),!o.cancelBubble)return Bo(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Er(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function L(e,t,n,r,s){var o={capture:r,passive:s},a=Wo(e,t,n,o);(t===document.body||t===window||t===document)&&ms(()=>{t.removeEventListener(e,a,o)})}function vl(e){for(var t=0;t<e.length;t++)qo.add(e[t]);for(var n of ss)n(e)}function Nn(e){var S;var t=this,n=t.ownerDocument,r=e.type,s=((S=e.composedPath)==null?void 0:S.call(e))||[],o=s[0]||e.target,a=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var u=s.indexOf(t);if(u===-1)return;l<=u&&(a=l)}if(o=s[a]||e.target,o!==t){_o(e,"currentTarget",{configurable:!0,get(){return o||n}});var f=se,d=ie;wt(null),Kt(null);try{for(var v,_=[];o!==null;){var g=o.assignedSlot||o.parentNode||o.host||null;try{var y=o["__"+r];if(y!=null&&(!o.disabled||e.target===o))if(wr(y)){var[w,...O]=y;w.apply(o,[e,...O])}else y.call(o,e)}catch(x){v?_.push(x):v=x}if(e.cancelBubble||g===t||g===null)break;o=g}if(v){for(let x of _)queueMicrotask(()=>{throw x});throw v}}finally{e.__root=t,delete e.currentTarget,wt(f),Kt(d)}}}function Ko(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function rn(e,t){var n=ie;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function P(e,t){var n=(t&$o)!==0,r=(t&Oi)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=Ko(o?e:"<!>"+e),n||(s=Et(s)));var a=r||Ao?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=Et(a),l=a.lastChild;rn(c,l)}else rn(a,a);return a}}function Yo(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&$o)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,a;return()=>{if(!a){var c=Ko(o),l=Et(c);if(s)for(a=document.createDocumentFragment();Et(l);)a.appendChild(Et(l));else a=Et(l)}var u=a.cloneNode(!0);if(s){var f=Et(u),d=u.lastChild;rn(f,d)}else rn(u,u);return u}}function Ne(e=""){{var t=Qn(e+"");return rn(t,t),t}}function Ce(){var e=document.createDocumentFragment(),t=document.createComment(""),n=Qn();return e.append(t,n),rn(t,n),e}function b(e,t){e!==null&&e.before(t)}function B(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function pl(e,t){return hl(e,t)}const pn=new Map;function hl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:a=!0}){Ii();var c=new Set,l=d=>{for(var v=0;v<d.length;v++){var _=d[v];if(!c.has(_)){c.add(_);var g=ul(_);t.addEventListener(_,Nn,{passive:g});var y=pn.get(_);y===void 0?(document.addEventListener(_,Nn,{passive:g}),pn.set(_,1)):pn.set(_,y+1)}}};l(ds(qo)),ss.add(l);var u=void 0,f=zi(()=>{var d=n??t.appendChild(Qn());return mn(()=>{if(o){Ve({});var v=de;v.c=o}s&&(r.$$events=s),u=e(d,r)||{},o&&He()}),()=>{var g;for(var v of c){t.removeEventListener(v,Nn);var _=pn.get(v);--_===0?(document.removeEventListener(v,Nn),pn.delete(v)):pn.set(v,_)}ss.delete(l),d!==n&&((g=d.parentNode)==null||g.removeChild(d))}});return gl.set(u,f),u}let gl=new WeakMap;function j(e,t,[n,r]=[0,0]){var s=e,o=null,a=null,c=qe,l=n>0?Sr:0,u=!1;const f=(v,_=!0)=>{u=!0,d(_,v)},d=(v,_)=>{c!==(c=v)&&(c?(o?Hn(o):_&&(o=mn(()=>_(s))),a&&Vn(a,()=>{a=null})):(a?Hn(a):_&&(a=mn(()=>_(s,[n+1,r]))),o&&Vn(o,()=>{o=null})))};$r(()=>{u=!1,t(f),u||d(null,null)},l)}function qn(e,t){return t}function _l(e,t,n,r){for(var s=[],o=t.length,a=0;a<o;a++)ys(t[a].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;Mi(l),l.append(n),r.clear(),Vt(e,t[0].prev,t[o-1].next)}Lo(s,()=>{for(var u=0;u<o;u++){var f=t[u];c||(r.delete(f.k),Vt(e,f.prev,f.next)),Ot(f.e,!c)}})}function Tt(e,t,n,r,s,o=null){var a=e,c={flags:t,items:new Map,first:null},l=(t&So)!==0;if(l){var u=e;a=u.appendChild(Qn())}var f=null,d=!1,v=ut(()=>{var _=n();return wr(_)?_:_==null?[]:ds(_)});$r(()=>{var _=i(v),g=_.length;d&&g===0||(d=g===0,bl(_,c,a,s,t,r,n),o!==null&&(g===0?f?Hn(f):f=mn(()=>o(a)):f!==null&&Vn(f,()=>{f=null})),i(v))})}function bl(e,t,n,r,s,o,a){var _e,we,be,U;var c=(s&Ci)!==0,l=(s&(_s|bs))!==0,u=e.length,f=t.items,d=t.first,v=d,_,g=null,y,w=[],O=[],S,x,E,D;if(c)for(D=0;D<u;D+=1)S=e[D],x=o(S,D),E=f.get(x),E!==void 0&&((_e=E.a)==null||_e.measure(),(y??(y=new Set)).add(E));for(D=0;D<u;D+=1){if(S=e[D],x=o(S,D),E=f.get(x),E===void 0){var z=v?v.e.nodes_start:n;g=yl(z,t,g,g===null?t.first:g.next,S,x,D,r,s,a),f.set(x,g),w=[],O=[],v=g.next;continue}if(l&&ml(E,S,D,s),(E.e.f&Pt)!==0&&(Hn(E.e),c&&((we=E.a)==null||we.unfix(),(y??(y=new Set)).delete(E))),E!==v){if(_!==void 0&&_.has(E)){if(w.length<O.length){var J=O[0],I;g=J.prev;var Y=w[0],le=w[w.length-1];for(I=0;I<w.length;I+=1)Xs(w[I],J,n);for(I=0;I<O.length;I+=1)_.delete(O[I]);Vt(t,Y.prev,le.next),Vt(t,g,Y),Vt(t,le,J),v=J,g=le,D-=1,w=[],O=[]}else _.delete(E),Xs(E,v,n),Vt(t,E.prev,E.next),Vt(t,E,g===null?t.first:g.next),Vt(t,g,E),g=E;continue}for(w=[],O=[];v!==null&&v.k!==x;)(v.e.f&Pt)===0&&(_??(_=new Set)).add(v),O.push(v),v=v.next;if(v===null)continue;E=v}w.push(E),g=E,v=E.next}if(v!==null||_!==void 0){for(var ge=_===void 0?[]:ds(_);v!==null;)(v.e.f&Pt)===0&&ge.push(v),v=v.next;var ye=ge.length;if(ye>0){var ve=(s&So)!==0&&u===0?n:null;if(c){for(D=0;D<ye;D+=1)(be=ge[D].a)==null||be.measure();for(D=0;D<ye;D+=1)(U=ge[D].a)==null||U.fix()}_l(t,ge,ve,f)}}c&&Er(()=>{var ee;if(y!==void 0)for(E of y)(ee=E.a)==null||ee.apply()}),ie.first=t.first&&t.first.e,ie.last=g&&g.e}function ml(e,t,n,r){(r&_s)!==0&&zn(e.v,t),(r&bs)!==0?zn(e.i,n):e.i=n}function yl(e,t,n,r,s,o,a,c,l,u){var f=(l&_s)!==0,d=(l&$i)===0,v=f?d?N(s):bn(s):s,_=(l&bs)===0?a:bn(a),g={i:_,v,k:o,a:null,e:null,prev:n,next:r};try{return g.e=mn(()=>c(e,v,_,u),Ni),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?t.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function Xs(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var a=Cr(o);s.before(o),o=a}}function Vt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Mt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],a=!1;o===!0&&(o=t.children,a=!0),o===void 0||o(e,a?()=>r:r)}function wl(e,t,n,r,s,o){var a,c,l=null,u=e,f;$r(()=>{const d=t()||null;var v=Di;d!==a&&(f&&(d===null?Vn(f,()=>{f=null,c=null}):d===c?Hn(f):Ot(f)),d&&d!==c&&(f=mn(()=>{if(l=document.createElementNS(v,d),rn(l,l),r){var _=l.appendChild(Qn());r(l,_)}ie.nodes_end=l,u.before(l)})),a=d,a&&(c=a))},Sr)}function xl(e,t,n){Cn(()=>{var r=Xe(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};an(()=>{var a=n();ws(a),s&&hs(o,a)&&(o=a,r.update(a))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function Qo(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Qo(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function kl(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Qo(e))&&(r&&(r+=" "),r+=t);return r}function Sl(e){return typeof e=="object"?kl(e):e??""}const eo=[...` 	
\r\f \v\uFEFF`];function Cl(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,a=0;(a=r.indexOf(s,a))>=0;){var c=a+o;(a===0||eo.includes(r[a-1]))&&(c===r.length||eo.includes(r[c]))?r=(a===0?"":r.substring(0,a))+r.substring(c+1):a=c}}return r===""?null:r}function to(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function Hr(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function $l(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(Hr)),s&&l.push(...Object.keys(s).map(Hr));var u=0,f=-1;const y=e.length;for(var d=0;d<y;d++){var v=e[d];if(c?v==="/"&&e[d-1]==="*"&&(c=!1):o?o===v&&(o=!1):v==="/"&&e[d+1]==="*"?c=!0:v==='"'||v==="'"?o=v:v==="("?a++:v===")"&&a--,!c&&o===!1&&a===0){if(v===":"&&f===-1)f=d;else if(v===";"||d===y-1){if(f!==-1){var _=Hr(e.substring(u,f).trim());if(!l.includes(_)){v!==";"&&d++;var g=e.substring(u,d).trim();n+=" "+g+";"}}u=d+1,f=-1}}}}return r&&(n+=to(r)),s&&(n+=to(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function yn(e,t,n,r,s,o){var a=e.__className;if(a!==n){var c=Cl(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var u=!!o[l];(s==null||u!==!!s[l])&&e.classList.toggle(l,u)}return o}function Br(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function Zo(e,t,n,r){var s=e.__style;if(s!==t){var o=$l(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(Br(e,n==null?void 0:n[0],r[0]),Br(e,n==null?void 0:n[1],r[1],"important")):Br(e,n,r));return r}const Tn=Symbol("class"),Dn=Symbol("style"),Xo=Symbol("is custom element"),ea=Symbol("is html");function El(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function qt(e,t,n,r){var s=ta(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[pi]=n),n==null?e.removeAttribute(t):typeof n!="string"&&na(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function no(e,t,n,r,s=!1){var o=ta(e),a=o[Xo],c=!o[ea],l=t||{},u=e.tagName==="OPTION";for(var f in t)f in n||(n[f]=null);n.class?n.class=Sl(n.class):n[Tn]&&(n.class=null),n[Dn]&&(n.style??(n.style=null));var d=na(e);for(const x in n){let E=n[x];if(u&&x==="value"&&E==null){e.value=e.__value="",l[x]=E;continue}if(x==="class"){var v=e.namespaceURI==="http://www.w3.org/1999/xhtml";yn(e,v,E,r,t==null?void 0:t[Tn],n[Tn]),l[x]=E,l[Tn]=n[Tn];continue}if(x==="style"){Zo(e,E,t==null?void 0:t[Dn],n[Dn]),l[x]=E,l[Dn]=n[Dn];continue}var _=l[x];if(E!==_){l[x]=E;var g=x[0]+x[1];if(g!=="$$")if(g==="on"){const D={},z="$$"+x;let J=x.slice(2);var y=al(J);if(sl(J)&&(J=J.slice(0,-7),D.capture=!0),!y&&_){if(E!=null)continue;e.removeEventListener(J,l[z],D),l[z]=null}if(E!=null)if(y)e[`__${J}`]=E,vl([J]);else{let I=function(Y){l[x].call(this,Y)};var S=I;l[z]=Wo(J,e,I,D)}else y&&(e[`__${J}`]=void 0)}else if(x==="style")qt(e,x,E);else if(x==="autofocus")fl(e,!!E);else if(!a&&(x==="__value"||x==="value"&&E!=null))e.value=e.__value=E;else if(x==="selected"&&u)El(e,E);else{var w=x;c||(w=ll(w));var O=w==="defaultValue"||w==="defaultChecked";if(E==null&&!a&&!O)if(o[x]=null,w==="value"||w==="checked"){let D=e;const z=t===void 0;if(w==="value"){let J=D.defaultValue;D.removeAttribute(w),D.defaultValue=J,D.value=D.__value=z?J:null}else{let J=D.defaultChecked;D.removeAttribute(w),D.defaultChecked=J,D.checked=z?J:!1}}else e.removeAttribute(x);else O||d.includes(w)&&(a||typeof E!="string")?e[w]=E:typeof E!="function"&&qt(e,w,E)}}}return l}function ta(e){return e.__attributes??(e.__attributes={[Xo]:e.nodeName.includes("-"),[ea]:e.namespaceURI===Ti})}var ro=new Map;function na(e){var t=ro.get(e.nodeName);if(t)return t;ro.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=bo(r);for(var o in n)n[o].set&&t.push(o);r=vs(r)}return t}function Qe(e,t,n=t){var r=Yn();xs(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=qr(e)?Wr(o):o,n(o),r&&o!==(o=t())){var a=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=a,e.selectionEnd=Math.min(c,e.value.length))}}),Xe(t)==null&&e.value&&n(qr(e)?Wr(e.value):e.value),an(()=>{var s=t();qr(e)&&s===Wr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function sr(e,t,n=t){xs(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),Xe(t)==null&&n(e.checked),an(()=>{var r=t();e.checked=!!r})}function qr(e){var t=e.type;return t==="number"||t==="range"}function Wr(e){return e===""?null:+e}function ra(e,t,n){if(e.multiple)return Al(e,t);for(var r of e.options){var s=Fn(r);if(ji(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Pl(e,t){Cn(()=>{var n=new MutationObserver(()=>{var r=e.__value;ra(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function os(e,t,n=t){var r=!0;xs(e,"change",s=>{var o=s?"[selected]":":checked",a;if(e.multiple)a=[].map.call(e.querySelectorAll(o),Fn);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");a=c&&Fn(c)}n(a)}),Cn(()=>{var s=t();if(ra(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=Fn(o),n(s))}e.__value=s,r=!1}),Pl(e)}function Al(e,t){for(var n of e.options)n.selected=~t.indexOf(Fn(n))}function Fn(e){return"__value"in e?e.__value:e.value}function so(e,t){return e===t||(e==null?void 0:e[yt])===t}function In(e={},t,n,r){return Cn(()=>{var s,o;return an(()=>{s=o,o=[],Xe(()=>{e!==n(...o)&&(t(e,...o),s&&so(n(...s),e)&&t(null,...s))})}),()=>{Er(()=>{o&&so(n(...o),e)&&t(null,...o)})}}),e}function Rl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ke(e=!1){const t=de,n=t.l.u;if(!n)return;let r=()=>ws(t.s);if(e){let s=0,o={};const a=Jn(()=>{let c=!1;const l=t.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&s++,s});r=()=>i(a)}n.b.length&&Ui(()=>{oo(t,r),ur(n.b)}),es(()=>{const s=Xe(()=>n.m.map(fi));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&es(()=>{oo(t,r),ur(n.a)})}function oo(e,t){if(e.l.s)for(const n of e.l.s)i(n);t()}function sa(e,t,n){if(e==null)return t(void 0),gn;const r=Xe(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const hn=[];function ot(e,t=gn){let n=null;const r=new Set;function s(c){if(hs(e,c)&&(e=c,n)){const l=!hn.length;for(const u of r)u[1](),hn.push(u,e);if(l){for(let u=0;u<hn.length;u+=2)hn[u][0](hn[u+1]);hn.length=0}}}function o(c){s(c(e))}function a(c,l=gn){const u=[c,l];return r.add(u),r.size===1&&(n=t(s,o)||gn),c(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:a}}function Me(e){let t;return sa(e,n=>t=n)(),t}let or=!1,as=Symbol();function sn(e,t,n){const r=n[t]??(n[t]={store:null,source:N(void 0),unsubscribe:gn});if(r.store!==e&&!(as in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=gn;else{var s=!0;r.unsubscribe=sa(e,o=>{s?r.source.v=o:m(r.source,o)}),s=!1}return e&&as in n?Me(e):i(r.source)}function Or(){const e={};function t(){ms(()=>{for(var n in e)e[n].unsubscribe();_o(e,as,{enumerable:!1,value:!0})})}return[e,t]}function Ol(e){var t=or;try{return or=!1,[e(),or]}finally{or=t}}const Tl={get(e,t){if(!e.exclude.includes(t))return i(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=Ze({get[t](){return e.props[t]}},t,Co)),e.special[t](n),Ws(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),Ws(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function Dt(e,t){return new Proxy({props:e,exclude:t,special:{},version:bn(0)},Tl)}const Dl={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(On(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];On(s)&&(s=s());const o=Wt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(On(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Wt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===yt||t===xo)return!1;for(let n of e.props)if(On(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){On(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function ln(...e){return new Proxy({props:e},Dl)}function ao(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function Ze(e,t,n,r){var J;var s=(n&Ei)!==0,o=!kn||(n&Pi)!==0,a=(n&Ai)!==0,c=(n&Ri)!==0,l=!1,u;a?[u,l]=Ol(()=>e[t]):u=e[t];var f=yt in e||xo in e,d=a&&(((J=Wt(e,t))==null?void 0:J.set)??(f&&t in e&&(I=>e[t]=I)))||void 0,v=r,_=!0,g=!1,y=()=>(g=!0,_&&(_=!1,c?v=Xe(r):v=r),v);u===void 0&&r!==void 0&&(d&&o&&mi(),u=y(),d&&d(u));var w;if(o)w=()=>{var I=e[t];return I===void 0?y():(_=!0,g=!1,I)};else{var O=(s?Jn:ut)(()=>e[t]);O.f|=yo,w=()=>{var I=i(O);return I!==void 0&&(v=void 0),I===void 0?v:I}}if((n&Co)===0)return w;if(d){var S=e.$$legacy;return function(I,Y){return arguments.length>0?((!o||!Y||S||l)&&d(Y?w():I),I):w()}}var x=!1,E=!1,D=N(u),z=Jn(()=>{var I=w(),Y=i(D);return x?(x=!1,E=!0,Y):(E=!1,D.v=I)});return a&&i(z),s||(z.equals=gs),function(I,Y){if(Ht!==null&&(x=E,w(),i(D)),arguments.length>0){const le=Y?i(z):o&&a?en(I):I;if(!z.equals(le)){if(x=!0,m(D,le),g&&v!==void 0&&(v=le),ao(z))return I;Xe(()=>i(z))}return I}return ao(z)?z.v:i(z)}}function Tr(e){de===null&&Eo(),kn&&de.l!==null?Il(de).m.push(e):es(()=>{const t=Xe(e);if(typeof t=="function")return t})}function jl(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function Nl(){const e=de;return e===null&&Eo(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const a=wr(s)?s.slice():[s],c=jl(t,n,r);for(const l of a)l.call(e.x,c);return!c.defaultPrevented}return!0}}function Il(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const Ml="5";var go;typeof window<"u"&&((go=window.__svelte??(window.__svelte={})).v??(go.v=new Set)).add(Ml);Si();const At=ot({isLoggedIn:!1,token:null,user:null});function Kr(){At.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const nt=ot("home"),Dr=ot(null),Te=ot({phase:"streaming",paused:!1,loadedCount:0,totalCount:null}),Ll="modulepreload",Fl=function(e){return"/skygit/"+e},io={},wn=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=Fl(l),l in io)return;io[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Ll,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((v,_)=>{d.addEventListener("load",v),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function oa(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function is(e,t){const n=await oa(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+a.byteLength);return c.set(r,0),c.set(new Uint8Array(a),r.byteLength),btoa(String.fromCharCode(...c))}async function ks(e,t){const n=Uint8Array.from(atob(t),u=>u.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await oa(e),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(a);return JSON.parse(l)}const Gl="https://api.github.com",Ul="skygit-config";function aa(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}async function dt(e){const t=await fetch(`${Gl}/user`,{headers:aa(e)});if(!t.ok)throw new Error("Failed to fetch GitHub user");return(await t.json()).login}async function ia(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${Ul}`,{headers:aa(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function la(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},a=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:a})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function jr(e,t){const n=await dt(e),r=`repositories/${t.owner}-${t.name}.json`,s={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));let a=null;const c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:s});c.ok&&(a=(await c.json()).sha);const l={message:`Update repo ${t.full_name}`,content:o};a&&(l.sha=a);const u=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"PUT",headers:s,body:JSON.stringify(l)});if(!u.ok){const f=await u.text();throw new Error(`GitHub commit failed: ${f}`)}}async function Ss(e){const n=`https://api.github.com/repos/${await dt(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){Te.set({phase:"idle",loadedCount:0,totalCount:0,paused:!1});return}if(!s.ok){const c=await s.text();throw new Error(`Failed to load repository list: ${c}`)}const a=(await s.json()).filter(c=>c.name.endsWith(".json"));Te.set({phase:"streaming",loadedCount:0,totalCount:a.length,paused:!1});for(const c of a){let l=!1;if(Te.subscribe(u=>l=u.paused)(),l)break;try{const u=await fetch(c.url,{headers:r});if(!u.ok){console.warn(`[SkyGit] Skipped missing repo file: ${c.name} (${u.status})`);continue}const f=await u.json(),d=atob(f.content),v=JSON.parse(d);ga([v]),Te.update(_=>({..._,loadedCount:_.loadedCount+1}))}catch(u){console.warn(`[SkyGit] Skipped malformed repo file: ${c.name}`,u);continue}}Te.update(c=>({...c,phase:"idle"}))}async function ca(e){const n=`https://api.github.com/repos/${await dt(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const a=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of a){const u=await fetch(l.url,{headers:r});if(!u.ok)continue;const f=await u.json(),d=JSON.parse(atob(f.content));c.push(d)}return c}async function ua(e,t){const n=await dt(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),a=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!a.ok){const c=await a.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function fa(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),a=`https://api.github.com/repos/${t.full_name}/contents/.messages/config.json`;let c=null;try{const u=await fetch(a,{headers:n});if(u.ok)c=(await u.json()).sha;else if(u.status!==404){const f=await u.text();throw new Error(`Failed to check if config.json exists: ${f}`)}}catch(u){console.warn("Error checking for config.json",u)}const l=await fetch(a,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:s,...c&&{sha:c}})});if(!l.ok){const u=await l.text();throw new Error(`Failed to commit config.json: ${u}`)}t.has_messages=!0,t.config=r,await jr(e,t)}async function da(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),a=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let c=null;a.ok&&(c=(await a.json()).sha);const l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:o,...c&&{sha:c}})});if(!l.ok){const f=await l.text();throw new Error(`Failed to update config.json: ${f}`)}const{commitRepoToGitHub:u}=await wn(async()=>{const{commitRepoToGitHub:f}=await Promise.resolve().then(()=>zl);return{commitRepoToGitHub:f}},void 0);await u(e,t)}async function Nr(e){const n=`https://api.github.com/repos/${await dt(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function Gn(e,t,n=null){const s=`https://api.github.com/repos/${await dt(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const u=await l.text();throw new Error(`Failed to check secrets.json: ${u}`)}}const a={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(a)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function va(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials,s=await is(e,r),{secrets:o,sha:a}=await Nr(e);o[n]=s,await Gn(e,o,a)}const zl=Object.freeze(Object.defineProperty({__proto__:null,activateMessagingForRepo:fa,checkSkyGitRepoExists:ia,commitRepoToGitHub:jr,createSkyGitRepo:la,deleteRepoFromGitHub:ua,getGitHubUsername:dt,getSecretsMap:Nr,saveSecretsMap:Gn,storeEncryptedCredentials:va,streamPersistedConversationsFromGitHub:ca,streamPersistedReposFromGitHub:Ss,updateRepoMessagingConfig:da},Symbol.toStringTag,{value:"Module"})),pa="skygit_repos",Jl=5*60*1e3,Vl=10;let nn=[],_r=null;const Hl=JSON.parse(localStorage.getItem(pa)||"[]"),jt=ot(Hl),Cs=ot(0),$s=ot(null);jt.subscribe(e=>{localStorage.setItem(pa,JSON.stringify(e))});function ha(e){if(jt.update(n=>n.some(s=>s.full_name===e.full_name)?n:[...n,e]),nn.some(n=>n.full_name===e.full_name)||nn.push(e),nn.length>=Vl){br();return}_r||(_r=setTimeout(br,Jl))}async function br(){if(nn.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...nn];nn=[],clearTimeout(_r),_r=null;for(const n of t)try{await jr(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function ga(e){jt.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function _a(){return nn.length>0}function ba(e){let t;return jt.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const lo=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Cs,flushRepoCommitQueue:br,getRepoByFullName:ba,hasPendingRepoCommits:_a,queueRepoForCommit:ha,repoList:jt,selectedRepo:$s,syncRepoListFromGitHub:ga},Symbol.toStringTag,{value:"Module"}));async function Bl(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function ql(e){localStorage.setItem("skygit_token",e)}function Wl(){return localStorage.getItem("skygit_token")}const ma="skygit_conversations",Kl=JSON.parse(localStorage.getItem(ma)||"{}"),En=ot(Kl),Es=ot(null);En.subscribe(e=>{localStorage.setItem(ma,JSON.stringify(e))});function ls(e,t){En.update(n=>({...n,[e]:t}))}function Yl(e,t){En.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function ya(e,t,n){En.update(r=>{const o=(r[t]||[]).map(a=>a.id===e?{...a,messages:[...a.messages||[],n],updatedAt:n.timestamp||Date.now()}:a);return{...r,[t]:o}}),Es.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Oe=[];for(let e=0;e<256;++e)Oe.push((e+256).toString(16).slice(1));function Ql(e,t=0){return(Oe[e[t+0]]+Oe[e[t+1]]+Oe[e[t+2]]+Oe[e[t+3]]+"-"+Oe[e[t+4]]+Oe[e[t+5]]+"-"+Oe[e[t+6]]+Oe[e[t+7]]+"-"+Oe[e[t+8]]+Oe[e[t+9]]+"-"+Oe[e[t+10]]+Oe[e[t+11]]+Oe[e[t+12]]+Oe[e[t+13]]+Oe[e[t+14]]+Oe[e[t+15]]).toLowerCase()}let Yr;const Zl=new Uint8Array(16);function Xl(){if(!Yr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Yr=crypto.getRandomValues.bind(crypto)}return Yr(Zl)}const ec=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),co={randomUUID:ec};function tc(e,t,n){var s;if(co.randomUUID&&!e)return co.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??Xl();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ql(r)}async function nc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const a=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));ls(t.full_name,a),t.conversations=a.map(c=>c.id),await jr(e,t)}async function wa(e,t){console.log("[SkyGit] 📝 commitToSkyGitConversations() called"),console.log("⏩ Payload:",t);const n=await dt(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,a=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:a})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function rc(e,t,n){console.log("[SkyGit] 🔧 createConversation called for:",t.full_name,"with title:",n),await dt(e);const r=tc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,a={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(a)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const f=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${f}`)}try{console.log("[SkyGit] 📤 Now committing to skygit-config..."),await wa(e,a)}catch(f){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",f)}const u={id:r,name:s,path:o,repo:t.full_name,title:n};Yl(u,t)}const Mn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let lr=!1;function sc(){lr=!0}async function cs(e){lr=!1;const t=new Set,n=JSON.parse(localStorage.getItem("skygit_repos")||"[]").map(a=>a.full_name),r=[],s=await Qr("https://api.github.com/user/repos",Mn(e));r.push(...s),Te.update(a=>({...a,totalCount:r.length}));const o=await Qr("https://api.github.com/user/orgs",Mn(e));for(const a of o){if(lr)return;const c=await Qr(`https://api.github.com/orgs/${a.login}/repos`,Mn(e));r.push(...c),Te.update(l=>({...l,totalCount:r.length}))}for(const a of r){if(lr)return;const c=a.full_name;if(t.has(c)||n.includes(c)){Te.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(c);const l=await oc(e,c),u=typeof a.has_discussions=="boolean"?a.has_discussions:!1,f={name:a.name,owner:a.owner.login,full_name:c,url:a.html_url,private:a.private,has_messages:l,has_discussions:u,config:null};if(f.has_discussions)try{const d=await fetch(`https://api.github.com/repos/${c}/contents/.messages/config.json`,{headers:Mn(e)});if(d.ok){const v=await d.json();f.config=JSON.parse(atob(v.content)),await nc(e,f)}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${c}`,d)}Te.update(d=>({...d,loadedCount:d.loadedCount+1})),ha(f)}Te.update(a=>({...a,phase:"idle"}))}async function Qr(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),a=await o.json();o.ok&&Array.isArray(a)?(n=n.concat(a),s=a.length<100,r++):s=!0}return n}async function oc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Mn(e)})).status===200}catch{return!1}}const us=ot({config:null,secrets:{},secretsSha:null});async function ac(e){const t=await dt(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)ls(o,s[o]);console.log("[SkyGit] ✅ Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const a=JSON.parse(atob(o.content)),c={};for(const[l,u]of Object.entries(a))try{c[l]=await ks(e,u)}catch(f){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,f)}r.secrets=c,r.secretsSha=o.sha}catch(a){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",a),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}us.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await Ss(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await ca(e)||[],o={};for(const a of s)o[a.repo]||(o[a.repo]=[]),o[a.repo].push({id:a.id,title:a.title,name:`${a.repo.replace(/\W+/g,"_")}_${a.title.replace(/\W+/g,"_")}.json`,path:`.messages/${a.repo.replace(/\W+/g,"_")}_${a.title.replace(/\W+/g,"_")}.json`,repo:a.repo});for(const a in o)ls(a,o[a])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let Wn=new Set,cr=new Map;const ic=10;function Ps(e,t){const n=`${e}::${t}`;if(Wn.add(n),Wn.size>=ic){mr();return}const r=lc(e);if(!cr.has(n)){const s=setTimeout(()=>{mr([n]),cr.delete(n)},r);cr.set(n,s)}}function lc(e){var s;const n=Me(jt).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function mr(e=null){const t=e||Array.from(Wn);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await dt(n);const r=Me(En);for(const s of t){Wn.delete(s),cr.delete(s);const[o,a]=s.split("::"),l=(r[o]||[]).find(f=>f.id===a);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const u={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await wa(n,u);const f=`.messages/conversation-${u.id}.json`,d=btoa(JSON.stringify(u,null,2)),v=await fetch(`https://api.github.com/repos/${o}/contents/${f}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${u.id}`,content:d})});if(!v.ok){const _=await v.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(f){console.error("[SkyGit] Conversation commit failed:",f)}}}function xa(){return Wn.size>0}const As=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:mr,hasPendingConversationCommits:xa,queueConversationForCommit:Ps},Symbol.toStringTag,{value:"Module"}));var cc=P('<p class="text-red-500 text-sm"> </p>'),uc=P('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticating…',1),fc=P('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Don’t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function dc(e,t){Ve(t,!1);let n=Ze(t,"onSubmit",8),r=Ze(t,"error",8,null),s=N(""),o=N(!1);async function a(){i(o)||(m(o,!0),await n()(i(s)),m(o,!1))}Ke();var c=fc(),l=p(h(c),2),u=p(l,2);{var f=y=>{var w=cc(),O=h(w);W(()=>B(O,r())),b(y,w)};j(u,y=>{r()&&y(f)})}var d=p(u,2),v=h(d);{var _=y=>{var w=uc();b(y,w)},g=y=>{var w=Ne("Authenticate");b(y,w)};j(v,y=>{i(o)?y(_):y(g,!1)})}W(()=>{l.disabled=i(o),d.disabled=i(o)}),Qe(l,()=>i(s),y=>m(s,y)),L("click",d,a),b(e,c),He()}var vc=P('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),pc=P('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function hc(e,t){Ve(t,!1);let n=Ze(t,"onApprove",8),r=Ze(t,"onReject",8),s=N(!1);async function o(){i(s)||(m(s,!0),await n()(),m(s,!1))}Ke();var a=pc(),c=p(h(a),6),l=h(c),u=h(l);{var f=_=>{var g=vc();b(_,g)},d=_=>{var g=Ne("I Accept");b(_,g)};j(u,_=>{i(s)?_(f):_(d,!1)})}var v=p(l,2);W(()=>{l.disabled=i(s),v.disabled=i(s)}),L("click",l,o),L("click",v,function(..._){var g;(g=r())==null||g.apply(this,_)}),b(e,a),He()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const gc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var _c=Yo("<svg><!><!></svg>");function cn(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]),r=Dt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ve(t,!1);let s=Ze(t,"name",8,void 0),o=Ze(t,"color",8,"currentColor"),a=Ze(t,"size",8,24),c=Ze(t,"strokeWidth",8,2),l=Ze(t,"absoluteStrokeWidth",8,!1),u=Ze(t,"iconNode",24,()=>[]);const f=(...y)=>y.filter((w,O,S)=>!!w&&S.indexOf(w)===O).join(" ");Ke();var d=_c();let v;var _=h(d);Tt(_,1,u,qn,(y,w)=>{let O=()=>i(w)[0],S=()=>i(w)[1];var x=Ce(),E=fe(x);wl(E,O,!0,(D,z)=>{let J;W(()=>J=no(D,J,{...S()}))}),b(y,x)});var g=p(_);Mt(g,t,"default",{}),W((y,w)=>v=no(d,v,{...gc,...r,width:a(),height:a(),stroke:o(),"stroke-width":y,class:w}),[()=>l()?Number(c())*24/Number(a()):c(),()=>f("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],ut),b(e,d),He()}function bc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function mc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function uo(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function yc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function wc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function xc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}function kc(e,t){const n=Dt(t,["children","$$slots","$$events","$$legacy"]);cn(e,ln({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var a=Ce(),c=fe(a);Mt(c,t,"default",{}),b(s,a)},$$slots:{default:!0}}))}var Sc=P('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),Cc=P('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),$c=P('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></button>'),Ec=P('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),Pc=P('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function Ac(e,t){Ve(t,!1);const n=N();let r=N({});En.subscribe(u=>m(r,u));function s(u){Dr.set(u),Es.set(u),nt.set("chats")}lt(()=>i(r),()=>{m(n,Object.values(i(r)).flat().sort((u,f)=>{const d=new Date(u.updatedAt||u.createdAt||0).getTime();return new Date(f.updatedAt||f.createdAt||0).getTime()-d}))}),Zn(),Ke();var o=Pc(),a=h(o);Tt(a,1,()=>i(n),u=>u.id,(u,f)=>{var d=$c(),v=h(d),_=h(v),g=p(v,2),y=h(g),w=p(g,2);{var O=x=>{var E=Sc(),D=h(E);W(z=>B(D,z),[()=>i(f).messages.at(-1).content],ut),b(x,E)},S=x=>{var E=Cc();b(x,E)};j(w,x=>{i(f).messages&&i(f).messages.length>0?x(O):x(S,!1)})}W(x=>{B(_,x),B(y,i(f).repo)},[()=>i(f).title||`Conversation ${i(f).id.slice(0,6)}`],ut),L("click",d,()=>s(i(f))),b(u,d)});var c=p(a,2);{var l=u=>{var f=Ec();b(u,f)};j(c,u=>{i(n).length===0&&u(l)})}b(e,o),He()}var Rc=P('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),Oc=P('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),Tc=P('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">✔️ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">🔄 Sync</button> <button class="text-blue-600 text-xs underline">🔍 Discover</button></div></div>'),Dc=P('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),jc=P('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),Nc=P('<ul class="space-y-2"></ul>'),Ic=P('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),Mc=P('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),Lc=P('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> 🔒 Private</label> <label><input type="checkbox"> 🌐 Public</label> <label><input type="checkbox"> 💬 With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function Fc(e,t){Ve(t,!1);const n=N(),r=N();let s=Ze(t,"search",8,""),o=N([]),a=N(),c=N(),l=N(!0),u=N(!0),f=N(!0),d=N(!0);jt.subscribe(C=>m(o,C)),Te.subscribe(C=>m(a,C));function v(){Te.update(C=>({...C,paused:!C.paused}))}function _(){if(i(a).paused){Te.update(T=>({...T,paused:!1}));const C=localStorage.getItem("skygit_token");C&&cs(C)}else sc(),Te.update(C=>({...C,paused:!0}))}async function g(C){const T=i(o).find(H=>H.full_name===C);if(T){jt.update(H=>H.filter(K=>K.full_name!==C));try{const H=localStorage.getItem("skygit_token");await ua(H,T),console.log(`[SkyGit] Deleted ${C} from GitHub`)}catch(H){console.warn(`[SkyGit] Failed to delete ${C} from GitHub:`,H)}}}async function y(){const C=localStorage.getItem("skygit_token");C&&(Te.update(T=>({...T,phase:"streaming",paused:!1,loadedCount:0})),await Ss(C))}async function w(){const C=localStorage.getItem("skygit_token");C&&(Te.update(T=>({...T,phase:"discovery",paused:!1})),cs(C))}function O(C){if(!C.has_discussions){alert("Discussions are not enabled for this repository. Please enable Discussions in GitHub settings.");return}$s.set(C),Dr.set(C)}lt(()=>(i(o),ws(s()),i(l),i(u),i(f),i(d)),()=>{m(n,i(o).filter(C=>{const T=s().toLowerCase(),H=C.full_name.toLowerCase().includes(T)||C.name.toLowerCase().includes(T)||C.owner.toLowerCase().includes(T),K=C.private&&i(l)||!C.private&&i(u),Z=C.has_messages&&i(f)||!C.has_messages&&i(d);return H&&K&&Z}))}),lt(()=>i(n),()=>{Cs.set(i(n).length)}),lt(()=>i(o),()=>{m(r,i(o).some(C=>!C.has_discussions))}),Zn(),Ke();var S=Lc(),x=fe(S);{var E=C=>{var T=Rc(),H=h(T),K=h(H);uo(K,{class:"w-4 h-4 animate-spin text-blue-500"});var Z=p(K,2),ne=h(Z),ae=p(H,2),oe=h(ae);W(()=>{B(ne,`Syncing: ${i(a).loadedCount??""}/${i(a).totalCount??"?"}`),B(oe,i(a).paused?"Resume Syncing":"Pause Syncing")}),L("click",ae,v),b(C,T)},D=(C,T)=>{{var H=Z=>{var ne=Oc(),ae=h(ne);uo(ae,{class:"w-4 h-4 animate-spin text-blue-500"});var oe=p(ae,2),$e=h(oe),M=p(oe,2),q=h(M);W(()=>{B($e,`Discov.: ${i(a).loadedCount??""}/${i(a).totalCount??"?"}`),B(q,i(a).paused?"Resume Discovery":"Pause Discovery")}),L("click",M,_),b(Z,ne)},K=(Z,ne)=>{{var ae=oe=>{var $e=Tc(),M=p(h($e),2),q=h(M),xe=p(q,2);L("click",q,y),L("click",xe,w),b(oe,$e)};j(Z,oe=>{i(a).phase==="idle"&&oe(ae)},ne)}};j(C,Z=>{i(a).phase==="discovery"?Z(H):Z(K,!1)},T)}};j(x,C=>{i(a).phase==="streaming"?C(E):C(D,!1)})}var z=p(x,2),J=h(z),I=h(J),Y=p(J,2),le=h(Y),ge=p(Y,2),ye=h(ge),ve=p(ge,2),_e=h(ve),we=p(z,2);{var be=C=>{var T=Nc();Tt(T,5,()=>i(n),H=>H.full_name,(H,K)=>{var Z=jc(),ne=h(Z),ae=h(ne),oe=h(ae),$e=p(ae,2),M=h($e),q=p(M);{var xe=pe=>{var Ee=Dc();b(pe,Ee)};j(q,pe=>{i(K).has_discussions||pe(xe)})}In(ne,pe=>m(c,pe),()=>i(c));var ke=p(ne,2),et=h(ke);xc(et,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),W(()=>{ae.disabled=!i(K).has_discussions,B(oe,i(K).full_name),B(M,`${(i(K).has_messages?" | 💬 .messages":" | no messaging")??""} `)}),L("click",ae,()=>O(i(K))),L("click",ke,()=>g(i(K).full_name)),b(H,Z)}),b(C,T)},U=C=>{var T=Ic();b(C,T)};j(we,C=>{i(n).length>0?C(be):C(U,!1)})}var ee=p(we,2);{var Q=C=>{var T=Mc();b(C,T)};j(ee,C=>{i(r)&&C(Q)})}sr(I,()=>i(l),C=>m(l,C)),sr(le,()=>i(u),C=>m(u,C)),sr(ye,()=>i(f),C=>m(f,C)),sr(_e,()=>i(d),C=>m(d,C)),b(e,S),He()}var Gc=P('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function Uc(e){var t=Gc();b(e,t)}var zc=P('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function Jc(e){var t=zc();b(e,t)}var Vc=P('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function Hc(e){var t=Vc();b(e,t)}function Zr(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Bc=P('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),qc=P('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),Wc=P('<button type="button"><div><!></div> <!> </button>'),Kc=P('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">⋯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function Yc(e,t){Ve(t,!1);const[n,r]=Or(),s=()=>sn(nt,"$currentRoute",n),o=()=>sn(Cs,"$filteredCount",n);let a=N(null),c=N(!1),l=N("");function u(){nt.set("settings")}function f(U){nt.set(U)}At.subscribe(U=>{m(a,U.user)});const d=[{id:"chats",icon:yc,label:"Chats"},{id:"repos",icon:mc,label:"Repos"},{id:"calls",icon:wc,label:"Calls"},{id:"contacts",icon:kc,label:"Contacts"},{id:"notifications",icon:bc,label:"Notifs"}];function v(){m(c,!i(c))}function _(){m(c,!1)}Ke();var g=Kc(),y=h(g),w=h(y),O=h(w),S=p(O,2),x=h(S),E=h(x),D=p(x,2),z=h(D),J=p(w,2),I=p(J,2);{var Y=U=>{var ee=Bc(),Q=h(ee),C=p(Q,6);xl(ee,(T,H)=>Zr==null?void 0:Zr(T,H),()=>_),L("click",Q,u),L("click",C,function(...T){Kr==null||Kr.apply(this,T)}),b(U,ee)};j(I,U=>{i(c)&&U(Y)})}var le=p(y,2),ge=h(le),ye=p(le,2);Tt(ye,5,()=>d,qn,(U,ee)=>{let Q=()=>i(ee).id,C=()=>i(ee).icon,T=()=>i(ee).label;var H=Wc();let K;var Z=h(H),ne=h(Z);C()(ne,{class:"w-5 h-5"});var ae=p(Z,2);{var oe=M=>{var q=qc(),xe=h(q);W(()=>B(xe,o())),b(M,q)};j(ae,M=>{Q()==="repos"&&i(l).trim()!==""&&M(oe)})}var $e=p(ae);W(M=>{K=yn(H,1,"relative flex flex-col items-center text-xs focus:outline-none",null,K,M),yn(Z,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===Q()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),B($e,` ${T()??""}`)},[()=>({"text-blue-600":s()===Q()})],ut),L("click",H,()=>f(Q())),b(U,H)});var ve=p(ye,2),_e=h(ve);{var we=U=>{Ac(U,{})},be=(U,ee)=>{{var Q=T=>{Fc(T,{get search(){return i(l)}})},C=(T,H)=>{{var K=ne=>{Uc(ne)},Z=(ne,ae)=>{{var oe=M=>{Jc(M)},$e=(M,q)=>{{var xe=ke=>{Hc(ke)};j(M,ke=>{s()==="notifications"&&ke(xe)},q)}};j(ne,M=>{s()==="contacts"?M(oe):M($e,!1)},ae)}};j(T,ne=>{s()==="calls"?ne(K):ne(Z,!1)},H)}};j(U,T=>{s()==="repos"?T(Q):T(C,!1)},ee)}};j(_e,U=>{s()==="chats"?U(we):U(be,!1)})}W(()=>{var U,ee,Q,C;qt(O,"src",(U=i(a))==null?void 0:U.avatar_url),B(E,((ee=i(a))==null?void 0:ee.name)||((Q=i(a))==null?void 0:Q.login)),B(z,`@${((C=i(a))==null?void 0:C.login)??""}`)}),L("click",J,v),Qe(ge,()=>i(l),U=>m(l,U)),b(e,g),He(),r()}var Qc=P('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">←</button>'),Zc=P('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Ir(e,t){Ve(t,!1);let n=N(!1);function r(g){m(n,g.detail.open)}At.subscribe(g=>{g.user}),Tr(()=>{const g=()=>{window.innerWidth>=768&&m(n,!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)}),Dr.subscribe(g=>{g&&window.innerWidth<768&&m(n,!1)}),Ke();var s=Zc(),o=h(s),a=h(o);{var c=g=>{var y=Qc();L("click",y,()=>m(n,!0)),b(g,y)};j(a,g=>{i(n)||g(c)})}var l=p(o,2);let u;var f=h(l);Yc(f,{$$events:{toggle:r}});var d=p(l,2);let v;var _=h(d);Mt(_,t,"default",{}),W((g,y)=>{u=yn(l,1,"sidebar md:block svelte-scw01y",null,u,g),v=yn(d,1,"main w-full svelte-scw01y",null,v,y)},[()=>({hidden:!i(n),open:i(n)}),()=>({hidden:i(n)})],ut),b(e,s),He()}var Xc=P('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function eu(e){Ir(e,{children:(t,n)=>{var r=Xc();b(t,r)},$$slots:{default:!0}})}var tu=P('<button title="Save">💾</button>'),nu=P('<button title="Edit">✏️</button>'),ru=P('<button title="Hide">🙈</button> <!>',1),su=P('<button title="Reveal">👁️</button>'),ou=P('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),au=P('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),iu=P('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),lu=P('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),cu=P('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">🗑️</button></td></tr> <!>',1),uu=P('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),fu=P('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),du=P('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">🔐 Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">➕ Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">💾 Add Credential</button></div></div>');function vu(e,t){Ve(t,!1);let n=N({}),r=N({}),s=N(new Set),o=N(null),a=N(""),c=N("s3"),l=N({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),u=N({}),f=null;const d=localStorage.getItem("skygit_token");Tr(async()=>{if(!d)return;const S=await Nr(d);m(n,S.secrets),f=S.sha});async function v(S){try{i(r)[S]||he(r,i(r)[S]=await ks(d,i(n)[S])),m(s,new Set(i(s)).add(S))}catch{alert("❌ Failed to decrypt.")}}function _(S){m(s,new Set([...i(s)].filter(x=>x!==S))),i(o)===S&&m(o,null)}function g(S){i(s).has(S)||m(s,new Set(i(s)).add(S)),m(o,S),m(u,{...i(r)[S]})}async function y(S){const x=await is(d,i(u));he(n,i(n)[S]=x),he(r,i(r)[S]=i(u)),m(s,new Set(i(s)).add(S)),m(o,null),await Gn(d,i(n),f)}async function w(S){confirm(`Are you sure you want to delete the credential for:
${S}?`)&&(delete i(n)[S],delete i(r)[S],m(s,new Set([...i(s)].filter(x=>x!==S))),i(o)===S&&m(o,null),await Gn(d,i(n),f))}async function O(){if(!i(a)||!i(c))return;const S=i(c)==="s3"?{type:"s3",accessKeyId:i(l).accessKeyId||"",secretAccessKey:i(l).secretAccessKey||"",region:i(l).region||""}:{type:"google_drive",client_id:i(l).client_id||"",client_secret:i(l).client_secret||"",refresh_token:i(l).refresh_token||""},x=await is(d,S);he(n,i(n)[i(a)]=x),he(r,i(r)[i(a)]=S),m(s,new Set(i(s)).add(i(a))),m(a,""),m(c,"s3"),m(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await Gn(d,i(n),f)}Ke(),Ir(e,{children:(S,x)=>{var E=du(),D=p(h(E),2),z=p(h(D));Tt(z,5,()=>Object.entries(i(n)),qn,(Q,C)=>{let T=()=>i(C)[0],H=()=>i(C)[1];var K=cu(),Z=fe(K),ne=h(Z),ae=h(ne),oe=p(ne),$e=h(oe),M=p(oe),q=h(M);{var xe=ce=>{var Se=Ne();W(()=>B(Se,i(r)[T()].type==="s3"?"S3":"Google Drive")),b(ce,Se)},ke=ce=>{var Se=Ne("?");b(ce,Se)};j(q,ce=>{i(r)[T()]?ce(xe):ce(ke,!1)})}var et=p(M),pe=h(et);{var Ee=ce=>{var Se=ru(),St=fe(Se),Yt=p(St,2);{var Gt=Ae=>{var Le=tu();L("click",Le,()=>y(T())),b(Ae,Le)},Ct=Ae=>{var Le=nu();L("click",Le,()=>g(T())),b(Ae,Le)};j(Yt,Ae=>{i(o)===T()?Ae(Gt):Ae(Ct,!1)})}L("click",St,()=>_(T())),b(ce,Se)},vt=ce=>{var Se=su();L("click",Se,()=>v(T())),b(ce,Se)};j(pe,ce=>{i(s).has(T())?ce(Ee):ce(vt,!1)})}var Lt=p(pe,2),Ft=p(Z,2);{var kt=ce=>{var Se=lu(),St=h(Se),Yt=h(St);{var Gt=Ae=>{var Le=au(),$t=fe(Le),k=p(h($t),2),$=h(k),R={},G=h($),V=p($t,2);Tt(V,1,()=>Object.entries(i(u)),qn,(te,re)=>{let X=()=>i(re)[0];var Fe=Ce(),pt=fe(Fe);{var Ge=ht=>{var Ut=ou(),Qt=h(Ut),Zt=h(Qt),un=p(Qt,2);W(()=>B(Zt,X())),Qe(un,()=>i(u)[X()],fn=>he(u,i(u)[X()]=fn)),b(ht,Ut)};j(pt,ht=>{X()!=="type"&&ht(Ge)})}b(te,Fe)}),W(()=>{R!==(R=i(u).type)&&($.value=($.__value=i(u).type)==null?"":i(u).type),B(G,i(u).type)}),b(Ae,Le)},Ct=Ae=>{var Le=iu(),$t=h(Le);W(k=>B($t,`${k??""}
                                    `),[()=>JSON.stringify(i(r)[T()],null,2)],ut),b(Ae,Le)};j(Yt,Ae=>{i(o)===T()?Ae(Gt):Ae(Ct,!1)})}b(ce,Se)};j(Ft,ce=>{i(s).has(T())&&ce(kt)})}W(ce=>{B(ae,T()),B($e,`${ce??""}...`)},[()=>H().slice(0,20)],ut),L("click",Lt,()=>w(T())),b(Q,K)});var J=p(D,2),I=p(h(J),2),Y=h(I),le=p(h(Y)),ge=p(Y,2),ye=p(h(ge));W(()=>{i(c),ns(()=>{})});var ve=h(ye);ve.value=(ve.__value="s3")==null?"":"s3";var _e=p(ve);_e.value=(_e.__value="google_drive")==null?"":"google_drive";var we=p(I,2);{var be=Q=>{var C=uu(),T=h(C),H=p(h(T)),K=p(T,2),Z=p(h(K)),ne=p(K,2),ae=p(h(ne));Qe(H,()=>i(l).accessKeyId,oe=>he(l,i(l).accessKeyId=oe)),Qe(Z,()=>i(l).secretAccessKey,oe=>he(l,i(l).secretAccessKey=oe)),Qe(ae,()=>i(l).region,oe=>he(l,i(l).region=oe)),b(Q,C)},U=(Q,C)=>{{var T=H=>{var K=fu(),Z=h(K),ne=p(h(Z)),ae=p(Z,2),oe=p(h(ae)),$e=p(ae,2),M=p(h($e));Qe(ne,()=>i(l).client_id,q=>he(l,i(l).client_id=q)),Qe(oe,()=>i(l).client_secret,q=>he(l,i(l).client_secret=q)),Qe(M,()=>i(l).refresh_token,q=>he(l,i(l).refresh_token=q)),b(H,K)};j(Q,H=>{i(c)==="google_drive"&&H(T)},C)}};j(we,Q=>{i(c)==="s3"?Q(be):Q(U,!1)})}var ee=p(we,2);Qe(le,()=>i(a),Q=>m(a,Q)),os(ye,()=>i(c),Q=>m(c,Q)),L("click",ee,O),b(S,E)},$$slots:{default:!0}}),He()}var pu=P('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),hu=P('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),gu=P('<div class="p-4 space-y-3"><!></div>');function _u(e,t){Ve(t,!1);const[n,r]=Or(),s=()=>sn(Es,"$selectedConversation",n),o=N(),a=N();lt(()=>s(),()=>{m(o,s())}),lt(()=>i(o),()=>{var d;m(a,((d=i(o))==null?void 0:d.messages)??[])}),lt(()=>i(a),()=>{console.log("[MessageList] Updated messages:",i(a))}),Zn(),Ke();var c=gu(),l=h(c);{var u=d=>{var v=Ce(),_=fe(v);Tt(_,1,()=>i(a),g=>g.id||g.timestamp,(g,y)=>{var w=pu(),O=h(w),S=h(O),x=p(O,2),E=h(x),D=p(x,2),z=h(D);W(J=>{B(S,i(y).sender),B(E,i(y).content),B(z,J)},[()=>new Date(i(y).timestamp).toLocaleString()],ut),b(g,w)}),b(d,v)},f=d=>{var v=hu();b(d,v)};j(l,d=>{i(a).length>0?d(u):d(f,!1)})}b(e,c),He(),r()}const er="https://api.github.com";async function Mr(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`${er}/repos/${t}/discussions`,s=await fetch(r,{headers:n});if(!s.ok)throw new Error("Failed to list discussions");let a=(await s.json()).find(u=>u.title==="SkyGit Presence Channel");if(a)return a.number;const c=await fetch(r,{method:"POST",headers:n,body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."})});if(!c.ok)throw new Error("Failed to create presence discussion");return(await c.json()).number}function bu(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function mu(e,t,n,r,s=null){const o=await Mr(e,t),a={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${er}/repos/${t}/discussions/${o}/comments`,l=new Date().toISOString();let u=l;const f=await fetch(c,{headers:a});let d=[];f.ok&&(d=await f.json());const v=d.find(y=>{try{const w=JSON.parse(y.body);return w.username===n&&w.session_id===r}catch{return!1}});if(v)try{const y=JSON.parse(v.body);y.join_timestamp&&(u=y.join_timestamp)}catch{}const _={username:n,session_id:r,join_timestamp:u,last_seen:l,signaling_info:s};let g=!1;if(v){let y;try{y=JSON.parse(v.body)}catch{y={}}const w=Math.abs(new Date(l)-new Date(y.last_seen));(!bu(y,_)||w>3e4)&&(g=!0)}if(v&&g){const y=`${c}/${v.id}`,w=await fetch(y,{method:"PATCH",headers:a,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] updated presence comment",w.status,w.statusText)}else if(!v){const y=await fetch(c,{method:"POST",headers:a,body:JSON.stringify({body:JSON.stringify(_)})});console.log("[SkyGit][Presence] posted new presence comment",y.status,y.statusText)}for(const y of d)try{const w=JSON.parse(y.body);if(w.username===n&&w.session_id!==r){const O=`${c}/${y.id}`;await fetch(O,{method:"DELETE",headers:a}),console.log("[SkyGit][Presence] deleted old presence comment",y.id)}}catch{}}async function yu(e,t,n,r,s){const o=await Mr(e,t),a={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},c=`${er}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:a});if(!l.ok)return;const f=(await l.json()).find(d=>{try{const v=JSON.parse(d.body);return v.username===n&&v.session_id===r}catch{return!1}});if(f){let d;try{d=JSON.parse(f.body)}catch{d={}}d.pendingRemovalBy=s,d.pendingRemovalAt=new Date().toISOString();const v=`${c}/${f.id}`;await fetch(v,{method:"PATCH",headers:a,body:JSON.stringify({body:JSON.stringify(d)})}),console.log("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function wu(e,t,n,r){const s=await Mr(e,t),o={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},a=`${er}/repos/${t}/discussions/${s}/comments`,c=await fetch(a,{headers:o});if(!c.ok)return;const u=(await c.json()).find(f=>{try{const d=JSON.parse(f.body);return d.username===n&&d.session_id===r}catch{return!1}});if(u){let f;try{f=JSON.parse(u.body)}catch{f={}}if(f.pendingRemovalBy&&f.pendingRemovalAt&&Date.now()-new Date(f.pendingRemovalAt).getTime()>6e4){const v=`${a}/${u.id}`;await fetch(v,{method:"DELETE",headers:o}),console.log("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function xu(e,t){const n=await Mr(e,t),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=`${er}/repos/${t}/discussions/${n}/comments`,o=await fetch(s,{headers:r});if(!o.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",o.status,o.statusText),[];const a=await o.json(),c=Date.now(),l=a.map(u=>{try{return JSON.parse(u.body)}catch{return null}}).filter(Boolean).filter(u=>u.last_seen&&c-new Date(u.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",l),l}async function yr(e,t,n,r,s=null){await mu(e,t,n,r,s)}async function ku(e,t){return await xu(e,t)}class Su{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:a,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:u,onFileSendProgress:f}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=a,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=u,this.onFileSendProgress=f,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let a=0,c=0;const l=new FileReader;l.onload=f=>{if(f.target.readyState!==FileReader.DONE)return;const d=new Uint8Array(f.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(d)}),c++,a+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),a<t.size?u():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const u=()=>{const f=t.slice(a,a+r);l.readAsArrayBuffer(f)};u()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Ie=ot({}),xt=ot([]);let Pe=null,rt=null,Rt=null,_n=null,ka=null,Sa=null,jn=null,ar={token:null,repoFullName:null,username:null};function Cu({_token:e,_repoFullName:t,_username:n,_sessionId:r}){ar.token===e&&ar.repoFullName===t&&ar.username===n||(ar={token:e,repoFullName:t,username:n},Eu(),Ie.set({}),xt.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),Rt=e,rt=t,Pe=n,_n=r,$u())}function $u(){console.log("[SkyGit][Presence] startPresence for repo:",rt,"as",Pe,"session",_n),yr(Rt,rt,Pe,_n),ka=setInterval(()=>{yr(Rt,rt,Pe,_n)},3e4),Sa=setInterval(async()=>{const e=await ku(Rt,rt);console.log("[SkyGit][Presence] polled peers:",e),xt.set(e.filter(t=>t.username!==Pe)),Pu(e),Tu(),Du()},5e3)}function Eu(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(ka),clearInterval(Sa)}async function Pu(e){Ie.update(t=>{const n={...t},r=Rs(e,Pe);if(Pe===r){for(const s of e)s.username!==Pe&&(n[s.username]||(n[s.username]={status:"connecting",conn:null},vo(s,n)));Object.keys(n).forEach(s=>{s!==Pe&&(e.some(o=>o.username===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.username===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null},vo(s,n))}return n});for(const t of e){if(t.username===Pe)continue;const n=Me(Ie);n[t.username]&&n[t.username].status==="connected"||(yu(Rt,rt,t.username,t.session_id,Pe),setTimeout(()=>{wu(Rt,rt,t.username,t.session_id)},6e4))}}function Rs(e,t){return e.map(r=>r.username).concat(t).sort()[0]}function Kn(e,t){return Rs(e,t)===t}function Au(e,t){if(!e||!e.conversationId||!e.content)return;ya(e.conversationId,rt,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=Me(xt);Kn(n,Pe)&&(Ps(rt,e.conversationId),Ie.update(r=>(Object.entries(r).forEach(([s,{conn:o}])=>{s!==t&&o&&o.dataChannel&&o.send({type:"chat",...e})}),r)))}function Ru(e,t){e&&Array.isArray(e.onlinePeers)&&xt.set(e.onlinePeers)}function Ou(e,t){!e||!e.subtype||Ie.update(n=>{var s;const r=(s=n[t])==null?void 0:s.conn;return r&&typeof r.handleSignal=="function"&&r.handleSignal(e),n})}function fo(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function vo(e,t){const n=new Su({token:Rt,repoFullName:rt,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{yr(Rt,rt,Pe,_n,r)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":Au(r,e.username);break;case"presence":Ru(r,e.username);break;case"signal":Ou(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{fo(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{fo(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{yr(Rt,rt,Pe,_n,r)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.username]={conn:n,status:"connected"},Ie.set(t)}function Tu(){const e=Me(xt);Kn(e,Pe)?jn||(jn=setInterval(()=>{const n=Me(xt);Kn(n,Pe)&&wn(()=>Promise.resolve().then(()=>As),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",po)):jn&&(clearInterval(jn),jn=null,window.removeEventListener("beforeunload",po))}function po(e){const t=Me(xt);Kn(t,Pe)&&wn(()=>Promise.resolve().then(()=>As),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let ho=!1;function Du(){const e=Me(xt),t=Kn(e,Pe);t&&!ho&&wn(()=>Promise.resolve().then(()=>As),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),ho=t}function fs(e,t){Ie.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function ju(e){Ie.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var Nu=P('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function Iu(e,t){Ve(t,!1);let n=Ze(t,"conversation",8),r=N("");function s(){var g;if(!i(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:i(r).trim(),timestamp:Date.now()};ya(n().id,n().repo,l);const f=(g=Me(At).user)==null?void 0:g.login,d=Me(xt),v=Rs(d,f),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};f===v?(ju({type:"chat",..._}),Ps(n().repo,n().id)):fs(v,{type:"chat",..._}),m(r,"")}Ke();var o=Nu(),a=h(o),c=p(a,2);Qe(a,()=>i(r),l=>m(r,l)),L("keydown",a,l=>l.key==="Enter"&&s()),L("click",c,s),b(e,o),He()}var Mu=P(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),Lu=P('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),Fu=P('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),Gu=P('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),Uu=P('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),zu=P('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),Ju=P('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),Vu=P('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),Hu=P('<button class="bg-yellow-100 border px-3 py-1 rounded">🔄 Change Screen Source</button>'),Bu=P("<span>🎤</span>"),qu=P("<span>🔇</span>"),Wu=P("<span>📷</span>"),Ku=P("<span>🚫📷</span>"),Yu=P("<span>⏹️ Stop Recording</span>"),Qu=P("<span>⏺️ Start Recording</span>"),Zu=P('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>⏺️ Recording...</span></div>'),Xu=P('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>⚠️ Peer is recording</span></div>'),ef=P('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">📎 Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),tf=P('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">×</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),nf=P('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),rf=P('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),sf=P('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),of=P('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),af=P('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function lf(e,t){Ve(t,!1);const[n,r]=Or(),s=()=>sn(Ie,"$peerConnections",n),o=()=>sn(xt,"$onlinePeers",n);let a=N(null),c=N(!1),l=N(null),u=N(null),f=null,d=N(!1),v=N(null),_=null,g=N(!1),y=N(null),w=N(!1),O=N(!0),S=N(!0),x=N(!0),E=N(!0),D=N(!0),z=N(!1),J=N(!1),I=null,Y=[],le=N({x:0,y:0}),ge=!1,ye={x:0,y:0},ve=N(),_e=N(null),we=N(!1),be=N(),U=N(),ee=N();function Q(){m(w,!0)}function C(){m(w,!1)}function T(k){m(w,!1),pe(!0,k)}function H(k){ge=!0,ye={x:k.clientX-i(le).x,y:k.clientY-i(le).y},document.addEventListener("mousemove",K),document.addEventListener("mouseup",Z)}function K(k){ge&&(he(le,i(le).x=k.clientX-ye.x),he(le,i(le).y=k.clientY-ye.y))}function Z(){ge=!1,document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Z)}function ne(){m(O,!1)}function ae(){m(O,!0)}function oe(){m(_e,null),m(we,!1)}async function $e(){let k=i(a)&&i(a).repo,$=Me(us).decrypted,R=null,G=null,V=null,te=null;if(k&&window.selectedRepo&&window.selectedRepo.config){const X=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;X&&$[X]&&($[X].type==="s3"&&(R=$[X]),$[X].type==="google_drive"&&(G=$[X]))}for(const X in $)$[X].type==="s3"&&!R&&(V=$[X]),$[X].type==="google_drive"&&!G&&(te=$[X]);const re=[];return(R||V)&&re.push("s3"),(G||te)&&re.push("google_drive"),re.length===2?(m(we,!0),new Promise(X=>{const Fe=setInterval(()=>{i(_e)&&(m(we,!1),clearInterval(Fe),X(i(_e)))},100)})):re.length===1?re[0]:null}Ie.subscribe(k=>{Object.keys(k).filter($=>k[$].status==="connected").map($=>({username:$}))});let M=N(!1),q=N("");async function xe(k){const $=localStorage.getItem("skygit_token");if(!$||!k)return null;try{const R=await fetch(`https://api.github.com/repos/${k}`,{headers:{Authorization:`token ${$}`}});if(R.ok){const G=await R.json();return jt.update(V=>V.map(te=>te.full_name===k?{...te,has_discussions:G.has_discussions}:te)),G.has_discussions}}catch(R){console.warn("Failed to refresh Discussions status",R)}return null}Dr.subscribe(k=>{var te;console.log("[SkyGit][Presence] currentContent changed:",k),m(a,k),m(M,!1),m(q,"");const $=localStorage.getItem("skygit_token"),R=Me(At),G=((te=R==null?void 0:R.user)==null?void 0:te.login)||null,V=i(a)?i(a).repo:null;if(console.log("[SkyGit][Presence] authStore value:",R),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",G,"repo",V,"selectedConversation",i(a)),$&&G&&V&&Cu({_token:$,_repoFullName:V,_username:G,_sessionId:crypto.randomUUID()}),i(a)&&i(a).repo){const re=ba(i(a).repo);console.log("[SkyGit][DEBUG] Lookup repo:",i(a).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&xe(i(a).repo).then(X=>{X?m(M,!1):m(M,!0)})}});function ke(){m(c,!1),f=null,i(l)&&(i(l).getTracks().forEach(k=>k.stop()),m(l,null)),m(u,null),f&&fs(f,{type:"signal",subtype:"call-end",conversationId:i(a).id})}function et(k){const $=k.target.files[0];!$||!i(c)||!f||Ie.update(R=>{var V;const G=(V=R[f])==null?void 0:V.conn;return G&&typeof G.sendFile=="function"&&G.sendFile($),R})}async function pe(k=!0,$="screen"){try{let R={video:!0,audio:k};$==="tab"?R={video:{displaySurface:"browser",cursor:"always"},audio:k}:$==="window"?R={video:{displaySurface:"window",cursor:"always"},audio:k}:$==="screen"&&(R={video:{displaySurface:"monitor",cursor:"always"},audio:k}),m(v,await navigator.mediaDevices.getDisplayMedia(R)),m(d,!0),Ie.update(G=>{var te;const V=(te=G[f])==null?void 0:te.conn;return V&&V.replaceVideoTrack&&(V.replaceVideoTrack(i(v).getVideoTracks()[0]),V.sendScreenShareSignal&&V.sendScreenShareSignal(!0,{audio:k})),G}),m(l,i(v)),i(v).getVideoTracks()[0].onended=Ee}catch(R){console.error("Screen share error:",R)}}function Ee(){i(v)&&(i(v).getTracks().forEach(k=>k.stop()),m(v,null)),m(d,!1),Ie.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.replaceVideoTrack,k}),m(l,_)}async function vt(){if(i(d))try{const k=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Ie.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.replaceVideoTrack&&R.replaceVideoTrack(k.getVideoTracks()[0]),$}),i(v)&&i(v).getTracks().forEach($=>$.stop()),m(v,k),m(l,k),k.getVideoTracks()[0].onended=Ee}catch(k){console.error("Change screen source error:",k)}}function Lt(){m(S,!i(S)),i(l)&&i(l).getAudioTracks().forEach(k=>k.enabled=i(S)),kt()}function Ft(){m(x,!i(x)),i(l)&&i(l).getVideoTracks().forEach(k=>k.enabled=i(x)),kt()}function kt(){Ie.update(k=>{var R;const $=(R=k[f])==null?void 0:R.conn;return $&&$.send&&$.send({type:"media-status",micOn:i(S),cameraOn:i(x)}),k})}function ce(k){Ie.update($=>{var G;const R=(G=$[f])==null?void 0:G.conn;return R&&R.send&&R.send({type:"recording-status",recording:k}),$})}function Se(){i(l)&&(Y=[],I=new MediaRecorder(i(l),{mimeType:"video/webm; codecs=vp9"}),I.ondataavailable=k=>{k.data.size>0&&Y.push(k.data)},I.onstop=Yt,I.start(),m(z,!0),ce(!0))}function St(){I&&i(z)&&(I.stop(),m(z,!1),ce(!1))}async function Yt(){const k=new Blob(Y,{type:"video/webm"});await Ct(k)}typeof window<"u"&&(window.skygitOnRecordingStatus=k=>{m(J,!!k.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(k,$)=>{m(g,k),m(y,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=k=>{typeof k.micOn=="boolean"&&m(E,k.micOn),typeof k.cameraOn=="boolean"&&m(D,k.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(k,$,R)=>{k.name,$===R&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(k,$,R)=>{$===R&&setTimeout(()=>{},2e3)});async function Gt(k,$){const R=`skygit-recording-${Date.now()}.webm`,G=$.bucket,V=$.region;if(!G||!V)return alert("S3 credential missing bucket or region."),null;const te=$.endpoint||`https://${G}.s3.${V}.amazonaws.com/${R}`;return(await fetch(te,{method:"PUT",headers:{"Content-Type":"video/webm"},body:k})).ok?te.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function Ct(k){let $=Me(us).decrypted,R=i(a)&&i(a).repo,G=null,V=null,te=null,re=null;if(R&&window.selectedRepo&&window.selectedRepo.config){const Ge=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Ge&&$[Ge]&&($[Ge].type==="s3"&&(G=$[Ge]),$[Ge].type==="google_drive"&&(V=$[Ge]))}for(const Ge in $)$[Ge].type==="s3"&&!G&&(te=$[Ge]),$[Ge].type==="google_drive"&&!V&&(re=$[Ge]);let X=null,Fe=await $e();if(!Fe){alert("No upload destination (S3 or Google Drive) configured.");return}Fe==="s3"&&(X=G||te),Fe==="google_drive"&&(X=V||re);let pt=null;Fe==="s3"?pt=await Gt(k,X):Fe==="google_drive"&&(pt=await Ae(k,X)),pt&&(fs(f,{type:"chat",content:`📹 Recording: ${pt}`}),alert("Recording uploaded and link shared!"))}async function Ae(k,$){let R;try{R=await Le($)}catch(pt){return alert("Google Drive authentication failed: "+pt.message),null}const G={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},V=new FormData;V.append("metadata",new Blob([JSON.stringify(G)],{type:"application/json"})),V.append("file",k);const te=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+R},body:V});if(!te.ok)return alert("Failed to upload to Google Drive"),null;const re=await te.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+R,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Fe=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+R}})).json();return Fe.webViewLink||Fe.webContentLink}async function Le(k){const $=new URLSearchParams;$.append("client_id",k.client_id),$.append("client_secret",k.client_secret),$.append("refresh_token",k.refresh_token),$.append("grant_type","refresh_token");const R=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!R.ok)throw new Error("Failed to get Google access token");return(await R.json()).access_token}function $t(){var te;const k=localStorage.getItem("skygit_token"),$=Me(At),R=((te=$==null?void 0:$.user)==null?void 0:te.login)||null,G=i(a)?i(a).repo:null,V=window.skygitSessionId;k&&R&&G&&V&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:k,repoFullName:G,username:R,sessionId:V})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",$t),lt(()=>(i(be),i(l)),()=>{i(be)&&i(l)&&he(be,i(be).srcObject=i(l))}),lt(()=>(i(U),i(u)),()=>{i(U)&&i(u)&&he(U,i(U).srcObject=i(u))}),lt(()=>(i(ee),i(v)),()=>{i(ee)&&i(v)&&he(ee,i(ee).srcObject=i(v))}),Zn(),Ke(),Ir(e,{children:(k,$)=>{var R=Ce(),G=fe(R);{var V=re=>{var X=Ce(),Fe=fe(X);{var pt=ht=>{var Ut=Mu(),Qt=h(Ut),Zt=p(h(Qt),4),un=p(Zt,2),fn=h(un),Lr=p(fn,2);W(()=>qt(Zt,"href",i(q))),L("click",fn,()=>m(M,!1)),L("click",Lr,async()=>{await xe(i(a).repo)}),b(ht,Ut)},Ge=ht=>{var Ut=of(),Qt=h(Ut),Zt=h(Qt),un=h(Zt),fn=h(un),Lr=p(un,2),Ca=h(Lr),Os=p(Zt,2),$a=h(Os),Ea=p(Os,2),Ts=h(Ea);{var Pa=ue=>{var Re=Ce(),gt=fe(Re);Tt(gt,1,()=>i(a).participants,Be=>Be,(Be,me)=>{var De=Ce(),Ue=fe(De);{var Pn=at=>{var _t=Lu();b(at,_t)},dn=at=>{var _t=Ce(),Fr=fe(_t);{var Gr=zt=>{var Xt=Ce(),An=fe(Xt);{var vn=je=>{var it=Fu(),Rn=p(h(it));W(()=>B(Rn,` ${i(me)??""}`)),b(je,it)},bt=je=>{var it=Gu(),Rn=p(h(it));W(()=>B(Rn,` ${i(me)??""}`)),b(je,it)};j(An,je=>{s()[i(me)].status==="connected"?je(vn):je(bt,!1)})}b(zt,Xt)},Ur=(zt,Xt)=>{{var An=bt=>{var je=Uu(),it=p(h(je));W(()=>B(it,` ${i(me)??""}`)),b(bt,je)},vn=bt=>{var je=zu(),it=p(h(je));W(()=>B(it,` ${i(me)??""}`)),b(bt,je)};j(zt,bt=>{o().find(je=>je.username===i(me))?bt(An):bt(vn,!1)},Xt)}};j(Fr,zt=>{s()[i(me)]?zt(Gr):zt(Ur,!1)})}b(at,_t)};j(Ue,at=>{i(me)===Me(At).user.login?at(Pn):at(dn,!1)})}b(Be,De)}),b(ue,Re)};j(Ts,ue=>{i(a).participants&&ue(Pa)})}var Aa=p(Ts,2);{var Ra=ue=>{var Re=Ju();L("click",Re,ke),b(ue,Re)};j(Aa,ue=>{i(c)&&ue(Ra)})}var Ds=p(Qt,2);{var Oa=ue=>{var Re=ef(),gt=fe(Re),Be=h(gt),me=p(h(Be),2);me.muted=!0,In(me,A=>m(be,A),()=>i(be));var De=p(me,2),Ue=h(De),Pn=h(Ue);{var dn=A=>{var F=Ne("🎤 Mic On");b(A,F)},at=A=>{var F=Ne("🔇 Mic Off");b(A,F)};j(Pn,A=>{i(S)?A(dn):A(at,!1)})}var _t=p(Ue,2),Fr=h(_t);{var Gr=A=>{var F=Ne("📷 Cam On");b(A,F)},Ur=A=>{var F=Ne("🚫📷 Cam Off");b(A,F)};j(Fr,A=>{i(x)?A(Gr):A(Ur,!1)})}var zt=p(Be,2),Xt=p(h(zt),2);In(Xt,A=>m(U,A),()=>i(U));var An=p(Xt,2),vn=h(An),bt=h(vn);{var je=A=>{var F=Ne("🎤 Mic On");b(A,F)},it=A=>{var F=Ne("🔇 Mic Off");b(A,F)};j(bt,A=>{i(E)?A(je):A(it,!1)})}var Rn=p(vn,2),La=h(Rn);{var Fa=A=>{var F=Ne("📷 Cam On");b(A,F)},Ga=A=>{var F=Ne("🚫📷 Cam Off");b(A,F)};j(La,A=>{i(D)?A(Fa):A(Ga,!1)})}var Ls=p(gt,2);{var Ua=A=>{var F=Vu(),oi=h(F),ai=p(h(oi));{var ii=Vr=>{var rr=Ne("(with audio)");b(Vr,rr)};j(ai,Vr=>{var rr;(rr=i(y))!=null&&rr.audio&&Vr(ii)})}b(A,F)};j(Ls,A=>{i(g)&&A(Ua)})}var Fs=p(Ls,2),Gs=h(Fs),za=p(h(Gs)),zr=p(Gs,2),Ja=h(zr);{var Va=A=>{var F=Ne("🛑 Stop Sharing");b(A,F)},Ha=A=>{var F=Ne("🖥️ Share Screen");b(A,F)};j(Ja,A=>{i(d)?A(Va):A(Ha,!1)})}var Us=p(zr,2);{var Ba=A=>{var F=Hu();L("click",F,vt),b(A,F)};j(Us,A=>{i(d)&&A(Ba)})}var tr=p(Us,2),qa=h(tr);{var Wa=A=>{var F=Bu();b(A,F)},Ka=A=>{var F=qu();b(A,F)};j(qa,A=>{i(S)?A(Wa):A(Ka,!1)})}var nr=p(tr,2),Ya=h(nr);{var Qa=A=>{var F=Wu();b(A,F)},Za=A=>{var F=Ku();b(A,F)};j(Ya,A=>{i(x)?A(Qa):A(Za,!1)})}var Jr=p(nr,2),Xa=h(Jr);{var ei=A=>{var F=Yu();b(A,F)},ti=A=>{var F=Qu();b(A,F)};j(Xa,A=>{i(z)?A(ei):A(ti,!1)})}var zs=p(Fs,2);{var ni=A=>{var F=Zu();b(A,F)};j(zs,A=>{i(z)&&A(ni)})}var ri=p(zs,2);{var si=A=>{var F=Xu();b(A,F)};j(ri,A=>{i(J)&&A(si)})}W(()=>{qt(tr,"title",i(S)?"Mute Mic":"Unmute Mic"),qt(nr,"title",i(x)?"Turn Off Camera":"Turn On Camera"),qt(Jr,"title",i(z)?"Stop Recording":"Start Recording")}),L("change",za,et),L("click",zr,function(...A){var F;(F=i(d)?Ee:Q)==null||F.apply(this,A)}),L("click",tr,Lt),L("click",nr,Ft),L("click",Jr,function(...A){var F;(F=i(z)?St:Se)==null||F.apply(this,A)}),b(ue,Re)};j(Ds,ue=>{i(c)&&ue(Oa)})}var js=p(Ds,2);{var Ta=ue=>{var Re=Ce(),gt=fe(Re);{var Be=De=>{var Ue=tf(),Pn=h(Ue),dn=h(Pn),at=p(dn,4);at.muted=!0,In(at,_t=>m(ee,_t),()=>i(ee)),In(Ue,_t=>m(ve,_t),()=>i(ve)),W(()=>Zo(Ue,`left: ${i(le).x??""}px; top: ${i(le).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),L("click",dn,Rl(ne)),L("mousedown",Ue,H),b(De,Ue)},me=De=>{var Ue=nf();L("click",Ue,ae),b(De,Ue)};j(gt,De=>{i(O)?De(Be):De(me,!1)})}b(ue,Re)};j(js,ue=>{i(d)&&i(v)&&ue(Ta)})}var Ns=p(js,2);{var Da=ue=>{var Re=rf(),gt=h(Re),Be=p(h(gt),2),me=p(Be,2),De=p(me,2),Ue=p(De,2);L("click",Be,()=>T("screen")),L("click",me,()=>T("window")),L("click",De,()=>T("tab")),L("click",Ue,C),b(ue,Re)};j(Ns,ue=>{i(w)&&ue(Da)})}var Is=p(Ns,2);{var ja=ue=>{var Re=sf(),gt=h(Re),Be=p(h(gt),2),me=p(Be,2),De=p(me,2);L("click",Be,()=>{m(_e,"google_drive")}),L("click",me,()=>{m(_e,"s3")}),L("click",De,oe),b(ue,Re)};j(Is,ue=>{i(we)&&ue(ja)})}var Ms=p(Is,2),Na=h(Ms);_u(Na,{get conversation(){return i(a)}});var Ia=p(Ms,2),Ma=h(Ia);Iu(Ma,{get conversation(){return i(a)}}),W(()=>{var ue;B(fn,i(a).title),B(Ca,i(a).repo),B($a,`${((ue=i(a).participants)==null?void 0:ue.length)??0} participants`)}),b(ht,Ut)};j(Fe,ht=>{i(M)?ht(pt):ht(Ge,!1)})}b(re,X)},te=re=>{var X=af();b(re,X)};j(G,re=>{i(a)?re(V):re(te,!1)})}b(k,R)},$$slots:{default:!0}}),He(),r()}var cf=P('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function uf(e,t){Ve(t,!1);const n=Nl();let r=N("");function s(){if(!i(r).trim()){alert("Title is required.");return}n("create",{title:i(r).trim()}),m(r,"")}function o(){n("cancel")}Ke();var a=cf(),c=h(a),l=p(h(c),2),u=p(l,2),f=h(u),d=p(f,2);Qe(l,()=>i(r),v=>m(r,v)),L("click",f,o),L("click",d,s),b(e,a),He()}var ff=P('<span class="text-green-700 font-semibold">✅ Enabled</span>'),df=P("<span> </span>"),vf=P('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),pf=Yo('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),hf=P('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),gf=P('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>💬 New Conversation (Enable Discussions first)</button></div>'),_f=P("<option> </option>"),bf=P('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">🛠️ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>— Select a credential —</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💾 Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">💬 New Conversation</button> <!>',1),mf=P('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),yf=P('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function wf(e,t){Ve(t,!1);let n=N([]),r=N(),s=N(!1),o=N(!1),a=N(""),c;$s.subscribe(g=>m(r,g)),Tr(async()=>{const g=localStorage.getItem("skygit_token");if(g)try{const{secrets:y}=await Nr(g),w=Object.keys(y),O=[];for(const S of w)try{const x=await ks(g,y[S]);O.push({url:S,...x})}catch(x){console.warn("Failed to decrypt",S,x)}m(n,O)}catch(y){console.warn("Could not load secrets",y)}});async function l(){const g=localStorage.getItem("skygit_token");if(!(!i(r)||!g)){m(s,!0);try{await fa(g,i(r)),he(r,i(r).has_messages=!0),wn(async()=>{const{selectedRepo:y}=await Promise.resolve().then(()=>lo);return{selectedRepo:y}},void 0).then(({selectedRepo:y})=>{y.set({...i(r)})})}catch(y){alert("Failed to activate messaging."),console.warn(y)}finally{m(s,!1)}}}async function u(){const g=localStorage.getItem("skygit_token");if(!(!g||!i(r)))try{await da(g,i(r)),alert("✅ Messaging config updated.");try{await va(g,i(r))}catch(y){alert("❌ Failed to store credential."),console.warn(y)}}catch(y){alert("❌ Failed to update config."),console.warn(y)}}async function f(g){const y=g.detail.title,w=localStorage.getItem("skygit_token");console.log("[SkyGit] 🧪 handleCreate() called with title:",y),await rc(w,i(r),y),m(o,!1)}function d(){m(o,!1)}function v(){if(!i(r))return;const g=`https://github.com/${i(r).full_name}/settings#discussions`;window.open(g,"_blank")}async function _(){const g=localStorage.getItem("skygit_token");if(!g||!i(r))return;const y=await fetch(`https://api.github.com/repos/${i(r).full_name}`,{headers:{Authorization:`token ${g}`}});if(y.ok){const w=await y.json(),O=!i(r).has_discussions;he(r,i(r).has_discussions=w.has_discussions),wn(async()=>{const{selectedRepo:S}=await Promise.resolve().then(()=>lo);return{selectedRepo:S}},void 0).then(({selectedRepo:S})=>{S.set({...i(r)})}),await tl(),O&&i(r).has_discussions?m(a,"✅ Discussions enabled! You can now use messaging."):i(r).has_discussions?m(a,""):m(a,"❌ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{m(a,"")},4e3)}}Ke(),Ir(e,{children:(g,y)=>{var w=Ce(),O=fe(w);{var S=E=>{var D=mf(),z=h(D),J=h(z),I=p(z,2),Y=h(I),le=p(h(Y)),ge=p(Y,2),ye=p(h(ge)),ve=p(ge,2),_e=p(h(ve),2),we=h(_e),be=p(ve,2),U=p(h(be)),ee=p(be,2),Q=p(h(ee)),C=p(ee,2),T=p(h(C),2);{var H=M=>{var q=ff();b(M,q)},K=M=>{var q=vf(),xe=p(fe(q),2),ke=p(xe,2),et=p(ke,2);{var pe=Ee=>{var vt=df();let Lt;var Ft=h(vt);W(kt=>{Lt=yn(vt,1,"ml-2 text-xs font-semibold",null,Lt,kt),B(Ft,i(a))},[()=>({"text-green-700":i(a).startsWith("✅"),"text-red-600":i(a).startsWith("❌")})],ut),b(Ee,vt)};j(et,Ee=>{i(a)&&Ee(pe)})}L("click",xe,v),L("click",ke,_),b(M,q)};j(T,M=>{i(r).has_discussions?M(H):M(K,!1)})}var Z=p(I,2);{var ne=M=>{var q=hf(),xe=h(q);{var ke=pe=>{var Ee=pf();b(pe,Ee)},et=pe=>{var Ee=Ne("💬 Activate Messaging");b(pe,Ee)};j(xe,pe=>{i(s)?pe(ke):pe(et,!1)})}W(()=>q.disabled=i(s)),L("click",q,l),b(M,q)};j(Z,M=>{i(r).has_messages||M(ne)})}var ae=p(Z,2);{var oe=M=>{var q=gf();b(M,q)},$e=(M,q)=>{{var xe=ke=>{var et=bf(),pe=fe(et),Ee=p(h(pe),2),vt=h(Ee),Lt=p(h(vt)),Ft=p(vt,2),kt=p(h(Ft));W(()=>{i(r),ns(()=>{})});var ce=h(kt);ce.value=(ce.__value="gitfs")==null?"":"gitfs";var Se=p(ce);Se.value=(Se.__value="s3")==null?"":"s3";var St=p(Se);St.value=(St.__value="google_drive")==null?"":"google_drive";var Yt=p(Ft,2),Gt=p(h(Yt));W(()=>{i(r),ns(()=>{i(n)})});var Ct=h(Gt);Ct.value=((Ct.__value="")==null,"");var Ae=p(Ct);Tt(Ae,1,()=>i(n).filter(R=>R.type===i(r).config.binary_storage_type),qn,(R,G)=>{var V=_f(),te={},re=h(V);W(()=>{te!==(te=i(G).url)&&(V.value=(V.__value=i(G).url)==null?"":i(G).url),B(re,i(G).url)}),b(R,V)});var Le=p(Ee,2),$t=p(pe,2),k=p($t,2);{var $=R=>{uf(R,{$$events:{create:f,cancel:d}})};j(k,R=>{i(o)&&R($)})}Qe(Lt,()=>i(r).config.commit_frequency_min,R=>he(r,i(r).config.commit_frequency_min=R)),os(kt,()=>i(r).config.binary_storage_type,R=>he(r,i(r).config.binary_storage_type=R)),os(Gt,()=>i(r).config.storage_info.url,R=>he(r,i(r).config.storage_info.url=R)),L("click",Le,u),L("click",$t,()=>m(o,!0)),b(ke,et)};j(M,ke=>{i(r).has_messages&&i(r).config&&ke(xe)},q)}};j(ae,M=>{i(r).has_discussions?M($e,!1):M(oe)})}W(()=>{B(J,i(r).full_name),B(le,` ${i(r).name??""}`),B(ye,` ${i(r).owner??""}`),qt(_e,"href",i(r).url),B(we,i(r).url),B(U,` ${(i(r).private?"🔒 Private":"🌐 Public")??""}`),B(Q,` ${(i(r).has_messages?"💬 Available":"🚫 Not enabled")??""}`)}),b(E,D)},x=E=>{var D=yf();b(E,D)};j(O,E=>{i(r)?E(S):E(x,!1)})}b(g,w)},$$slots:{default:!0}}),He()}var xf=P('<p class="text-center mt-20">Loading...</p>');function kf(e,t){Ve(t,!1);const[n,r]=Or(),s=()=>sn(nt,"$currentRoute",n),o=()=>sn(Te,"$syncState",n);let a=N(null),c=null,l=N("");At.subscribe(O=>{O.isLoggedIn||(nt.set("login"),m(a,null),c=null)}),Tr(()=>{const O=Wl();O?u(O):nt.set("login")});async function u(O){m(l,"");const S=await Bl(O);if(!S){localStorage.removeItem("skygit_token"),m(l,"Invalid token. Please check your PAT and try again."),nt.set("login");return}m(a,O),c=S,ql(O),At.set({isLoggedIn:!0,token:i(a),user:c}),await ia(i(a),c.login)?(nt.set("home"),await v()):nt.set("consent")}async function f(){await la(i(a)),nt.set("home"),await v()}function d(){localStorage.removeItem("skygit_token"),nt.set("login")}async function v(){try{console.log("[SkyGit] Initializing app state..."),await ac(i(a))}catch(O){console.warn("[SkyGit] Failed to initialize startup state:",O)}}window.addEventListener("beforeunload",O=>{(xa()||_a())&&(mr(),br(),O.preventDefault(),O.returnValue="")}),lt(()=>(s(),o(),i(a)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{cs(i(a))}catch(O){console.warn("[SkyGit] Repo discovery failed:",O)}}),Zn(),Ke();var _=Ce(),g=fe(_);{var y=O=>{var S=xf();b(O,S)},w=(O,S)=>{{var x=D=>{dc(D,{onSubmit:u,get error(){return i(l)}})},E=(D,z)=>{{var J=Y=>{hc(Y,{onApprove:f,onReject:d})},I=(Y,le)=>{{var ge=ve=>{vu(ve,{})},ye=(ve,_e)=>{{var we=U=>{lf(U,{})},be=(U,ee)=>{{var Q=T=>{wf(T,{})},C=T=>{eu(T)};j(U,T=>{s()==="repos"?T(Q):T(C,!1)},ee)}};j(ve,U=>{s()==="chats"?U(we):U(be,!1)},_e)}};j(Y,ve=>{s()==="settings"?ve(ge):ve(ye,!1)},le)}};j(D,Y=>{s()==="consent"?Y(J):Y(I,!1)},z)}};j(O,D=>{s()==="login"?D(x):D(E,!1)},S)}};j(g,O=>{s()==="loading"?O(y):O(w,!1)})}b(e,_),He(),r()}pl(kf,{target:document.getElementById("app")});
