(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const no=!1;var Nr=Array.isArray,Ci=Array.prototype.indexOf,Ss=Array.from,Io=Object.defineProperty,Yt=Object.getOwnPropertyDescriptor,jo=Object.getOwnPropertyDescriptors,$i=Object.prototype,Pi=Array.prototype,ks=Object.getPrototypeOf,ro=Object.isExtensible;function Gn(e){return typeof e=="function"}const Sn=()=>{};function Ei(e){return e()}function xr(e){for(var t=0;t<e.length;t++)e[t]()}const vt=2,No=4,Mr=8,Cs=16,Lt=32,An=64,Sr=128,it=256,kr=512,Qe=1024,Ft=2048,dn=4096,Tt=8192,Lr=16384,Ai=32768,Fr=65536,Mo=1<<17,Ri=1<<19,Lo=1<<20,us=1<<21,kt=Symbol("$state"),Fo=Symbol("legacy props"),Oi=Symbol("");function Go(e){return e===this.v}function Gr(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Di(e,t){return e!==t}function $s(e){return!Gr(e,this.v)}function Ti(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ii(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ji(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ni(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Mi(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Li(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Fi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Gi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Rn=!1,Ui=!1;function zi(){Rn=!0}const Ps=1,Es=2,Uo=4,Ji=8,qi=16,Vi=1,Hi=2,zo=4,Bi=8,Wi=16,Jo=1,Ki=2,Je=Symbol(),Qi="http://www.w3.org/1999/xhtml",Yi="http://www.w3.org/2000/svg";function As(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let de=null;function so(e){de=e}function Be(e,t=!1,n){var r=de={p:de,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Rn&&!t&&(de.l={s:null,u:null,r1:[],r2:Cn(!1)}),Rs(()=>{r.d=!0})}function We(e){const t=de;if(t!==null){const i=t.e;if(i!==null){var n=ue,r=se;t.e=null;try{for(var s=0;s<i.length;s++){var o=i[s];Zt(o.effect),$t(o.reaction),Tn(o.fn)}}finally{Zt(n),$t(r)}}de=t.p,t.m=!0}return{}}function On(){return!Rn||de!==null&&de.l===null}function rn(e,t){if(typeof e!="object"||e===null||kt in e)return e;const n=ks(e);if(n!==$i&&n!==Pi)return e;var r=new Map,s=Nr(e),o=Bt(0),i=se,c=l=>{var f=se;$t(i);var d;return d=l(),$t(f),d};return s&&r.set("length",Bt(e.length)),new Proxy(e,{defineProperty(l,f,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Li();var u=r.get(f);return u===void 0?(u=c(()=>Bt(d.value)),r.set(f,u)):m(u,c(()=>rn(d.value))),!0},deleteProperty(l,f){var d=r.get(f);if(d===void 0)f in l&&r.set(f,c(()=>Bt(Je)));else{if(s&&typeof f=="string"){var u=r.get("length"),v=Number(f);Number.isInteger(v)&&v<u.v&&m(u,v)}m(d,Je),oo(o)}return!0},get(l,f,d){var h;if(f===kt)return e;var u=r.get(f),v=f in l;if(u===void 0&&(!v||(h=Yt(l,f))!=null&&h.writable)&&(u=c(()=>Bt(rn(v?l[f]:Je))),r.set(f,u)),u!==void 0){var _=a(u);return _===Je?void 0:_}return Reflect.get(l,f,d)},getOwnPropertyDescriptor(l,f){var d=Reflect.getOwnPropertyDescriptor(l,f);if(d&&"value"in d){var u=r.get(f);u&&(d.value=a(u))}else if(d===void 0){var v=r.get(f),_=v==null?void 0:v.v;if(v!==void 0&&_!==Je)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return d},has(l,f){var _;if(f===kt)return!0;var d=r.get(f),u=d!==void 0&&d.v!==Je||Reflect.has(l,f);if(d!==void 0||ue!==null&&(!u||(_=Yt(l,f))!=null&&_.writable)){d===void 0&&(d=c(()=>Bt(u?rn(l[f]):Je)),r.set(f,d));var v=a(d);if(v===Je)return!1}return u},set(l,f,d,u){var k;var v=r.get(f),_=f in l;if(s&&f==="length")for(var h=d;h<v.v;h+=1){var b=r.get(h+"");b!==void 0?m(b,Je):h in l&&(b=c(()=>Bt(Je)),r.set(h+"",b))}v===void 0?(!_||(k=Yt(l,f))!=null&&k.writable)&&(v=c(()=>Bt(void 0)),m(v,c(()=>rn(d))),r.set(f,v)):(_=v.v!==Je,m(v,c(()=>rn(d))));var x=Reflect.getOwnPropertyDescriptor(l,f);if(x!=null&&x.set&&x.set.call(u,d),!_){if(s&&typeof f=="string"){var R=r.get("length"),w=Number(f);Number.isInteger(w)&&w>=R.v&&m(R,w+1)}oo(o)}return!0},ownKeys(l){a(o);var f=Reflect.ownKeys(l).filter(v=>{var _=r.get(v);return _===void 0||_.v!==Je});for(var[d,u]of r)u.v!==Je&&!(d in l)&&f.push(d);return f},setPrototypeOf(){Fi()}})}function oo(e,t=1){m(e,e.v+t)}function ao(e){try{if(e!==null&&typeof e=="object"&&kt in e)return e[kt]}catch{}return e}function Zi(e,t){return Object.is(ao(e),ao(t))}const Qn=new Map;function Cn(e,t){var n={f:0,v:e,reactions:null,equals:Go,rv:0,wv:0};return n}function Bt(e,t){const n=Cn(e);return ul(n),n}function N(e,t=!1){var r;const n=Cn(e);return t||(n.equals=$s),Rn&&de!==null&&de.l!==null&&((r=de.l).s??(r.s=[])).push(n),n}function ye(e,t){return m(e,Ye(()=>a(e))),t}function m(e,t,n=!1){se!==null&&!xt&&On()&&(se.f&(vt|Cs))!==0&&!(He!=null&&He.includes(e))&&Gi();let r=n?rn(t):t;return Yn(e,r)}function Yn(e,t){if(!e.equals(t)){var n=e.v;ir?Qn.set(e,t):Qn.set(e,n),e.v=t,e.wv=sa(),qo(e,Ft),On()&&ue!==null&&(ue.f&Qe)!==0&&(ue.f&(Lt|An))===0&&(ot===null?fl([e]):ot.push(e))}return t}function io(e,t=1){var n=a(e),r=t===1?n++:n--;return m(e,n),r}function qo(e,t){var n=e.reactions;if(n!==null)for(var r=On(),s=n.length,o=0;o<s;o++){var i=n[o],c=i.f;(c&Ft)===0&&(!r&&i===ue||(gt(i,t),(c&(Qe|it))!==0&&((c&vt)!==0?qo(i,dn):Vr(i))))}}let Xi=!1;var lo,Vo,Ho,Bo;function el(){if(lo===void 0){lo=window,Vo=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Ho=Yt(t,"firstChild").get,Bo=Yt(t,"nextSibling").get,ro(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),ro(n)&&(n.__t=void 0)}}function sr(e=""){return document.createTextNode(e)}function Ot(e){return Ho.call(e)}function Ur(e){return Bo.call(e)}function g(e,t){return Ot(e)}function fe(e,t){{var n=Ot(e);return n instanceof Comment&&n.data===""?Ur(n):n}}function p(e,t=1,n=!1){let r=e;for(;t--;)r=Ur(r);return r}function tl(e){e.textContent=""}function Zn(e){var t=vt|Ft,n=se!==null&&(se.f&vt)!==0?se:null;return ue===null||n!==null&&(n.f&it)!==0?t|=it:ue.f|=Lo,{ctx:de,deps:null,effects:null,equals:Go,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??ue}}function pt(e){const t=Zn(e);return t.equals=$s,t}function Wo(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)jt(t[n])}}function nl(e){for(var t=e.parent;t!==null;){if((t.f&vt)===0)return t;t=t.parent}return null}function rl(e){var t,n=ue;Zt(nl(e));try{Wo(e),t=aa(e)}finally{Zt(n)}return t}function Ko(e){var t=rl(e),n=(Qt||(e.f&it)!==0)&&e.deps!==null?dn:Qe;gt(e,n),e.equals(t)||(e.v=t,e.wv=sa())}function Qo(e){ue===null&&se===null&&ji(),se!==null&&(se.f&it)!==0&&ue===null&&Ii(),ir&&Ti()}function sl(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Dn(e,t,n,r=!0){var s=ue,o={ctx:de,deps:null,nodes_start:null,nodes_end:null,f:e|Ft,first:null,fn:t,last:null,next:null,parent:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{qr(o),o.f|=Ai}catch(l){throw jt(o),l}else t!==null&&Vr(o);var i=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(Lo|Sr))===0;if(!i&&r&&(s!==null&&sl(o,s),se!==null&&(se.f&vt)!==0)){var c=se;(c.effects??(c.effects=[])).push(o)}return o}function Rs(e){const t=Dn(Mr,null,!1);return gt(t,Qe),t.teardown=e,t}function fs(e){Qo();var t=ue!==null&&(ue.f&Lt)!==0&&de!==null&&!de.m;if(t){var n=de;(n.e??(n.e=[])).push({fn:e,effect:ue,reaction:se})}else{var r=Tn(e);return r}}function ol(e){return Qo(),vn(e)}function al(e){const t=Dn(An,e,!0);return(n={})=>new Promise(r=>{n.outro?$n(t,()=>{jt(t),r(void 0)}):(jt(t),r(void 0))})}function Tn(e){return Dn(No,e,!1)}function ft(e,t){var n=de,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=vn(()=>{e(),!r.ran&&(r.ran=!0,m(n.l.r2,!0),Ye(t))})}function or(){var e=de;vn(()=>{if(a(e.l.r2)){for(var t of e.l.r1){var n=t.effect;(n.f&Qe)!==0&&gt(n,dn),In(n)&&qr(n),t.ran=!1}e.l.r2.v=!1}})}function vn(e){return Dn(Mr,e,!0)}function Y(e,t=[],n=Zn){const r=t.map(n);return ar(()=>e(...r.map(a)))}function ar(e,t=0){return Dn(Mr|Cs|t,e,!0)}function cn(e,t=!0){return Dn(Mr|Lt,e,!0,t)}function Yo(e){var t=e.teardown;if(t!==null){const n=ir,r=se;uo(!0),$t(null);try{t.call(null)}finally{uo(n),$t(r)}}}function Zo(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;(n.f&An)!==0?n.parent=null:jt(n,t),n=r}}function il(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Lt)===0&&jt(t),t=n}}function jt(e,t=!0){var n=!1;if((t||(e.f&Ri)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,s=e.nodes_end;r!==null;){var o=r===s?null:Ur(r);r.remove(),r=o}n=!0}Zo(e,t&&!n),Er(e,0),gt(e,Lr);var i=e.transitions;if(i!==null)for(const l of i)l.stop();Yo(e);var c=e.parent;c!==null&&c.first!==null&&Xo(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Xo(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function $n(e,t){var n=[];Os(e,n,!0),ea(n,()=>{jt(e),t&&t()})}function ea(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var s of e)s.out(r)}else t()}function Os(e,t,n){if((e.f&Tt)===0){if(e.f^=Tt,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var s=r.next,o=(r.f&Fr)!==0||(r.f&Lt)!==0;Os(r,t,o?n:!1),r=s}}}function Xn(e){ta(e,!0)}function ta(e,t){if((e.f&Tt)!==0){e.f^=Tt,(e.f&Qe)===0&&(e.f^=Qe),In(e)&&(gt(e,Ft),Vr(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&Fr)!==0||(n.f&Lt)!==0;ta(n,s?t:!1),n=r}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let er=[],ds=[];function na(){var e=er;er=[],xr(e)}function ll(){var e=ds;ds=[],xr(e)}function zr(e){er.length===0&&queueMicrotask(na),er.push(e)}function co(){er.length>0&&na(),ds.length>0&&ll()}let yr=!1,Cr=!1,$r=null,on=!1,ir=!1;function uo(e){ir=e}let Wn=[];let se=null,xt=!1;function $t(e){se=e}let ue=null;function Zt(e){ue=e}let He=null;function cl(e){He=e}function ul(e){se!==null&&se.f&us&&(He===null?cl([e]):He.push(e))}let qe=null,et=0,ot=null;function fl(e){ot=e}let ra=1,Pr=0,Qt=!1,Kt=null;function sa(){return++ra}function In(e){var u;var t=e.f;if((t&Ft)!==0)return!0;if((t&dn)!==0){var n=e.deps,r=(t&it)!==0;if(n!==null){var s,o,i=(t&kr)!==0,c=r&&ue!==null&&!Qt,l=n.length;if(i||c){var f=e,d=f.parent;for(s=0;s<l;s++)o=n[s],(i||!((u=o==null?void 0:o.reactions)!=null&&u.includes(f)))&&(o.reactions??(o.reactions=[])).push(f);i&&(f.f^=kr),c&&d!==null&&(d.f&it)===0&&(f.f^=it)}for(s=0;s<l;s++)if(o=n[s],In(o)&&Ko(o),o.wv>e.wv)return!0}(!r||ue!==null&&!Qt)&&gt(e,Qe)}return!1}function dl(e,t){for(var n=t;n!==null;){if((n.f&Sr)!==0)try{n.fn(e);return}catch{n.f^=Sr}n=n.parent}throw yr=!1,e}function vl(e){return(e.f&Lr)===0&&(e.parent===null||(e.parent.f&Sr)===0)}function Jr(e,t,n,r){if(yr){if(n===null&&(yr=!1),vl(t))throw e;return}n!==null&&(yr=!0);{dl(e,t);return}}function oa(e,t,n=!0){var r=e.reactions;if(r!==null)for(var s=0;s<r.length;s++){var o=r[s];He!=null&&He.includes(e)||((o.f&vt)!==0?oa(o,t,!1):t===o&&(n?gt(o,Ft):(o.f&Qe)!==0&&gt(o,dn),Vr(o)))}}function aa(e){var _;var t=qe,n=et,r=ot,s=se,o=Qt,i=He,c=de,l=xt,f=e.f;qe=null,et=0,ot=null,Qt=(f&it)!==0&&(xt||!on||se===null),se=(f&(Lt|An))===0?e:null,He=null,so(e.ctx),xt=!1,Pr++,e.f|=us;try{var d=(0,e.fn)(),u=e.deps;if(qe!==null){var v;if(Er(e,et),u!==null&&et>0)for(u.length=et+qe.length,v=0;v<qe.length;v++)u[et+v]=qe[v];else e.deps=u=qe;if(!Qt)for(v=et;v<u.length;v++)((_=u[v]).reactions??(_.reactions=[])).push(e)}else u!==null&&et<u.length&&(Er(e,et),u.length=et);if(On()&&ot!==null&&!xt&&u!==null&&(e.f&(vt|dn|Ft))===0)for(v=0;v<ot.length;v++)oa(ot[v],e);return s!==null&&(Pr++,ot!==null&&(r===null?r=ot:r.push(...ot))),d}finally{qe=t,et=n,ot=r,se=s,Qt=o,He=i,so(c),xt=l,e.f^=us}}function pl(e,t){let n=t.reactions;if(n!==null){var r=Ci.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(t.f&vt)!==0&&(qe===null||!qe.includes(t))&&(gt(t,dn),(t.f&(it|kr))===0&&(t.f^=kr),Wo(t),Er(t,0))}function Er(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)pl(e,n[r])}function qr(e){var t=e.f;if((t&Lr)===0){gt(e,Qe);var n=ue,r=de,s=on;ue=e,on=!0;try{(t&Cs)!==0?il(e):Zo(e),Yo(e);var o=aa(e);e.teardown=typeof o=="function"?o:null,e.wv=ra;var i=e.deps,c;no&&Ui&&e.f&Ft}catch(l){Jr(l,e,n,r||e.ctx)}finally{on=s,ue=n}}}function gl(){try{Ni()}catch(e){if($r!==null)Jr(e,$r,null);else throw e}}function ia(){var e=on;try{var t=0;for(on=!0;Wn.length>0;){t++>1e3&&gl();var n=Wn,r=n.length;Wn=[];for(var s=0;s<r;s++){var o=_l(n[s]);hl(o)}}}finally{Cr=!1,on=e,$r=null,Qn.clear()}}function hl(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Lr|Tt))===0)try{In(r)&&(qr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Xo(r):r.fn=null))}catch(s){Jr(s,r,null,r.ctx)}}}function Vr(e){Cr||(Cr=!0,queueMicrotask(ia));for(var t=$r=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(An|Lt))!==0){if((n&Qe)===0)return;t.f^=Qe}}Wn.push(t)}function _l(e){for(var t=[],n=e;n!==null;){var r=n.f,s=(r&(Lt|An))!==0,o=s&&(r&Qe)!==0;if(!o&&(r&Tt)===0){if((r&No)!==0)t.push(n);else if(s)n.f^=Qe;else{var i=se;try{se=n,In(n)&&qr(n)}catch(f){Jr(f,n,null,n.ctx)}finally{se=i}}var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return t}function yl(e){var t;for(co();Wn.length>0;)Cr=!0,ia(),co();return t}async function ml(){await Promise.resolve(),yl()}function a(e){var t=e.f,n=(t&vt)!==0;if(Kt!==null&&Kt.add(e),se!==null&&!xt){if(!(He!=null&&He.includes(e))){var r=se.deps;e.rv<Pr&&(e.rv=Pr,qe===null&&r!==null&&r[et]===e?et++:qe===null?qe=[e]:(!Qt||!qe.includes(e))&&qe.push(e))}}else if(n&&e.deps===null&&e.effects===null){var s=e,o=s.parent;o!==null&&(o.f&it)===0&&(s.f^=it)}return n&&(s=e,In(s)&&Ko(s)),ir&&Qn.has(e)?Qn.get(e):e.v}function bl(e){var t=Kt;Kt=new Set;var n=Kt,r;try{if(Ye(e),t!==null)for(r of Kt)t.add(r)}finally{Kt=t}return n}function vs(e){var t=bl(()=>Ye(e));for(var n of t)if((n.f&Mo)!==0)for(const r of n.deps||[])(r.f&vt)===0&&Yn(r,r.v);else Yn(n,n.v)}function Ye(e){var t=xt;try{return xt=!0,e()}finally{xt=t}}const wl=-7169;function gt(e,t){e.f=e.f&wl|t}function Ds(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(kt in e)ps(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&kt in n&&ps(n)}}}function ps(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{ps(e[r],t)}catch{}const n=ks(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=jo(n);for(let s in r){const o=r[s].get;if(o)try{o.call(e)}catch{}}}}}function xl(e){return e.endsWith("capture")&&e!=="gotpointercapture"&&e!=="lostpointercapture"}const Sl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function kl(e){return Sl.includes(e)}const Cl={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function $l(e){return e=e.toLowerCase(),Cl[e]??e}const Pl=["touchstart","touchmove"];function El(e){return Pl.includes(e)}function Al(e,t){if(t){const n=document.body;e.autofocus=!0,zr(()=>{document.activeElement===n&&e.focus()})}}let fo=!1;function Rl(){fo||(fo=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function la(e){var t=se,n=ue;$t(null),Zt(null);try{return e()}finally{$t(t),Zt(n)}}function Ts(e,t,n,r=n){e.addEventListener(t,()=>la(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),Rl()}const ca=new Set,gs=new Set;function ua(e,t,n,r={}){function s(o){if(r.capture||qn.call(t,o),!o.cancelBubble)return la(()=>n==null?void 0:n.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?zr(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function F(e,t,n,r,s){var o={capture:r,passive:s},i=ua(e,t,n,o);(t===document.body||t===window||t===document)&&Rs(()=>{t.removeEventListener(e,i,o)})}function Ol(e){for(var t=0;t<e.length;t++)ca.add(e[t]);for(var n of gs)n(e)}function qn(e){var w;var t=this,n=t.ownerDocument,r=e.type,s=((w=e.composedPath)==null?void 0:w.call(e))||[],o=s[0]||e.target,i=0,c=e.__root;if(c){var l=s.indexOf(c);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=s.indexOf(t);if(f===-1)return;l<=f&&(i=l)}if(o=s[i]||e.target,o!==t){Io(e,"currentTarget",{configurable:!0,get(){return o||n}});var d=se,u=ue;$t(null),Zt(null);try{for(var v,_=[];o!==null;){var h=o.assignedSlot||o.parentNode||o.host||null;try{var b=o["__"+r];if(b!=null&&(!o.disabled||e.target===o))if(Nr(b)){var[x,...R]=b;x.apply(o,[e,...R])}else b.call(o,e)}catch(k){v?_.push(k):v=k}if(e.cancelBubble||h===t||h===null)break;o=h}if(v){for(let k of _)queueMicrotask(()=>{throw k});throw v}}finally{e.__root=t,delete e.currentTarget,$t(d),Zt(u)}}}function fa(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function un(e,t){var n=ue;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function P(e,t){var n=(t&Jo)!==0,r=(t&Ki)!==0,s,o=!e.startsWith("<!>");return()=>{s===void 0&&(s=fa(o?e:"<!>"+e),n||(s=Ot(s)));var i=r||Vo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=Ot(i),l=i.lastChild;un(c,l)}else un(i,i);return i}}function da(e,t,n="svg"){var r=!e.startsWith("<!>"),s=(t&Jo)!==0,o=`<${n}>${r?e:"<!>"+e}</${n}>`,i;return()=>{if(!i){var c=fa(o),l=Ot(c);if(s)for(i=document.createDocumentFragment();Ot(l);)i.appendChild(Ot(l));else i=Ot(l)}var f=i.cloneNode(!0);if(s){var d=Ot(f),u=f.lastChild;un(d,u)}else un(f,f);return f}}function Ge(e=""){{var t=sr(e+"");return un(t,t),t}}function xe(){var e=document.createDocumentFragment(),t=document.createComment(""),n=sr();return e.append(t,n),un(t,n),e}function y(e,t){e!==null&&e.before(t)}function B(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function Dl(e,t){return Tl(e,t)}const bn=new Map;function Tl(e,{target:t,anchor:n,props:r={},events:s,context:o,intro:i=!0}){el();var c=new Set,l=u=>{for(var v=0;v<u.length;v++){var _=u[v];if(!c.has(_)){c.add(_);var h=El(_);t.addEventListener(_,qn,{passive:h});var b=bn.get(_);b===void 0?(document.addEventListener(_,qn,{passive:h}),bn.set(_,1)):bn.set(_,b+1)}}};l(Ss(ca)),gs.add(l);var f=void 0,d=al(()=>{var u=n??t.appendChild(sr());return cn(()=>{if(o){Be({});var v=de;v.c=o}s&&(r.$$events=s),f=e(u,r)||{},o&&We()}),()=>{var h;for(var v of c){t.removeEventListener(v,qn);var _=bn.get(v);--_===0?(document.removeEventListener(v,qn),bn.delete(v)):bn.set(v,_)}gs.delete(l),u!==n&&((h=u.parentNode)==null||h.removeChild(u))}});return Il.set(f,d),f}let Il=new WeakMap;function I(e,t,[n,r]=[0,0]){var s=e,o=null,i=null,c=Je,l=n>0?Fr:0,f=!1;const d=(v,_=!0)=>{f=!0,u(_,v)},u=(v,_)=>{c!==(c=v)&&(c?(o?Xn(o):_&&(o=cn(()=>_(s))),i&&$n(i,()=>{i=null})):(i?Xn(i):_&&(i=cn(()=>_(s,[n+1,r]))),o&&$n(o,()=>{o=null})))};ar(()=>{f=!1,t(d),f||u(null,null)},l)}function jl(e,t,n){var r=e,s=Je,o,i=On()?Di:Gr;ar(()=>{i(s,s=t())&&(o&&$n(o),o=cn(()=>n(r)))})}function tr(e,t){return t}function Nl(e,t,n,r){for(var s=[],o=t.length,i=0;i<o;i++)Os(t[i].e,s,!0);var c=o>0&&s.length===0&&n!==null;if(c){var l=n.parentNode;tl(l),l.append(n),r.clear(),Wt(e,t[0].prev,t[o-1].next)}ea(s,()=>{for(var f=0;f<o;f++){var d=t[f];c||(r.delete(d.k),Wt(e,d.prev,d.next)),jt(d.e,!c)}})}function Nt(e,t,n,r,s,o=null){var i=e,c={flags:t,items:new Map,first:null},l=(t&Uo)!==0;if(l){var f=e;i=f.appendChild(sr())}var d=null,u=!1,v=pt(()=>{var _=n();return Nr(_)?_:_==null?[]:Ss(_)});ar(()=>{var _=a(v),h=_.length;u&&h===0||(u=h===0,Ml(_,c,i,s,t,r,n),o!==null&&(h===0?d?Xn(d):d=cn(()=>o(i)):d!==null&&$n(d,()=>{d=null})),a(v))})}function Ml(e,t,n,r,s,o,i){var be,Re,Se,J;var c=(s&Ji)!==0,l=(s&(Ps|Es))!==0,f=e.length,d=t.items,u=t.first,v=u,_,h=null,b,x=[],R=[],w,k,E,T;if(c)for(T=0;T<f;T+=1)w=e[T],k=o(w,T),E=d.get(k),E!==void 0&&((be=E.a)==null||be.measure(),(b??(b=new Set)).add(E));for(T=0;T<f;T+=1){if(w=e[T],k=o(w,T),E=d.get(k),E===void 0){var D=v?v.e.nodes_start:n;h=Fl(D,t,h,h===null?t.first:h.next,w,k,T,r,s,i),d.set(k,h),x=[],R=[],v=h.next;continue}if(l&&Ll(E,w,T,s),(E.e.f&Tt)!==0&&(Xn(E.e),c&&((Re=E.a)==null||Re.unfix(),(b??(b=new Set)).delete(E))),E!==v){if(_!==void 0&&_.has(E)){if(x.length<R.length){var M=R[0],L;h=M.prev;var K=x[0],oe=x[x.length-1];for(L=0;L<x.length;L+=1)vo(x[L],M,n);for(L=0;L<R.length;L+=1)_.delete(R[L]);Wt(t,K.prev,oe.next),Wt(t,h,K),Wt(t,oe,M),v=M,h=oe,T-=1,x=[],R=[]}else _.delete(E),vo(E,v,n),Wt(t,E.prev,E.next),Wt(t,E,h===null?t.first:h.next),Wt(t,h,E),h=E;continue}for(x=[],R=[];v!==null&&v.k!==k;)(v.e.f&Tt)===0&&(_??(_=new Set)).add(v),R.push(v),v=v.next;if(v===null)continue;E=v}x.push(E),h=E,v=E.next}if(v!==null||_!==void 0){for(var V=_===void 0?[]:Ss(_);v!==null;)(v.e.f&Tt)===0&&V.push(v),v=v.next;var X=V.length;if(X>0){var pe=(s&Uo)!==0&&f===0?n:null;if(c){for(T=0;T<X;T+=1)(Se=V[T].a)==null||Se.measure();for(T=0;T<X;T+=1)(J=V[T].a)==null||J.fix()}Nl(t,V,pe,d)}}c&&zr(()=>{var te;if(b!==void 0)for(E of b)(te=E.a)==null||te.apply()}),ue.first=t.first&&t.first.e,ue.last=h&&h.e}function Ll(e,t,n,r){(r&Ps)!==0&&Yn(e.v,t),(r&Es)!==0?Yn(e.i,n):e.i=n}function Fl(e,t,n,r,s,o,i,c,l,f){var d=(l&Ps)!==0,u=(l&qi)===0,v=d?u?N(s):Cn(s):s,_=(l&Es)===0?i:Cn(i),h={i:_,v,k:o,a:null,e:null,prev:n,next:r};try{return h.e=cn(()=>c(e,v,_,f),Xi),h.e.prev=n&&n.e,h.e.next=r&&r.e,n===null?t.first=h:(n.next=h,n.e.next=h.e),r!==null&&(r.prev=h,r.e.prev=h.e),h}finally{}}function vo(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var i=Ur(o);s.before(o),o=i}}function Wt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Gt(e,t,n,r,s){var c;var o=(c=t.$$slots)==null?void 0:c[n],i=!1;o===!0&&(o=t.children,i=!0),o===void 0||o(e,i?()=>r:r)}function Gl(e,t,n,r,s,o){var i,c,l=null,f=e,d;ar(()=>{const u=t()||null;var v=Yi;u!==i&&(d&&(u===null?$n(d,()=>{d=null,c=null}):u===c?Xn(d):jt(d)),u&&u!==c&&(d=cn(()=>{if(l=document.createElementNS(v,u),un(l,l),r){var _=l.appendChild(sr());r(l,_)}ue.nodes_end=l,f.before(l)})),i=u,i&&(c=i))},Fr)}function Ul(e,t,n){Tn(()=>{var r=Ye(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var s=!1,o={};vn(()=>{var i=n();Ds(i),s&&Gr(o,i)&&(o=i,r.update(i))}),s=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function va(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=va(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function zl(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=va(e))&&(r&&(r+=" "),r+=t);return r}function Jl(e){return typeof e=="object"?zl(e):e??""}const po=[...` 	
\r\fÂ \v\uFEFF`];function ql(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,i=0;(i=r.indexOf(s,i))>=0;){var c=i+o;(i===0||po.includes(r[i-1]))&&(c===r.length||po.includes(r[c]))?r=(i===0?"":r.substring(0,i))+r.substring(c+1):i=c}}return r===""?null:r}function go(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var o=e[s];o!=null&&o!==""&&(r+=" "+s+": "+o+n)}return r}function ns(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Vl(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];r&&l.push(...Object.keys(r).map(ns)),s&&l.push(...Object.keys(s).map(ns));var f=0,d=-1;const b=e.length;for(var u=0;u<b;u++){var v=e[u];if(c?v==="/"&&e[u-1]==="*"&&(c=!1):o?o===v&&(o=!1):v==="/"&&e[u+1]==="*"?c=!0:v==='"'||v==="'"?o=v:v==="("?i++:v===")"&&i--,!c&&o===!1&&i===0){if(v===":"&&d===-1)d=u;else if(v===";"||u===b-1){if(d!==-1){var _=ns(e.substring(f,d).trim());if(!l.includes(_)){v!==";"&&u++;var h=e.substring(f,u).trim();n+=" "+h+";"}}f=u+1,d=-1}}}}return r&&(n+=go(r)),s&&(n+=go(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function Pn(e,t,n,r,s,o){var i=e.__className;if(i!==n){var c=ql(n,r,o);c==null?e.removeAttribute("class"):t?e.className=c:e.setAttribute("class",c),e.__className=n}else if(o&&s!==o)for(var l in o){var f=!!o[l];(s==null||f!==!!s[l])&&e.classList.toggle(l,f)}return o}function rs(e,t={},n,r){for(var s in n){var o=n[s];t[s]!==o&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,o,r))}}function pa(e,t,n,r){var s=e.__style;if(s!==t){var o=Vl(t,r);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}else r&&(Array.isArray(r)?(rs(e,n==null?void 0:n[0],r[0]),rs(e,n==null?void 0:n[1],r[1],"important")):rs(e,n,r));return r}const Un=Symbol("class"),zn=Symbol("style"),ga=Symbol("is custom element"),ha=Symbol("is html");function Hl(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Dt(e,t,n,r){var s=_a(e);s[t]!==(s[t]=n)&&(t==="loading"&&(e[Oi]=n),n==null?e.removeAttribute(t):typeof n!="string"&&ya(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function ho(e,t,n,r,s=!1){var o=_a(e),i=o[ga],c=!o[ha],l=t||{},f=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=Jl(n.class):n[Un]&&(n.class=null),n[zn]&&(n.style??(n.style=null));var u=ya(e);for(const k in n){let E=n[k];if(f&&k==="value"&&E==null){e.value=e.__value="",l[k]=E;continue}if(k==="class"){var v=e.namespaceURI==="http://www.w3.org/1999/xhtml";Pn(e,v,E,r,t==null?void 0:t[Un],n[Un]),l[k]=E,l[Un]=n[Un];continue}if(k==="style"){pa(e,E,t==null?void 0:t[zn],n[zn]),l[k]=E,l[zn]=n[zn];continue}var _=l[k];if(E!==_){l[k]=E;var h=k[0]+k[1];if(h!=="$$")if(h==="on"){const T={},D="$$"+k;let M=k.slice(2);var b=kl(M);if(xl(M)&&(M=M.slice(0,-7),T.capture=!0),!b&&_){if(E!=null)continue;e.removeEventListener(M,l[D],T),l[D]=null}if(E!=null)if(b)e[`__${M}`]=E,Ol([M]);else{let L=function(K){l[k].call(this,K)};var w=L;l[D]=ua(M,e,L,T)}else b&&(e[`__${M}`]=void 0)}else if(k==="style")Dt(e,k,E);else if(k==="autofocus")Al(e,!!E);else if(!i&&(k==="__value"||k==="value"&&E!=null))e.value=e.__value=E;else if(k==="selected"&&f)Hl(e,E);else{var x=k;c||(x=$l(x));var R=x==="defaultValue"||x==="defaultChecked";if(E==null&&!i&&!R)if(o[k]=null,x==="value"||x==="checked"){let T=e;const D=t===void 0;if(x==="value"){let M=T.defaultValue;T.removeAttribute(x),T.defaultValue=M,T.value=T.__value=D?M:null}else{let M=T.defaultChecked;T.removeAttribute(x),T.defaultChecked=M,T.checked=D?M:!1}}else e.removeAttribute(k);else R||u.includes(x)&&(i||typeof E!="string")?e[x]=E:typeof E!="function"&&Dt(e,x,E)}}}return l}function _a(e){return e.__attributes??(e.__attributes={[ga]:e.nodeName.includes("-"),[ha]:e.namespaceURI===Qi})}var _o=new Map;function ya(e){var t=_o.get(e.nodeName);if(t)return t;_o.set(e.nodeName,t=[]);for(var n,r=e,s=Element.prototype;s!==r;){n=jo(r);for(var o in n)n[o].set&&t.push(o);r=ks(r)}return t}function tt(e,t,n=t){var r=On();Ts(e,"input",s=>{var o=s?e.defaultValue:e.value;if(o=ss(e)?os(o):o,n(o),r&&o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd;e.value=o??"",c!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(c,e.value.length))}}),Ye(t)==null&&e.value&&n(ss(e)?os(e.value):e.value),vn(()=>{var s=t();ss(e)&&s===os(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function gr(e,t,n=t){Ts(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),Ye(t)==null&&n(e.checked),vn(()=>{var r=t();e.checked=!!r})}function ss(e){var t=e.type;return t==="number"||t==="range"}function os(e){return e===""?null:+e}function ma(e,t,n){if(e.multiple)return Wl(e,t);for(var r of e.options){var s=Kn(r);if(Zi(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Bl(e,t){Tn(()=>{var n=new MutationObserver(()=>{var r=e.__value;ma(e,r)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function hs(e,t,n=t){var r=!0;Ts(e,"change",s=>{var o=s?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),Kn);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");i=c&&Kn(c)}n(i)}),Tn(()=>{var s=t();if(ma(e,s,r),r&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=Kn(o),n(s))}e.__value=s,r=!1}),Bl(e)}function Wl(e,t){for(var n of e.options)n.selected=~t.indexOf(Kn(n))}function Kn(e){return"__value"in e?e.__value:e.value}function yo(e,t){return e===t||(e==null?void 0:e[kt])===t}function Vn(e={},t,n,r){return Tn(()=>{var s,o;return vn(()=>{s=o,o=[],Ye(()=>{e!==n(...o)&&(t(e,...o),s&&yo(n(...s),e)&&t(null,...s))})}),()=>{zr(()=>{o&&yo(n(...o),e)&&t(null,...o)})}}),e}function Kl(e){return function(...t){var n=t[0];return n.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ze(e=!1){const t=de,n=t.l.u;if(!n)return;let r=()=>Ds(t.s);if(e){let s=0,o={};const i=Zn(()=>{let c=!1;const l=t.s;for(const f in l)l[f]!==o[f]&&(o[f]=l[f],c=!0);return c&&s++,s});r=()=>a(i)}n.b.length&&ol(()=>{mo(t,r),xr(n.b)}),fs(()=>{const s=Ye(()=>n.m.map(Ei));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&fs(()=>{mo(t,r),xr(n.a)})}function mo(e,t){if(e.l.s)for(const n of e.l.s)a(n);t()}function ba(e,t,n){if(e==null)return t(void 0),Sn;const r=Ye(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const wn=[];function st(e,t=Sn){let n=null;const r=new Set;function s(c){if(Gr(e,c)&&(e=c,n)){const l=!wn.length;for(const f of r)f[1](),wn.push(f,e);if(l){for(let f=0;f<wn.length;f+=2)wn[f][0](wn[f+1]);wn.length=0}}}function o(c){s(c(e))}function i(c,l=Sn){const f=[c,l];return r.add(f),r.size===1&&(n=t(s,o)||Sn),c(e),()=>{r.delete(f),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function Ae(e){let t;return ba(e,n=>t=n)(),t}let hr=!1,_s=Symbol();function fn(e,t,n){const r=n[t]??(n[t]={store:null,source:N(void 0),unsubscribe:Sn});if(r.store!==e&&!(_s in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Sn;else{var s=!0;r.unsubscribe=ba(e,o=>{s?r.source.v=o:m(r.source,o)}),s=!1}return e&&_s in n?Ae(e):a(r.source)}function Hr(){const e={};function t(){Rs(()=>{for(var n in e)e[n].unsubscribe();Io(e,_s,{enumerable:!1,value:!0})})}return[e,t]}function Ql(e){var t=hr;try{return hr=!1,[e(),hr]}finally{hr=t}}const Yl={get(e,t){if(!e.exclude.includes(t))return a(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,n){return t in e.special||(e.special[t]=nt({get[t](){return e.props[t]}},t,zo)),e.special[t](n),io(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),io(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function Mt(e,t){return new Proxy({props:e,exclude:t,special:{},version:Cn(0)},Yl)}const Zl={get(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Gn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r)return r[t]}},set(e,t,n){let r=e.props.length;for(;r--;){let s=e.props[r];Gn(s)&&(s=s());const o=Yt(s,t);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(e,t){let n=e.props.length;for(;n--;){let r=e.props[n];if(Gn(r)&&(r=r()),typeof r=="object"&&r!==null&&t in r){const s=Yt(r,t);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,t){if(t===kt||t===Fo)return!1;for(let n of e.props)if(Gn(n)&&(n=n()),n!=null&&t in n)return!0;return!1},ownKeys(e){const t=[];for(let n of e.props){Gn(n)&&(n=n());for(const r in n)t.includes(r)||t.push(r)}return t}};function pn(...e){return new Proxy({props:e},Zl)}function bo(e){var t;return((t=e.ctx)==null?void 0:t.d)??!1}function nt(e,t,n,r){var M;var s=(n&Vi)!==0,o=!Rn||(n&Hi)!==0,i=(n&Bi)!==0,c=(n&Wi)!==0,l=!1,f;i?[f,l]=Ql(()=>e[t]):f=e[t];var d=kt in e||Fo in e,u=i&&(((M=Yt(e,t))==null?void 0:M.set)??(d&&t in e&&(L=>e[t]=L)))||void 0,v=r,_=!0,h=!1,b=()=>(h=!0,_&&(_=!1,c?v=Ye(r):v=r),v);f===void 0&&r!==void 0&&(u&&o&&Mi(),f=b(),u&&u(f));var x;if(o)x=()=>{var L=e[t];return L===void 0?b():(_=!0,h=!1,L)};else{var R=(s?Zn:pt)(()=>e[t]);R.f|=Mo,x=()=>{var L=a(R);return L!==void 0&&(v=void 0),L===void 0?v:L}}if((n&zo)===0)return x;if(u){var w=e.$$legacy;return function(L,K){return arguments.length>0?((!o||!K||w||l)&&u(K?x():L),L):x()}}var k=!1,E=!1,T=N(f),D=Zn(()=>{var L=x(),K=a(T);return k?(k=!1,E=!0,K):(E=!1,T.v=L)});return i&&a(D),s||(D.equals=$s),function(L,K){if(Kt!==null&&(k=E,x(),a(T)),arguments.length>0){const oe=K?a(D):o&&i?rn(L):L;if(!D.equals(oe)){if(k=!0,m(T,oe),h&&v!==void 0&&(v=oe),bo(D))return L;Ye(()=>a(D))}return L}return bo(D)?D.v:a(D)}}function lr(e){de===null&&As(),Rn&&de.l!==null?nc(de).m.push(e):fs(()=>{const t=Ye(e);if(typeof t=="function")return t})}function Xl(e){de===null&&As(),lr(()=>()=>Ye(e))}function ec(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function tc(){const e=de;return e===null&&As(),(t,n,r)=>{var o;const s=(o=e.s.$$events)==null?void 0:o[t];if(s){const i=Nr(s)?s.slice():[s],c=ec(t,n,r);for(const l of i)l.call(e.x,c);return!c.defaultPrevented}return!0}}function nc(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}const rc="5";var To;typeof window<"u"&&((To=window.__svelte??(window.__svelte={})).v??(To.v=new Set)).add(rc);zi();const St=st({isLoggedIn:!1,token:null,user:null});function as(){St.set({isLoggedIn:!1,token:null,user:null}),localStorage.removeItem("skygit_token")}const at=st("home"),Br=st(null),Ie=st({phase:"streaming",paused:!1,loadedCount:0,totalCount:null}),sc="modulepreload",oc=function(e){return"/skygit/"+e},wo={},cr=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=oc(l),l in wo)return;wo[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":sc,f||(u.as="script"),u.crossOrigin="",u.href=l,c&&u.setAttribute("nonce",c),document.head.appendChild(u),f)return new Promise((v,_)=>{u.addEventListener("load",v),u.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})};async function wa(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function ys(e,t){const n=await wa(e),r=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(JSON.stringify(t)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},n,o),c=new Uint8Array(r.byteLength+i.byteLength);return c.set(r,0),c.set(new Uint8Array(i),r.byteLength),btoa(String.fromCharCode(...c))}async function Is(e,t){const n=Uint8Array.from(atob(t),f=>f.charCodeAt(0)),r=n.slice(0,12),s=n.slice(12),o=await wa(e),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},o,s),l=new TextDecoder().decode(i);return JSON.parse(l)}const kn=new Map,Ar=new Map,ac="https://api.github.com",ic="skygit-config";function xa(e){return{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}}let Jn=null;async function Et(e){return Jn||(Jn=(async()=>{const t=await fetch(`${ac}/user`,{headers:xa(e)});if(!t.ok)throw Jn=null,new Error("Failed to fetch GitHub user");return(await t.json()).login})(),Jn)}async function lc(e,t){const n=await fetch(`https://api.github.com/repos/${t}/${ic}`,{headers:xa(e)});if(n.status===404)return!1;if(!n.ok)throw await n.text(),new Error("Error checking repo existence");return!0}async function cc(e){const t={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},n=await fetch("https://api.github.com/user/repos",{method:"POST",headers:t,body:JSON.stringify({name:"skygit-config",private:!0,description:"Configuration repo for SkyGit",auto_init:!0})});if(!n.ok){const c=await n.text();throw new Error(`Failed to create repo: ${c}`)}const r=await n.json(),s=r.owner.login,o={created:new Date().toISOString(),encryption:!1,media:"github",commitPolicy:"manual"},i=btoa(unescape(encodeURIComponent(JSON.stringify(o,null,2))));return await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/config.json`,{method:"PUT",headers:t,body:JSON.stringify({message:"Initialize SkyGit config",content:i})}),await fetch(`https://api.github.com/repos/${s}/skygit-config/contents/.messages/.gitkeep`,{method:"PUT",headers:t,body:JSON.stringify({message:"Create .messages folder",content:btoa("")})}),r}async function js(e,t,n=2){const r=await Et(e),s=`repositories/${t.owner}-${t.name}.json`,o=kn.get(s);if(o)return o;const i={Authorization:`token ${e}`,Accept:"application/vnd.github+json","Content-Type":"application/json"},c=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(Ar.get(s)===c)return;let f=0,d=null;const v=(async()=>{for(;f<=n;){let _=null;try{const R=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{headers:i});R.ok&&(_=(await R.json()).sha)}catch{}const h={message:`Update repo ${t.full_name}`,content:c,..._&&{sha:_}},b=await fetch(`https://api.github.com/repos/${r}/skygit-config/contents/${s}`,{method:"PUT",headers:i,body:JSON.stringify(h)});if(b.ok){Ar.set(s,c);return}if(d=await b.text(),b.status===409){f+=1;continue}break}throw new Error(`GitHub commit failed: ${d}`)})().finally(()=>kn.delete(s));return kn.set(s,v),v}async function Sa(e){const n=`https://api.github.com/repos/${await Et(e)}/skygit-config/contents/repositories`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404){Ie.set({phase:"idle",loadedCount:0,totalCount:0,paused:!1});return}if(!s.ok){const c=await s.text();throw new Error(`Failed to load repository list: ${c}`)}const i=(await s.json()).filter(c=>c.name.endsWith(".json"));Ie.set({phase:"streaming",loadedCount:0,totalCount:i.length,paused:!1});for(const c of i){let l=!1;if(Ie.subscribe(f=>l=f.paused)(),l)break;try{const f=await fetch(c.url,{headers:r});if(!f.ok){console.warn(`[SkyGit] Skipped missing repo file: ${c.name} (${f.status})`);continue}const d=await f.json(),u=atob(d.content),v=JSON.parse(u);$a([v]),Ie.update(_=>({..._,loadedCount:_.loadedCount+1}))}catch(f){console.warn(`[SkyGit] Skipped malformed repo file: ${c.name}`,f);continue}}Ie.update(c=>({...c,phase:"idle"}))}async function uc(e){const n=`https://api.github.com/repos/${await Et(e)}/skygit-config/contents/conversations`,r={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},s=await fetch(n,{headers:r});if(s.status===404)return;if(!s.ok){const l=await s.text();throw new Error(`Failed to load conversations: ${l}`)}const i=(await s.json()).filter(l=>l.name.endsWith(".json")),c=[];for(const l of i){const f=await fetch(l.url,{headers:r});if(!f.ok)continue;const d=await f.json(),u=JSON.parse(atob(d.content));c.push(u)}return c}async function fc(e,t){const n=await Et(e),r=`repositories/${t.owner}-${t.name}.json`,s=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(!s.ok){const c=await s.text();throw new Error(`Unable to locate repo file for deletion: ${c}`)}const o=await s.json(),i=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Remove repo ${t.full_name}`,sha:o.sha})});if(!i.ok){const c=await i.text();throw new Error(`Failed to delete repo file: ${c}`)}}async function dc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={commit_frequency_min:1440,binary_storage_type:"gitfs",storage_info:{type:"gitfs",url:""}},s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2))));if(Ar.get(o)===i)return;const c=kn.get(o);if(c)return c;const l=`https://api.github.com/repos/${t.full_name}/contents/${s}`;let f=null;try{const u=await fetch(l,{headers:n});if(u.ok)f=(await u.json()).sha;else if(u.status!==404){const v=await u.text();throw new Error(`Failed to check if config.json exists: ${v}`)}}catch(u){console.warn("Error checking for config.json",u)}const d=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify({message:"Activate messaging: add .messages/config.json",content:i,...f&&{sha:f}})});if(!d.ok){const u=await d.text();throw new Error(`Failed to commit config.json: ${u}`)}t.has_messages=!0,t.config=r,await js(e,t)}async function vc(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=t.config,s=".messages/config.json",o=`${t.full_name}/${s}`,i=btoa(unescape(encodeURIComponent(JSON.stringify(r,null,2)))),c=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{headers:n});let l=null;c.ok&&(l=(await c.json()).sha);const f=fetch(`https://api.github.com/repos/${t.full_name}/contents/${s}`,{method:"PUT",headers:n,body:JSON.stringify({message:"Update messaging config",content:i,...l&&{sha:l}})}).then(async u=>{if(!u.ok){const v=await u.text();throw new Error(`Failed to update config.json: ${v}`)}Ar.set(o,i)}).finally(()=>{kn.delete(o)});kn.set(o,f),await f;const{queueRepoForCommit:d}=await cr(async()=>{const{queueRepoForCommit:u}=await Promise.resolve().then(()=>Aa);return{queueRepoForCommit:u}},void 0);await d(t)}async function Ns(e){const n=`https://api.github.com/repos/${await Et(e)}/skygit-config/contents/secrets.json`,r=await fetch(n,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(r.status===404)return{secrets:{},sha:null};const s=await r.json();return{secrets:JSON.parse(atob(s.content)),sha:s.sha}}async function mr(e,t,n=null){const s=`https://api.github.com/repos/${await Et(e)}/skygit-config/contents/secrets.json`,o=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2))));if(!n){const l=await fetch(s,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"}});if(l.ok)n=(await l.json()).sha;else if(l.status!==404){const f=await l.text();throw new Error(`Failed to check secrets.json: ${f}`)}}const i={message:"Update secrets.json",content:o,...n&&{sha:n}},c=await fetch(s,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify(i)});if(!c.ok){const l=await c.text();throw new Error(`Failed to write secrets.json: ${l}`)}}async function pc(e,t){const n=t.config.storage_info.url,r=t.config.storage_info.credentials;if(!r||Object.keys(r).length===0)return;const s=await ys(e,r),{secrets:o,sha:i}=await Ns(e);o[n]=s,await mr(e,o,i)}const ka="skygit_repos",gc=5*60*1e3,hc=10;let an=[],Rr=null;const _c=JSON.parse(localStorage.getItem(ka)||"[]"),Pt=st(_c),Ms=st(0),Or=st(null);Pt.subscribe(e=>{localStorage.setItem(ka,JSON.stringify(e))});function Ca(e){if(Pt.update(n=>{const r=n.findIndex(s=>s.full_name===e.full_name);if(r>=0){const s=[...n];return s[r]=e,s}return[...n,e]}),an.some(n=>n.full_name===e.full_name)||an.push(e),an.length>=hc){nr();return}Rr||(Rr=setTimeout(nr,gc))}async function nr(){if(an.length===0)return;const e=localStorage.getItem("skygit_token");if(!e)return;const t=[...an];an=[],clearTimeout(Rr),Rr=null;for(const n of t)try{await js(e,n),console.log("[SkyGit] Repo committed:",n.full_name)}catch(r){console.error("[SkyGit] Failed to commit repo:",n.full_name,r)}}function $a(e){Pt.update(t=>{const n=new Map(t.map(s=>[s.full_name,s]));for(const s of e)n.set(s.full_name,s);const r=Array.from(n.values());return localStorage.setItem("skygit_repos",JSON.stringify(r)),r})}function Pa(){return an.length>0}function Ea(e){let t;return Pt.update(n=>(t=n.find(r=>r.full_name===e||r.name===e),n)),t}const Aa=Object.freeze(Object.defineProperty({__proto__:null,filteredCount:Ms,flushRepoCommitQueue:nr,getRepoByFullName:Ea,hasPendingRepoCommits:Pa,queueRepoForCommit:Ca,repoList:Pt,selectedRepo:Or,syncRepoListFromGitHub:$a},Symbol.toStringTag,{value:"Module"}));async function yc(e){try{const t=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${e}`}});return t.ok?await t.json():null}catch{return null}}function mc(e){localStorage.setItem("skygit_token",e)}function bc(){return localStorage.getItem("skygit_token")}const Ra="skygit_conversations",wc=JSON.parse(localStorage.getItem(Ra)||"{}"),jn=st(wc),Ls=st(null);jn.subscribe(e=>{localStorage.setItem(Ra,JSON.stringify(e))});function ms(e,t){jn.update(n=>({...n,[e]:t}))}function xc(e,t){jn.update(n=>{const r=n[t.full_name]||[];return{...n,[t.full_name]:[...r,e]}}),t.conversations||(t.conversations=[]),t.conversations.includes(e.id)||t.conversations.push(e.id)}function Oa(e,t,n){jn.update(r=>{const o=(r[t]||[]).map(i=>i.id===e?{...i,messages:[...i.messages||[],n],updatedAt:n.timestamp||Date.now()}:i);return{...r,[t]:o}}),Ls.update(r=>(r==null?void 0:r.id)===e&&(r==null?void 0:r.repo)===t?{...r,messages:[...r.messages||[],n],updatedAt:n.timestamp||Date.now()}:r)}const Te=[];for(let e=0;e<256;++e)Te.push((e+256).toString(16).slice(1));function Sc(e,t=0){return(Te[e[t+0]]+Te[e[t+1]]+Te[e[t+2]]+Te[e[t+3]]+"-"+Te[e[t+4]]+Te[e[t+5]]+"-"+Te[e[t+6]]+Te[e[t+7]]+"-"+Te[e[t+8]]+Te[e[t+9]]+"-"+Te[e[t+10]]+Te[e[t+11]]+Te[e[t+12]]+Te[e[t+13]]+Te[e[t+14]]+Te[e[t+15]]).toLowerCase()}let is;const kc=new Uint8Array(16);function Cc(){if(!is){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");is=crypto.getRandomValues.bind(crypto)}return is(kc)}const $c=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xo={randomUUID:$c};function Pc(e,t,n){var s;if(xo.randomUUID&&!e)return xo.randomUUID();e=e||{};const r=e.random??((s=e.rng)==null?void 0:s.call(e))??Cc();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Sc(r)}async function Ec(e,t){const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r=`https://api.github.com/repos/${t.full_name}/contents/.messages`,s=await fetch(r,{headers:n});if(!s.ok)return;const i=(await s.json()).filter(c=>c.name.startsWith("conversation-")&&c.name.endsWith(".json")).map(c=>({id:c.name.replace("conversation-","").replace(".json",""),name:c.name,path:c.path,repo:t.full_name}));ms(t.full_name,i),t.conversations=i.map(c=>c.id),await js(e,t)}async function Da(e,t){console.log("[SkyGit] ðŸ“ commitToSkyGitConversations() called"),console.log("â© Payload:",t);const n=await Et(e),r=t.repo.replace(/\W+/g,"_"),s=t.title.replace(/\W+/g,"_"),o=`conversations/${r}_${s}.json`,i=btoa(JSON.stringify(t,null,2)),c=await fetch(`https://api.github.com/repos/${n}/skygit-config/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Add conversation ${t.id}`,content:i})});if(!c.ok){const l=await c.text();throw new Error(`[SkyGit] Failed to commit to skygit-config: ${c.status} ${l}`)}}async function Ac(e,t,n){console.log("[SkyGit] ðŸ”§ createConversation called for:",t.full_name,"with title:",n),await Et(e);const r=Pc();t.full_name.replace(/\W+/g,"_"),n.replace(/\W+/g,"_");const s=`conversation-${r}.json`,o=`.messages/${s}`,i={id:r,repo:t.full_name,title:n,createdAt:new Date().toISOString(),participants:[],messages:[]},c=btoa(JSON.stringify(i)),l=await fetch(`https://api.github.com/repos/${t.full_name}/contents/${o}`,{method:"PUT",headers:{Authorization:`token ${e}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Create new conversation ${r}`,content:c})});if(!l.ok){const d=await l.text();throw new Error(`[SkyGit] Failed to write conversation to ${t.full_name}: ${l.status} ${d}`)}try{console.log("[SkyGit] ðŸ“¤ Now committing to skygit-config..."),await Da(e,i)}catch(d){console.warn("[SkyGit] Failed to mirror conversation to skygit-config:",d)}const f={id:r,name:s,path:o,repo:t.full_name,title:n};xc(f,t)}const Hn=e=>({Authorization:`token ${e}`,Accept:"application/vnd.github+json"});let br=!1;function Rc(){br=!0}async function bs(e){br=!1;const t=new Set,n=[],r=await ls("https://api.github.com/user/repos",Hn(e));n.push(...r),Ie.update(o=>({...o,totalCount:n.length}));const s=await ls("https://api.github.com/user/orgs",Hn(e));for(const o of s){if(br)return;const i=await ls(`https://api.github.com/orgs/${o.login}/repos`,Hn(e));n.push(...i),Ie.update(c=>({...c,totalCount:n.length}))}for(const o of n){if(br)return;const i=o.full_name;if(t.has(i)){Ie.update(d=>({...d,loadedCount:d.loadedCount+1}));continue}t.add(i);const c=await Oc(e,i),l=typeof o.has_discussions=="boolean"?o.has_discussions:!1,f={name:o.name,owner:o.owner.login,full_name:i,url:o.html_url,private:o.private,has_messages:c,has_discussions:l,config:null};if(f.has_messages){try{const d=await fetch(`https://api.github.com/repos/${i}/contents/.messages/config.json`,{headers:Hn(e)});if(d.ok){const u=await d.json();f.config=JSON.parse(atob(u.content))}}catch(d){console.warn(`[SkyGit] Invalid config.json in ${i}`,d)}await Ec(e,f)}Ie.update(d=>({...d,loadedCount:d.loadedCount+1})),Ca(f)}try{await nr()}catch(o){console.warn("[SkyGit] Failed to flush repo commit queue:",o)}Ie.update(o=>({...o,phase:"idle"}))}async function ls(e,t){let n=[],r=1,s=!1;for(;!s;){const o=await fetch(`${e}?per_page=100&page=${r}`,{headers:t}),i=await o.json();o.ok&&Array.isArray(i)?(n=n.concat(i),s=i.length<100,r++):s=!0}return n}async function Oc(e,t){try{return(await fetch(`https://api.github.com/repos/${t}/contents/.messages`,{headers:Hn(e)})).status===200}catch{return!1}}const ws=st({config:null,secrets:{},secretsSha:null});async function Dc(e){const t=await Et(e),n={Authorization:`token ${e}`,Accept:"application/vnd.github+json"},r={config:null,secrets:{},secretsSha:null};try{const s=JSON.parse(localStorage.getItem("skygit_conversations")||"{}");for(const o in s)ms(o,s[o]);console.log("[SkyGit] âœ… Loaded conversations from localStorage")}catch(s){console.warn("[SkyGit] Failed to load local conversations:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/config.json`,{headers:n});if(s.ok){const o=await s.json();r.config=JSON.parse(atob(o.content))}else s.status!==404&&console.warn("[SkyGit] Failed to load config.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading config.json:",s)}try{const s=await fetch(`https://api.github.com/repos/${t}/skygit-config/contents/secrets.json`,{headers:n});if(s.ok){const o=await s.json();try{const i=JSON.parse(atob(o.content)),c={};for(const[l,f]of Object.entries(i))try{c[l]=await Is(e,f)}catch(d){console.warn(`[SkyGit] Failed to decrypt secret for ${l}:`,d)}r.secrets=c,r.secretsSha=o.sha}catch(i){console.warn("[SkyGit] Failed to parse or decrypt secrets.json:",i),console.warn("[SkyGit] Content preview:",o.content.slice(0,50)),r.secrets={},r.secretsSha=o.sha}}else s.status!==404&&console.warn("[SkyGit] Failed to load secrets.json:",await s.text())}catch(s){console.warn("[SkyGit] Error loading secrets.json:",s)}ws.set(r);try{console.log("[SkyGit] Streaming saved repos..."),await Sa(e)}catch(s){console.warn("[SkyGit] Failed to stream repos:",s)}try{console.log("[SkyGit] Streaming saved conversations...");const s=await uc(e)||[],o={};for(const i of s)o[i.repo]||(o[i.repo]=[]),o[i.repo].push({id:i.id,title:i.title,name:`${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,path:`.messages/${i.repo.replace(/\W+/g,"_")}_${i.title.replace(/\W+/g,"_")}.json`,repo:i.repo});for(const i in o)ms(i,o[i])}catch(s){console.warn("[SkyGit] Failed to stream conversations:",s)}}let rr=new Set,wr=new Map;const Tc=10;function Fs(e,t){const n=`${e}::${t}`;if(rr.add(n),rr.size>=Tc){Dr();return}const r=Ic(e);if(!wr.has(n)){const s=setTimeout(()=>{Dr([n]),wr.delete(n)},r);wr.set(n,s)}}function Ic(e){var s;const n=Ae(Pt).find(o=>o.full_name===e);return(((s=n==null?void 0:n.config)==null?void 0:s.commit_frequency_min)??5)*60*1e3}async function Dr(e=null){const t=e||Array.from(rr);if(t.length===0)return;const n=localStorage.getItem("skygit_token");if(!n)return;await Et(n);const r=Ae(jn);for(const s of t){rr.delete(s),wr.delete(s);const[o,i]=s.split("::"),l=(r[o]||[]).find(d=>d.id===i);if(!l||!l.messages||l.messages.length===0){console.warn("[SkyGit] Skipped empty or missing conversation:",s);continue}const f={id:l.id,repo:o,title:l.title||`Conversation ${l.id}`,createdAt:l.createdAt||new Date().toISOString(),participants:l.participants||[],messages:l.messages};try{await Da(n,f);const d=`.messages/conversation-${f.id}.json`,u=btoa(JSON.stringify(f,null,2)),v=await fetch(`https://api.github.com/repos/${o}/contents/${d}`,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github+json"},body:JSON.stringify({message:`Update conversation ${f.id}`,content:u})});if(!v.ok){const _=await v.text();console.error(`[SkyGit] Failed to commit to target repo ${o}:`,_)}}catch(d){console.error("[SkyGit] Conversation commit failed:",d)}}}function Ta(){return rr.size>0}const Gs=Object.freeze(Object.defineProperty({__proto__:null,flushConversationCommitQueue:Dr,hasPendingConversationCommits:Ta,queueConversationForCommit:Fs},Symbol.toStringTag,{value:"Module"}));var jc=P('<p class="text-red-500 text-sm"> </p>'),Nc=P('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Authenticatingâ€¦',1),Mc=P('<div class="space-y-4 max-w-md mx-auto mt-20 p-6 bg-white rounded shadow"><h2 class="text-xl font-semibold">Enter your GitHub Personal Access Token</h2> <input type="text" placeholder="ghp_..." class="w-full border p-2 rounded"> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full flex items-center justify-center disabled:opacity-50"><!></button> <p class="text-sm text-gray-500">Donâ€™t have a token? <a class="text-blue-600 underline" target="_blank" href="https://github.com/settings/tokens/new?scopes=repo,read:user&amp;description=SkyGit">Generate one here</a></p></div>');function Lc(e,t){Be(t,!1);let n=nt(t,"onSubmit",8),r=nt(t,"error",8,null),s=N(""),o=N(!1);async function i(){a(o)||(m(o,!0),await n()(a(s)),m(o,!1))}Ze();var c=Mc(),l=p(g(c),2),f=p(l,2);{var d=b=>{var x=jc(),R=g(x);Y(()=>B(R,r())),y(b,x)};I(f,b=>{r()&&b(d)})}var u=p(f,2),v=g(u);{var _=b=>{var x=Nc();y(b,x)},h=b=>{var x=Ge("Authenticate");y(b,x)};I(v,b=>{a(o)?b(_):b(h,!1)})}Y(()=>{l.disabled=a(o),u.disabled=a(o)}),tt(l,()=>a(s),b=>m(s,b)),F("click",u,i),y(e,c),We()}var Fc=P('<span class="animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span> Creating...',1),Gc=P('<div class="max-w-md mx-auto mt-20 p-6 bg-white rounded shadow space-y-4"><h2 class="text-xl font-bold">Repository Creation</h2> <p>SkyGit needs to create a private GitHub repository in your account called <strong><code>skygit-config</code></strong>.</p> <p>This repository will store your conversation metadata and settings.</p> <div class="flex space-x-4 mt-6"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center disabled:opacity-50"><!></button> <button class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button></div></div>');function Uc(e,t){Be(t,!1);let n=nt(t,"onApprove",8),r=nt(t,"onReject",8),s=N(!1);async function o(){a(s)||(m(s,!0),await n()(),m(s,!1))}Ze();var i=Gc(),c=p(g(i),6),l=g(c),f=g(l);{var d=_=>{var h=Fc();y(_,h)},u=_=>{var h=Ge("I Accept");y(_,h)};I(f,_=>{a(s)?_(d):_(u,!1)})}var v=p(l,2);Y(()=>{l.disabled=a(s),v.disabled=a(s)}),F("click",l,o),F("click",v,function(..._){var h;(h=r())==null||h.apply(this,_)}),y(e,i),We()}/**
 * @license lucide-svelte v0.485.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const zc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Jc=da("<svg><!><!></svg>");function gn(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]),r=Mt(n,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Be(t,!1);let s=nt(t,"name",8,void 0),o=nt(t,"color",8,"currentColor"),i=nt(t,"size",8,24),c=nt(t,"strokeWidth",8,2),l=nt(t,"absoluteStrokeWidth",8,!1),f=nt(t,"iconNode",24,()=>[]);const d=(...b)=>b.filter((x,R,w)=>!!x&&w.indexOf(x)===R).join(" ");Ze();var u=Jc();let v;var _=g(u);Nt(_,1,f,tr,(b,x)=>{let R=()=>a(x)[0],w=()=>a(x)[1];var k=xe(),E=fe(k);Gl(E,R,!0,(T,D)=>{let M;Y(()=>M=ho(T,M,{...w()}))}),y(b,k)});var h=p(_);Gt(h,t,"default",{}),Y((b,x)=>v=ho(u,v,{...zc,...r,width:i(),height:i(),stroke:o(),"stroke-width":b,class:x}),[()=>l()?Number(c())*24/Number(i()):c(),()=>d("lucide-icon","lucide",s()?`lucide-${s()}`:"",n.class)],pt),y(e,u),We()}function qc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"bell"},()=>n,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function Vc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"folder"},()=>n,{iconNode:[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function So(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"loader-circle"},()=>n,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function Hc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"message-circle"},()=>n,{iconNode:[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function Bc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"phone"},()=>n,{iconNode:[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function Wc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"trash-2"},()=>n,{iconNode:[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}function Kc(e,t){const n=Mt(t,["children","$$slots","$$events","$$legacy"]);gn(e,pn({name:"users"},()=>n,{iconNode:[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}],["circle",{cx:"9",cy:"7",r:"4"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}]],children:(s,o)=>{var i=xe(),c=fe(i);Gt(c,t,"default",{}),y(s,i)},$$slots:{default:!0}}))}const Tr=st({});function ko(e,t){Tr.update(n=>({...n,[e]:t}))}var Qc=P('<span title="Presence paused" class="mt-0.5">â¸ï¸</span>'),Yc=P('<span title="Presence active" class="mt-0.5">â–¶ï¸</span>'),Zc=P('<p class="text-xs text-gray-400 italic truncate mt-1"> </p>'),Xc=P('<p class="text-xs text-gray-300 italic mt-1">No messages yet.</p>'),eu=P('<button class="px-3 py-2 hover:bg-blue-50 rounded cursor-pointer text-left flex gap-2 items-start"><!> <div class="flex-1"><p class="text-sm font-medium truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p> <!></div></button>'),tu=P('<p class="text-xs text-gray-400 italic px-3 py-4">No conversations yet.</p>'),nu=P('<div class="flex flex-col gap-1 mt-2"><!> <!></div>');function ru(e,t){Be(t,!1);const n=N();let r=N({}),s=N({});jn.subscribe(d=>m(r,d)),Tr.subscribe(d=>m(s,d));function o(d){Br.set(d),Ls.set(d),at.set("chats")}ft(()=>a(r),()=>{m(n,Object.values(a(r)).flat().sort((d,u)=>{const v=new Date(d.updatedAt||d.createdAt||0).getTime();return new Date(u.updatedAt||u.createdAt||0).getTime()-v}))}),or(),Ze();var i=nu(),c=g(i);Nt(c,1,()=>a(n),d=>d.id,(d,u)=>{var v=xe(),_=fe(v);jl(_,()=>`${a(u).id}-${a(s)[a(u).repo]}`,h=>{var b=eu(),x=g(b);{var R=V=>{var X=Qc();y(V,X)},w=V=>{var X=Yc();y(V,X)};I(x,V=>{a(s)[a(u).repo]===!1?V(R):V(w,!1)})}var k=p(x,2),E=g(k),T=g(E),D=p(E,2),M=g(D),L=p(D,2);{var K=V=>{var X=Zc(),pe=g(X);Y(be=>B(pe,be),[()=>a(u).messages.at(-1).content],pt),y(V,X)},oe=V=>{var X=Xc();y(V,X)};I(L,V=>{a(u).messages&&a(u).messages.length>0?V(K):V(oe,!1)})}Y(V=>{B(T,V),B(M,a(u).repo)},[()=>a(u).title||`Conversation ${a(u).id.slice(0,6)}`],pt),F("click",b,()=>o(a(u))),y(h,b)}),y(d,v)});var l=p(c,2);{var f=d=>{var u=tu();y(d,u)};I(l,d=>{a(n).length===0&&d(f)})}y(e,i),We()}var su=P('<div class="flex items-center justify-between mb-3 text-sm text-gray-500"><div class="flex items-center gap-2"><!> <span> </span></div> <button class="text-blue-600 text-xs underline"> </button></div>'),ou=P('<div class="flex justify-end mb-3"><!> <span> </span> <button class="text-blue-600 text-xs underline"> </button></div>'),au=P('<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 mb-3"><div class="text-xs text-gray-400">âœ”ï¸ Discovery complete</div> <div class="flex gap-2"><button class="text-blue-600 text-xs underline">ðŸ”„ Sync</button> <button class="text-blue-600 text-xs underline">ðŸ” Discover</button></div></div>'),iu=P('<span class="ml-2 text-xs text-red-600 font-semibold">Discussions disabled</span>'),lu=P('<li class="flex items-center justify-between bg-gray-100 px-3 py-2 rounded"><div class="text-sm truncate"><button class="font-medium text-blue-700 hover:underline cursor-pointer"> </button> <p class="text-xs text-gray-500"> <!></p></div> <button aria-label="Remove repo"><!></button></li>'),cu=P('<ul class="space-y-2"></ul>'),uu=P('<p class="text-sm text-gray-400 italic mt-2">No matching repositories found.</p>'),fu=P('<div class="mt-3 text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-1">Some repositories have Discussions disabled. Enable Discussions in your GitHub repo settings to use messaging features.</div>'),du=P('<!> <div class="flex flex-wrap gap-3 text-xs text-gray-700 mb-3"><label><input type="checkbox"> ðŸ”’ Private</label> <label><input type="checkbox"> ðŸŒ Public</label> <label><input type="checkbox"> ðŸ’¬ With Messages</label> <label><input type="checkbox"> No Messages</label></div> <!> <!>',1);function vu(e,t){Be(t,!1);const n=N(),r=N();let s=nt(t,"search",8,""),o=N([]),i=N(),c=N(),l=N(!0),f=N(!0),d=N(!0),u=N(!0);Pt.subscribe(C=>m(o,C)),Ie.subscribe(C=>m(i,C));function v(){Ie.update(C=>({...C,paused:!C.paused}))}function _(){if(a(i).paused){Ie.update(j=>({...j,paused:!1}));const C=localStorage.getItem("skygit_token");C&&bs(C)}else Rc(),Ie.update(C=>({...C,paused:!0}))}async function h(C){const j=a(o).find(H=>H.full_name===C);if(j){Pt.update(H=>H.filter(Z=>Z.full_name!==C));try{const H=localStorage.getItem("skygit_token");await fc(H,j),console.log(`[SkyGit] Deleted ${C} from GitHub`)}catch(H){console.warn(`[SkyGit] Failed to delete ${C} from GitHub:`,H)}}}async function b(){const C=localStorage.getItem("skygit_token");C&&(Ie.update(j=>({...j,phase:"streaming",paused:!1,loadedCount:0})),await Sa(C))}async function x(){const C=localStorage.getItem("skygit_token");C&&(Ie.update(j=>({...j,phase:"discovery",paused:!1})),bs(C))}function R(C){Or.set(C),Br.set(C)}ft(()=>(a(o),Ds(s()),a(l),a(f),a(d),a(u)),()=>{m(n,a(o).filter(C=>{const j=s().toLowerCase(),H=C.full_name.toLowerCase().includes(j)||C.name.toLowerCase().includes(j)||C.owner.toLowerCase().includes(j),Z=C.private&&a(l)||!C.private&&a(f),ee=C.has_messages&&a(d)||!C.has_messages&&a(u);return H&&Z&&ee}))}),ft(()=>a(n),()=>{Ms.set(a(n).length)}),ft(()=>a(o),()=>{m(r,a(o).some(C=>!C.has_discussions))}),or(),Ze();var w=du(),k=fe(w);{var E=C=>{var j=su(),H=g(j),Z=g(H);So(Z,{class:"w-4 h-4 animate-spin text-blue-500"});var ee=p(Z,2),ne=g(ee),ce=p(H,2),ae=g(ce);Y(()=>{B(ne,`Syncing: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),B(ae,a(i).paused?"Resume Syncing":"Pause Syncing")}),F("click",ce,v),y(C,j)},T=(C,j)=>{{var H=ee=>{var ne=ou(),ce=g(ne);So(ce,{class:"w-4 h-4 animate-spin text-blue-500"});var ae=p(ce,2),Ce=g(ae),U=p(ae,2),Q=g(U);Y(()=>{B(Ce,`Discov.: ${a(i).loadedCount??""}/${a(i).totalCount??"?"}`),B(Q,a(i).paused?"Resume Discovery":"Pause Discovery")}),F("click",U,_),y(ee,ne)},Z=(ee,ne)=>{{var ce=ae=>{var Ce=au(),U=p(g(Ce),2),Q=g(U),$e=p(Q,2);F("click",Q,b),F("click",$e,x),y(ae,Ce)};I(ee,ae=>{a(i).phase==="idle"&&ae(ce)},ne)}};I(C,ee=>{a(i).phase==="discovery"?ee(H):ee(Z,!1)},j)}};I(k,C=>{a(i).phase==="streaming"?C(E):C(T,!1)})}var D=p(k,2),M=g(D),L=g(M),K=p(M,2),oe=g(K),V=p(K,2),X=g(V),pe=p(V,2),be=g(pe),Re=p(D,2);{var Se=C=>{var j=cu();Nt(j,5,()=>a(n),H=>H.full_name,(H,Z)=>{var ee=lu(),ne=g(ee),ce=g(ne),ae=g(ce),Ce=p(ce,2),U=g(Ce),Q=p(U);{var $e=_e=>{var je=iu();y(_e,je)};I(Q,_e=>{a(Z).has_discussions||_e($e)})}Vn(ne,_e=>m(c,_e),()=>a(c));var he=p(ne,2),Xe=g(he);Wc(Xe,{class:"w-4 h-4 text-red-500 hover:text-red-700"}),Y(()=>{B(ae,a(Z).full_name),B(U,`${(a(Z).has_messages?" | ðŸ’¬ .messages":" | no messaging")??""} `)}),F("click",ce,()=>R(a(Z))),F("click",he,()=>h(a(Z).full_name)),y(H,ee)}),y(C,j)},J=C=>{var j=uu();y(C,j)};I(Re,C=>{a(n).length>0?C(Se):C(J,!1)})}var te=p(Re,2);{var W=C=>{var j=fu();y(C,j)};I(te,C=>{a(r)&&C(W)})}gr(L,()=>a(l),C=>m(l,C)),gr(oe,()=>a(f),C=>m(f,C)),gr(X,()=>a(d),C=>m(d,C)),gr(be,()=>a(u),C=>m(u,C)),y(e,w),We()}var pu=P('<p class="text-sm text-gray-500">[Calls history will appear here]</p>');function gu(e){var t=pu();y(e,t)}var hu=P('<p class="text-sm text-gray-500">[Contacts  will appear here]</p>');function _u(e){var t=hu();y(e,t)}var yu=P('<p class="text-sm text-gray-500">[Notifications will show here]</p>');function mu(e){var t=yu();y(e,t)}function cs(e,t){const n=r=>{e.contains(r.target)||t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var bu=P('<div class="absolute top-12 right-0 w-40 bg-white border border-gray-200 rounded shadow-md text-sm z-50"><button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Help</button> <hr> <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button></div>'),wu=P('<div class="absolute top-0 right-1 -mt-1 -mr-1 bg-blue-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-semibold shadow"> </div>'),xu=P('<button type="button"><div><!></div> <!> </button>'),Su=P('<div class="p-4 relative h-full overflow-y-auto"><div class="flex items-center justify-between mb-4 relative"><div class="flex items-center gap-3"><img class="w-10 h-10 rounded-full" alt="avatar"> <div><p class="font-semibold"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button class="text-gray-500 hover:text-gray-700 text-lg font-bold" aria-label="Open menu">â‹¯</button> <!></div> <div class="relative mb-4"><input type="text" placeholder="" class="w-full pl-10 pr-3 py-2 rounded bg-gray-100 text-sm border border-gray-300 focus:outline-none"> <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M10 2a8 8 0 015.29 13.71l4.5 4.5a1 1 0 01-1.42 1.42l-4.5-4.5A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z"></path></svg></div> <div class="flex justify-around mb-4 text-xs text-center"></div> <div><!></div></div>');function ku(e,t){Be(t,!1);const[n,r]=Hr(),s=()=>fn(at,"$currentRoute",n),o=()=>fn(Ms,"$filteredCount",n);let i=N(null),c=N(!1),l=N("");function f(){at.set("settings")}function d(J){at.set(J)}St.subscribe(J=>{m(i,J.user)});const u=[{id:"chats",icon:Hc,label:"Chats"},{id:"repos",icon:Vc,label:"Repos"},{id:"calls",icon:Bc,label:"Calls"},{id:"contacts",icon:Kc,label:"Contacts"},{id:"notifications",icon:qc,label:"Notifs"}];function v(){m(c,!a(c))}function _(){m(c,!1)}Ze();var h=Su(),b=g(h),x=g(b),R=g(x),w=p(R,2),k=g(w),E=g(k),T=p(k,2),D=g(T),M=p(x,2),L=p(M,2);{var K=J=>{var te=bu(),W=g(te),C=p(W,6);Ul(te,(j,H)=>cs==null?void 0:cs(j,H),()=>_),F("click",W,f),F("click",C,function(...j){as==null||as.apply(this,j)}),y(J,te)};I(L,J=>{a(c)&&J(K)})}var oe=p(b,2),V=g(oe),X=p(oe,2);Nt(X,5,()=>u,tr,(J,te)=>{let W=()=>a(te).id,C=()=>a(te).icon,j=()=>a(te).label;var H=xu();let Z;var ee=g(H),ne=g(ee);C()(ne,{class:"w-5 h-5"});var ce=p(ee,2);{var ae=U=>{var Q=wu(),$e=g(Q);Y(()=>B($e,o())),y(U,Q)};I(ce,U=>{W()==="repos"&&a(l).trim()!==""&&U(ae)})}var Ce=p(ce);Y(U=>{Z=Pn(H,1,"relative flex flex-col items-center text-xs focus:outline-none",null,Z,U),Pn(ee,1,`w-10 h-10 rounded-full flex items-center justify-center ${s()===W()?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:text-blue-600"}`),B(Ce,` ${j()??""}`)},[()=>({"text-blue-600":s()===W()})],pt),F("click",H,()=>d(W())),y(J,H)});var pe=p(X,2),be=g(pe);{var Re=J=>{ru(J,{})},Se=(J,te)=>{{var W=j=>{vu(j,{get search(){return a(l)}})},C=(j,H)=>{{var Z=ne=>{gu(ne)},ee=(ne,ce)=>{{var ae=U=>{_u(U)},Ce=(U,Q)=>{{var $e=he=>{mu(he)};I(U,he=>{s()==="notifications"&&he($e)},Q)}};I(ne,U=>{s()==="contacts"?U(ae):U(Ce,!1)},ce)}};I(j,ne=>{s()==="calls"?ne(Z):ne(ee,!1)},H)}};I(J,j=>{s()==="repos"?j(W):j(C,!1)},te)}};I(be,J=>{s()==="chats"?J(Re):J(Se,!1)})}Y(()=>{var J,te,W,C;Dt(R,"src",(J=a(i))==null?void 0:J.avatar_url),B(E,((te=a(i))==null?void 0:te.name)||((W=a(i))==null?void 0:W.login)),B(D,`@${((C=a(i))==null?void 0:C.login)??""}`)}),F("click",M,v),tt(V,()=>a(l),J=>m(l,J)),y(e,h),We(),r()}var Cu=P('<button class="p-2 text-gray-700 text-xl rounded bg-white shadow" aria-label="Open sidebar">â†</button>'),$u=P('<div class="layout svelte-scw01y"><div class="p-2 md:hidden"><!></div> <div><!></div> <div><!></div></div>');function Wr(e,t){Be(t,!1);let n=N(!1);function r(h){m(n,h.detail.open)}St.subscribe(h=>{h.user}),lr(()=>{const h=()=>{window.innerWidth>=768&&m(n,!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)}),Br.subscribe(h=>{h&&window.innerWidth<768&&m(n,!1)}),Ze();var s=$u(),o=g(s),i=g(o);{var c=h=>{var b=Cu();F("click",b,()=>m(n,!0)),y(h,b)};I(i,h=>{a(n)||h(c)})}var l=p(o,2);let f;var d=g(l);ku(d,{$$events:{toggle:r}});var u=p(l,2);let v;var _=g(u);Gt(_,t,"default",{}),Y((h,b)=>{f=Pn(l,1,"sidebar md:block svelte-scw01y",null,f,h),v=Pn(u,1,"main w-full svelte-scw01y",null,v,b)},[()=>({hidden:!a(n),open:a(n)}),()=>({hidden:a(n)})],pt),y(e,s),We()}var Pu=P('<p class="text-gray-400 italic text-center mt-20">Welcome to skygit.</p>');function Eu(e){Wr(e,{children:(t,n)=>{var r=Pu();y(t,r)},$$slots:{default:!0}})}var Au=P('<button title="Save">ðŸ’¾</button>'),Ru=P('<button title="Edit">âœï¸</button>'),Ou=P('<button title="Hide">ðŸ™ˆ</button> <!>',1),Du=P('<button title="Reveal">ðŸ‘ï¸</button>'),Tu=P('<label class="block mb-2"><span class="font-semibold"> </span> <input class="w-full border px-2 py-1 rounded text-xs"></label>'),Iu=P('<label class="block mb-2"><span class="font-semibold">Type</span> <select disabled class="w-full border px-2 py-1 rounded text-xs bg-gray-100 text-gray-500"><option> </option></select></label> <!>',1),ju=P('<pre class="text-xs text-gray-700 bg-white border rounded p-2"> </pre>'),Nu=P('<tr class="bg-gray-50 text-xs"><td colspan="4" class="p-3"><!></td></tr>'),Mu=P('<tr class="border-t"><td class="p-2 align-top"> </td><td class="p-2 font-mono text-xs text-gray-500"> </td><td class="p-2 text-xs text-gray-700"><!></td><td class="p-2 space-x-3 text-sm"><!> <button title="Delete">ðŸ—‘ï¸</button></td></tr> <!>',1),Lu=P('<div class="grid md:grid-cols-3 gap-4"><label>Access Key ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Secret Access Key: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Region: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Fu=P('<div class="grid md:grid-cols-3 gap-4"><label>Client ID: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Client Secret: <input class="w-full border px-2 py-1 rounded text-sm"></label> <label>Refresh Token: <input class="w-full border px-2 py-1 rounded text-sm"></label></div>'),Gu=P('<div class="p-6 max-w-4xl mx-auto space-y-6"><h2 class="text-2xl font-semibold text-gray-800">ðŸ” Credential Manager</h2> <table class="w-full text-sm border rounded overflow-hidden shadow"><thead class="bg-gray-100 text-left"><tr><th class="p-2">URL</th><th class="p-2">Encrypted Preview</th><th class="p-2">Type</th><th class="p-2">Actions</th></tr></thead><tbody></tbody></table> <div class="border-t pt-4 space-y-2"><h3 class="text-lg font-semibold text-gray-700">âž• Add Credential</h3> <div class="grid md:grid-cols-2 gap-4"><label>URL: <input placeholder="https://my-storage.com/path" class="w-full border px-2 py-1 rounded text-sm"></label> <label>Type: <select class="w-full border px-2 py-1 rounded text-sm"><option>S3</option><option>Google Drive</option></select></label></div> <!> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">ðŸ’¾ Add Credential</button></div></div>');function Uu(e,t){Be(t,!1);let n=N({}),r=N({}),s=N(new Set),o=N(null),i=N(""),c=N("s3"),l=N({type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),f=N({}),d=null;const u=localStorage.getItem("skygit_token");lr(async()=>{if(!u)return;const w=await Ns(u);m(n,w.secrets),d=w.sha});async function v(w){try{a(r)[w]||ye(r,a(r)[w]=await Is(u,a(n)[w])),m(s,new Set(a(s)).add(w))}catch{alert("âŒ Failed to decrypt.")}}function _(w){m(s,new Set([...a(s)].filter(k=>k!==w))),a(o)===w&&m(o,null)}function h(w){a(s).has(w)||m(s,new Set(a(s)).add(w)),m(o,w),m(f,{...a(r)[w]})}async function b(w){const k=await ys(u,a(f));ye(n,a(n)[w]=k),ye(r,a(r)[w]=a(f)),m(s,new Set(a(s)).add(w)),m(o,null),await mr(u,a(n),d)}async function x(w){confirm(`Are you sure you want to delete the credential for:
${w}?`)&&(delete a(n)[w],delete a(r)[w],m(s,new Set([...a(s)].filter(k=>k!==w))),a(o)===w&&m(o,null),await mr(u,a(n),d))}async function R(){if(!a(i)||!a(c))return;const w=a(c)==="s3"?{type:"s3",accessKeyId:a(l).accessKeyId||"",secretAccessKey:a(l).secretAccessKey||"",region:a(l).region||""}:{type:"google_drive",client_id:a(l).client_id||"",client_secret:a(l).client_secret||"",refresh_token:a(l).refresh_token||""},k=await ys(u,w);ye(n,a(n)[a(i)]=k),ye(r,a(r)[a(i)]=w),m(s,new Set(a(s)).add(a(i))),m(i,""),m(c,"s3"),m(l,{type:"s3",accessKeyId:"",secretAccessKey:"",region:""}),await mr(u,a(n),d)}Ze(),Wr(e,{children:(w,k)=>{var E=Gu(),T=p(g(E),2),D=p(g(T));Nt(D,5,()=>Object.entries(a(n)),tr,(W,C)=>{let j=()=>a(C)[0],H=()=>a(C)[1];var Z=Mu(),ee=fe(Z),ne=g(ee),ce=g(ne),ae=p(ne),Ce=g(ae),U=p(ae),Q=g(U);{var $e=ge=>{var ke=Ge();Y(()=>B(ke,a(r)[j()].type==="s3"?"S3":"Google Drive")),y(ge,ke)},he=ge=>{var ke=Ge("?");y(ge,ke)};I(Q,ge=>{a(r)[j()]?ge($e):ge(he,!1)})}var Xe=p(U),_e=g(Xe);{var je=ge=>{var ke=Ou(),yt=fe(ke),Jt=p(yt,2);{var qt=Oe=>{var Ue=Au();F("click",Ue,()=>b(j())),y(Oe,Ue)},At=Oe=>{var Ue=Ru();F("click",Ue,()=>h(j())),y(Oe,Ue)};I(Jt,Oe=>{a(o)===j()?Oe(qt):Oe(At,!1)})}F("click",yt,()=>_(j())),y(ge,ke)},ht=ge=>{var ke=Du();F("click",ke,()=>v(j())),y(ge,ke)};I(_e,ge=>{a(s).has(j())?ge(je):ge(ht,!1)})}var Ut=p(_e,2),_t=p(ee,2);{var zt=ge=>{var ke=Nu(),yt=g(ke),Jt=g(yt);{var qt=Oe=>{var Ue=Iu(),Rt=fe(Ue),Xt=p(g(Rt),2),en=g(Xt),Pe={},S=g(en),$=p(Rt,2);Nt($,1,()=>Object.entries(a(f)),tr,(O,z)=>{let q=()=>a(z)[0];var ie=xe(),re=fe(ie);{var le=Ne=>{var lt=Tu(),Me=g(lt),Vt=g(Me),tn=p(Me,2);Y(()=>B(Vt,q())),tt(tn,()=>a(f)[q()],hn=>ye(f,a(f)[q()]=hn)),y(Ne,lt)};I(re,Ne=>{q()!=="type"&&Ne(le)})}y(O,ie)}),Y(()=>{Pe!==(Pe=a(f).type)&&(en.value=(en.__value=a(f).type)==null?"":a(f).type),B(S,a(f).type)}),y(Oe,Ue)},At=Oe=>{var Ue=ju(),Rt=g(Ue);Y(Xt=>B(Rt,`${Xt??""}
                                    `),[()=>JSON.stringify(a(r)[j()],null,2)],pt),y(Oe,Ue)};I(Jt,Oe=>{a(o)===j()?Oe(qt):Oe(At,!1)})}y(ge,ke)};I(_t,ge=>{a(s).has(j())&&ge(zt)})}Y(ge=>{B(ce,j()),B(Ce,`${ge??""}...`)},[()=>H().slice(0,20)],pt),F("click",Ut,()=>x(j())),y(W,Z)});var M=p(T,2),L=p(g(M),2),K=g(L),oe=p(g(K)),V=p(K,2),X=p(g(V));Y(()=>{a(c),vs(()=>{})});var pe=g(X);pe.value=(pe.__value="s3")==null?"":"s3";var be=p(pe);be.value=(be.__value="google_drive")==null?"":"google_drive";var Re=p(L,2);{var Se=W=>{var C=Lu(),j=g(C),H=p(g(j)),Z=p(j,2),ee=p(g(Z)),ne=p(Z,2),ce=p(g(ne));tt(H,()=>a(l).accessKeyId,ae=>ye(l,a(l).accessKeyId=ae)),tt(ee,()=>a(l).secretAccessKey,ae=>ye(l,a(l).secretAccessKey=ae)),tt(ce,()=>a(l).region,ae=>ye(l,a(l).region=ae)),y(W,C)},J=(W,C)=>{{var j=H=>{var Z=Fu(),ee=g(Z),ne=p(g(ee)),ce=p(ee,2),ae=p(g(ce)),Ce=p(ce,2),U=p(g(Ce));tt(ne,()=>a(l).client_id,Q=>ye(l,a(l).client_id=Q)),tt(ae,()=>a(l).client_secret,Q=>ye(l,a(l).client_secret=Q)),tt(U,()=>a(l).refresh_token,Q=>ye(l,a(l).refresh_token=Q)),y(H,Z)};I(W,H=>{a(c)==="google_drive"&&H(j)},C)}};I(Re,W=>{a(c)==="s3"?W(Se):W(J,!1)})}var te=p(Re,2);tt(oe,()=>a(i),W=>m(i,W)),hs(X,()=>a(c),W=>m(c,W)),F("click",te,R),y(w,E)},$$slots:{default:!0}}),We()}var zu=P('<div class="bg-blue-100 p-2 rounded shadow text-sm"><div class="font-semibold text-blue-800"> </div> <div> </div> <div class="text-xs text-gray-500"> </div></div>'),Ju=P('<p class="text-center text-gray-400 italic mt-10">No messages yet.</p>'),qu=P('<div class="p-4 space-y-3"><!></div>');function Vu(e,t){Be(t,!1);const[n,r]=Hr(),s=()=>fn(Ls,"$selectedConversation",n),o=N(),i=N();ft(()=>s(),()=>{m(o,s())}),ft(()=>a(o),()=>{var u;m(i,((u=a(o))==null?void 0:u.messages)??[])}),ft(()=>a(i),()=>{console.log("[MessageList] Updated messages:",a(i))}),or(),Ze();var c=qu(),l=g(c);{var f=u=>{var v=xe(),_=fe(v);Nt(_,1,()=>a(i),h=>h.id||h.timestamp,(h,b)=>{var x=zu(),R=g(x),w=g(R),k=p(R,2),E=g(k),T=p(k,2),D=g(T);Y(M=>{B(w,a(b).sender),B(E,a(b).content),B(D,M)},[()=>new Date(a(b).timestamp).toLocaleString()],pt),y(h,x)}),y(u,v)},d=u=>{var v=Ju();y(u,v)};I(l,u=>{a(i).length>0?u(f):u(d,!1)})}y(e,c),We(),r()}const Co="skygit_context_id";function Hu(){if(typeof window>"u")return"server";let e=localStorage.getItem(Co);return e||(e=crypto.randomUUID(),localStorage.setItem(Co,e)),e}const Ct="https://api.github.com";let Ir=!1;async function Bu(e,t,n){const[r,s]=t.split("/");return(await ln(e,`
    query($owner:String!,$name:String!,$number:Int!){
      repository(owner:$owner,name:$name){ discussion(number:$number){ id } }
    }`,{owner:r,name:s,number:n})).repository.discussion.id}async function Wu(e,t,n){await ln(e,`
    mutation($id:ID!,$body:String!){
      addDiscussionComment(input:{discussionId:$id,body:$body}){ clientMutationId }
    }`,{id:t,body:n})}async function Ia(e,t,n){await ln(e,`
    mutation($cid:ID!,$body:String!){
      updateDiscussionComment(input:{commentId:$cid,body:$body}){ clientMutationId }
    }`,{cid:t,body:n})}async function ja(e,t){await ln(e,`
    mutation($cid:ID!){ deleteDiscussionComment(input:{id:$cid}){ clientMutationId } }`,{cid:t})}async function ln(e,t,n={}){const r=await fetch(`${Ct}/graphql`,{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})});if(!r.ok){const o=await r.text();throw new Error(`GraphQL API error (${r.status}): ${o}`)}const s=await r.json();if(s.errors&&s.errors.length)throw new Error(`GraphQL API returned errors: ${JSON.stringify(s.errors)}`);return s.data}function _r(e){return`skygit_presence_discussion_${e}`}async function Kr(e,t){var d;if(typeof window<"u"){const u=localStorage.getItem(_r(t));if(u)try{if((await fetch(`${Ct}/repos/${t}/discussions/${u}`,{headers:{Authorization:`token ${e}`}})).ok)return Number(u);localStorage.removeItem(_r(t))}catch{}}const n={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},r=`${Ct}/repos/${t}/discussions`;let s=[];try{const u=await fetch(r,{headers:n});u.ok&&(s=await u.json())}catch{}const o=s.find(u=>u.title==="SkyGit Presence Channel");if(o)return typeof window<"u"&&localStorage.setItem(_r(t),o.number),o.number;let i;try{const u=await fetch(`${Ct}/repos/${t}/discussions/categories`,{headers:n});if(u.ok){const v=await u.json();v.length&&(i=((d=v.find(_=>_.slug==="general"))==null?void 0:d.id)||v[0].id)}}catch{}if(!i){const[u,v]=t.split("/");try{const h=(await ln(e,`
        query($owner:String!,$name:String!){
          repository(owner:$owner,name:$name){
            discussionCategories(first:50){ nodes{ id slug name } }
          }
        }`,{owner:u,name:v})).repository.discussionCategories.nodes;h.length&&(i=(h.find(x=>x.slug==="general")||h[0]).id)}catch(_){console.warn("[SkyGit][Presence] GraphQL categories fallback failed",_)}}if(!i)throw new Error("Failed to resolve a discussion category id");if(typeof i=="string"&&i.startsWith("DIC_")){const[u,v]=t.split("/"),_=`
      mutation($repoId:ID!,$catId:ID!,$title:String!,$body:String!){
        createDiscussion(input:{repositoryId:$repoId,categoryId:$catId,title:$title,body:$body}){
          discussion{ number }
        }
      }`,b=(await ln(e,"query($owner:String!,$name:String!){repository(owner:$owner,name:$name){id}}",{owner:u,name:v})).repository.id,x=await ln(e,_,{repoId:b,catId:i,title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore."});return c(x.createDiscussion.discussion.number)}function c(u){return typeof window<"u"&&localStorage.setItem(_r(t),u),u}const l=await fetch(r,{method:"POST",headers:{...n,"Content-Type":"application/json"},body:JSON.stringify({title:"SkyGit Presence Channel",body:"Discussion used by SkyGit for presence signaling. Safe to ignore.",category_id:i})});if(!l.ok){if(l.status===422||l.status===409){const u=await fetch(r,{headers:n});if(u.ok){const _=(await u.json()).find(h=>h.title==="SkyGit Presence Channel");if(_)return c(_.number)}}throw new Error("Failed to create presence discussion")}const f=await l.json();return c(f.number)}function Ku(e,t){const n=r=>{const{last_seen:s,...o}=r;return o};return JSON.stringify(n(e))===JSON.stringify(n(t))}async function Qu(e,t,n,r,s=null){const o=await Kr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},c=`${Ct}/repos/${t}/discussions/${o}/comments`;let l=null;async function f(){return l||(l=await Bu(e,t,o),l)}const d=new Date().toISOString();let u=d;const v=await fetch(c,{headers:i});let _=[];v.ok&&(_=await v.json());let h=null;if(typeof window<"u"&&(h=localStorage.getItem(x())),h&&!_.some(D=>String(D.id)===h))try{const D=await fetch(`${Ct}/repos/${t}/discussions/comments/${h}`,{headers:i});if(D.ok){const M=await D.json();_.push(M)}else typeof window<"u"&&localStorage.removeItem(x()),h=null}catch{}const b=Hu();function x(){return`skygit_presence_comment_${t}_${b}`}const R=_.filter(D=>{try{const M=JSON.parse(D.body);return M.username===n&&M.context_id===b}catch{return!1}}),w=R.find(D=>{try{return JSON.parse(D.body).session_id===r}catch{return!1}});if(w)try{const D=JSON.parse(w.body);D.join_timestamp&&(u=D.join_timestamp)}catch{}const k={username:n,context_id:b,session_id:r,join_timestamp:u,last_seen:d,signaling_info:s};let E=!1;if(w){let D;try{D=JSON.parse(w.body)}catch{D={}}const M=Math.abs(new Date(d)-new Date(D.last_seen));(!Ku(D,k)||M>3e4)&&(E=!0)}if(w&&E){try{await Ia(e,w.node_id,JSON.stringify(k)),typeof window<"u"&&localStorage.setItem(x(),String(w.id))}catch{const M=`${c}/${w.id}`;await fetch(M,{method:"PATCH",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(k)})}),typeof window<"u"&&localStorage.setItem(x(),String(w.id))}Ir||$o(t,w.id)}else if(!w)try{const D=await f();await Wu(e,D,JSON.stringify(k));const M=await fetch(c,{headers:i});if(M.ok){const K=(await M.json()).find(oe=>{try{const V=JSON.parse(oe.body);return V.session_id===r&&V.context_id===b}catch{return!1}});K&&typeof window<"u"&&(localStorage.setItem(x(),String(K.id)),Ir||$o(t,K.id))}}catch{await fetch(c,{method:"POST",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(k)})});try{const M=await fetch(c+"?per_page=1",{headers:i});if(M.ok){const L=await M.json();L.length&&typeof window<"u"&&localStorage.setItem(x(),String(L[0].id))}}catch{}}const T=10*60*1e3;for(const D of R)if(!(w&&D.id===w.id))try{const M=JSON.parse(D.body);Date.now()-new Date(M.last_seen||M.join_timestamp).getTime()>T&&(await ja(e,D.node_id),typeof window<"u"&&h===String(D.id)&&localStorage.removeItem(x()))}catch{}}function $o(e,t){typeof window>"u"||Ir||(Ir=!0,window.addEventListener("beforeunload",()=>{const n=`${Ct}/repos/${e}/discussions/comments/${t}`,r={body:JSON.stringify({left_at:new Date().toISOString()})};fetch(n,{method:"PATCH",headers:{Authorization:`token ${localStorage.getItem("skygit_token")||""}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json","Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}).catch(()=>{})}))}async function Yu(e,t,n,r,s){const o=await Kr(e,t),i={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},c=`${Ct}/repos/${t}/discussions/${o}/comments`,l=await fetch(c,{headers:i});if(!l.ok)return;const d=(await l.json()).find(u=>{try{const v=JSON.parse(u.body);return v.username===n&&v.session_id===r}catch{return!1}});if(d){let u;try{u=JSON.parse(d.body)}catch{u={}}u.pendingRemovalBy=s,u.pendingRemovalAt=new Date().toISOString();try{await Ia(e,d.node_id,JSON.stringify(u))}catch{const _=`${c}/${d.id}`;await fetch(_,{method:"PATCH",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify({body:JSON.stringify(u)})})}console.debug("[SkyGit][Presence] marked peer for pending removal",n,r)}}async function Zu(e,t,n,r){const s=await Kr(e,t),o={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.inertia-preview+json, application/vnd.github.squirrel-girl-preview+json"},i=`${Ct}/repos/${t}/discussions/${s}/comments`,c=await fetch(i,{headers:o});if(!c.ok)return;const f=(await c.json()).find(d=>{try{const u=JSON.parse(d.body);return u.username===n&&u.session_id===r}catch{return!1}});if(f){let d;try{d=JSON.parse(f.body)}catch{d={}}if(d.pendingRemovalBy&&d.pendingRemovalAt&&Date.now()-new Date(d.pendingRemovalAt).getTime()>6e4){try{await ja(e,f.node_id)}catch{const _=`${i}/${f.id}`;await fetch(_,{method:"DELETE",headers:o})}console.debug("[SkyGit][Presence] deleted stale peer presence",n,r)}}}async function Xu(e,t){const n=await Kr(e,t),r={Authorization:`token ${e}`,Accept:"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json"},s=`${Ct}/repos/${t}/discussions/${n}/comments`,o=await fetch(s,{headers:r});if(!o.ok)return console.warn("[SkyGit][Presence] pollPresenceFromDiscussion failed",o.status,o.statusText),[];const i=await o.json(),c=Date.now(),l=i.map(f=>{try{return JSON.parse(f.body)}catch{return null}}).filter(Boolean).filter(f=>f.last_seen&&c-new Date(f.last_seen).getTime()<2*60*1e3);return console.log("[SkyGit][Presence] pollPresenceFromDiscussion got peers",l),l}async function jr(e,t,n,r,s=null){await Qu(e,t,n,r,s)}async function Us(e,t){return await Xu(e,t)}class ef{constructor({token:t,repoFullName:n,peerUsername:r,isPersistent:s=!1,onSignal:o,onRemoteStream:i,onDataChannelMessage:c,onFileReceived:l,onFileReceiveProgress:f,onFileSendProgress:d}){this.token=t,this.repoFullName=n,this.peerUsername=r,this.isPersistent=s,this.onSignal=o,this.onRemoteStream=i,this.onDataChannelMessage=c,this.onFileReceived=l,this.onFileReceiveProgress=f,this.onFileSendProgress=d,this.peerConnection=null,this.dataChannel=null,this.remoteDataChannel=null,this.signalingCallback=null,this.fileTransfers={}}async start(t,n=null){if(this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerConnection.onicecandidate=r=>{r.candidate&&this.signalingCallback&&this.signalingCallback({type:"ice",candidate:r.candidate})},this.peerConnection.ontrack=r=>{this.onRemoteStream&&this.onRemoteStream(r.streams[0])},this.peerConnection.ondatachannel=r=>{this.remoteDataChannel=r.channel,this.setupDataChannel(r.channel)},t){this.dataChannel=this.peerConnection.createDataChannel("skygit"),this.setupDataChannel(this.dataChannel);const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"offer",sdp:r})}else if(n){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(n.sdp));const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:r})}}setupDataChannel(t){t.onopen=()=>{},t.onclose=()=>{},t.onerror=n=>{},this._setupDataChannelHandlers()}_setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleDataChannelMessage(n)}catch{console.error("Invalid data channel message:",t.data)}})}handleDataChannelMessage(t){if(t.type==="screen-share"){typeof window<"u"&&window.skygitOnScreenShare&&window.skygitOnScreenShare(t.active,t.meta);return}if(t.type==="media-status"){typeof window<"u"&&window.skygitOnMediaStatus&&window.skygitOnMediaStatus({micOn:t.micOn,cameraOn:t.cameraOn});return}t.type&&t.type.startsWith("file-")?this.handleFileMessage(t):this.onDataChannelMessage&&this.onDataChannelMessage(t)}async handleSignal(t){if(t.type==="offer"){await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n),this.signalingCallback&&this.signalingCallback({type:"answer",sdp:n})}else t.type==="answer"?await this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)):t.type==="ice"&&await this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate));this.onSignal&&this.onSignal(t)}send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&this.dataChannel.send(JSON.stringify(t))}sendScreenShareSignal(t,n={}){this.send({type:"screen-share",active:t,meta:n})}sendFile(t){const n=crypto.randomUUID(),r=16*1024,s=Math.ceil(t.size/r),o={type:"file-meta",id:n,name:t.name,size:t.size,totalChunks:s};this.send(o);let i=0,c=0;const l=new FileReader;l.onload=d=>{if(d.target.readyState!==FileReader.DONE)return;const u=new Uint8Array(d.target.result);this.send({type:"file-chunk",id:n,seq:c,data:Array.from(u)}),c++,i+=r,typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,c,s),i<t.size?f():(this.send({type:"file-end",id:n}),typeof this.onFileSendProgress=="function"&&this.onFileSendProgress(o,s,s))};const f=()=>{const d=t.slice(i,i+r);l.readAsArrayBuffer(d)};f()}handleFileMessage(t){if(t.type==="file-meta")this.fileTransfers[t.id]={meta:t,chunks:[],received:0},typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(t,0,t.totalChunks);else if(t.type==="file-chunk"){const n=this.fileTransfers[t.id];n&&(n.chunks[t.seq]=new Uint8Array(t.data),n.received++,typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.received,n.meta.totalChunks))}else if(t.type==="file-end"){const n=this.fileTransfers[t.id];if(n){const r=new Blob(n.chunks,{type:"application/octet-stream"});this.onFileReceived&&this.onFileReceived(n.meta,r),typeof this.onFileReceiveProgress=="function"&&this.onFileReceiveProgress(n.meta,n.meta.totalChunks,n.meta.totalChunks),delete this.fileTransfers[t.id]}}}replaceVideoTrack(t){if(!this.peerConnection)return;const r=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");r&&r.replaceTrack(t)}stop(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.remoteDataChannel&&(this.remoteDataChannel.close(),this.remoteDataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}}const Ee=st({}),rt=st([]);let It=null,Ve=null,dt=null,me=null;function tf(){return me}let Na=null,xn=null,sn=null;function Po(){Ma(),Ee.set({}),rt.set([]),clearInterval(sn),sn=null,Bn={token:null,repoFullName:null,username:null}}let Bn={token:null,repoFullName:null,username:null};function Eo({_token:e,_repoFullName:t,_username:n,_sessionId:r}){Bn.token===e&&Bn.repoFullName===t&&Bn.username===n||(Bn={token:e,repoFullName:t,username:n},Ma(),Ee.set({}),rt.set([]),console.log("[SkyGit][Presence] initializePeerManager:",{_token:e,_repoFullName:t,_username:n,_sessionId:r}),dt=e,Ve=t,It=n,me=r,Us(dt,Ve).then(s=>{console.log("[SkyGit][Presence] initial peers:",s);const o=s.filter(i=>i.username!==It);rt.set(o),zs(s),La(),Fa(),En(s,me)?nf():rf()}).catch(s=>{console.error("[SkyGit][Presence] initial poll error",s)}))}function nf(){console.log("[SkyGit][Presence] startLeaderPresence (leader) for repo:",Ve,"as",It,"session",me),jr(dt,Ve,It,me),Na=setInterval(()=>{jr(dt,Ve,It,me)},3e4),xn=setInterval(async()=>{const e=await Us(dt,Ve);console.log("[SkyGit][Presence] [Leader] polled peers:",e),rt.set(e.filter(t=>t.session_id!==me)),zs(e),La(),Fa()},5e3)}function rf(){console.log("[SkyGit][Presence] startNonLeaderPresenceMonitor for repo:",Ve,"as",It,"session",me);const e=async()=>{const n=await Us(dt,Ve);console.log("[SkyGit][Presence] [Non-Leader] polled peers:",n),rt.set(n.filter(r=>r.session_id!==me)),zs(n)};e().catch(n=>console.error("[SkyGit][Presence] non-leader initial poll error",n)),xn=setInterval(()=>{e().catch(n=>console.error("[SkyGit][Presence] non-leader poll error",n))},5e3);const t=Ee.subscribe(n=>{Object.values(n).some(s=>s.status==="connected")&&xn&&(console.log("[SkyGit][Presence] [Non-Leader] connected to leader, stopping presence polling"),clearInterval(xn),xn=null,t())})}function Ma(){console.log("[SkyGit][Presence] stopPresence"),clearInterval(Na),clearInterval(xn)}async function zs(e){Ee.update(t=>{const n={...t},r=Js(e,me);if(me===r){for(const s of e)s.session_id!==me&&(n[s.session_id]||(n[s.session_id]={status:"connecting",conn:null,username:s.username},Ro(s,n)));Object.keys(n).forEach(s=>{s!==me&&(e.some(o=>o.session_id===s)||(n[s].conn&&n[s].conn.stop(),delete n[s]))})}else{const s=e.find(o=>o.session_id===r);Object.keys(n).forEach(o=>{o!==r&&(n[o].conn&&n[o].conn.stop(),delete n[o])}),s&&!n[r]&&(n[r]={status:"connecting",conn:null,username:s.username},Ro(s,n))}return n});for(const t of e){if(t.session_id===me)continue;const n=Ae(Ee);n[t.session_id]&&n[t.session_id].status==="connected"||(Yu(dt,Ve,t.username,t.session_id,It),setTimeout(()=>{Zu(dt,Ve,t.username,t.session_id)},6e4))}}function Js(e,t){return e.map(r=>r.session_id).concat(t).sort()[0]}function En(e,t){return Js(e,t)===t}function sf(e,t){if(!e||!e.conversationId||!e.content)return;Oa(e.conversationId,Ve,{id:e.id||crypto.randomUUID(),sender:t,content:e.content,timestamp:e.timestamp||Date.now()});const n=Ae(rt);En(n,me)&&(Fs(Ve,e.conversationId),Ee.update(r=>(Object.values(r).forEach(({conn:s,username:o})=>{o!==t&&s&&s.dataChannel&&s.send({type:"chat",...e})}),r)))}function of(e,t){e&&Array.isArray(e.onlinePeers)&&rt.set(e.onlinePeers)}function af(e,t){!e||!e.subtype||Ee.update(n=>{const r=Object.values(n).find(o=>o.username===t),s=r==null?void 0:r.conn;return s&&typeof s.handleSignal=="function"&&s.handleSignal(e),n})}function Ao(e,t,n,r){typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(e,n,r);const s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=e.name,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},2e3)}async function Ro(e,t){const n=new ef({token:dt,repoFullName:Ve,peerUsername:e.username,isPersistent:!0,onRemoteStream:()=>{},onSignal:r=>{jr(dt,Ve,It,me,r)},onDataChannelMessage:r=>{if(!(!r||typeof r!="object"))switch(r.type){case"chat":sf(r,e.username);break;case"presence":of(r,e.username);break;case"signal":af(r,e.username);break;default:console.log("Unknown message type:",r);break}},onFileReceived:(r,s)=>{Ao(r,s,r.totalChunks,r.totalChunks)},onFileReceiveProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},onFileSendProgress:(r,s,o)=>{typeof window<"u"&&window.skygitFileSendProgress&&window.skygitFileSendProgress(r,s,o)}});n.onFileReceived=(r,s)=>{Ao(r,s,r.totalChunks,r.totalChunks)},n.onFileReceiveProgress=(r,s,o)=>{typeof window<"u"&&window.skygitFileReceiveProgress&&window.skygitFileReceiveProgress(r,s,o)},n.signalingCallback=r=>{jr(dt,Ve,It,me,r)},await n.start(!0,e.signaling_info&&e.signaling_info.offer?e.signaling_info:null),t[e.session_id]={conn:n,status:"connected",username:e.username},Ee.set(t)}function La(){const e=Ae(rt);En(e,me)?sn||(sn=setInterval(()=>{const n=Ae(rt);En(n,me)&&cr(()=>Promise.resolve().then(()=>Gs),void 0).then(r=>{r.flushConversationCommitQueue&&r.flushConversationCommitQueue()})},10*60*1e3),window.addEventListener("beforeunload",Oo)):sn&&(clearInterval(sn),sn=null,window.removeEventListener("beforeunload",Oo))}function Oo(e){const t=Ae(rt);En(t,me)&&cr(()=>Promise.resolve().then(()=>Gs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()})}let Do=!1;function Fa(){const e=Ae(rt),t=En(e,me);t&&!Do&&cr(()=>Promise.resolve().then(()=>Gs),void 0).then(n=>{n.flushConversationCommitQueue&&n.flushConversationCommitQueue()}),Do=t}function xs(e,t){Ee.update(n=>(n[e]&&n[e].conn&&n[e].conn.dataChannel&&n[e].conn.send(t),n))}function lf(e){Ee.update(t=>(Object.values(t).forEach(({conn:n})=>{n&&n.dataChannel&&n.send(e)}),t))}var cf=P('<div class="flex items-center gap-2"><input type="text" placeholder="Type a message..." class="flex-1 border rounded px-3 py-2 text-sm"> <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">Send</button></div>');function uf(e,t){Be(t,!1);let n=nt(t,"conversation",8),r=N("");function s(){var h;if(!a(r).trim())return;const l={id:crypto.randomUUID(),sender:"You",content:a(r).trim(),timestamp:Date.now()};Oa(n().id,n().repo,l),(h=Ae(St).user)==null||h.login;const d=Ae(rt),u=tf(),v=Js(d,u),_={id:l.id,conversationId:n().id,content:l.content,timestamp:l.timestamp};u===v?(lf({type:"chat",..._}),Fs(n().repo,n().id)):xs(v,{type:"chat",..._}),m(r,"")}Ze();var o=cf(),i=g(o),c=p(i,2);tt(i,()=>a(r),l=>m(r,l)),F("keydown",i,l=>l.key==="Enter"&&s()),F("click",c,s),y(e,o),We()}var ff=P(`<div class="flex flex-col items-center justify-center h-full"><div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-6 rounded shadow max-w-xl w-full flex flex-col items-center"><strong class="mb-2 text-lg">Discussions are disabled for this repository.</strong> <div class="mb-2 text-center">You cannot send or view messages for this conversation until Discussions are re-enabled in your repository's GitHub settings.</div> <a target="_blank" class="underline text-blue-700 font-semibold mb-2">Open GitHub Settings</a> <div class="flex gap-2"><button class="px-3 py-1 bg-yellow-300 hover:bg-yellow-400 rounded font-bold" aria-label="Dismiss notification">Dismiss</button> <button class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded font-bold" aria-label="Refresh Discussions status">Refresh</button></div></div></div>`),df=P('<span class="inline-flex items-center gap-1 text-xs text-gray-500"><span class="w-3 h-3 rounded-full bg-gray-400"></span> You</span>'),vf=P('<span class="inline-flex items-center gap-1 text-xs text-green-600"><span class="w-3 h-3 rounded-full bg-green-500"></span> </span>'),pf=P('<span class="inline-flex items-center gap-1 text-xs text-blue-600"><span class="w-3 h-3 rounded-full bg-blue-500"></span> </span>'),gf=P('<span class="inline-flex items-center gap-1 text-xs text-yellow-600"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> </span>'),hf=P('<span class="inline-flex items-center gap-1 text-xs text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-300"></span> </span>'),_f=P('<button class="bg-red-500 text-white px-3 py-1 rounded text-xs">End Call</button>'),yf=P('<div class="flex flex-row justify-center items-center py-2"><span class="bg-yellow-300 text-black px-2 py-1 rounded font-bold text-xs">Remote is sharing their screen<!>!</span></div>'),mf=P('<button class="bg-yellow-100 border px-3 py-1 rounded">ðŸ”„ Change Screen Source</button>'),bf=P("<span>ðŸŽ¤</span>"),wf=P("<span>ðŸ”‡</span>"),xf=P("<span>ðŸ“·</span>"),Sf=P("<span>ðŸš«ðŸ“·</span>"),kf=P("<span>â¹ï¸ Stop Recording</span>"),Cf=P("<span>âºï¸ Start Recording</span>"),$f=P('<div class="fixed top-4 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-pulse"><span>âºï¸ Recording...</span></div>'),Pf=P('<div class="fixed top-16 right-4 z-50 bg-yellow-400 text-black px-4 py-2 rounded shadow-lg flex items-center gap-2"><span>âš ï¸ Peer is recording</span></div>'),Ef=P('<div class="flex flex-row justify-center items-center py-4 gap-4"><div><div class="text-xs text-gray-400 mb-1">Local Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div> <div><div class="text-xs text-gray-400 mb-1">Remote Video</div> <video autoplay playsinline="" width="200" height="150" style="background: #222;"><track kind="captions"></video> <div class="flex flex-row gap-2 justify-center mt-1"><span class="text-xs"><!></span> <span class="text-xs"><!></span></div></div></div> <!> <div class="flex flex-row items-center gap-3 justify-center mt-2"><label class="bg-gray-100 border px-3 py-1 rounded cursor-pointer">ðŸ“Ž Share File <input type="file" style="display:none"></label> <button class="bg-blue-100 border px-3 py-1 rounded"><!></button> <!> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-gray-200 border px-3 py-1 rounded flex items-center gap-1"><!></button> <button class="bg-red-200 border px-3 py-1 rounded flex items-center gap-1 font-bold"><!></button></div> <!> <!>',3),Af=P('<div class="fixed z-50 flex flex-col items-end cursor-move" tabindex="-1" aria-hidden="true"><div class="bg-white border shadow-lg rounded-lg p-2 flex flex-col items-center relative"><button class="absolute top-1 right-1 text-gray-400 hover:text-black text-lg font-bold px-1" style="z-index:2;" title="Close Preview">Ã—</button> <div class="text-xs text-gray-500 mb-1">Screen Share Preview</div> <video autoplay playsinline="" width="160" height="100" style="border-radius: 0.5rem; background: #222;"><track kind="captions"></video></div></div>',2),Rf=P('<button class="fixed bottom-6 right-6 z-50 bg-white border shadow rounded-full px-3 py-2 text-xs font-bold hover:bg-blue-100">Show Screen Preview</button>'),Of=P('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Select what to share</div> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Entire Screen</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Application Window</button> <button class="bg-gray-200 rounded px-3 py-2 hover:bg-blue-100">Browser Tab</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),Df=P('<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"><div class="bg-white rounded-lg shadow-lg p-6 min-w-[260px] flex flex-col gap-3"><div class="font-bold mb-2">Choose upload destination</div> <button class="bg-blue-200 rounded px-3 py-2 hover:bg-blue-300">Google Drive</button> <button class="bg-yellow-200 rounded px-3 py-2 hover:bg-yellow-300">S3</button> <button class="mt-2 text-sm text-gray-500 hover:text-black">Cancel</button></div></div>'),Tf=P('<div class="flex flex-col h-full"><div class="flex items-center justify-between px-4 py-2 border-b"><div><h2 class="text-xl font-semibold"> </h2> <button class="ml-4 text-xs px-2 py-1 rounded border bg-gray-100 hover:bg-gray-200"> </button> <p class="text-sm text-gray-500"> </p></div> <div class="text-sm text-gray-500"> </div> <div class="ml-4 flex flex-wrap gap-3 items-center"><!> <!></div></div> <!> <!> <!> <!> <div class="flex-1 overflow-y-auto"><!></div> <div class="border-t p-4"><!></div></div>'),If=P('<p class="text-gray-400 italic text-center mt-20">Select a conversation from the sidebar to view it.</p>');function jf(e,t){Be(t,!1);const[n,r]=Hr(),s=()=>fn(Ee,"$peerConnections",n),o=()=>fn(rt,"$onlinePeers",n);let i=N(null),c=N(!1),l=N(null),f=N(null),d=null,u=N(!1),v=N(null),_=null,h=N(!1),b=N(null),x=N(!1),R=N(!0),w=N(!0),k=N(!0),E=N(!0),T=N(!0),D=N(!1),M=N(!1),L=N(!0);const K=Tr.subscribe(S=>{a(i)&&a(i).repo&&m(L,S[a(i).repo]!==!1)});let oe=null,V=[],X=N({x:0,y:0}),pe=!1,be={x:0,y:0},Re=N(),Se=N(null),J=N(!1),te=N(),W=N(),C=N();function j(){m(x,!0)}function H(){m(x,!1)}function Z(S){m(x,!1),Ut(!0,S)}function ee(S){pe=!0,be={x:S.clientX-a(X).x,y:S.clientY-a(X).y},document.addEventListener("mousemove",ne),document.addEventListener("mouseup",ce)}function ne(S){pe&&(ye(X,a(X).x=S.clientX-be.x),ye(X,a(X).y=S.clientY-be.y))}function ce(){pe=!1,document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",ce)}function ae(){m(R,!1)}function Ce(){m(R,!0)}function U(){m(Se,null),m(J,!1)}function Q(){var q;if(!a(i))return;const S=a(i).repo,$=localStorage.getItem("skygit_token"),O=Ae(St),z=(q=O==null?void 0:O.user)==null?void 0:q.login;!$||!z||(a(L)?(ko(S,!1),Po()):(ko(S,!0),Eo({_token:$,_repoFullName:S,_username:z,_sessionId:crypto.randomUUID()})))}Xl(()=>{K()});async function $e(){let S=a(i)&&a(i).repo,$=Ae(ws).decrypted,O=null,z=null,q=null,ie=null;if(S&&window.selectedRepo&&window.selectedRepo.config){const le=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;le&&$[le]&&($[le].type==="s3"&&(O=$[le]),$[le].type==="google_drive"&&(z=$[le]))}for(const le in $)$[le].type==="s3"&&!O&&(q=$[le]),$[le].type==="google_drive"&&!z&&(ie=$[le]);const re=[];return(O||q)&&re.push("s3"),(z||ie)&&re.push("google_drive"),re.length===2?(m(J,!0),new Promise(le=>{const Ne=setInterval(()=>{a(Se)&&(m(J,!1),clearInterval(Ne),le(a(Se)))},100)})):re.length===1?re[0]:null}Ee.subscribe(S=>{Object.entries(S).filter(([$,O])=>O.status==="connected").map(([$,O])=>({session_id:$,username:O.username}))});let he=N(!1),Xe=N("");async function _e(S){const $=localStorage.getItem("skygit_token");if(!$||!S)return null;try{const O=await fetch(`https://api.github.com/repos/${S}`,{headers:{Authorization:`token ${$}`}});if(O.ok){const z=await O.json();return Pt.update(q=>q.map(ie=>ie.full_name===S?{...ie,has_discussions:z.has_discussions}:ie)),z.has_discussions}}catch(O){console.warn("Failed to refresh Discussions status",O)}return null}Br.subscribe(S=>{var ie;console.log("[SkyGit][Presence] currentContent changed:",S),m(i,S),m(he,!1),m(Xe,"");const $=localStorage.getItem("skygit_token"),O=Ae(St),z=((ie=O==null?void 0:O.user)==null?void 0:ie.login)||null,q=a(i)?a(i).repo:null;if(console.log("[SkyGit][Presence] authStore value:",O),console.log("[SkyGit][Presence] onConversationSelect: token",$,"username",z,"repo",q,"selectedConversation",a(i)),$&&z&&q){const re=Ae(Tr);m(L,re[q]!==!1),a(L)?Eo({_token:$,_repoFullName:q,_username:z,_sessionId:crypto.randomUUID()}):Po()}if(a(i)&&a(i).repo){const re=Ea(a(i).repo);console.log("[SkyGit][DEBUG] Lookup repo:",a(i).repo,"Result:",re,"has_discussions:",re==null?void 0:re.has_discussions),re&&re.has_discussions===!1&&_e(a(i).repo).then(le=>{le?m(he,!1):m(he,!0)})}});function je(){m(c,!1),d=null,a(l)&&(a(l).getTracks().forEach(S=>S.stop()),m(l,null)),m(f,null),d&&xs(d,{type:"signal",subtype:"call-end",conversationId:a(i).id})}function ht(S){const $=S.target.files[0];!$||!a(c)||!d||Ee.update(O=>{var q;const z=(q=O[d])==null?void 0:q.conn;return z&&typeof z.sendFile=="function"&&z.sendFile($),O})}async function Ut(S=!0,$="screen"){try{let O={video:!0,audio:S};$==="tab"?O={video:{displaySurface:"browser",cursor:"always"},audio:S}:$==="window"?O={video:{displaySurface:"window",cursor:"always"},audio:S}:$==="screen"&&(O={video:{displaySurface:"monitor",cursor:"always"},audio:S}),m(v,await navigator.mediaDevices.getDisplayMedia(O)),m(u,!0),Ee.update(z=>{var ie;const q=(ie=z[d])==null?void 0:ie.conn;return q&&q.replaceVideoTrack&&(q.replaceVideoTrack(a(v).getVideoTracks()[0]),q.sendScreenShareSignal&&q.sendScreenShareSignal(!0,{audio:S})),z}),m(l,a(v)),a(v).getVideoTracks()[0].onended=_t}catch(O){console.error("Screen share error:",O)}}function _t(){a(v)&&(a(v).getTracks().forEach(S=>S.stop()),m(v,null)),m(u,!1),Ee.update(S=>{var O;const $=(O=S[d])==null?void 0:O.conn;return $&&$.replaceVideoTrack,S}),m(l,_)}async function zt(){if(a(u))try{const S=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});Ee.update($=>{var z;const O=(z=$[d])==null?void 0:z.conn;return O&&O.replaceVideoTrack&&O.replaceVideoTrack(S.getVideoTracks()[0]),$}),a(v)&&a(v).getTracks().forEach($=>$.stop()),m(v,S),m(l,S),S.getVideoTracks()[0].onended=_t}catch(S){console.error("Change screen source error:",S)}}function ge(){m(w,!a(w)),a(l)&&a(l).getAudioTracks().forEach(S=>S.enabled=a(w)),yt()}function ke(){m(k,!a(k)),a(l)&&a(l).getVideoTracks().forEach(S=>S.enabled=a(k)),yt()}function yt(){Ee.update(S=>{var O;const $=(O=S[d])==null?void 0:O.conn;return $&&$.send&&$.send({type:"media-status",micOn:a(w),cameraOn:a(k)}),S})}function Jt(S){Ee.update($=>{var z;const O=(z=$[d])==null?void 0:z.conn;return O&&O.send&&O.send({type:"recording-status",recording:S}),$})}function qt(){a(l)&&(V=[],oe=new MediaRecorder(a(l),{mimeType:"video/webm; codecs=vp9"}),oe.ondataavailable=S=>{S.data.size>0&&V.push(S.data)},oe.onstop=Oe,oe.start(),m(D,!0),Jt(!0))}function At(){oe&&a(D)&&(oe.stop(),m(D,!1),Jt(!1))}async function Oe(){const S=new Blob(V,{type:"video/webm"});await Rt(S)}typeof window<"u"&&(window.skygitOnRecordingStatus=S=>{m(M,!!S.recording)}),typeof window<"u"&&(window.skygitOnScreenShare=(S,$)=>{m(h,S),m(b,$||null)}),typeof window<"u"&&(window.skygitOnMediaStatus=S=>{typeof S.micOn=="boolean"&&m(E,S.micOn),typeof S.cameraOn=="boolean"&&m(T,S.cameraOn)}),typeof window<"u"&&(window.skygitFileReceiveProgress=(S,$,O)=>{S.name,$===O&&setTimeout(()=>{},3e3)},window.skygitFileSendProgress=(S,$,O)=>{$===O&&setTimeout(()=>{},2e3)});async function Ue(S,$){const O=`skygit-recording-${Date.now()}.webm`,z=$.bucket,q=$.region;if(!z||!q)return alert("S3 credential missing bucket or region."),null;const ie=$.endpoint||`https://${z}.s3.${q}.amazonaws.com/${O}`;return(await fetch(ie,{method:"PUT",headers:{"Content-Type":"video/webm"},body:S})).ok?ie.split("?")[0]:(alert("Failed to upload to S3. (If this is a private bucket, you must implement AWS Signature v4 client-side or use a backend proxy.)"),null)}async function Rt(S){let $=Ae(ws).decrypted,O=a(i)&&a(i).repo,z=null,q=null,ie=null,re=null;if(O&&window.selectedRepo&&window.selectedRepo.config){const Me=window.selectedRepo.config.storage_info&&window.selectedRepo.config.storage_info.url;Me&&$[Me]&&($[Me].type==="s3"&&(z=$[Me]),$[Me].type==="google_drive"&&(q=$[Me]))}for(const Me in $)$[Me].type==="s3"&&!z&&(ie=$[Me]),$[Me].type==="google_drive"&&!q&&(re=$[Me]);let le=null,Ne=await $e();if(!Ne){alert("No upload destination (S3 or Google Drive) configured.");return}Ne==="s3"&&(le=z||ie),Ne==="google_drive"&&(le=q||re);let lt=null;Ne==="s3"?lt=await Ue(S,le):Ne==="google_drive"&&(lt=await Xt(S,le)),lt&&(xs(d,{type:"chat",content:`ðŸ“¹ Recording: ${lt}`}),alert("Recording uploaded and link shared!"))}async function Xt(S,$){let O;try{O=await en($)}catch(lt){return alert("Google Drive authentication failed: "+lt.message),null}const z={name:`SkyGit Recording ${new Date().toISOString()}.webm`,mimeType:"video/webm"},q=new FormData;q.append("metadata",new Blob([JSON.stringify(z)],{type:"application/json"})),q.append("file",S);const ie=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+O},body:q});if(!ie.ok)return alert("Failed to upload to Google Drive"),null;const re=await ie.json();await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+O,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const Ne=await(await fetch(`https://www.googleapis.com/drive/v3/files/${re.id}?fields=webViewLink,webContentLink`,{headers:{Authorization:"Bearer "+O}})).json();return Ne.webViewLink||Ne.webContentLink}async function en(S){const $=new URLSearchParams;$.append("client_id",S.client_id),$.append("client_secret",S.client_secret),$.append("refresh_token",S.refresh_token),$.append("grant_type","refresh_token");const O=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.toString()});if(!O.ok)throw new Error("Failed to get Google access token");return(await O.json()).access_token}function Pe(){var ie;const S=localStorage.getItem("skygit_token"),$=Ae(St),O=((ie=$==null?void 0:$.user)==null?void 0:ie.login)||null,z=a(i)?a(i).repo:null,q=window.skygitSessionId;S&&O&&z&&q&&fetch("/api/deletePresenceComment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:S,repoFullName:z,username:O,sessionId:q})})}window.skygitSessionId=crypto.randomUUID(),window.addEventListener("beforeunload",Pe),ft(()=>(a(te),a(l)),()=>{a(te)&&a(l)&&ye(te,a(te).srcObject=a(l))}),ft(()=>(a(W),a(f)),()=>{a(W)&&a(f)&&ye(W,a(W).srcObject=a(f))}),ft(()=>(a(C),a(v)),()=>{a(C)&&a(v)&&ye(C,a(C).srcObject=a(v))}),or(),Ze(),Wr(e,{children:(S,$)=>{var O=xe(),z=fe(O);{var q=re=>{var le=xe(),Ne=fe(le);{var lt=Vt=>{var tn=ff(),hn=g(tn),Nn=p(g(hn),4),ur=p(Nn,2),fr=g(ur),_n=p(fr,2);Y(()=>Dt(Nn,"href",a(Xe))),F("click",fr,()=>m(he,!1)),F("click",_n,async()=>{await _e(a(i).repo)}),y(Vt,tn)},Me=Vt=>{var tn=Tf(),hn=g(tn),Nn=g(hn),ur=g(Nn),fr=g(ur),_n=p(ur,2),Ga=g(_n),Ua=p(_n,2),za=g(Ua),qs=p(Nn,2),Ja=g(qs),qa=p(qs,2),Vs=g(qa);{var Va=ve=>{var De=xe(),mt=fe(De);Nt(mt,1,()=>a(i).participants,Ke=>Ke,(Ke,we)=>{var Le=xe(),ze=fe(Le);{var Mn=ct=>{var bt=df();y(ct,bt)},yn=ct=>{var bt=xe(),Qr=fe(bt);{var Yr=Ht=>{var nn=xe(),Ln=fe(nn);{var mn=Fe=>{var ut=vf(),Fn=p(g(ut));Y(()=>B(Fn,` ${a(we)??""}`)),y(Fe,ut)},wt=Fe=>{var ut=pf(),Fn=p(g(ut));Y(()=>B(Fn,` ${a(we)??""}`)),y(Fe,ut)};I(Ln,Fe=>{s()[a(we)].status==="connected"?Fe(mn):Fe(wt,!1)})}y(Ht,nn)},Zr=(Ht,nn)=>{{var Ln=wt=>{var Fe=gf(),ut=p(g(Fe));Y(()=>B(ut,` ${a(we)??""}`)),y(wt,Fe)},mn=wt=>{var Fe=hf(),ut=p(g(Fe));Y(()=>B(ut,` ${a(we)??""}`)),y(wt,Fe)};I(Ht,wt=>{o().find(Fe=>Fe.username===a(we))?wt(Ln):wt(mn,!1)},nn)}};I(Qr,Ht=>{s()[a(we)]?Ht(Yr):Ht(Zr,!1)})}y(ct,bt)};I(ze,ct=>{a(we)===Ae(St).user.login?ct(Mn):ct(yn,!1)})}y(Ke,Le)}),y(ve,De)};I(Vs,ve=>{a(i).participants&&ve(Va)})}var Ha=p(Vs,2);{var Ba=ve=>{var De=_f();F("click",De,je),y(ve,De)};I(Ha,ve=>{a(c)&&ve(Ba)})}var Hs=p(hn,2);{var Wa=ve=>{var De=Ef(),mt=fe(De),Ke=g(mt),we=p(g(Ke),2);we.muted=!0,Vn(we,A=>m(te,A),()=>a(te));var Le=p(we,2),ze=g(Le),Mn=g(ze);{var yn=A=>{var G=Ge("ðŸŽ¤ Mic On");y(A,G)},ct=A=>{var G=Ge("ðŸ”‡ Mic Off");y(A,G)};I(Mn,A=>{a(w)?A(yn):A(ct,!1)})}var bt=p(ze,2),Qr=g(bt);{var Yr=A=>{var G=Ge("ðŸ“· Cam On");y(A,G)},Zr=A=>{var G=Ge("ðŸš«ðŸ“· Cam Off");y(A,G)};I(Qr,A=>{a(k)?A(Yr):A(Zr,!1)})}var Ht=p(Ke,2),nn=p(g(Ht),2);Vn(nn,A=>m(W,A),()=>a(W));var Ln=p(nn,2),mn=g(Ln),wt=g(mn);{var Fe=A=>{var G=Ge("ðŸŽ¤ Mic On");y(A,G)},ut=A=>{var G=Ge("ðŸ”‡ Mic Off");y(A,G)};I(wt,A=>{a(E)?A(Fe):A(ut,!1)})}var Fn=p(mn,2),ti=g(Fn);{var ni=A=>{var G=Ge("ðŸ“· Cam On");y(A,G)},ri=A=>{var G=Ge("ðŸš«ðŸ“· Cam Off");y(A,G)};I(ti,A=>{a(T)?A(ni):A(ri,!1)})}var Ys=p(mt,2);{var si=A=>{var G=yf(),xi=g(G),Si=p(g(xi));{var ki=ts=>{var pr=Ge("(with audio)");y(ts,pr)};I(Si,ts=>{var pr;(pr=a(b))!=null&&pr.audio&&ts(ki)})}y(A,G)};I(Ys,A=>{a(h)&&A(si)})}var Zs=p(Ys,2),Xs=g(Zs),oi=p(g(Xs)),Xr=p(Xs,2),ai=g(Xr);{var ii=A=>{var G=Ge("ðŸ›‘ Stop Sharing");y(A,G)},li=A=>{var G=Ge("ðŸ–¥ï¸ Share Screen");y(A,G)};I(ai,A=>{a(u)?A(ii):A(li,!1)})}var eo=p(Xr,2);{var ci=A=>{var G=mf();F("click",G,zt),y(A,G)};I(eo,A=>{a(u)&&A(ci)})}var dr=p(eo,2),ui=g(dr);{var fi=A=>{var G=bf();y(A,G)},di=A=>{var G=wf();y(A,G)};I(ui,A=>{a(w)?A(fi):A(di,!1)})}var vr=p(dr,2),vi=g(vr);{var pi=A=>{var G=xf();y(A,G)},gi=A=>{var G=Sf();y(A,G)};I(vi,A=>{a(k)?A(pi):A(gi,!1)})}var es=p(vr,2),hi=g(es);{var _i=A=>{var G=kf();y(A,G)},yi=A=>{var G=Cf();y(A,G)};I(hi,A=>{a(D)?A(_i):A(yi,!1)})}var to=p(Zs,2);{var mi=A=>{var G=$f();y(A,G)};I(to,A=>{a(D)&&A(mi)})}var bi=p(to,2);{var wi=A=>{var G=Pf();y(A,G)};I(bi,A=>{a(M)&&A(wi)})}Y(()=>{Dt(dr,"title",a(w)?"Mute Mic":"Unmute Mic"),Dt(vr,"title",a(k)?"Turn Off Camera":"Turn On Camera"),Dt(es,"title",a(D)?"Stop Recording":"Start Recording")}),F("change",oi,ht),F("click",Xr,function(...A){var G;(G=a(u)?_t:j)==null||G.apply(this,A)}),F("click",dr,ge),F("click",vr,ke),F("click",es,function(...A){var G;(G=a(D)?At:qt)==null||G.apply(this,A)}),y(ve,De)};I(Hs,ve=>{a(c)&&ve(Wa)})}var Bs=p(Hs,2);{var Ka=ve=>{var De=xe(),mt=fe(De);{var Ke=Le=>{var ze=Af(),Mn=g(ze),yn=g(Mn),ct=p(yn,4);ct.muted=!0,Vn(ct,bt=>m(C,bt),()=>a(C)),Vn(ze,bt=>m(Re,bt),()=>a(Re)),Y(()=>pa(ze,`left: ${a(X).x??""}px; top: ${a(X).y??""}px; min-width: 180px; min-height: 120px; user-select: none;`)),F("click",yn,Kl(ae)),F("mousedown",ze,ee),y(Le,ze)},we=Le=>{var ze=Rf();F("click",ze,Ce),y(Le,ze)};I(mt,Le=>{a(R)?Le(Ke):Le(we,!1)})}y(ve,De)};I(Bs,ve=>{a(u)&&a(v)&&ve(Ka)})}var Ws=p(Bs,2);{var Qa=ve=>{var De=Of(),mt=g(De),Ke=p(g(mt),2),we=p(Ke,2),Le=p(we,2),ze=p(Le,2);F("click",Ke,()=>Z("screen")),F("click",we,()=>Z("window")),F("click",Le,()=>Z("tab")),F("click",ze,H),y(ve,De)};I(Ws,ve=>{a(x)&&ve(Qa)})}var Ks=p(Ws,2);{var Ya=ve=>{var De=Df(),mt=g(De),Ke=p(g(mt),2),we=p(Ke,2),Le=p(we,2);F("click",Ke,()=>{m(Se,"google_drive")}),F("click",we,()=>{m(Se,"s3")}),F("click",Le,U),y(ve,De)};I(Ks,ve=>{a(J)&&ve(Ya)})}var Qs=p(Ks,2),Za=g(Qs);Vu(Za,{get conversation(){return a(i)}});var Xa=p(Qs,2),ei=g(Xa);uf(ei,{get conversation(){return a(i)}}),Y(()=>{var ve;B(fr,a(i).title),Dt(_n,"title",a(L)?"Pause presence polling":"Start presence polling"),B(Ga,a(L)?"â¸ Pause Presence":"â–¶ Start Presence"),B(za,a(i).repo),B(Ja,`${((ve=a(i).participants)==null?void 0:ve.length)??0} participants`)}),F("click",_n,Q),y(Vt,tn)};I(Ne,Vt=>{a(he)?Vt(lt):Vt(Me,!1)})}y(re,le)},ie=re=>{var le=If();y(re,le)};I(z,re=>{a(i)?re(q):re(ie,!1)})}y(S,O)},$$slots:{default:!0}}),We(),r()}var Nf=P('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"><div class="bg-white p-4 rounded shadow-md w-96"><h2 class="text-lg font-semibold mb-2">New Conversation</h2> <input placeholder="Conversation title" class="w-full border px-3 py-2 rounded mb-4"> <div class="flex justify-end gap-2"><button class="bg-gray-200 px-3 py-1 rounded">Cancel</button> <button class="bg-blue-600 text-white px-3 py-1 rounded">Create</button></div></div></div>');function Mf(e,t){Be(t,!1);const n=tc();let r=N("");function s(){if(!a(r).trim()){alert("Title is required.");return}n("create",{title:a(r).trim()}),m(r,"")}function o(){n("cancel")}Ze();var i=Nf(),c=g(i),l=p(g(c),2),f=p(l,2),d=g(f),u=p(d,2);tt(l,()=>a(r),v=>m(r,v)),F("click",d,o),F("click",u,s),y(e,i),We()}var Lf=P('<span class="text-green-700 font-semibold">âœ… Enabled</span>'),Ff=P("<span> </span>"),Gf=P('<span class="text-red-600 font-semibold">Disabled</span> <button class="ml-2 text-xs text-blue-600 underline">Enable Discussions</button> <button class="ml-2 text-xs text-gray-500 underline">Refresh</button> <!> <div class="text-xs text-gray-500 mt-2">To enable messaging, activate Discussions in your GitHub repo settings. After enabling, click Refresh.</div>',1),Uf=da('<svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg> Activating...',1),zf=P('<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded flex items-center gap-2"><!></button>'),Jf=P('<div class="mt-6 text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm opacity-50 cursor-not-allowed" disabled>ðŸ’¬ New Conversation (Enable Discussions first)</button></div>'),qf=P("<option> </option>"),Vf=P('<div class="mt-6 border-t pt-4 space-y-3"><h3 class="text-lg font-semibold text-gray-800">ðŸ› ï¸ Messaging Config</h3> <div class="grid gap-2 text-sm text-gray-700"><label>Commit frequency (min): <input type="number" class="w-full border px-2 py-1 rounded"></label> <label>Binary storage type: <select class="w-full border px-2 py-1 rounded"><option>gitfs</option><option>s3</option><option>google_drive</option></select></label> <label>Storage URL: <select class="w-full border px-2 py-1 rounded"><option disabled>â€” Select a credential â€”</option><!></select></label></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¾ Save Configuration</button></div> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">ðŸ’¬ New Conversation</button> <!>',1),Hf=P('<div class="p-6 space-y-4 bg-white shadow rounded max-w-3xl mx-auto mt-6"><h2 class="text-2xl font-semibold text-blue-700"> </h2> <div class="text-sm text-gray-700 space-y-1"><div><strong>Name:</strong> </div> <div><strong>Owner:</strong> </div> <div><strong>GitHub:</strong> <a target="_blank" class="text-blue-600 underline hover:text-blue-800"> </a></div> <div><strong>Visibility:</strong> </div> <div><strong>Messaging:</strong> </div> <div><strong>Discussions:</strong> <!></div></div> <!> <!></div>'),Bf=P('<p class="text-gray-400 italic text-center mt-20">Select a repository from the sidebar to view its details.</p>');function Wf(e,t){Be(t,!1);let n=N([]),r=N(),s=N(!1),o=N(!1),i=N(""),c;Or.subscribe(h=>m(r,h)),lr(async()=>{const h=localStorage.getItem("skygit_token");if(h)try{const{secrets:b}=await Ns(h),x=Object.keys(b),R=[];for(const w of x)try{const k=await Is(h,b[w]);R.push({url:w,...k})}catch(k){console.warn("Failed to decrypt",w,k)}m(n,R)}catch(b){console.warn("Could not load secrets",b)}});async function l(){const h=localStorage.getItem("skygit_token");if(!(!a(r)||!h)){m(s,!0);try{await dc(h,a(r)),ye(r,a(r).has_messages=!0),cr(async()=>{const{selectedRepo:b}=await Promise.resolve().then(()=>Aa);return{selectedRepo:b}},void 0).then(({selectedRepo:b})=>{b.set({...a(r)})})}catch(b){alert("Failed to activate messaging."),console.warn(b)}finally{m(s,!1)}}}async function f(){const h=localStorage.getItem("skygit_token");if(!(!h||!a(r)))try{await vc(h,a(r)),alert("âœ… Messaging config updated.");try{await pc(h,a(r))}catch(b){alert("âŒ Failed to store credential."),console.warn(b)}}catch(b){alert("âŒ Failed to update config."),console.warn(b)}}async function d(h){const b=h.detail.title,x=localStorage.getItem("skygit_token");console.log("[SkyGit] ðŸ§ª handleCreate() called with title:",b),await Ac(x,a(r),b),m(o,!1)}function u(){m(o,!1)}function v(){if(!a(r))return;const h=`https://github.com/${a(r).full_name}/settings/discussions`;window.open(h,"_blank")}async function _(){const h=localStorage.getItem("skygit_token");if(!h||!a(r))return;const b=await fetch(`https://api.github.com/repos/${a(r).full_name}`,{headers:{Authorization:`token ${h}`}});if(b.ok){const x=await b.json(),R=!a(r).has_discussions;ye(r,a(r).has_discussions=x.has_discussions),Or.set({...a(r)}),Pt.update(w=>w.map(k=>k.full_name===a(r).full_name?{...a(r)}:k)),await ml(),R&&a(r).has_discussions?m(i,"âœ… Discussions enabled! You can now use messaging."):a(r).has_discussions?m(i,""):m(i,"âŒ Discussions are still disabled."),clearTimeout(c),c=setTimeout(()=>{m(i,"")},4e3)}}Ze(),Wr(e,{children:(h,b)=>{var x=xe(),R=fe(x);{var w=E=>{var T=Hf(),D=g(T),M=g(D),L=p(D,2),K=g(L),oe=p(g(K)),V=p(K,2),X=p(g(V)),pe=p(V,2),be=p(g(pe),2),Re=g(be),Se=p(pe,2),J=p(g(Se)),te=p(Se,2),W=p(g(te)),C=p(te,2),j=p(g(C),2);{var H=U=>{var Q=Lf();y(U,Q)},Z=U=>{var Q=Gf(),$e=p(fe(Q),2),he=p($e,2),Xe=p(he,2);{var _e=je=>{var ht=Ff();let Ut;var _t=g(ht);Y(zt=>{Ut=Pn(ht,1,"ml-2 text-xs font-semibold",null,Ut,zt),B(_t,a(i))},[()=>({"text-green-700":a(i).startsWith("âœ…"),"text-red-600":a(i).startsWith("âŒ")})],pt),y(je,ht)};I(Xe,je=>{a(i)&&je(_e)})}F("click",$e,v),F("click",he,_),y(U,Q)};I(j,U=>{a(r).has_discussions?U(H):U(Z,!1)})}var ee=p(L,2);{var ne=U=>{var Q=zf(),$e=g(Q);{var he=_e=>{var je=Uf();y(_e,je)},Xe=_e=>{var je=Ge("ðŸ’¬ Activate Messaging");y(_e,je)};I($e,_e=>{a(s)?_e(he):_e(Xe,!1)})}Y(()=>Q.disabled=a(s)),F("click",Q,l),y(U,Q)};I(ee,U=>{a(r).has_messages||U(ne)})}var ce=p(ee,2);{var ae=U=>{var Q=Jf();y(U,Q)},Ce=(U,Q)=>{{var $e=he=>{var Xe=Vf(),_e=fe(Xe),je=p(g(_e),2),ht=g(je),Ut=p(g(ht)),_t=p(ht,2),zt=p(g(_t));Y(()=>{a(r),vs(()=>{})});var ge=g(zt);ge.value=(ge.__value="gitfs")==null?"":"gitfs";var ke=p(ge);ke.value=(ke.__value="s3")==null?"":"s3";var yt=p(ke);yt.value=(yt.__value="google_drive")==null?"":"google_drive";var Jt=p(_t,2),qt=p(g(Jt));Y(()=>{a(r),vs(()=>{a(n)})});var At=g(qt);At.value=((At.__value="")==null,"");var Oe=p(At);Nt(Oe,1,()=>a(n).filter(Pe=>Pe.type===a(r).config.binary_storage_type),tr,(Pe,S)=>{var $=qf(),O={},z=g($);Y(()=>{O!==(O=a(S).url)&&($.value=($.__value=a(S).url)==null?"":a(S).url),B(z,a(S).url)}),y(Pe,$)});var Ue=p(je,2),Rt=p(_e,2),Xt=p(Rt,2);{var en=Pe=>{Mf(Pe,{$$events:{create:d,cancel:u}})};I(Xt,Pe=>{a(o)&&Pe(en)})}tt(Ut,()=>a(r).config.commit_frequency_min,Pe=>ye(r,a(r).config.commit_frequency_min=Pe)),hs(zt,()=>a(r).config.binary_storage_type,Pe=>ye(r,a(r).config.binary_storage_type=Pe)),hs(qt,()=>a(r).config.storage_info.url,Pe=>ye(r,a(r).config.storage_info.url=Pe)),F("click",Ue,f),F("click",Rt,()=>m(o,!0)),y(he,Xe)};I(U,he=>{a(r).has_messages&&a(r).config&&he($e)},Q)}};I(ce,U=>{a(r).has_discussions?U(Ce,!1):U(ae)})}Y(()=>{B(M,a(r).full_name),B(oe,` ${a(r).name??""}`),B(X,` ${a(r).owner??""}`),Dt(be,"href",a(r).url),B(Re,a(r).url),B(J,` ${(a(r).private?"ðŸ”’ Private":"ðŸŒ Public")??""}`),B(W,` ${(a(r).has_messages?"ðŸ’¬ Available":"ðŸš« Not enabled")??""}`)}),y(E,T)},k=E=>{var T=Bf();y(E,T)};I(R,E=>{a(r)?E(w):E(k,!1)})}y(h,x)},$$slots:{default:!0}}),We()}var Kf=P('<p class="text-center mt-20">Loading...</p>');function Qf(e,t){Be(t,!1);const[n,r]=Hr(),s=()=>fn(at,"$currentRoute",n),o=()=>fn(Ie,"$syncState",n);let i=N(null),c=null,l=N("");St.subscribe(R=>{R.isLoggedIn||(at.set("login"),m(i,null),c=null)}),lr(()=>{const R=bc();R?f(R):at.set("login")});async function f(R){m(l,"");const w=await yc(R);if(!w){localStorage.removeItem("skygit_token"),m(l,"Invalid token. Please check your PAT and try again."),at.set("login");return}m(i,R),c=w,mc(R),St.set({isLoggedIn:!0,token:a(i),user:c}),await lc(a(i),c.login)?(at.set("home"),await v()):at.set("consent")}async function d(){await cc(a(i)),at.set("home"),await v()}function u(){localStorage.removeItem("skygit_token"),at.set("login")}async function v(){try{console.log("[SkyGit] Initializing app state..."),await Dc(a(i))}catch(R){console.warn("[SkyGit] Failed to initialize startup state:",R)}}window.addEventListener("beforeunload",R=>{(Ta()||Pa())&&(Dr(),nr(),R.preventDefault(),R.returnValue="")}),ft(()=>(s(),o(),a(i)),()=>{if(s()==="home"&&o().phase==="idle"&&!o().paused)try{bs(a(i))}catch(R){console.warn("[SkyGit] Repo discovery failed:",R)}}),or(),Ze();var _=xe(),h=fe(_);{var b=R=>{var w=Kf();y(R,w)},x=(R,w)=>{{var k=T=>{Lc(T,{onSubmit:f,get error(){return a(l)}})},E=(T,D)=>{{var M=K=>{Uc(K,{onApprove:d,onReject:u})},L=(K,oe)=>{{var V=pe=>{Uu(pe,{})},X=(pe,be)=>{{var Re=J=>{jf(J,{})},Se=(J,te)=>{{var W=j=>{Wf(j,{})},C=j=>{Eu(j)};I(J,j=>{s()==="repos"?j(W):j(C,!1)},te)}};I(pe,J=>{s()==="chats"?J(Re):J(Se,!1)},be)}};I(K,pe=>{s()==="settings"?pe(V):pe(X,!1)},oe)}};I(T,K=>{s()==="consent"?K(M):K(L,!1)},D)}};I(R,T=>{s()==="login"?T(k):T(E,!1)},w)}};I(h,R=>{s()==="loading"?R(b):R(x,!1)})}y(e,_),We(),r()}Dl(Qf,{target:document.getElementById("app")});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});"serviceWorker"in navigator&&navigator.serviceWorker.register("/skygit/sw.js",{scope:"/skygit/"});
